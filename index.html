<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="OXFORD POPULATION HEALTH">
<meta name="dcterms.date" content="2024-11-10">

<title>Fundamentals of Statistical Software &amp; Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(SKYBLUE1.jpeg);
background-size: cover;
      }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Fundamentals of Statistical Software &amp; Analysis</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">OXFORD POPULATION HEALTH </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              UNIVERSITY OF OXFORD MEDICAL SCIENCES DIVISION
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 10, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#course-dataset-1" id="toc-course-dataset-1" class="nav-link active" data-scroll-target="#course-dataset-1"><span class="header-section-number">1</span> Course Dataset 1</a></li>
  <li><a href="#course-dataset-2" id="toc-course-dataset-2" class="nav-link" data-scroll-target="#course-dataset-2"><span class="header-section-number">2</span> Course Dataset 2</a></li>
  <li><a href="#a1.1-what-is-statistics" id="toc-a1.1-what-is-statistics" class="nav-link" data-scroll-target="#a1.1-what-is-statistics"><span class="header-section-number">3</span> A1.1 What is Statistics?</a></li>
  <li><a href="#sec-A1.2" id="toc-sec-A1.2" class="nav-link" data-scroll-target="#sec-A1.2"><span class="header-section-number">4</span> A1.2: Introduction to R, SPSS and Stata</a></li>
  <li><a href="#load-dataset" id="toc-load-dataset" class="nav-link" data-scroll-target="#load-dataset"><span class="header-section-number">5</span> Load dataset</a></li>
  <li><a href="#sec-A1.3" id="toc-sec-A1.3" class="nav-link" data-scroll-target="#sec-A1.3"><span class="header-section-number">6</span> A1.3: Descriptive Statistics</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">6.1</span> Summary</a></li>
  <li><a href="#measures-of-central-tendency" id="toc-measures-of-central-tendency" class="nav-link" data-scroll-target="#measures-of-central-tendency"><span class="header-section-number">6.2</span> Measures of Central Tendency</a>
  <ul class="collapse">
  <li><a href="#a-mean" id="toc-a-mean" class="nav-link" data-scroll-target="#a-mean"><span class="header-section-number">6.2.1</span> a) Mean</a></li>
  <li><a href="#b-median" id="toc-b-median" class="nav-link" data-scroll-target="#b-median"><span class="header-section-number">6.2.2</span> b) Median</a></li>
  <li><a href="#c-mode" id="toc-c-mode" class="nav-link" data-scroll-target="#c-mode"><span class="header-section-number">6.2.3</span> c) Mode</a></li>
  <li><a href="#d-quantiles" id="toc-d-quantiles" class="nav-link" data-scroll-target="#d-quantiles"><span class="header-section-number">6.2.4</span> d) Quantiles</a></li>
  <li><a href="#e-iqr" id="toc-e-iqr" class="nav-link" data-scroll-target="#e-iqr"><span class="header-section-number">6.2.5</span> e) IQR</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise"><span class="header-section-number">6.2.6</span> Exercise</a></li>
  <li><a href="#f-range" id="toc-f-range" class="nav-link" data-scroll-target="#f-range"><span class="header-section-number">6.2.7</span> f) Range</a></li>
  <li><a href="#g-sd-and-variance" id="toc-g-sd-and-variance" class="nav-link" data-scroll-target="#g-sd-and-variance"><span class="header-section-number">6.2.8</span> g) SD and Variance</a></li>
  <li><a href="#bar-charts-and-histograms" id="toc-bar-charts-and-histograms" class="nav-link" data-scroll-target="#bar-charts-and-histograms"><span class="header-section-number">6.2.9</span> Bar charts and histograms</a></li>
  <li><a href="#histograms" id="toc-histograms" class="nav-link" data-scroll-target="#histograms"><span class="header-section-number">6.2.10</span> Histograms</a></li>
  <li><a href="#grouping-continuous-data" id="toc-grouping-continuous-data" class="nav-link" data-scroll-target="#grouping-continuous-data"><span class="header-section-number">6.2.11</span> Grouping Continuous Data</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#a1.4-estimates-and-confidence-intervals" id="toc-a1.4-estimates-and-confidence-intervals" class="nav-link" data-scroll-target="#a1.4-estimates-and-confidence-intervals"><span class="header-section-number">7</span> A1.4: Estimates and Confidence Intervals</a>
  <ul class="collapse">
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1"><span class="header-section-number">7.0.1</span> Exercise</a></li>
  <li><a href="#calculate-se" id="toc-calculate-se" class="nav-link" data-scroll-target="#calculate-se"><span class="header-section-number">7.0.2</span> Calculate SE</a></li>
  </ul></li>
  <li><a href="#confidence-interval" id="toc-confidence-interval" class="nav-link" data-scroll-target="#confidence-interval"><span class="header-section-number">8</span> 95% confidence interval</a>
  <ul class="collapse">
  <li><a href="#calculate-the-sample-size" id="toc-calculate-the-sample-size" class="nav-link" data-scroll-target="#calculate-the-sample-size"><span class="header-section-number">8.0.1</span> Calculate the Sample Size</a></li>
  <li><a href="#calculate-the-sd" id="toc-calculate-the-sd" class="nav-link" data-scroll-target="#calculate-the-sd"><span class="header-section-number">8.0.2</span> Calculate the SD</a></li>
  <li><a href="#calculate-the-se" id="toc-calculate-the-se" class="nav-link" data-scroll-target="#calculate-the-se"><span class="header-section-number">8.0.3</span> Calculate the SE</a></li>
  <li><a href="#calculate-the-mean-bmi" id="toc-calculate-the-mean-bmi" class="nav-link" data-scroll-target="#calculate-the-mean-bmi"><span class="header-section-number">8.0.4</span> Calculate the mean BMI</a></li>
  <li><a href="#calculate-the-se-1" id="toc-calculate-the-se-1" class="nav-link" data-scroll-target="#calculate-the-se-1"><span class="header-section-number">8.0.5</span> Calculate the SE</a></li>
  <li><a href="#calculate-99-ci-for-bmi" id="toc-calculate-99-ci-for-bmi" class="nav-link" data-scroll-target="#calculate-99-ci-for-bmi"><span class="header-section-number">8.0.6</span> Calculate 99% CI for BMI</a></li>
  </ul></li>
  <li><a href="#a1.5-hypothesis-testing" id="toc-a1.5-hypothesis-testing" class="nav-link" data-scroll-target="#a1.5-hypothesis-testing"><span class="header-section-number">9</span> A1.5: Hypothesis Testing</a></li>
  <li><a href="#a1.6-transforming-variables" id="toc-a1.6-transforming-variables" class="nav-link" data-scroll-target="#a1.6-transforming-variables"><span class="header-section-number">10</span> A1.6: Transforming Variables</a>
  <ul class="collapse">
  <li><a href="#custom-function-to-find-the-mode" id="toc-custom-function-to-find-the-mode" class="nav-link" data-scroll-target="#custom-function-to-find-the-mode"><span class="header-section-number">10.1</span> Custom function to find the mode</a></li>
  </ul></li>
  <li><a href="#sec-A2.1" id="toc-sec-A2.1" class="nav-link" data-scroll-target="#sec-A2.1"><span class="header-section-number">11</span> A2.1 Introduction to Power and Sample Size Calculation</a></li>
  <li><a href="#sec-A2.2" id="toc-sec-A2.2" class="nav-link" data-scroll-target="#sec-A2.2"><span class="header-section-number">12</span> A2.2 Power calculations for a difference in means</a>
  <ul class="collapse">
  <li><a href="#power-calculations-for-two-means" id="toc-power-calculations-for-two-means" class="nav-link" data-scroll-target="#power-calculations-for-two-means"><span class="header-section-number">12.1</span> Power calculations for two means</a>
  <ul class="collapse">
  <li><a href="#question-a2.2" id="toc-question-a2.2" class="nav-link" data-scroll-target="#question-a2.2"><span class="header-section-number">12.1.1</span> Question A2.2:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-A2.4" id="toc-sec-A2.4" class="nav-link" data-scroll-target="#sec-A2.4"><span class="header-section-number">13</span> A2.4 Sample Size Calculation for RCTs</a>
  <ul class="collapse">
  <li><a href="#estimating-sample-size-for-a-hypothesis-in-a-cross-sectional-study" id="toc-estimating-sample-size-for-a-hypothesis-in-a-cross-sectional-study" class="nav-link" data-scroll-target="#estimating-sample-size-for-a-hypothesis-in-a-cross-sectional-study"><span class="header-section-number">13.1</span> Estimating sample size for a hypothesis in a cross-sectional study</a></li>
  </ul></li>
  <li><a href="#sec-A2.5" id="toc-sec-A2.5" class="nav-link" data-scroll-target="#sec-A2.5"><span class="header-section-number">14</span> A2.5 Sample size calculations for cross-sectional studies (or surveys)</a></li>
  <li><a href="#sec-A2.6" id="toc-sec-A2.6" class="nav-link" data-scroll-target="#sec-A2.6"><span class="header-section-number">15</span> A2.6 Sample size calculations for case-control studies</a></li>
  <li><a href="#sec-B1.1" id="toc-sec-B1.1" class="nav-link" data-scroll-target="#sec-B1.1"><span class="header-section-number">16</span> B1.1: Correlation and Scatterplots</a>
  <ul class="collapse">
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2"><span class="header-section-number">16.0.1</span> Exercise</a></li>
  </ul></li>
  <li><a href="#sec-B1.2" id="toc-sec-B1.2" class="nav-link" data-scroll-target="#sec-B1.2"><span class="header-section-number">17</span> B1.2: Differences Between Means (ANOVA 1)</a></li>
  <li><a href="#sec-B1.3" id="toc-sec-B1.3" class="nav-link" data-scroll-target="#sec-B1.3"><span class="header-section-number">18</span> B1.3: Univariable Linear Regression</a>
  <ul class="collapse">
  <li><a href="#sec-B1.3a" id="toc-sec-B1.3a" class="nav-link" data-scroll-target="#sec-B1.3a"><span class="header-section-number">18.1</span> B1.3a: Linear regression with continuous exposure</a>
  <ul class="collapse">
  <li><a href="#question-1.3a" id="toc-question-1.3a" class="nav-link" data-scroll-target="#question-1.3a"><span class="header-section-number">18.1.1</span> Question 1.3a</a></li>
  </ul></li>
  <li><a href="#sec-B1.3b" id="toc-sec-B1.3b" class="nav-link" data-scroll-target="#sec-B1.3b"><span class="header-section-number">18.2</span> B1.3b: Linear regression with categorical exposure</a></li>
  </ul></li>
  <li><a href="#sec-B1.4" id="toc-sec-B1.4" class="nav-link" data-scroll-target="#sec-B1.4"><span class="header-section-number">19</span> BI.4: Multiple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#question-b1.4a" id="toc-question-b1.4a" class="nav-link" data-scroll-target="#question-b1.4a"><span class="header-section-number">19.1</span> Question B1.4a:</a></li>
  <li><a href="#working-example-1" id="toc-working-example-1" class="nav-link" data-scroll-target="#working-example-1"><span class="header-section-number">19.2</span> Working example 1</a></li>
  </ul></li>
  <li><a href="#sec-B1.5" id="toc-sec-B1.5" class="nav-link" data-scroll-target="#sec-B1.5"><span class="header-section-number">20</span> B1.5: Model Selection and F-Tests</a></li>
  <li><a href="#sec-B1.6" id="toc-sec-B1.6" class="nav-link" data-scroll-target="#sec-B1.6"><span class="header-section-number">21</span> B1.6: Regression Diagnostics</a>
  <ul class="collapse">
  <li><a href="#checking-normality-of-residuals" id="toc-checking-normality-of-residuals" class="nav-link" data-scroll-target="#checking-normality-of-residuals"><span class="header-section-number">21.1</span> Checking Normality of Residuals</a></li>
  <li><a href="#checking-homoscedasticity" id="toc-checking-homoscedasticity" class="nav-link" data-scroll-target="#checking-homoscedasticity"><span class="header-section-number">21.2</span> Checking Homoscedasticity</a>
  <ul class="collapse">
  <li><a href="#question-b1.6" id="toc-question-b1.6" class="nav-link" data-scroll-target="#question-b1.6"><span class="header-section-number">21.2.1</span> Question B1.6:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-B2.1" id="toc-sec-B2.1" class="nav-link" data-scroll-target="#sec-B2.1"><span class="header-section-number">22</span> B2.1: ANOVA Revisited- Post-Hoc Testing</a>
  <ul class="collapse">
  <li><a href="#question-b2.1" id="toc-question-b2.1" class="nav-link" data-scroll-target="#question-b2.1"><span class="header-section-number">22.1</span> Question B2.1:</a></li>
  </ul></li>
  <li><a href="#sec-B2.2a" id="toc-sec-B2.2a" class="nav-link" data-scroll-target="#sec-B2.2a"><span class="header-section-number">23</span> B2.2a: Correcting For Multiple Comparisons</a>
  <ul class="collapse">
  <li><a href="#false-discovery-rate" id="toc-false-discovery-rate" class="nav-link" data-scroll-target="#false-discovery-rate"><span class="header-section-number">23.1</span> False Discovery Rate</a></li>
  </ul></li>
  <li><a href="#sec-B2.3" id="toc-sec-B2.3" class="nav-link" data-scroll-target="#sec-B2.3"><span class="header-section-number">24</span> B2.3 Two-way ANOVA</a></li>
  <li><a href="#sec-B2.4" id="toc-sec-B2.4" class="nav-link" data-scroll-target="#sec-B2.4"><span class="header-section-number">25</span> B2.4 Repeated Measures and the Paired T-Test</a></li>
  <li><a href="#sec-B2.5" id="toc-sec-B2.5" class="nav-link" data-scroll-target="#sec-B2.5"><span class="header-section-number">26</span> B2.5 Repeated Measures ANOVA</a></li>
  <li><a href="#sec-B3.1" id="toc-sec-B3.1" class="nav-link" data-scroll-target="#sec-B3.1"><span class="header-section-number">27</span> B3.1 The Parametric Assumptions</a>
  <ul class="collapse">
  <li><a href="#question-b3.1b" id="toc-question-b3.1b" class="nav-link" data-scroll-target="#question-b3.1b"><span class="header-section-number">27.0.1</span> Question B3.1b:</a></li>
  </ul></li>
  <li><a href="#sec-B3.2" id="toc-sec-B3.2" class="nav-link" data-scroll-target="#sec-B3.2"><span class="header-section-number">28</span> B3.2 Mann-Whitney U Test</a>
  <ul class="collapse">
  <li><a href="#question-b3.2" id="toc-question-b3.2" class="nav-link" data-scroll-target="#question-b3.2"><span class="header-section-number">28.0.1</span> Question B3.2:</a></li>
  </ul></li>
  <li><a href="#sec-B3.3" id="toc-sec-B3.3" class="nav-link" data-scroll-target="#sec-B3.3"><span class="header-section-number">29</span> B3.3 Kruskal-Wallis Test</a>
  <ul class="collapse">
  <li><a href="#question-b3.3" id="toc-question-b3.3" class="nav-link" data-scroll-target="#question-b3.3"><span class="header-section-number">29.0.1</span> Question B3.3:</a></li>
  </ul></li>
  <li><a href="#sec-B3.4" id="toc-sec-B3.4" class="nav-link" data-scroll-target="#sec-B3.4"><span class="header-section-number">30</span> B3.4 Wilcoxon Signed Rank Test</a>
  <ul class="collapse">
  <li><a href="#question-b3.4" id="toc-question-b3.4" class="nav-link" data-scroll-target="#question-b3.4"><span class="header-section-number">30.0.1</span> Question B3.4:</a></li>
  </ul></li>
  <li><a href="#sec-B3.5" id="toc-sec-B3.5" class="nav-link" data-scroll-target="#sec-B3.5"><span class="header-section-number">31</span> B3.5 Friedman Test</a></li>
  <li><a href="#sec-B3.6" id="toc-sec-B3.6" class="nav-link" data-scroll-target="#sec-B3.6"><span class="header-section-number">32</span> B3.6 Spearman’s Rank Order Correlation</a>
  <ul class="collapse">
  <li><a href="#question-b3.6" id="toc-question-b3.6" class="nav-link" data-scroll-target="#question-b3.6"><span class="header-section-number">32.0.1</span> Question B3.6:</a></li>
  </ul></li>
  <li><a href="#c1-binary-data-and-logistic-regression" id="toc-c1-binary-data-and-logistic-regression" class="nav-link" data-scroll-target="#c1-binary-data-and-logistic-regression"><span class="header-section-number">33</span> C1: Binary Data and Logistic Regression</a>
  <ul class="collapse">
  <li><a href="#sec-C1.1" id="toc-sec-C1.1" class="nav-link" data-scroll-target="#sec-C1.1"><span class="header-section-number">33.1</span> C1.1 Introduction to Prevalence, Risk, Odds and Rates</a>
  <ul class="collapse">
  <li><a href="#risk" id="toc-risk" class="nav-link" data-scroll-target="#risk"><span class="header-section-number">33.1.1</span> Risk</a></li>
  <li><a href="#odds" id="toc-odds" class="nav-link" data-scroll-target="#odds"><span class="header-section-number">33.1.2</span> Odds</a></li>
  <li><a href="#rates" id="toc-rates" class="nav-link" data-scroll-target="#rates"><span class="header-section-number">33.1.3</span> Rates</a></li>
  <li><a href="#question-c1.1a.i" id="toc-question-c1.1a.i" class="nav-link" data-scroll-target="#question-c1.1a.i"><span class="header-section-number">33.1.4</span> Question C1.1a.i:</a></li>
  <li><a href="#question-c1.1a.ii" id="toc-question-c1.1a.ii" class="nav-link" data-scroll-target="#question-c1.1a.ii"><span class="header-section-number">33.1.5</span> Question C1.1a.ii:</a></li>
  <li><a href="#question-c1.1b.i" id="toc-question-c1.1b.i" class="nav-link" data-scroll-target="#question-c1.1b.i"><span class="header-section-number">33.1.6</span> Question C1.1b.i:</a></li>
  <li><a href="#question-c1.1b.ii" id="toc-question-c1.1b.ii" class="nav-link" data-scroll-target="#question-c1.1b.ii"><span class="header-section-number">33.1.7</span> Question C1.1b.ii:</a></li>
  </ul></li>
  <li><a href="#sec-C1.2" id="toc-sec-C1.2" class="nav-link" data-scroll-target="#sec-C1.2"><span class="header-section-number">33.2</span> C1.2 The Chi-Square Test and the Test For Trend</a>
  <ul class="collapse">
  <li><a href="#x2-contingency-tables" id="toc-x2-contingency-tables" class="nav-link" data-scroll-target="#x2-contingency-tables"><span class="header-section-number">33.2.1</span> 2x2 Contingency Tables</a></li>
  <li><a href="#chi-square-test" id="toc-chi-square-test" class="nav-link" data-scroll-target="#chi-square-test"><span class="header-section-number">33.2.2</span> Chi-Square Test</a></li>
  </ul></li>
  <li><a href="#sec-linear" id="toc-sec-linear" class="nav-link" data-scroll-target="#sec-linear"><span class="header-section-number">33.3</span> Test for Linear Trend</a></li>
  <li><a href="#sec-C1.3" id="toc-sec-C1.3" class="nav-link" data-scroll-target="#sec-C1.3"><span class="header-section-number">33.4</span> C1.3 Univariable Logistic Regression</a>
  <ul class="collapse">
  <li><a href="#logistic-regression-models-for-binary-exposure" id="toc-logistic-regression-models-for-binary-exposure" class="nav-link" data-scroll-target="#logistic-regression-models-for-binary-exposure"><span class="header-section-number">33.4.1</span> Logistic Regression Models for Binary Exposure</a></li>
  <li><a href="#logistic-regression-with-a-categorical-exposure" id="toc-logistic-regression-with-a-categorical-exposure" class="nav-link" data-scroll-target="#logistic-regression-with-a-categorical-exposure"><span class="header-section-number">33.4.2</span> Logistic regression with a categorical exposure</a></li>
  <li><a href="#logistic-regression-with-an-ordered-categorical-exposure" id="toc-logistic-regression-with-an-ordered-categorical-exposure" class="nav-link" data-scroll-target="#logistic-regression-with-an-ordered-categorical-exposure"><span class="header-section-number">33.4.3</span> Logistic regression with an ordered categorical exposure</a></li>
  <li><a href="#logistic-regression-with-a-continuous-exposure" id="toc-logistic-regression-with-a-continuous-exposure" class="nav-link" data-scroll-target="#logistic-regression-with-a-continuous-exposure"><span class="header-section-number">33.4.4</span> Logistic regression with a continuous exposure</a></li>
  </ul></li>
  <li><a href="#sec-C1.4" id="toc-sec-C1.4" class="nav-link" data-scroll-target="#sec-C1.4"><span class="header-section-number">33.5</span> C1.4 Multivariable Logistic Regression</a>
  <ul class="collapse">
  <li><a href="#controlling-for-confounding-in-logistic-regression-models" id="toc-controlling-for-confounding-in-logistic-regression-models" class="nav-link" data-scroll-target="#controlling-for-confounding-in-logistic-regression-models"><span class="header-section-number">33.5.1</span> Controlling for Confounding in Logistic Regression Models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#c2-survival-data" id="toc-c2-survival-data" class="nav-link" data-scroll-target="#c2-survival-data"><span class="header-section-number">34</span> C2: Survival Data</a>
  <ul class="collapse">
  <li><a href="#sec-C2.1" id="toc-sec-C2.1" class="nav-link" data-scroll-target="#sec-C2.1"><span class="header-section-number">34.1</span> C2.1 Introduction to Survival Data</a>
  <ul class="collapse">
  <li><a href="#characteristics-of-survival-data" id="toc-characteristics-of-survival-data" class="nav-link" data-scroll-target="#characteristics-of-survival-data"><span class="header-section-number">34.1.1</span> Characteristics of Survival Data</a></li>
  <li><a href="#defining-time-to-event" id="toc-defining-time-to-event" class="nav-link" data-scroll-target="#defining-time-to-event"><span class="header-section-number">34.1.2</span> Defining time-to event</a></li>
  <li><a href="#censoring" id="toc-censoring" class="nav-link" data-scroll-target="#censoring"><span class="header-section-number">34.1.3</span> Censoring</a></li>
  <li><a href="#possible-observations-of-an-individual-being-followed-up-for-time-to-event" id="toc-possible-observations-of-an-individual-being-followed-up-for-time-to-event" class="nav-link" data-scroll-target="#possible-observations-of-an-individual-being-followed-up-for-time-to-event"><span class="header-section-number">34.1.4</span> Possible Observations of an individual being followed up for time-to-event</a></li>
  <li><a href="#how-censoring-may-arise" id="toc-how-censoring-may-arise" class="nav-link" data-scroll-target="#how-censoring-may-arise"><span class="header-section-number">34.1.5</span> How Censoring may arise</a></li>
  <li><a href="#survival-and-hazard-functions" id="toc-survival-and-hazard-functions" class="nav-link" data-scroll-target="#survival-and-hazard-functions"><span class="header-section-number">34.1.6</span> Survival and Hazard functions</a></li>
  <li><a href="#why-we-estimate-the-survival-function" id="toc-why-we-estimate-the-survival-function" class="nav-link" data-scroll-target="#why-we-estimate-the-survival-function"><span class="header-section-number">34.1.7</span> Why we estimate the Survival function ?</a></li>
  <li><a href="#question-c2.1a" id="toc-question-c2.1a" class="nav-link" data-scroll-target="#question-c2.1a"><span class="header-section-number">34.1.8</span> Question C2.1a:</a></li>
  </ul></li>
  <li><a href="#sec-C2.2" id="toc-sec-C2.2" class="nav-link" data-scroll-target="#sec-C2.2"><span class="header-section-number">34.2</span> C2.2 Kaplan-Meier Survival Function &amp; the Log Rank Test</a>
  <ul class="collapse">
  <li><a href="#sec-C2.2.1" id="toc-sec-C2.2.1" class="nav-link" data-scroll-target="#sec-C2.2.1"><span class="header-section-number">34.2.1</span> C2.2.1 Kaplan-Meier Survival Function</a></li>
  <li><a href="#confidence-interval-for-survival-function" id="toc-confidence-interval-for-survival-function" class="nav-link" data-scroll-target="#confidence-interval-for-survival-function"><span class="header-section-number">34.2.2</span> Confidence Interval for Survival function</a></li>
  </ul></li>
  <li><a href="#c2.3-cox-proportional-hazards-regression" id="toc-c2.3-cox-proportional-hazards-regression" class="nav-link" data-scroll-target="#c2.3-cox-proportional-hazards-regression"><span class="header-section-number">34.3</span> C2.3 Cox Proportional Hazards Regression</a>
  <ul class="collapse">
  <li><a href="#cox-model-cox-1972" id="toc-cox-model-cox-1972" class="nav-link" data-scroll-target="#cox-model-cox-1972"><span class="header-section-number">34.3.1</span> Cox Model (Cox 1972)</a></li>
  <li><a href="#test-the-proportional-hazards-assumption-pha" id="toc-test-the-proportional-hazards-assumption-pha" class="nav-link" data-scroll-target="#test-the-proportional-hazards-assumption-pha"><span class="header-section-number">34.3.2</span> Test the Proportional Hazards Assumption (PHA)</a></li>
  </ul></li>
  <li><a href="#c2.4-poisson-regression" id="toc-c2.4-poisson-regression" class="nav-link" data-scroll-target="#c2.4-poisson-regression"><span class="header-section-number">34.4</span> C2.4 Poisson Regression</a></li>
  </ul></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference"><span class="header-section-number">35</span> Reference</a></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><img src="images%20(10).jpeg" class="img-fluid"></p>
<p><strong>Welcome to <u>Fundamentals of Statistical Software and Analysis</u>, or FoSSA for short!</strong> The course comprises of 7 modules:</p>
<p><strong>A1</strong>: Introduction to Statistics using R, Stata &amp; SPSS</p>
<p><strong>A2</strong>: Power and Sample Size Calculations</p>
<p><strong>B1</strong>: Linear Regression</p>
<p><strong>B2</strong>: Multiple Comparisons and Repeated Measures</p>
<p><strong>B3</strong>: Non-Parametric Measures</p>
<p><strong>C1</strong>: Binary Data and Logistic Regression</p>
<p><strong>C2</strong>: Survival Data</p>
<p>Each module contains short videos to introduce and explain the statistical concepts and tests, along with practical exercises to work through.</p>
<p>The practicals are provided in three different statistical software packages, Stata, R, and SPSS. You can follow through the course using any one of these three packages. If you are unsure which package you would like to use, you may want to work through the introductions to each of them in Module A1 before making your decision.</p>
<p><u><strong>End of Module Quiz</strong></u> At the end of each module there is a short multiple choice quiz. If you wish to receive a certificate for the course you must visit every page and complete all of the quizzes with an average (mean) mark of 50% or greater. The FoSSA admin team will check quiz completions on a monthly basis and send certificates to any new completers.</p>
<p><u><strong>Proceeding through the Course</strong></u> You should study all of Module A1 before moving on to the other modules to make sure you have a firm grasp of the key concepts. Before you start on the first module, take a look at the Course Information section. Here you will find the data sets you will need for your practicals and other useful information to support you in your studies.</p>
<section id="course-dataset-1" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Course Dataset 1</h1>
<p>The Whitehall FoSSA Study is a simulated cohort study similar to the original Whitehall Study of Civil Servants, set up in the 1960s, which followed London-based male civil servants with a view to investigating cardiovascular disease and mortality. Participants from the original Whitehall cohort in the 1960s were flagged for mortality at the Office for National Statistics, which provided the date and cause of all deaths occurring until the end of September 2005. The (simulated) Whitehall FoSSA Study was conducted in 1997 to assess risk factors for cardiac and all-cause mortality in a subset of the original cohort that was still being followed. The Whitehall FoSSA Study contains information on 4,327 individuals that were followed-up from 1997 until 2005, and the variables are summarised in the table below. See Clarke et al.&nbsp;(2007), Arch Intern Med, 167(13) for more details on the real data that inspired this dataset.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
<th>Type of measure</th>
<th>Coding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>whl1_id</td>
<td>Participant ID number</td>
<td>Continuous</td>
<td></td>
</tr>
<tr class="even">
<td>age_grp</td>
<td>Age group (years)</td>
<td>Categorical</td>
<td>1=60-70; 2=71-75; 3=76-80; 4=81-95</td>
</tr>
<tr class="odd">
<td>prior_cvd</td>
<td>Prior CVD</td>
<td>Binary</td>
<td>0=No; 1=Yes</td>
</tr>
<tr class="even">
<td>prior_t2dm</td>
<td>Prior Type 2 Diabetes</td>
<td>Binary</td>
<td>0=No; 1=Yes</td>
</tr>
<tr class="odd">
<td>prior_cancer</td>
<td>Prior Cancer</td>
<td>Binary</td>
<td>0=No; 1=Yes</td>
</tr>
<tr class="even">
<td>sbp</td>
<td>Systolic Blood Pressure (mmHg)</td>
<td>Continuous</td>
<td>86-230 mmHg</td>
</tr>
<tr class="odd">
<td>bmi</td>
<td>Body Mass Index (BMI; kg/m2)</td>
<td>Continuous</td>
<td>15-44 kg/m2</td>
</tr>
<tr class="even">
<td>bmi_grp4</td>
<td>BMI, grouped</td>
<td>Categorical</td>
<td>1=Underweight; 2=Normal; 3=Overweight; 4=Obese</td>
</tr>
<tr class="odd">
<td>hdlc</td>
<td>HDL cholesterol (mmol/L)</td>
<td>Continuous</td>
<td>0.5-3.07 mmol/L</td>
</tr>
<tr class="even">
<td>ldlc</td>
<td>LDL cholesterol (mmol/L)</td>
<td>Continuous</td>
<td>1.05-6.81 mmol/L</td>
</tr>
<tr class="odd">
<td>chol</td>
<td>Total cholesterol (mmol/L)</td>
<td>Continuous</td>
<td>2.24-10.77 mmol/L</td>
</tr>
<tr class="even">
<td>currsmoker</td>
<td>Current smoker</td>
<td>Binary</td>
<td>0= Not a current smoker, 1= Current smoker</td>
</tr>
<tr class="odd">
<td>frailty</td>
<td>Summary frailty score</td>
<td>Categorical</td>
<td>1= least frail quintile; 5= most frail quintile</td>
</tr>
<tr class="even">
<td>vitd</td>
<td>Vitamin D [25(OH)D]</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>nmol/L</td>
<td>Continuous</td>
<td>18.92-419.89 nmol/L</td>
<td></td>
</tr>
<tr class="even">
<td>cvd_death</td>
<td>Fatal CVD</td>
<td>Binary</td>
<td>0=No; 1=Yes</td>
</tr>
<tr class="odd">
<td>death</td>
<td>Death</td>
<td>Binary</td>
<td>0=No; 1=Yes</td>
</tr>
<tr class="even">
<td>fu_years</td>
<td>Years of follow-up</td>
<td>Continuous</td>
<td>0.03-8.5 years</td>
</tr>
</tbody>
</table>
<p>As this is simulated data, some of the associations you may find between variables are not real, nor do they reflect what the current science suggests about risk factors for cardiovascular disease and mortality. Please do not use this dataset for anything beyond the training material in this course.</p>
<p><strong>Stata Dataset</strong></p>
<p><a href="https://1drv.ms/u/s!AtvH6PgKXPEDgwP2lAgifbZkgIPY?e=aNbXz3" target="_blank">Whitehall_fossa.dta</a></p>
<p><strong>CSV Dataset</strong></p>
<p><a href="https://1drv.ms/u/s!AtvH6PgKXPEDgwJyVUbrcv6Mvhrs?e=tv5mtd" target="_blank">Whitehall_fossa(in).csv</a></p>
</section>
<section id="course-dataset-2" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Course Dataset 2</h1>
<p>The FoSSA Mouse dataset is a simulated set of health check data of a group of 60 mice throughout a fictional study. The data consist of weights in grams and body condition scores on a 5 point ordinal scale, each taken at three points throughout the trial.</p>
<p>Weights are quite self explanatory, but if you would like a frame of reference for the body condition scores (BCS) then you can see how these are assigned here- <a href="https://1drv.ms/b/s!AtvH6PgKXPEDgwS--ub-UbRhAYGa?e=qF1kL3" target="_blank">Body Condition Score Mice.pdf</a></p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
<th>Type of measure</th>
<th>Coding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Strain</td>
<td>Names of the three strains of mice in the trial, use for reference purposes</td>
<td>Categorical</td>
<td>Names</td>
</tr>
<tr class="even">
<td>Strain_group</td>
<td>Numerical groupings of the three mouse strains</td>
<td>Categorical</td>
<td></td>
</tr>
<tr class="odd">
<td>1= Wild type, 2= Cdkn1a knockout, 3= NRAS knockout</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Weight_baseline</td>
<td>Weight measured at the beginning of the study</td>
<td>Continuous</td>
<td>Value in grams</td>
</tr>
<tr class="odd">
<td>BCS_baseline</td>
<td>Body condition score assessed at the beginning of the study</td>
<td>Ordinal</td>
<td>1= lowest body condition (very underweight), 5= highest body condition (obese)</td>
</tr>
<tr class="even">
<td>Weight_mid</td>
<td>Weight measured at the mid point of the study</td>
<td>Continuous</td>
<td>Value in grams</td>
</tr>
<tr class="odd">
<td>BCS_mid</td>
<td>Body condition score assessed at the mid point of the study</td>
<td>Ordinal</td>
<td>1= lowest body condition (very underweight), 5= highest body condition (obese)</td>
</tr>
<tr class="even">
<td>Weight_end</td>
<td>Weight measured at the end of the study</td>
<td>Continuous</td>
<td>Value in grams</td>
</tr>
<tr class="odd">
<td>BCS_end</td>
<td>Body condition score assessed at the end of the study</td>
<td>Ordinal</td>
<td>1= lowest body condition (very underweight), 5= highest body condition (obese)</td>
</tr>
</tbody>
</table>
<p><strong>CSV Dataset</strong></p>
<p><a href="https://1drv.ms/u/s!AtvH6PgKXPEDgwAYD3AGm-u5pqz0?e=dKTNR6" target="_blank">FoSSA mouse data.csv</a></p>
<p><strong>Stata Dataset</strong></p>
<p><a href="https://1drv.ms/u/s!AtvH6PgKXPEDgwHxCHLZQsUdBIoP?e=wDNy3D" target="_blank">mouse_data.dta</a></p>
</section>
<section id="a1.1-what-is-statistics" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> A1.1 What is Statistics?</h1>
<p>This course uses three different options for statistical analysis software for the practical exercises. The next lesson <a href="#sec-A1.2" class="quarto-xref">Section&nbsp;4</a> is broken up into three subsections. You only need to complete the one for the software you are planning to use throughout the course. These sessions will help you to familiarise yourself with your chosen software, and set up the course datasets. After the initial set up, there will be one lesson for each topic, but then you will have the choice of which statistical software you would like to use for the practical.</p>
</section>
<section id="sec-A1.2" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> A1.2: Introduction to R, SPSS and Stata</h1>
<p><a href="https://thegraphcourses.org/courses/fossa/topics/a1-2-2b-introduction-to-r/" target="_blank">Click here</a> to go to the introduction to R</p>
<p><a href="https://thegraphcourses.org/courses/fossa/topics/a1-2-1a-introduction-to-stata/" target="_blank">Click here</a> to go to the introduction to Stata</p>
<p><a href="https://thegraphcourses.org/courses/fossa/topics/a1-2-2c-introduction-to-spss/">Click here</a> to go to the introduction to SPSS</p>
</section>
<section id="load-dataset" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Load dataset</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Whitehall_fossa(in).csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sec-A1.3" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> A1.3: Descriptive Statistics</h1>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this session, students will be able to:</p>
<ul>
<li>Continue practicing basic software commands</li>
<li>Learn how to explore the dataset, identifying the different types of variable stored</li>
<li>Calculate the different measures of location and spread</li>
<li>Plot frequency distributions and histograms</li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: 1.3: <a href="https://1drv.ms/f/s!AtvH6PgKXPEDgnWvKjMfvpOKM02i?e=AfGZuY" target="_blank">Descriptive Statistics</a></p>
<p>There are many different ways to generate basic descriptive statistics for your dataset in R, some of which have already been covered.</p>
<p>Here, we will cover several basic functions. Remember that there is always more information to be found online, and many good resources exist only a Google search away!</p>
<section id="summary" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="summary"><span class="header-section-number">6.1</span> Summary</h2>
<p>The summary function can be used to generate a minimum, 1st quartile, median, median, 3rd quartile , maximum, and number of NA datapoints for all numeric variables within a dataset. See the following:</p>
<pre><code>summary(object.name)</code></pre>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(whitehall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    whl1_id         age_grp        prior_cvd        prior_t2dm     
 Min.   :10001   Min.   :1.000   Min.   :0.0000   Min.   :0.00000  
 1st Qu.:11082   1st Qu.:2.000   1st Qu.:0.0000   1st Qu.:0.00000  
 Median :12164   Median :2.000   Median :0.0000   Median :0.00000  
 Mean   :12164   Mean   :2.328   Mean   :0.2491   Mean   :0.06009  
 3rd Qu.:13246   3rd Qu.:3.000   3rd Qu.:0.0000   3rd Qu.:0.00000  
 Max.   :14327   Max.   :4.000   Max.   :1.0000   Max.   :1.00000  
                                                                   
  prior_cancer         sbp             bmi           bmi_grp4    
 Min.   :0.0000   Min.   : 86.0   Min.   :15.00   Min.   :1.000  
 1st Qu.:0.0000   1st Qu.:119.0   1st Qu.:23.00   1st Qu.:2.000  
 Median :0.0000   Median :129.0   Median :25.00   Median :3.000  
 Mean   :0.0758   Mean   :130.8   Mean   :25.22   Mean   :2.648  
 3rd Qu.:0.0000   3rd Qu.:141.0   3rd Qu.:27.00   3rd Qu.:3.000  
 Max.   :1.0000   Max.   :230.0   Max.   :44.00   Max.   :4.000  
                  NA's   :9       NA's   :17      NA's   :17     
      hdlc            ldlc            chol         currsmoker    
 Min.   :0.050   Min.   :1.050   Min.   : 2.24   Min.   :0.0000  
 1st Qu.:0.820   1st Qu.:2.840   1st Qu.: 4.85   1st Qu.:0.0000  
 Median :1.050   Median :3.350   Median : 5.47   Median :0.0000  
 Mean   :1.092   Mean   :3.367   Mean   : 5.51   Mean   :0.1261  
 3rd Qu.:1.320   3rd Qu.:3.870   3rd Qu.: 6.15   3rd Qu.:0.0000  
 Max.   :3.070   Max.   :6.810   Max.   :10.77   Max.   :1.0000  
 NA's   :25      NA's   :25      NA's   :5       NA's   :6       
    frailty          vitd          cvd_death          death       
 Min.   :1.00   Min.   : 18.92   Min.   :0.0000   Min.   :0.0000  
 1st Qu.:2.00   1st Qu.: 45.60   1st Qu.:0.0000   1st Qu.:0.0000  
 Median :3.00   Median : 55.70   Median :0.0000   Median :0.0000  
 Mean   :2.95   Mean   : 57.39   Mean   :0.1514   Mean   :0.3527  
 3rd Qu.:4.00   3rd Qu.: 66.69   3rd Qu.:0.0000   3rd Qu.:1.0000  
 Max.   :5.00   Max.   :419.89   Max.   :1.0000   Max.   :1.0000  
                                                                  
    fu_years      
 Min.   :0.03117  
 1st Qu.:5.98514  
 Median :7.75754  
 Mean   :6.81234  
 3rd Qu.:8.50000  
 Max.   :8.50000  
                  </code></pre>
</div>
</div>
<p>Note that this produces summary statistics for the entire dataset. To focus in on a specific column variable, we can use the $ operator as previously:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(whitehall<span class="sc">$</span>bmi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  15.00   23.00   25.00   25.22   27.00   44.00      17 </code></pre>
</div>
</div>
<p>It is useful here to check that your minimum, maximum and mean are reasonable values. Try to generate some summary statistics for systolic blood pressure (SBP). Are these figures reasonable?</p>
<p>You can also obtain summary statistics that are differentiated by another variable, such as <code>age group</code>, using the <code>by</code> function, as follows:</p>
<pre><code>by(object.name, object.name$variable, summary)</code></pre>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(whitehall, whitehall<span class="sc">$</span>age_grp, summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>whitehall$age_grp: 1
    whl1_id         age_grp    prior_cvd        prior_t2dm     
 Min.   :10003   Min.   :1   Min.   :0.0000   Min.   :0.00000  
 1st Qu.:11013   1st Qu.:1   1st Qu.:0.0000   1st Qu.:0.00000  
 Median :12110   Median :1   Median :0.0000   Median :0.00000  
 Mean   :12138   Mean   :1   Mean   :0.2541   Mean   :0.04471  
 3rd Qu.:13252   3rd Qu.:1   3rd Qu.:1.0000   3rd Qu.:0.00000  
 Max.   :14323   Max.   :1   Max.   :1.0000   Max.   :1.00000  
                                                               
  prior_cancer          sbp             bmi           bmi_grp4   
 Min.   :0.00000   Min.   : 87.0   Min.   :16.00   Min.   :1.00  
 1st Qu.:0.00000   1st Qu.:117.8   1st Qu.:23.00   1st Qu.:2.00  
 Median :0.00000   Median :128.5   Median :25.00   Median :3.00  
 Mean   :0.06824   Mean   :129.9   Mean   :25.34   Mean   :2.66  
 3rd Qu.:0.00000   3rd Qu.:140.0   3rd Qu.:27.00   3rd Qu.:3.00  
 Max.   :1.00000   Max.   :205.0   Max.   :41.00   Max.   :4.00  
                   NA's   :2       NA's   :6       NA's   :6     
      hdlc            ldlc            chol         currsmoker    
 Min.   :0.050   Min.   :1.150   Min.   :2.380   Min.   :0.0000  
 1st Qu.:0.830   1st Qu.:2.880   1st Qu.:4.910   1st Qu.:0.0000  
 Median :1.060   Median :3.340   Median :5.480   Median :0.0000  
 Mean   :1.098   Mean   :3.368   Mean   :5.537   Mean   :0.1435  
 3rd Qu.:1.320   3rd Qu.:3.850   3rd Qu.:6.150   3rd Qu.:0.0000  
 Max.   :3.070   Max.   :6.530   Max.   :9.760   Max.   :1.0000  
 NA's   :6       NA's   :5       NA's   :4                       
    frailty          vitd          cvd_death           death       
 Min.   :1.00   Min.   : 22.20   Min.   :0.00000   Min.   :0.0000  
 1st Qu.:1.00   1st Qu.: 50.40   1st Qu.:0.00000   1st Qu.:0.0000  
 Median :2.00   Median : 60.34   Median :0.00000   Median :0.0000  
 Mean   :2.42   Mean   : 61.72   Mean   :0.05529   Mean   :0.1612  
 3rd Qu.:4.00   3rd Qu.: 69.41   3rd Qu.:0.00000   3rd Qu.:0.0000  
 Max.   :5.00   Max.   :419.89   Max.   :1.00000   Max.   :1.0000  
                                                                   
    fu_years     
 Min.   :0.2745  
 1st Qu.:7.6138  
 Median :7.9062  
 Mean   :7.5706  
 3rd Qu.:8.5000  
 Max.   :8.5000  
                 
------------------------------------------------------------ 
whitehall$age_grp: 2
    whl1_id         age_grp    prior_cvd        prior_t2dm     
 Min.   :10001   Min.   :2   Min.   :0.0000   Min.   :0.00000  
 1st Qu.:11112   1st Qu.:2   1st Qu.:0.0000   1st Qu.:0.00000  
 Median :12193   Median :2   Median :0.0000   Median :0.00000  
 Mean   :12185   Mean   :2   Mean   :0.2512   Mean   :0.06101  
 3rd Qu.:13281   3rd Qu.:2   3rd Qu.:1.0000   3rd Qu.:0.00000  
 Max.   :14316   Max.   :2   Max.   :1.0000   Max.   :1.00000  
                                                               
  prior_cancer          sbp             bmi           bmi_grp4    
 Min.   :0.00000   Min.   : 88.0   Min.   :15.00   Min.   :1.000  
 1st Qu.:0.00000   1st Qu.:119.0   1st Qu.:23.00   1st Qu.:2.000  
 Median :0.00000   Median :129.0   Median :25.00   Median :3.000  
 Mean   :0.07266   Mean   :131.2   Mean   :25.09   Mean   :2.634  
 3rd Qu.:0.00000   3rd Qu.:140.0   3rd Qu.:27.00   3rd Qu.:3.000  
 Max.   :1.00000   Max.   :230.0   Max.   :41.00   Max.   :4.000  
                   NA's   :4       NA's   :9       NA's   :9      
      hdlc           ldlc            chol          currsmoker    
 Min.   :0.16   Min.   :1.050   Min.   : 2.240   Min.   :0.0000  
 1st Qu.:0.83   1st Qu.:2.830   1st Qu.: 4.820   1st Qu.:0.0000  
 Median :1.04   Median :3.340   Median : 5.430   Median :0.0000  
 Mean   :1.09   Mean   :3.363   Mean   : 5.495   Mean   :0.1293  
 3rd Qu.:1.32   3rd Qu.:3.880   3rd Qu.: 6.110   3rd Qu.:0.0000  
 Max.   :2.86   Max.   :6.320   Max.   :10.770   Max.   :1.0000  
 NA's   :12     NA's   :13      NA's   :1        NA's   :1       
    frailty           vitd          cvd_death          death       
 Min.   :1.000   Min.   : 18.92   Min.   :0.0000   Min.   :0.0000  
 1st Qu.:1.000   1st Qu.: 47.47   1st Qu.:0.0000   1st Qu.:0.0000  
 Median :3.000   Median : 57.97   Median :0.0000   Median :0.0000  
 Mean   :2.742   Mean   : 58.73   Mean   :0.1143   Mean   :0.2812  
 3rd Qu.:4.000   3rd Qu.: 68.72   3rd Qu.:0.0000   3rd Qu.:1.0000  
 Max.   :5.000   Max.   :137.00   Max.   :1.0000   Max.   :1.0000  
                                                                   
    fu_years      
 Min.   :0.08918  
 1st Qu.:7.24144  
 Median :7.82297  
 Mean   :7.09217  
 3rd Qu.:8.50000  
 Max.   :8.50000  
                  
------------------------------------------------------------ 
whitehall$age_grp: 3
    whl1_id         age_grp    prior_cvd        prior_t2dm     
 Min.   :10004   Min.   :3   Min.   :0.0000   Min.   :0.00000  
 1st Qu.:11080   1st Qu.:3   1st Qu.:0.0000   1st Qu.:0.00000  
 Median :12096   Median :3   Median :0.0000   Median :0.00000  
 Mean   :12141   Mean   :3   Mean   :0.2498   Mean   :0.06685  
 3rd Qu.:13206   3rd Qu.:3   3rd Qu.:0.0000   3rd Qu.:0.00000  
 Max.   :14327   Max.   :3   Max.   :1.0000   Max.   :1.00000  
                                                               
  prior_cancer          sbp             bmi           bmi_grp4    
 Min.   :0.00000   Min.   : 87.0   Min.   :16.00   Min.   :1.000  
 1st Qu.:0.00000   1st Qu.:118.0   1st Qu.:23.00   1st Qu.:2.000  
 Median :0.00000   Median :129.0   Median :25.00   Median :3.000  
 Mean   :0.08171   Mean   :130.8   Mean   :25.26   Mean   :2.647  
 3rd Qu.:0.00000   3rd Qu.:141.0   3rd Qu.:27.00   3rd Qu.:3.000  
 Max.   :1.00000   Max.   :230.0   Max.   :44.00   Max.   :4.000  
                   NA's   :2       NA's   :2       NA's   :2      
      hdlc            ldlc            chol         currsmoker    
 Min.   :0.210   Min.   :1.110   Min.   :2.640   Min.   :0.0000  
 1st Qu.:0.810   1st Qu.:2.810   1st Qu.:4.850   1st Qu.:0.0000  
 Median :1.060   Median :3.365   Median :5.500   Median :0.0000  
 Mean   :1.092   Mean   :3.377   Mean   :5.523   Mean   :0.1126  
 3rd Qu.:1.320   3rd Qu.:3.862   3rd Qu.:6.180   3rd Qu.:0.0000  
 Max.   :2.540   Max.   :6.810   Max.   :9.870   Max.   :1.0000  
 NA's   :5       NA's   :5                       NA's   :2       
    frailty           vitd          cvd_death          death       
 Min.   :1.000   Min.   : 20.91   Min.   :0.0000   Min.   :0.0000  
 1st Qu.:2.000   1st Qu.: 43.82   1st Qu.:0.0000   1st Qu.:0.0000  
 Median :3.000   Median : 54.60   Median :0.0000   Median :0.0000  
 Mean   :3.235   Mean   : 55.55   Mean   :0.1996   Mean   :0.4364  
 3rd Qu.:4.000   3rd Qu.: 64.07   3rd Qu.:0.0000   3rd Qu.:1.0000  
 Max.   :5.000   Max.   :311.06   Max.   :1.0000   Max.   :1.0000  
                                                                   
    fu_years      
 Min.   :0.03117  
 1st Qu.:4.90797  
 Median :7.64918  
 Mean   :6.46223  
 3rd Qu.:8.50000  
 Max.   :8.50000  
                  
------------------------------------------------------------ 
whitehall$age_grp: 4
    whl1_id         age_grp    prior_cvd        prior_t2dm     prior_cancer    
 Min.   :10002   Min.   :4   Min.   :0.0000   Min.   :0.000   Min.   :0.00000  
 1st Qu.:11140   1st Qu.:4   1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:0.00000  
 Median :12251   Median :4   Median :0.0000   Median :0.000   Median :0.00000  
 Mean   :12181   Mean   :4   Mean   :0.2345   Mean   :0.067   Mean   :0.08543  
 3rd Qu.:13204   3rd Qu.:4   3rd Qu.:0.0000   3rd Qu.:0.000   3rd Qu.:0.00000  
 Max.   :14326   Max.   :4   Max.   :1.0000   Max.   :1.000   Max.   :1.00000  
                                                                               
      sbp             bmi           bmi_grp4          hdlc      
 Min.   : 86.0   Min.   :16.00   Min.   :1.000   Min.   :0.180  
 1st Qu.:118.0   1st Qu.:23.00   1st Qu.:2.000   1st Qu.:0.820  
 Median :129.0   Median :25.00   Median :3.000   Median :1.050  
 Mean   :130.5   Mean   :25.33   Mean   :2.675   Mean   :1.090  
 3rd Qu.:141.0   3rd Qu.:27.00   3rd Qu.:3.000   3rd Qu.:1.325  
 Max.   :198.0   Max.   :40.00   Max.   :4.000   Max.   :2.740  
 NA's   :1                                       NA's   :2      
      ldlc            chol         currsmoker        frailty     
 Min.   :1.060   Min.   :2.520   Min.   :0.0000   Min.   :1.000  
 1st Qu.:2.835   1st Qu.:4.810   1st Qu.:0.0000   1st Qu.:3.000  
 Median :3.360   Median :5.490   Median :0.0000   Median :4.000  
 Mean   :3.362   Mean   :5.496   Mean   :0.1162   Mean   :3.819  
 3rd Qu.:3.865   3rd Qu.:6.170   3rd Qu.:0.0000   3rd Qu.:5.000  
 Max.   :6.040   Max.   :8.820   Max.   :1.0000   Max.   :5.000  
 NA's   :2                       NA's   :3                       
      vitd          cvd_death          death           fu_years      
 Min.   : 20.49   Min.   :0.0000   Min.   :0.0000   Min.   :0.06271  
 1st Qu.: 38.86   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:3.43643  
 Median : 48.42   Median :0.0000   Median :1.0000   Median :6.03797  
 Mean   : 50.50   Mean   :0.3132   Mean   :0.6901   Mean   :5.51926  
 3rd Qu.: 59.15   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:7.81324  
 Max.   :139.77   Max.   :1.0000   Max.   :1.0000   Max.   :8.50000  
                                                                     </code></pre>
</div>
</div>
<p><em>Does this generate any interesting information, or do any differences become immediately apparent?</em></p>
</section>
<section id="measures-of-central-tendency" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="measures-of-central-tendency"><span class="header-section-number">6.2</span> Measures of Central Tendency</h2>
<section id="a-mean" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="a-mean"><span class="header-section-number">6.2.1</span> a) Mean</h3>
<p>To calculate the mean, we use the following function.</p>
<pre><code>mean(object.name$variable)</code></pre>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(whitehall<span class="sc">$</span>sbp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>The above function may seem complete. We note, from our previous investigation, that there are some NA values within this dataset. Resultantly, we must remember to tell RStudio to calculate the mean without these values, using <code>na.rm = TRUE</code> . You can double check the values to see the difference.</p>
<pre><code>mean(object.name$variable, na.rm = TRUE)</code></pre>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(whitehall<span class="sc">$</span>sbp, <span class="at">na.rm=</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 130.7515</code></pre>
</div>
</div>
</section>
<section id="b-median" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="b-median"><span class="header-section-number">6.2.2</span> b) Median</h3>
<p>We can compute median using a similar function:</p>
<pre><code>median(object.name$variable, na.rm = TRUE)</code></pre>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(whitehall<span class="sc">$</span>sbp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 129</code></pre>
</div>
</div>
</section>
<section id="c-mode" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="c-mode"><span class="header-section-number">6.2.3</span> c) Mode</h3>
<pre><code>install.packages("DescTools")

library(DescTools)

Mode(x, na.rm = FALSE) 

# if there are missing values you can to make “na.rm = TRUE”</code></pre>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Mode</span>(whitehall<span class="sc">$</span>bmi_grp4, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3
attr(,"freq")
[1] 2091</code></pre>
</div>
</div>
<p><strong>The most common category of BMI group is ‘3’, with N=2091.</strong></p>
</section>
<section id="d-quantiles" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="d-quantiles"><span class="header-section-number">6.2.4</span> d) Quantiles</h3>
<p>The quantile function can be used to calculate the median, and first and third quartiles, by using a second argument to define the percentage range ‘probs’ as a decimal figure between 0 and 1.</p>
<p>Remember that the first quartile = 25% of values, and the third = 75%. In this way, we can also use the quantile function to compute any percentile cut-off for our data.</p>
<pre><code>quantile(object.name$variable, probs = , na.rm=TRUE)</code></pre>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(whitehall<span class="sc">$</span>sbp, <span class="at">probs=</span><span class="fl">0.25</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>25% 
119 </code></pre>
</div>
</div>
</section>
<section id="e-iqr" class="level3" data-number="6.2.5">
<h3 data-number="6.2.5" class="anchored" data-anchor-id="e-iqr"><span class="header-section-number">6.2.5</span> e) IQR</h3>
<p>To calculate IQR, we can simply use the following: # Standard Error</p>
</section>
<section id="exercise" class="level3" data-number="6.2.6">
<h3 data-number="6.2.6" class="anchored" data-anchor-id="exercise"><span class="header-section-number">6.2.6</span> Exercise</h3>
<pre><code>IQR(object.name$variable)</code></pre>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">IQR</span>(whitehall<span class="sc">$</span>sbp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22</code></pre>
</div>
</div>
<p>See if you can figure out how to calculate IQR using the quantile function!</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(whitehall<span class="sc">$</span>sbp, <span class="at">probs=</span><span class="fl">0.75</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">quantile</span>(whitehall<span class="sc">$</span>sbp, <span class="at">probs=</span><span class="fl">0.25</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>75% 
 22 </code></pre>
</div>
</div>
<p>Calculate the Sample size, remember to exclude missing values!</p>
</section>
<section id="f-range" class="level3" data-number="6.2.7">
<h3 data-number="6.2.7" class="anchored" data-anchor-id="f-range"><span class="header-section-number">6.2.7</span> f) Range</h3>
<p>To calculate range, we simply subtract the maximum from minimum values, as shown:</p>
<pre><code>max(object.name$variable) – min(object.name$variable)</code></pre>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(whitehall<span class="sc">$</span>sbp) <span class="sc">-</span> <span class="fu">min</span>(whitehall<span class="sc">$</span>sbp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</section>
<section id="g-sd-and-variance" class="level3" data-number="6.2.8">
<h3 data-number="6.2.8" class="anchored" data-anchor-id="g-sd-and-variance"><span class="header-section-number">6.2.8</span> g) SD and Variance</h3>
<p>To calculate standard deviation and variance, you can use the following simple functions:</p>
<pre><code>sd(object.name$variable)

var(object.name$variable)</code></pre>
<section id="question-a1.3a.i" class="level4" data-number="6.2.8.1">
<h4 data-number="6.2.8.1" class="anchored" data-anchor-id="question-a1.3a.i"><span class="header-section-number">6.2.8.1</span> Question A1.3a.i:</h4>
<p><strong>After completing the steps above, can you classify the following variables as Categorical, Binary, Ordinal, Continuous?</strong></p>
<ul>
<li>Prior CVD</li>
<li>SBP</li>
<li>Frailty</li>
<li>Death</li>
</ul>
</section>
<section id="answer-a1.3a.i" class="level4" data-number="6.2.8.2">
<h4 data-number="6.2.8.2" class="anchored" data-anchor-id="answer-a1.3a.i"><span class="header-section-number">6.2.8.2</span> Answer A1.3a.i:</h4>
<ul>
<li>Prior CV: binary</li>
<li>SBP: continuous</li>
<li>Frailty: ordinal</li>
<li>Death: binary</li>
</ul>
</section>
<section id="question-a1.3a.ii" class="level4" data-number="6.2.8.3">
<h4 data-number="6.2.8.3" class="anchored" data-anchor-id="question-a1.3a.ii"><span class="header-section-number">6.2.8.3</span> Question A1.3a.ii:</h4>
<p><strong>What are the measures of central tendency (mean, median and mode) and the measures of spread (range, interquartile range and standard deviation) for the measured cholesterol of participants in our dataset (using the chol variable)?</strong></p>
</section>
</section>
<section id="bar-charts-and-histograms" class="level3" data-number="6.2.9">
<h3 data-number="6.2.9" class="anchored" data-anchor-id="bar-charts-and-histograms"><span class="header-section-number">6.2.9</span> Bar charts and histograms</h3>
<p>R offers several powerful tools to make easily customisable visualisations of data.</p>
<section id="bar-charts" class="level4" data-number="6.2.9.1">
<h4 data-number="6.2.9.1" class="anchored" data-anchor-id="bar-charts"><span class="header-section-number">6.2.9.1</span> Bar Charts</h4>
<p>To make a simple barplot, we can use the <code>barplot()</code> function, and then input code in order to represent the data in different ways. The first step is to load several useful packages which will assist with our graphing. We then load these libraries. These open-source packages contain several additional tools that we can use.</p>
<pre><code>install.packages("tidyverse")

install.packages("RColorBrewer")

library(tidyverse)

library(RColorBrewer)</code></pre>
<p>We then generate a table, which we will assign as the object <code>bmi.counts</code>. It is this object we ask R to generate a barplot for.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>bmi.counts <span class="ot">&lt;-</span> <span class="fu">table</span>(whitehall<span class="sc">$</span>bmi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Within the barplot function, we can label the X and Y axis using <code>xlab=</code> and <code>ylab=</code>, title the graph using <code>main=</code>, and change the colour of the bars using <code>col=</code>. Here, the package <code>RColorBrewer</code> allows us to generate a vector of (20) contiguous colours.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(bmi.counts, <span class="at">xlab =</span> <span class="st">"BMI"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"BMI of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There is also opportunity to create stacked bar graphs in R. We can change the orientation by using the argument ‘horiz = TRUE’</p>
</section>
</section>
<section id="histograms" class="level3" data-number="6.2.10">
<h3 data-number="6.2.10" class="anchored" data-anchor-id="histograms"><span class="header-section-number">6.2.10</span> Histograms</h3>
<p>We can make a simple histogram using the <code>hist()</code> function in R. This function takes in a vector of values for which the histogram will be plotted. As with before, we will modify the histogram to add axis labels and a title.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>bmi, <span class="at">xlab =</span> <span class="st">"BMI"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"BMI of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">12</span>), <span class="at">density=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="grouping-continuous-data" class="level3" data-number="6.2.11">
<h3 data-number="6.2.11" class="anchored" data-anchor-id="grouping-continuous-data"><span class="header-section-number">6.2.11</span> Grouping Continuous Data</h3>
<p>Grouping continuous data is simply an extension of the skills we used to earlier create our binary variable. There are many reasons why you would want to categorise a continuous variable, and cut-offs need to be defined for different categories. <code>BMI</code> is a skewed variable and different parts of the distribution of BMI may have different relationships with diseases that we investigate.</p>
<p>Our first step is to create a new, empty column, which we will title <code>bmi.grouped</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Our subsequent code will act to populate this new column we’ve created in our data frame.</p>
<p>Our goal is to get R to assign values to this new column, which will be drawn from the existing BMI data recorded for those rows. Remember that each row is a collection (vector) of data that represents a different individual.</p>
<p>We will define <code>BMI</code> of less than 18.5 as 0, between 18 – 25 as 1,between 25-30 as 2, and greater than or equal to 30 as 3. This will be then coded in. This can be achieved with the below simple operators:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped [whitehall<span class="sc">$</span>bmi<span class="sc">&lt;</span><span class="fl">18.5</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped [whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span><span class="fl">18.5</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>bmi<span class="sc">&lt;</span><span class="dv">25</span>]<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped [whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span><span class="dv">25</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>bmi <span class="sc">&lt;</span><span class="dv">30</span>]<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped [whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span><span class="dv">30</span>]<span class="ot">&lt;-</span><span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It is important to also check that this variable is in the right format, using <code>class()</code>.</p>
<p>class(whitehall.data$bmi.grouped)</p>
<p>[1] “numeric”</p>
<p>R views our new variable as ‘numeric’. Clearly, however, it is an ordered categorical variable. Therefore, we have to ensure that R views the variable as a Factor. Simultaneously, while completing this task, we can also label our groups using the <code>labels=c()</code> function, remembering to use “” to denote different category titles. This can be completed as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped <span class="ot">&lt;-</span> <span class="fu">factor</span> (whitehall<span class="sc">$</span>bmi.grouped, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"&lt;18.5"</span>, <span class="st">"18.5-24.9"</span>, <span class="st">"25-29.9"</span>, <span class="st">"&gt;30"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>####Question A1.3b.i:</p>
<p><strong>Which type of variable can you plot with a bar chart? When should you use a histogram?</strong></p>
<section id="question-a1.3b.ii" class="level4" data-number="6.2.11.1">
<h4 data-number="6.2.11.1" class="anchored" data-anchor-id="question-a1.3b.ii"><span class="header-section-number">6.2.11.1</span> Question A1.3b.ii:</h4>
<p><strong>Plot the bar chart that counts the number of participants in each BMI group and save it. Can you give this graph a title? Can you label the y axis and change the colour of the bars in the chart?</strong></p>
</section>
<section id="question-a1.3b.iii" class="level4" data-number="6.2.11.2">
<h4 data-number="6.2.11.2" class="anchored" data-anchor-id="question-a1.3b.iii"><span class="header-section-number">6.2.11.2</span> Question A1.3b.iii:</h4>
<p><strong>Plot a histogram of SBP and describe the distribution.</strong></p>
</section>
<section id="question-a1.3b.iv" class="level4" data-number="6.2.11.3">
<h4 data-number="6.2.11.3" class="anchored" data-anchor-id="question-a1.3b.iv"><span class="header-section-number">6.2.11.3</span> Question A1.3b.iv:</h4>
<p><strong>Regroup SBP in a different way, and decide which grouping best represents the data.</strong></p>
</section>
<section id="question-a1.3b.v" class="level4" data-number="6.2.11.4">
<h4 data-number="6.2.11.4" class="anchored" data-anchor-id="question-a1.3b.v"><span class="header-section-number">6.2.11.4</span> Question A1.3b.v:</h4>
<p><strong>Can you change the number of bins used to plot the histogram of SBP? What is the effect of changing the number of bins?</strong></p>
</section>
<section id="answer-a1.3b.i" class="level4" data-number="6.2.11.5">
<h4 data-number="6.2.11.5" class="anchored" data-anchor-id="answer-a1.3b.i"><span class="header-section-number">6.2.11.5</span> Answer A1.3b.i:</h4>
<p><strong>Categorical variables (such as our newly created BMI categories) can be visually represented using a bar graph.</strong></p>
<p><strong>Histograms should be employed for continuous numerical variables. In our current dataset, variables that could be appropriately represented using a histogram include systolic blood pressure, blood cholesterol, and LDL levels.</strong></p>
</section>
<section id="answer-a1.3b.ii" class="level4" data-number="6.2.11.6">
<h4 data-number="6.2.11.6" class="anchored" data-anchor-id="answer-a1.3b.ii"><span class="header-section-number">6.2.11.6</span> Answer A1.3b.ii:</h4>
<p><strong>To generate this bar graph, we will follow the same process as we did before we had grouped BMI into the new variable. Note that we’ve changed the number of colours on our contiguous spectrum to 4, to reflect the new number of categories.</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>bmi.grouped.graph <span class="ot">&lt;-</span> <span class="fu">table</span>(whitehall<span class="sc">$</span>bmi.grouped)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(bmi.grouped.graph, <span class="at">horiz =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"BMI"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"BMI of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="answer-a1.3b.iii" class="level4" data-number="6.2.11.7">
<h4 data-number="6.2.11.7" class="anchored" data-anchor-id="answer-a1.3b.iii"><span class="header-section-number">6.2.11.7</span> Answer A1.3b.iii:</h4>
<p>As above, the code for this histogram is as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>sbp, <span class="at">xlab =</span> <span class="st">"SBP"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"Histogram of SBP of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">12</span>), <span class="at">density=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>There appears to be a small right skew (positive skew) to this distribution but it is approximately normally distributed.</strong></p>
</section>
<section id="answer-a1.3b.iv" class="level4" data-number="6.2.11.8">
<h4 data-number="6.2.11.8" class="anchored" data-anchor-id="answer-a1.3b.iv"><span class="header-section-number">6.2.11.8</span> Answer A1.3b.iv:</h4>
<p>We will group SBP according to the American College of Cardiology/American Heart Association guidelines for hypertension management, which classes blood pressure according to the following categories. The process for coding this new variable is near identical to the BMI categorisation — have a go yourself!</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Blood Pressure Caterogory</th>
<th>Systolic Blood Pressure</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Normal</td>
<td>&lt;120 mmHg</td>
</tr>
<tr class="even">
<td>Elevated</td>
<td>120-129 mmHg</td>
</tr>
<tr class="odd">
<td>Hypertension</td>
<td></td>
</tr>
<tr class="even">
<td>Stage 1</td>
<td>130-139 mmHg</td>
</tr>
<tr class="odd">
<td>Stage 2</td>
<td>&gt;=140 mmHg</td>
</tr>
</tbody>
</table>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped<span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped [whitehall<span class="sc">$</span>sbp<span class="sc">&lt;</span><span class="dv">120</span>]<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped [whitehall<span class="sc">$</span>sbp <span class="sc">&gt;=</span><span class="dv">120</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>sbp <span class="sc">&lt;</span><span class="dv">130</span>]<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped [whitehall<span class="sc">$</span>sbp <span class="sc">&gt;=</span><span class="dv">130</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>sbp <span class="sc">&lt;</span><span class="dv">140</span>]<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped [whitehall<span class="sc">$</span>sbp <span class="sc">&gt;=</span><span class="dv">140</span>]<span class="ot">&lt;-</span><span class="dv">4</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(whitehall<span class="sc">$</span>sbp.grouped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped <span class="ot">&lt;-</span> <span class="fu">factor</span>(whitehall<span class="sc">$</span>sbp.grouped, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Normotensive"</span>, <span class="st">"Elevated"</span>, <span class="st">"Stage 1 Hypertension"</span>, <span class="st">"Stage 2 Hypertension"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="answer-a1.3b.v" class="level4" data-number="6.2.11.9">
<h4 data-number="6.2.11.9" class="anchored" data-anchor-id="answer-a1.3b.v"><span class="header-section-number">6.2.11.9</span> Answer A1.3b.v:</h4>
<p>Normally, R automatically calculates the size of each bin of the histogram. We may not find, however, that the default bins offer an appropriate or sufficient visualisation of the data. We can change the number of bins by adding an additional argument to our <code>hist()</code> code, <code>breaks=()</code></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>sbp, <span class="at">xlab =</span> <span class="st">"SBP"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"Histogram of SBP of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">12</span>), <span class="at">density=</span><span class="dv">100</span>, <span class="at">breaks =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If we try two extremes, we end up with two different graphs — and the distribution and skew is easier to assess.</p>
<p>We could say that this appears to be a more ‘normal’ distribution — even though the underlying data hasn’t changed!</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>sbp, <span class="at">xlab =</span> <span class="st">"SBP"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"Histogram of SBP of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">12</span>), <span class="at">density=</span><span class="dv">100</span>, <span class="at">breaks =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>When represented with larger bins, however, the distribution does not seem to be quite as normally distributed. Some of the information at lower levels of SBP and in the far right tail is obscured.</p>
</section>
</section>
</section>
</section>
<section id="a1.4-estimates-and-confidence-intervals" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> A1.4: Estimates and Confidence Intervals</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this session, students will be able to:</p>
<ul>
<li><p>Understand the concepts of statistical inference and sampling distributions</p></li>
<li><p>Calculate standard error and confidence intervals by hand</p></li>
<li><p>Calculate standard error and confidence intervals using statistical software</p></li>
<li><p>Interpret confidence intervals for a difference in means</p></li>
</ul>
</div>
</div>
<p>You can download the slides here: <a href="https://1drv.ms/f/s!AtvH6PgKXPEDgnY0BpwEnf5fdwSy?e=mUsXfF" target="_blank">1.4: Estimates and Confidence Intervals</a></p>
<p><strong>Standard error (SE)</strong> can be defined as the standard deviation of the sampling distribution. The standard error is calculated using the formula: <span class="math inline">\(SE = \frac{\sigma}{\sqrt{n}}\)</span>.</p>
<p><strong>OR</strong></p>
<p>Standard Deviation (SD) and sample size (n) can be used to calculate SE as per the following formula:</p>
<p><span class="math display">\[
SE = \frac{SD}{\sqrt{n}}
\]</span></p>
<p>To calculate SE in R, we will need to first calculate both the SD and n and define these calculations as objects. We will then input these calculations into a formula in order to calculate SE. Let’s calculate the SE for SBP, as an example. Remember to name your objects properly and tell R to exclude missing values!</p>
<ol type="1">
<li>To calculate n, we will use the <code>sum</code> function.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>SBP.n <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(whitehall<span class="sc">$</span>sbp))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>SBP.n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4318</code></pre>
</div>
</div>
<section id="exercise-1" class="level3" data-number="7.0.1">
<h3 data-number="7.0.1" class="anchored" data-anchor-id="exercise-1"><span class="header-section-number">7.0.1</span> Exercise</h3>
<p>Calculate SD, noting again that we are rounding to 3 significant figures and excluding NA values.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>SBP.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(whitehall<span class="sc">$</span>sbp, <span class="at">na.rm=</span>T)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(SBP.sd, <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17.566</code></pre>
</div>
</div>
</section>
<section id="calculate-se" class="level3" data-number="7.0.2">
<h3 data-number="7.0.2" class="anchored" data-anchor-id="calculate-se"><span class="header-section-number">7.0.2</span> Calculate SE</h3>
<p>To calculate SE using the formula we derived above, and have further simplified our digits instructions.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>SBP.se <span class="ot">&lt;-</span> SBP.sd<span class="sc">/</span><span class="fu">sqrt</span>(SBP.n)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span> (SBP.se, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.267</code></pre>
</div>
</div>
</section>
</section>
<section id="confidence-interval" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> 95% confidence interval</h1>
<p>The 95% confidence interval is given by the formula: <span class="math inline">\(CI = \bar{x} \pm Z \cdot \frac{\sigma}{\sqrt{n}}\)</span>.</p>
<p>The formula for the 95% confidence interval is:</p>
<p><span class="math display">\[
CI = \bar{x} \pm Z \cdot \frac{\sigma}{\sqrt{n}}
\]</span></p>
<p>Z0.975 is the 97.5% percentile of the standard normal distribution (~1.96 SD from the mean). We can determine this precisely in R using qnorm(0.975), which equals to 1.959964, as previously demonstrated.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>Za <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>SBP.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(whitehall<span class="sc">$</span>sbp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>ci.Z_SBP <span class="ot">&lt;-</span> <span class="fu">c</span>((SBP.mean <span class="sc">-</span> (SBP.se<span class="sc">*</span>Za)), (SBP.mean <span class="sc">+</span> (SBP.se<span class="sc">*</span>Za))) </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>ci.Z_SBP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 130.2276 131.2754</code></pre>
</div>
</div>
<p><strong>We can interpret this is as that ’we are 95% confident that the true mean SBP for this population lies between 130.2276 mmHg and 131.2754 mmHg.</strong></p>
<p>Notice how <code>LDLC.sd/sqrt(LDLC.n)</code> is effectively <span class="math inline">\(\frac{\sigma}{\sqrt{n}}\)</span> which is the SE. The implication of this is that the larger n is (i.e., the sample size), the smaller SE and the narrower the CI will be (i.e., there will be less uncertainty around the estimated mean). We can also plot a histogram, using our knowledge from previous sections, in order to check whether this variable is approximately normally distributed.</p>
<section id="question-a1.4.i" class="level4" data-number="8.0.0.1">
<h4 data-number="8.0.0.1" class="anchored" data-anchor-id="question-a1.4.i"><span class="header-section-number">8.0.0.1</span> Question A1.4.i:</h4>
<p>Calculate a 95% confidence interval for mean BMI. How would you interpret this interval?</p>
</section>
<section id="calculate-the-sample-size" class="level3" data-number="8.0.1">
<h3 data-number="8.0.1" class="anchored" data-anchor-id="calculate-the-sample-size"><span class="header-section-number">8.0.1</span> Calculate the Sample Size</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>BMI.n <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(whitehall<span class="sc">$</span>bmi))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calculate-the-sd" class="level3" data-number="8.0.2">
<h3 data-number="8.0.2" class="anchored" data-anchor-id="calculate-the-sd"><span class="header-section-number">8.0.2</span> Calculate the SD</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>BMI.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(whitehall<span class="sc">$</span>bmi, <span class="at">na.rm =</span> T)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(BMI.sd, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.262</code></pre>
</div>
</div>
</section>
<section id="calculate-the-se" class="level3" data-number="8.0.3">
<h3 data-number="8.0.3" class="anchored" data-anchor-id="calculate-the-se"><span class="header-section-number">8.0.3</span> Calculate the SE</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>BMI.se <span class="ot">&lt;-</span> BMI.sd<span class="sc">/</span><span class="fu">sqrt</span>(BMI.n)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(BMI.se, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05</code></pre>
</div>
</div>
</section>
<section id="calculate-the-mean-bmi" class="level3" data-number="8.0.4">
<h3 data-number="8.0.4" class="anchored" data-anchor-id="calculate-the-mean-bmi"><span class="header-section-number">8.0.4</span> Calculate the mean BMI</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>BMI.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(whitehall<span class="sc">$</span>bmi, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calculate-the-se-1" class="level3" data-number="8.0.5">
<h3 data-number="8.0.5" class="anchored" data-anchor-id="calculate-the-se-1"><span class="header-section-number">8.0.5</span> Calculate the SE</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>Za <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>ci.z_BMI <span class="ot">&lt;-</span> <span class="fu">c</span>((BMI.mean <span class="sc">-</span> (BMI.se<span class="sc">*</span>Za)), (BMI.mean <span class="sc">+</span> (BMI.se<span class="sc">*</span>Za))) </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>ci.z_BMI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25.11954 25.31434</code></pre>
</div>
</div>
<p><strong>95% of sample means for BMI lie between 25.12 and 25.31</strong></p>
</section>
<section id="calculate-99-ci-for-bmi" class="level3" data-number="8.0.6">
<h3 data-number="8.0.6" class="anchored" data-anchor-id="calculate-99-ci-for-bmi"><span class="header-section-number">8.0.6</span> Calculate 99% CI for BMI</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>ZA <span class="ot">&lt;-</span> <span class="fu">qnorm</span> (<span class="fl">0.995</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>ci.z99_BMI <span class="ot">&lt;-</span> <span class="fu">c</span>((BMI.mean <span class="sc">-</span> (BMI.se<span class="sc">*</span>ZA)), (BMI.mean <span class="sc">+</span> (BMI.se<span class="sc">*</span>ZA))) </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>ci.z99_BMI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25.08894 25.34494</code></pre>
</div>
</div>
<p><strong>The 99% CI is wider. This is because only 1% of your sample means will fall outside this range. Therefore, to be more certain, the range of values will increase to allow for this.</strong></p>
</section>
</section>
<section id="a1.5-hypothesis-testing" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> A1.5: Hypothesis Testing</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this session, students will be able to:</p>
<ul>
<li><p>Interpret p-values</p></li>
<li><p>Describe type I and type II errors</p></li>
<li><p>Calculate and interpret t-tests for a difference in means</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/f/s!AtvH6PgKXPEDgnfMu293w_0JDjiV?e=FHsi8c" target="_blank">1.5: Hypothesis Testing</a></p>
<p>A t-test is an inferential statistic that can be calculated in order to determine the relationship and significance of the difference between the mean values of two separate population variables. There are several assumptions that we take to be true when performing a t-test:</p>
<ul>
<li><p>The data are continuous</p></li>
<li><p>The sample data have been randomly sampled from a population</p></li>
<li><p>There is homogeneity of variance (i.e.&nbsp;the variability of the data in each group is similar)</p></li>
<li><p>The distribution is approximately normal</p></li>
</ul>
<p>The t-statistic <span class="math inline">\(t\)</span> is given by:</p>
<p><span class="math display">\[
t = \frac{\bar{X}_1 - \bar{X}_2}{\sqrt{s_p^2 \left( \frac{1}{n_1} + \frac{1}{n_2} \right)}}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\bar{X}_1\)</span> and <span class="math inline">\(\bar{X}_2\)</span> are the sample means of the two groups,</li>
<li><span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span> are the sample sizes of the two groups,</li>
<li><span class="math inline">\(s_p^2\)</span> is the pooled variance, calculated as:</li>
</ul>
<p><span class="math display">\[
s_p^2 = \frac{(n_1 - 1)s_1^2 + (n_2 - 1)s_2^2}{n_1 + n_2 - 2}
\]</span></p>
<ul>
<li><span class="math inline">\(s_1^2\)</span> and <span class="math inline">\(s_2^2\)</span> are the variances of the two groups.</li>
</ul>
<p>A one-sample t-test (or student’s t-test) is used on a continuous measurement to decide whether a population mean is equal to a specific value — i.e.&nbsp;is the systolic blood pressure of our population 120, or not. In R, to complete a one-sample t-test, the syntax is:</p>
<pre><code>t.test(x, conf.level=0.95 , …[options] )</code></pre>
<p>For a two-sample t-test (independent samples t-test), the following code should be used:</p>
<pre><code>t.test(x[group==1], x[group==2] , conf.level=0.95 , …[options] )</code></pre>
<p>For a two-sample test, x specifies the variable on which to perform the t-test, while the group variable defines the groups to be compared. An alternative formulation for the two sample t.test is:</p>
<pre><code>t.test(x~group, data=)</code></pre>
<p>See <code>?t.test</code> for details of the other options within the native R help files.</p>
<section id="question-a1.5a" class="level4" data-number="9.0.0.1">
<h4 data-number="9.0.0.1" class="anchored" data-anchor-id="question-a1.5a"><span class="header-section-number">9.0.0.1</span> Question A1.5a:</h4>
<p><strong>Recode BMI into a binary variable so that one group has a BMI below 25, and the other group has a BMI of 25 and above. Perform a t-test to compare the mean SBP in those with BMI&lt;25 and those with BMI≥. Answer the questions:</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&lt;</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>bmi_grp4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   1    2 
1843 2467 </code></pre>
</div>
</div>
<p>I. **What is the mean SBP where BMI &lt;25 (<span class="math inline">\(\overline{x_1}\)</span>)?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sbp<span class="sc">~</span>bmi_grp4, mean, <span class="at">subset =</span> bmi_grp4 <span class="sc">==</span> <span class="dv">1</span>, <span class="at">data =</span> whitehall) </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>x1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  bmi_grp4      sbp
1        1 129.4905</code></pre>
</div>
</div>
<p>I. 129.49mmHg</p>
<ol start="2" type="I">
<li>**What is the mean SBP where BMI ≥25 (<span class="math inline">\(\overline{x_2}\)</span>)?</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sbp<span class="sc">~</span>bmi_grp4, mean, <span class="at">subset =</span> bmi_grp4 <span class="sc">==</span> <span class="dv">2</span>, <span class="at">data =</span> whitehall) </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>x2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  bmi_grp4      sbp
1        2 131.6524</code></pre>
</div>
</div>
<ol start="2" type="I">
<li><p>131.65mmHg</p></li>
<li><p>**What is the mean difference (<span class="math inline">\(\overline{x_2}-\overline{x_1}\)</span>)?</p></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mean_diff <span class="ot">&lt;-</span> x1 <span class="sc">-</span> x2 </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>mean_diff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  bmi_grp4       sbp
1       -1 -2.161945</code></pre>
</div>
</div>
<ol start="3" type="I">
<li><p>Using basic arithmetic in R:131.6524-129.4905 = 2.1619</p></li>
<li><p><strong>What is the test statistic t ?</strong></p></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">t.test</span>(sbp<span class="sc">~</span>bmi_grp4, <span class="at">data =</span> whitehall) </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  sbp by bmi_grp4
t = -4.0068, df = 3959, p-value = 6.267e-05
alternative hypothesis: true difference in means between group 1 and group 2 is not equal to 0
95 percent confidence interval:
 -3.219796 -1.104094
sample estimates:
mean in group 1 mean in group 2 
       129.4905        131.6524 </code></pre>
</div>
</div>
<ol start="4" type="I">
<li>The t-statistic is the ratio of the departure of the estimated value of a parameter from its hypothesized value to its standard error. It can be utilised to tell us about whether we should support or reject the null hypothesis.t = -4.0068</li>
</ol>
<p>V. <strong>What is 95% CI for the mean difference?</strong></p>
<p><strong>95 percent confidence interval: -3.22, -1.10That is to say, we are 95% confident that the difference in the mean systolic blood pressure between those with BMI &lt;25 and BMI 25 lies between 1.10 and 3.22 mmHg.</strong></p>
<ol start="6" type="I">
<li><strong>What is the p-value for this t-test and what does it mean?</strong></li>
</ol>
<p><strong>The p-value is 6.267e-05 = 0.00006267. Remember that p-values provide us with the probability of getting the mean difference we saw here, or one greater, if the null hypothesis was actually true. In this case, that probability is extremely low.Here, our p-value tells us that there is very strong evidence against the null hypothesis (which would be that there is no difference in SBP between our two BMI groups).Therefore, we can say that there is a significant difference in the mean SBP measures in people who are overweight and those who are not.</strong></p>
</section>
<section id="question-a1.5b" class="level4" data-number="9.0.0.2">
<h4 data-number="9.0.0.2" class="anchored" data-anchor-id="question-a1.5b"><span class="header-section-number">9.0.0.2</span> Question A1.5b:</h4>
<p><strong>If a clinician has decided that a difference of at least 5 mmHg is considered a clinically worthwhile difference in blood pressure with regard to morbidity associated with high blood pressure, do you consider the result in A1.5a to be clinically significant?</strong></p>
<p><strong>Answer A1.5b:</strong></p>
<p><strong>No.&nbsp;Note here the difference between clinical and statistical significance. Whilst there is a statistically significant difference between the 2 mean SBP measures, with a mean difference of 2.16 mmHg, the result is not clinically significant.</strong></p>
</section>
</section>
<section id="a1.6-transforming-variables" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> A1.6: Transforming Variables</h1>
<p>In <a href="#sec-A1.3" class="quarto-xref">Section&nbsp;6</a> you learnt about data types and data distributions. Many of the tests that we use for continuous variables assume that the data follow a Gaussian or normal distribution. You have learnt how to create a histogram and use this to assess if the data follow the appropriate distribution. But what do we do if they don’t?</p>
<p>In these situations it is often acceptable to ‘transform’ your variable. This means to apply a mathematical function to each observed value, and then analyse the transformed values. This is a perfectly valid and widely accepted approach to dealing with skewed data. You just need to take care to use it appropriately. For example, you must ensure that if you are comparing means between two or more groups, that you perform the same transformation on all groups in the analysis so that the means are still comparable. Also, you must make sure that you interpret the results of any statistical tests on transformed data appropriately. It is often best to transform any means and mean differences back into the original units.</p>
<p>The table below shows the most useful transformations to deal with different deviations from the normal distribution.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Form of data</th>
<th>Transformation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Slightly right-skewed</td>
<td>Square root</td>
</tr>
<tr class="even">
<td>Moderately right-skewed</td>
<td>Logarithmic</td>
</tr>
<tr class="odd">
<td>Very right-skewed</td>
<td>Reciprocal</td>
</tr>
<tr class="even">
<td>Left-skewed</td>
<td>Square</td>
</tr>
<tr class="odd">
<td>Counts</td>
<td>Square root</td>
</tr>
<tr class="even">
<td>Proportions</td>
<td>Arcsine square root</td>
</tr>
</tbody>
</table>
<p>If you have decided to use a transformation it is best to plot your raw data (histogram or Q-Q plot depending on your preference), create a new variable with the transformed data, and then plot the transformed variable in the same way to check that the transformation has had the desired effect.</p>
<p>Sometimes variable transformations do not help. For example, if the measures of central tendency are all at the very extreme values of a variable then it is unlikely that any transformation will be useful. In these cases, non-parametric tests may be preferred. We will cover when and how to use non-parametric tests in Module B3.</p>
<p>The natural log is the log to the base of the constant e (also known as Euler’s number), which is approximately 2.718281828459.</p>
<p>If you are interested in why this number is so important, a quick Google of the term Euler’s number should suffice, but you do not need to know why we use this value in order to run this analysis. (NB: Euler’s number is not to be confused with Euler’s constant, which is a different thing entirely!)</p>
<p>Firstly, plot and inspect a histogram of the variable hdlc. Adding a normal curve might help to see what we are looking at.</p>
<p>To do this in R you write:</p>
<pre><code>data$variable_log &lt;- log(data$variable)</code></pre>
<p><strong>Use this function to log transform the ‘hdlc’ variable. Now create a new histogram of your transformed variable. How does this compare to your original? Does this transformation help your data? What might you do differently?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>hdlc.log <span class="ot">&lt;-</span> <span class="fu">log</span>(whitehall<span class="sc">$</span>hdlc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then to look at the histogram we write:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>hdlc.log, <span class="at">breaks =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You can see that the data are closer to following the normal curve in this histogram compared to the previous. In the first histogram the most common values (taller bars) are slightly outside of the normal curve to the left of the mean, and there is a more gradual slope on the right-hand side of the mean (peak of the normal curve). This means there are more values in the bins to the right of the mean than to the left of the mean. This is a (very) slight right skew.</p>
<p>In the histogram of the transformed data the highest points are closer to the mean, so this could be classed as a slight improvement, but we are more seeing some of the most common values slightly to the right of the mean, and a more gradual slop off to the left, so a very minimal left skew. This wouldn’t worry us if we saw a skew this slight in the raw data, but in transformed data this is an ‘over-correction’ and indicates that the log transformation might not be the best option for this variable. Referring back to the table at the top of the page, we would select the square root transformation here instead.</p>
<p>In reality, the original hdlc variable was quite close to normality, and a sufficiently large sample size that we would not be worried, but it is a good candidate to experiment on.</p>
<section id="custom-function-to-find-the-mode" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="custom-function-to-find-the-mode"><span class="header-section-number">10.1</span> Custom function to find the mode</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>get_mode <span class="ot">&lt;-</span> <span class="cf">function</span>(v){ </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  uniq_vals <span class="ot">&lt;-</span> <span class="fu">unique</span>(v) <span class="co"># Get unique values </span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  uniq_vals[<span class="fu">which.max</span>(<span class="fu">tabulate</span>(<span class="fu">match</span>(v, uniq_vals)))] <span class="co"># Find the most frequent value</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">31</span>, <span class="dv">38</span>, <span class="dv">18</span>, <span class="dv">14</span>, <span class="dv">16</span>, <span class="dv">25</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">27</span>, <span class="dv">42</span>, <span class="dv">30</span>, <span class="dv">32</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mode</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>mode_value <span class="ot">&lt;-</span> <span class="fu">get_mode</span>(x) </span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>mode_value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-A2.1" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> A2.1 Introduction to Power and Sample Size Calculation</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this session, students will be able to:</p>
<ul>
<li><p>Continue practicing basic software commands</p></li>
<li><p>Learn how to explore the dataset, identifying the different types of variable stored</p></li>
<li><p>Calculate the different measures of location and spread</p></li>
<li><p>Plot frequency distributions and histograms</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgklIx_PHxzZ6DWAA?e=Zb8cS1" target="_blank">A2.1 Key Concepts</a></p>
<p>The power package</p>
<p>We can estimate sample size and power using the R package ‘pwr’. First you need to install the package and load the library:</p>
<pre><code>install.packages("pwr")

library(pwr)</code></pre>
<p>Once this package is installed, we can start calculating our needed sample size to test hypotheses or we can estimate the amount of power a study had to detect a difference is one existed. The next sections will show you how to do this.</p>
<p><strong>Look at the help file for the function pwr.t.test. What is the default value for significance level?</strong></p>
<p><strong>What information do you need to conduct a sample size estimate for difference between means?</strong></p>
<p>The default value for significance level (denoted as ’sig.level‘) in the function is 0.05. This is indicated by sig.level=0.05, and can be changed by specifying a different number in the function. So you can work out the sample size you would need for different significance levels.</p>
<p>To conduct a sample size estimate between means you need the power and alpha values you have decided on, the estimated mean of each group in the population, or the estimated difference between groups in the population, and the estimated population standard deviation.</p>
</section>
<section id="sec-A2.2" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> A2.2 Power calculations for a difference in means</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this session, students will be able to:</p>
<ul>
<li><p>Explain the key concept of power and what impacts it</p></li>
<li><p>Estimate the power of a given study</p></li>
<li><p>Estimate the sample size needed to test hypotheses in different study designs</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgko9OFv6whK6t7Mf?e=10INKQ" target="_blank">A2.2 Power calculations for a difference in means</a></p>
<section id="power-calculations-for-two-means" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="power-calculations-for-two-means"><span class="header-section-number">12.1</span> Power calculations for two means</h2>
<p>Here is an example:</p>
<p>Estimate the sample size needed to compare the mean systolic blood pressure (SBP) in two populations. From a pilot study, you think that the group with lower blood pressure will have a mean SBP of 120 mm Hg, and the standard deviation (SD) of both groups will be 15 mm Hg. You have decided that you are interested in a minimum difference of 5 mm Hg, and you want 90% power, and a 5% significance level.</p>
<p>In R, we need to calculate two statistics to estimate sample size: delta (i.e.&nbsp;the expected difference between groups) and sigma (variance, which in this case is the pooled standard deviation). Once we have delta and sigma, we can calculate the effect size we expect to see, which is Cohen’s d.&nbsp;We can guess delta and sigma from looking at past studies or by running a pilot study. Cohen’s d is estimated by dividing the delta by the sigma.</p>
<p><strong>Cohen’s d</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">15</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3333333</code></pre>
</div>
</div>
<p><strong>Use the ‘pwr.t.test’ command to assess the sample size needed to detect this effect size.</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>power1 <span class="ot">&lt;-</span><span class="fu">pwr.t.test</span>(<span class="at">d=</span>d, <span class="at">power=</span><span class="fl">0.9</span>, <span class="at">sig.level =</span><span class="fl">0.05</span> ) </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>power1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 190.0991
              d = 0.3333333
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>You need approximately 190 participants in each group, and 380 participants overall.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>n is number in <em>each</em> group</p>
</div>
</div>
<p><strong>If we want to estimate the power of a given sample size, we omit the ‘power’ option, and instead use the ‘n=’ option:</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>power2 <span class="ot">&lt;-</span><span class="fu">pwr.t.test</span>(<span class="at">n=</span><span class="dv">190</span>, <span class="at">d=</span>d, <span class="at">sig.level =</span><span class="fl">0.05</span> ) </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>power2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 190
              d = 0.3333333
      sig.level = 0.05
          power = 0.8998509
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>We can see here that recruiting 190 participants in each blood pressure group would enable our study to have 90% power.</p>
<section id="question-a2.2" class="level3" data-number="12.1.1">
<h3 data-number="12.1.1" class="anchored" data-anchor-id="question-a2.2"><span class="header-section-number">12.1.1</span> Question A2.2:</h3>
<p>how much power would we have ended up with in our study if we only managed to recruit 150 participants in each group, but the variance of our study sample was smaller than what we anticipated (so SD=12) ?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">12</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>d1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4166667</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>power3 <span class="ot">&lt;-</span> <span class="fu">pwr.t.test</span>(<span class="at">n=</span><span class="dv">150</span>, <span class="at">d=</span>d1, <span class="at">sig.level =</span> <span class="fl">0.05</span>) </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>power3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 150
              d = 0.4166667
      sig.level = 0.05
          power = 0.9491662
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p><strong>We recruited fewer participants, which would decrease our power, but since our variance was lower our power actually increased overall to 95%</strong></p>
<p>#A2.3 Power calculations for two proportions {#sec-A2.3}</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain the key concept of power and what impacts it</p></li>
<li><p>Estimate the power of a given study</p></li>
<li><p>Estimate the sample size needed to test hypotheses in different study designs</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgkscJs5h1Z49wtOt?e=Zp3dNL" target="_blank">A2.3 Power calculations for a difference in proportions</a></p>
<p>Here is an example:</p>
<p>Estimate the sample size needed to compare the proportion of people who smoke in two populations. From previous work, you think that 10% of the people in population A smoke, and that an absolute increase of 5% in population B (compared to population A) would be clinically significant. You want 90% power, and a 5% significance level.</p>
<ul>
<li><p>In this scenario we use the <code>pwr.2p.test</code> command in the power package.</p></li>
<li><p>alpha = sig.level option and is equal to 0.05</p></li>
<li><p>power = 0.90</p></li>
<li><p>p1 = 0.10</p></li>
<li><p>p2 = 0.15</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>power4 <span class="ot">&lt;-</span><span class="fu">pwr.2p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.1</span>, <span class="at">p2=</span><span class="fl">0.15</span>), <span class="at">sig.level=</span><span class="fl">0.05</span>, <span class="at">power=</span><span class="fl">0.9</span>) </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>power4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Difference of proportion power calculation for binomial distribution (arcsine transformation) 

              h = 0.1518977
              n = 910.8011
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: same sample sizes</code></pre>
</div>
</div>
<p><strong>You estimate that you need 911 participants from each population, with a total sample of around 1,821.</strong></p>
<ul>
<li><p>If you wanted different sample sizes in each group, you would use the command <code>pwr.2p2n.test</code> instead.</p></li>
<li><p>If we type <code>plot(power4)</code> we can see how the power level changes with varying sample sizes:</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(power4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="question-a2.3" class="level4" data-number="12.1.1.1">
<h4 data-number="12.1.1.1" class="anchored" data-anchor-id="question-a2.3"><span class="header-section-number">12.1.1.1</span> Question A2.3:</h4>
<p>Unfortunately, the funding body has informed you, you only have enough resources to recruit a fixed number of people. Can you estimate the power of a study if you only had 500 people in total (with even numbers in each group)?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>power5 <span class="ot">&lt;-</span> <span class="fu">pwr.2p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.1</span>, <span class="at">p2=</span><span class="fl">0.15</span>), <span class="at">n =</span> <span class="dv">250</span>, <span class="at">sig.level =</span> <span class="fl">0.05</span>) </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>power5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Difference of proportion power calculation for binomial distribution (arcsine transformation) 

              h = 0.1518977
              n = 250
      sig.level = 0.05
          power = 0.396905
    alternative = two.sided

NOTE: same sample sizes</code></pre>
</div>
</div>
<p><strong>In this scenario, the power of the study would be only 0.40. Most people would regard such a study as under-powered as there is only a 40% chance that the effect will be detected if one truly exists.</strong></p>
</section>
</section>
</section>
</section>
<section id="sec-A2.4" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> A2.4 Sample Size Calculation for RCTs</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain the key concept of power and what impacts it</p></li>
<li><p>Estimate the power of a given study</p></li>
<li><p><strong>Estimate the sample size needed to test hypotheses in different study designs</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgk0-hp9s4sp7vf9n?e=saaL89" target="_blank">A2.4: Sample Size Calculations for RCTs</a></p>
<p><strong>Sample size calculation for testing a hypothesis (Clinical trials or clinical interventional studies)</strong></p>
<p>The sample size <span class="math inline">\(n\)</span> for each group in an RCT with continuous outcomes is given by:</p>
<p><span class="math display">\[
n = \frac{{2 \sigma^2 \left(Z_{\frac{\alpha}{2}} + Z_{\beta}\right)^2}}{{\Delta^2}}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(n\)</span> is the sample size required in each group,</li>
<li><span class="math inline">\(\sigma^2\)</span> is the population variance (or an estimate based on prior studies or pilot data),</li>
<li><span class="math inline">\(Z_{\frac{\alpha}{2}}\)</span> is the critical value of the standard normal distribution at significance level <span class="math inline">\(\alpha\)</span>,(e.g., 95% confidence corresponds to <span class="math inline">\(Z_{\alpha/2} \approx 1.96\)</span>).</li>
<li><span class="math inline">\(Z_{\beta}\)</span> is the critical value for power <span class="math inline">\(1 - \beta\)</span>,(e.g., 80% power corresponds to <span class="math inline">\(Z_{\beta} \approx 0.84\)</span>)</li>
<li><span class="math inline">\(\Delta\)</span> is the effect size (the minimum detectable difference between groups).</li>
</ul>
<p><em>This formula is used to ensure the study has enough power to detect a clinically meaningful difference.</em></p>
<p>Here is an example:</p>
<p>In a parallel RCT, 25% of the subjects on the standard therapy had a successful outcome. It is only of clinical relevance if a 40% absolute improvement is observed in the new therapy. How many subjects are required in order to detect this difference with 80% power at the 5% level of significance?</p>
<p>In this case we need to assess a difference in proportions again, this time with an effect size that has a 0.40 difference between the groups:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>power6<span class="ot">&lt;-</span><span class="fu">pwr.2p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.25</span>, <span class="at">p2=</span><span class="fl">0.65</span>), <span class="at">power=</span><span class="fl">0.8</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>power6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Difference of proportion power calculation for binomial distribution (arcsine transformation) 

              h = 0.8282914
              n = 22.88076
      sig.level = 0.05
          power = 0.8
    alternative = two.sided

NOTE: same sample sizes</code></pre>
</div>
</div>
<p>23 subjects per group and 46 subjects are required in total.</p>
<section id="estimating-sample-size-for-a-hypothesis-in-a-cross-sectional-study" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="estimating-sample-size-for-a-hypothesis-in-a-cross-sectional-study"><span class="header-section-number">13.1</span> Estimating sample size for a hypothesis in a cross-sectional study</h2>
<section id="question-a2.4" class="level4" data-number="13.1.0.1">
<h4 data-number="13.1.0.1" class="anchored" data-anchor-id="question-a2.4"><span class="header-section-number">13.1.0.1</span> Question A2.4:</h4>
<p>In the same parallel trial as described in the example above, we still observe that 25% of the subjects on the standard therapy had a successful outcome, but this time it is only of clinical relevance if a 40% relative improvement is observed in the new therapy. How many subjects are required in order to detect this difference with 80% power at the 5% level of significance?</p>
</section>
<section id="answer-a2.4" class="level4" data-number="13.1.0.2">
<h4 data-number="13.1.0.2" class="anchored" data-anchor-id="answer-a2.4"><span class="header-section-number">13.1.0.2</span> Answer A2.4:</h4>
<p>First you need to work out what a 40% relative increase on 25% is: <code>0.25*1.40=35%</code> of subjects would need to have a successful outcome for there to be clinical relevance.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>power7<span class="ot">&lt;-</span><span class="fu">pwr.2p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.25</span>, <span class="at">p2=</span><span class="fl">0.35</span>), <span class="at">power=</span><span class="fl">0.8</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>power7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Difference of proportion power calculation for binomial distribution (arcsine transformation) 

              h = 0.2189061
              n = 327.5826
      sig.level = 0.05
          power = 0.8
    alternative = two.sided

NOTE: same sample sizes</code></pre>
</div>
</div>
<p>We need many more patients than in the example above due to the small effect size that we now wish to detect.</p>
</section>
</section>
</section>
<section id="sec-A2.5" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> A2.5 Sample size calculations for cross-sectional studies (or surveys)</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain the key concept of power and what impacts it</p></li>
<li><p>Estimate the power of a given study</p></li>
<li><p><strong>Estimate the sample size needed to test hypotheses in different study designs</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgkzY9gcUKlV9CwAA?e=deJFls" target="_blank">A2.5: Sample size calculations for cross-sectional studies (or surveys)</a></p>
<p>To determine the sample size <span class="math inline">\(n\)</span> for estimating a population proportion in a cross-sectional study, use the following formula:</p>
<p><span class="math display">\[n = \frac{{Z_{\frac{\alpha}{2}}^2 \cdot p \cdot (1 - p)}}{{d^2}}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(n\)</span> is the required sample size,</li>
<li><span class="math inline">\(Z_{\frac{\alpha}{2}}\)</span> is the critical value for the desired confidence level (e.g., for 95% confidence, <span class="math inline">\(Z_{\frac{\alpha}{2}} \approx 1.96\)</span>),</li>
<li><span class="math inline">\(p\)</span> is the estimated population proportion (e.g., based on prior data or a pilot study),</li>
<li><span class="math inline">\(d\)</span> is the desired margin of error or precision (the maximum allowable difference between the sample estimate and population proportion).</li>
</ul>
<p><em>This formula helps ensure that the sample size is large enough to accurately estimate the population proportion with a specified confidence level and precision.</em></p>
<p><strong>Example of estimating sample size for a hypothesis in a cross-sectional study</strong></p>
<p>You have been asked to help with a power calculation for a cross-sectional study, to estimate the point prevalence of obesity within a population. A study five years ago in this population found that 30% of people were obese, but the government thinks this has increased by 10% (to a point prevalence of 40%). Estimate the sample size needed for this study, assuming that the previous point prevalence of 30% is your ‘null hypothesis’. You want 80% power.</p>
<ul>
<li>You are calculating a sample size for one proportion here.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>power8 <span class="ot">&lt;-</span><span class="fu">pwr.p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.3</span>, <span class="at">p2=</span><span class="fl">0.4</span>), <span class="at">power=</span><span class="fl">0.8</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>) </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>power8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     proportion power calculation for binomial distribution (arcsine transformation) 

              h = 0.2101589
              n = 177.7096
      sig.level = 0.05
          power = 0.8
    alternative = two.sided</code></pre>
</div>
</div>
<p><strong>You need about 178 participants in your study to estimate this prevalence.</strong></p>
<section id="question-a2.5" class="level4" data-number="14.0.0.1">
<h4 data-number="14.0.0.1" class="anchored" data-anchor-id="question-a2.5"><span class="header-section-number">14.0.0.1</span> Question A2.5:</h4>
<p>One researcher has suggested that the proportion of the population who is obese may actually have decreased by 10% in the last five years (i.e.&nbsp;to 20%). How would this change your estimate for the sample size needed?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>power9 <span class="ot">&lt;-</span><span class="fu">pwr.p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.3</span>, <span class="at">p2=</span><span class="fl">0.2</span>), <span class="at">power=</span><span class="fl">0.8</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>) </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>power9</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     proportion power calculation for binomial distribution (arcsine transformation) 

              h = 0.2319843
              n = 145.8443
      sig.level = 0.05
          power = 0.8
    alternative = two.sided</code></pre>
</div>
</div>
<p><strong>The estimated sample size has now reduced slightly, to 146.</strong></p>
<p><strong>Based the outputs above, we can conclude that more data are needed to detect a change in proportion from 0.3 to 0.4 than from 0.3 to 0.2. For a fixed absolute difference (here the absolute difference in proportions is 0.1), larger sample sizes are needed to obtain a given level of power as the proportions approach 0.5.</strong></p>
<p>Recall that the standard error (se) of the sampling distribution of p is <span class="math inline">\(SE = \sqrt{\frac{p(1 - p)}{n}}\)</span>.</p>
<p>Where: - ( p ) is the sample proportion, - ( n ) is the sample size.</p>
<p>As p gets closer to 0.5, the amount of variability increases (se is largest when p=0.5) and, therefore, more data are needed to detect a change in proportions of 0.1.</p>
</section>
</section>
<section id="sec-A2.6" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> A2.6 Sample size calculations for case-control studies</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain the key concept of power and what impacts it</p></li>
<li><p>Estimate the power of a given study</p></li>
<li><p><strong>Estimate the sample size needed to test hypotheses in different study designs</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgk4r89kfykscn_0P?e=XnJyGw" target="_blank">A2.6: Sample size calculations for case-control studies</a></p>
<p>To calculate the sample size <span class="math inline">\(n\)</span> for each group (cases and controls) in a case-control study, use the following formula:</p>
<p><span class="math display">\[
n = \frac{\left(Z_{\frac{\alpha}{2}} + Z_{\beta}\right)^2 \cdot [p_1 (1 - p_1) + p_2 (1 - p_2)]}{(p_1 - p_2)^2}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(n\)</span> is the sample size required in each group (cases and controls),</li>
<li><span class="math inline">\(Z_{\frac{\alpha}{2}}\)</span> is the critical value for the desired significance level (e.g., for 95% confidence, <span class="math inline">\(Z_{\frac{\alpha}{2}} \approx 1.96\)</span>),</li>
<li><span class="math inline">\(Z_{\beta}\)</span> is the critical value for the desired power (e.g., for 80% power, <span class="math inline">\(Z_{\beta} \approx 0.84\)</span>),</li>
<li><span class="math inline">\(p_1\)</span> is the proportion of cases exposed to the risk factor,</li>
<li><span class="math inline">\(p_2\)</span> is the proportion of controls exposed to the risk factor,</li>
<li><span class="math inline">\((p_1 - p_2)\)</span> represents the minimum detectable difference between the proportions of exposure in cases and controls.</li>
</ul>
<p>This formula ensures sufficient power to detect a statistically significant difference in exposure between cases and controls.</p>
<p><strong>Estimating sample size for case-control studies</strong></p>
<p>You have now been asked to help another research group with their power calculations. They want to conduct a case-control study of sterilization (tubal ligation) and ovarian cancer. You could use parameters from a recent paper (reference below). Parameters of interest might include the proportion of cases or controls with tubal ligation, and the odds ratio.</p>
<p>Tubal ligation, hysterectomy and epithelial ovarian cancer in the New England Case-Control Study. Rice MS, Murphy MA, Vitonis AF, Cramer DW, Titus LJ, Tworoger SS, Terry KL. Int J Cancer. 2013 Nov 15;133(10):2415-21. doi: 10.1002/ijc.28249. Epub 2013 Jul 9.</p>
<p>Looking at the paper, you could extract the following relevant information needed to estimate your sample size:</p>
<ul>
<li><p>Proportion of controls with tubal ligation: 18.5%.</p></li>
<li><p>Proportion of cases with tubal ligation: 12.8%.</p></li>
<li><p>Odds ratio for the association between tubal ligation and ovarian cancer: 0.82.</p></li>
<li><p>This study used 2,265 cases and 2,333 controls.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You probably won’t need to use all of these parameters.</p>
</div>
</div>
<p>If you want to use a test of proportions to assess how large your sample needs to be for an expected odds ratio of the association between tubal ligation and ovarian cancer, you need to have two proportions for the command. Above we assume that 18% of controls have had tubal ligation, so we then can use this formula to work background from an expected odds ratio to see the other proportion:</p>
<p><span class="math display">\[p2 = {\frac{(OR*p1)}{(1+p1(OR-1))}}\]</span></p>
<p><strong>Example 2.6</strong></p>
<p><strong>how many people do you need to recruit into your study if your odds ratio is less than 0.8 and you want to have power of at least 80% ?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>power10 <span class="ot">&lt;-</span><span class="fu">pwr.p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.9</span>, <span class="at">p2=</span><span class="fl">0.8</span>), <span class="at">power=</span><span class="fl">0.8</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>power10 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     proportion power calculation for binomial distribution (arcsine transformation) 

              h = 0.2837941
              n = 97.45404
      sig.level = 0.05
          power = 0.8
    alternative = two.sided</code></pre>
</div>
</div>
<section id="question-a2.6a" class="level4" data-number="15.0.0.1">
<h4 data-number="15.0.0.1" class="anchored" data-anchor-id="question-a2.6a"><span class="header-section-number">15.0.0.1</span> Question A2.6a:</h4>
<p><strong>Looking at the plot, how many people do you need to recruit into your study if your odds ratio is less than 0.8 and you want to have power of at least 80%?</strong></p>
</section>
<section id="answer-a2.6a" class="level4" data-number="15.0.0.2">
<h4 data-number="15.0.0.2" class="anchored" data-anchor-id="answer-a2.6a"><span class="header-section-number">15.0.0.2</span> Answer A2.6a:</h4>
<p><strong>If the odds ratio in this scenario is ≤ 0.8, (i.e.&nbsp;an effect size of 20% -40%) then you can reach a power ≥ 0.8 with a sample size of around 5000 people. If the true odds ratio is closer to 0.9 (i.e.&nbsp;a 10% effect size), then you would require a much larger sample size.</strong></p>
</section>
<section id="answer-a2.6b" class="level4" data-number="15.0.0.3">
<h4 data-number="15.0.0.3" class="anchored" data-anchor-id="answer-a2.6b"><span class="header-section-number">15.0.0.3</span> Answer A2.6b:</h4>
<p>We substitute a proportion of 18% and an OR of 0.85 into the formula:</p>
<p><span class="math display">\[p2 = {\frac{(OR*p1)}{(1+p1(OR-1))}}\]</span></p>
<p>p2= (0.85*0.18)/(1+0.18(0.85-1)</p>
<p>Using R like a calculator, we get:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>(<span class="fl">0.85</span><span class="sc">*</span><span class="fl">0.18</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+0.18</span><span class="sc">*</span>(<span class="fl">0.85</span><span class="dv">-1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1572456</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>power11 <span class="ot">&lt;-</span><span class="fu">pwr.2p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.18</span>, <span class="at">p2=</span><span class="fl">0.1572</span>), <span class="at">power=</span><span class="fl">0.9</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>power11</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Difference of proportion power calculation for binomial distribution (arcsine transformation) 

              h = 0.06092931
              n = 5660.744
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: same sample sizes</code></pre>
</div>
</div>
<p><strong>You need 5661 cases and 5661 controls, so about 11,322 participants in total, to obtain 90% power if your OR of tubal ligation with ovarian cancer is 0.85.</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>power12 <span class="ot">&lt;-</span> <span class="fu">power.t.test</span>(<span class="at">delta =</span> <span class="fl">6.0</span> <span class="sc">-</span> <span class="fl">5.5</span>, <span class="at">sd =</span> <span class="dv">1</span>, <span class="at">power =</span> <span class="fl">0.9</span>, <span class="at">sig.level =</span> <span class="fl">0.05</span>, <span class="at">type =</span> <span class="st">"two.sample"</span>, <span class="at">alternative =</span> <span class="st">"two.sided"</span>) </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>power12</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 85.03129
          delta = 0.5
             sd = 1
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-B1.1" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> B1.1: Correlation and Scatterplots</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p><strong>Explore the data with correlations and scatterplots.</strong></p></li>
<li><p>Use an ANOVA to test for a difference in means across a categorical variable.</p></li>
<li><p>Conduct univariable and multivariable linear regression</p></li>
<li><p>Check the regression diagnostics of a linear model.</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgmDgs-JMcoXm3eiT?e=JK9ZN2" target="_blank">B1.1 Correlation and Scatterplots</a></p>
<p>In this section we will use correlations and scatter plots to examine the relationship between two continuous variables.</p>
<section id="exercise-2" class="level3" data-number="16.0.1">
<h3 data-number="16.0.1" class="anchored" data-anchor-id="exercise-2"><span class="header-section-number">16.0.1</span> Exercise</h3>
<p>Let us now assess if there is a relationship between BMI and SBP. A scatterplot is a quick way to have a first impression on how variables may relate to each other.There are several ways to create a scatterplot in R. The basic function is <code>plot()</code>, used as plot(x,y) where x and y denote the (x,y) points to plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(whitehall<span class="sc">$</span>bmi, whitehall<span class="sc">$</span>sbp, <span class="at">xlab=</span><span class="st">"BMI (kg/m2)"</span>,<span class="at">ylab=</span><span class="st">"Systolic blood pressure (mm Hg)"</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>If we look at the plot we can see some vertical lines as BMI was collected at discrete values and each vertical line represent individuals with the same BMI. Also there does not appear to be an obvious relationship between the two variables as the dots all appear in a big clump in the middle, without any direction to them.</strong></p>
<p><strong>Correlations</strong></p>
<p>We can also assess if there is any relationship between age and SBP by looking at their correlation. In R, you can use <code>cor()</code> to obtain correlations. Also <code>cor.test()</code> can be used if a test of association is needed.</p>
<p>In the presence of missing values it is important to set the argument ’use‘ to specify the method for computing correlations otherwise <code>cor()</code> will not work. If ’use‘ is set to <code>use=”complete.obs“</code> then the correlation is computed after casewise deletion of missing values. If ’use‘ is set to <code>use=”pairwise.complete.obs”</code> then the correlation between each pair of variables is computed using all complete pairs of observations on those variables.</p>
<section id="question-b1.1b" class="level4" data-number="16.0.1.1">
<h4 data-number="16.0.1.1" class="anchored" data-anchor-id="question-b1.1b"><span class="header-section-number">16.0.1.1</span> Question B1.1b:</h4>
<p><strong>Interpret the correlation coefficient between SBP and BMI.</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>corrbp_bmi <span class="ot">&lt;-</span> <span class="fu">cor</span>(whitehall[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>], <span class="at">use=</span><span class="st">"complete.obs"</span>) </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(corrbp_bmi, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     sbp  bmi
sbp 1.00 0.09
bmi 0.09 1.00</code></pre>
</div>
</div>
<p><strong>The correlation between SBP and BMI is 0.09 and it is a weak positive correlation.</strong></p>
</section>
</section>
</section>
<section id="sec-B1.2" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> B1.2: Differences Between Means (ANOVA 1)</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explore the data with correlations and scatterplots.</p></li>
<li><p><strong>Use an ANOVA to test for a difference in means across a categorical variable.</strong></p></li>
<li><p>Conduct univariable and multivariable linear regression</p></li>
<li><p>Check the regression diagnostics of a linear model.</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgmRgQCCQzpD8K_il?e=lfjuje" target="_blank">B1.2 Differences Between Means (ANOVA I)</a></p>
<p>The ANOVA procedure allows us to establish whether there is evidence that the mean SBP values across the BMI groups are not all equal. You use an ANOVA to test for differences in means across levels of a categorical variable (not a continuous one).</p>
<p>We use <code>aov()</code> to perform ANOVA, and we get a summary of the ANOVA table using <code>summary()</code>. aov() can be used in two ways as follows:</p>
<pre><code>fit3 &lt;- aov(y ~ x, data=my.data)

fit3 &lt;- aov(my.data$y ~ my.data$x)</code></pre>
<section id="question-b1.2" class="level4" data-number="17.0.0.1">
<h4 data-number="17.0.0.1" class="anchored" data-anchor-id="question-b1.2"><span class="header-section-number">17.0.0.1</span> Question B1.2:</h4>
<p>We are going to use this to test for a significant difference in mean SBP across the BMI groups.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_fact<span class="ot">&lt;-</span><span class="fu">factor</span>(whitehall<span class="sc">$</span>bmi_grp4)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">aov</span>(sbp<span class="sc">~</span>bmi_fact, <span class="at">data=</span>whitehall) </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              Df  Sum Sq Mean Sq F value   Pr(&gt;F)    
bmi_fact       1    4922    4922   16.07 6.23e-05 ***
Residuals   4299 1317058     306                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
26 observations deleted due to missingness</code></pre>
</div>
</div>
<p><strong>The result indicates there are differences in SBP across the four categories of BMI as the p-value of 0.0001 is highly significant.</strong></p>
<p><strong>However, an ANOVA a global test and does not tell us which BMI groups are significantly different from each other. You will learn how to produce comparisons of all possible pairings of the BMI groups, as well as many other aspects of the ANOVA test in Module B2.</strong></p>
</section>
</section>
<section id="sec-B1.3" class="level1" data-number="18">
<h1 data-number="18"><span class="header-section-number">18</span> B1.3: Univariable Linear Regression</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explore the data with correlations and scatterplots.</p></li>
<li><p>Use an ANOVA to test for a difference in means across a categorical variable.</p></li>
<li><p><strong>Conduct univariable and multivariable linear regression.</strong></p></li>
<li><p>Check the regression diagnostics of a linear model.</p></li>
</ul>
</div>
</div>
<section id="sec-B1.3a" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="sec-B1.3a"><span class="header-section-number">18.1</span> B1.3a: Linear regression with continuous exposure</h2>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgl8msjztdiIBftCe?e=FozZzE" target="_blank">B1.3a Univariable Linear Regression</a></p>
<p>In section <a href="#sec-B1.1" class="quarto-xref">Section&nbsp;16</a> we examined the association between two continuous variables (SBP and BMI [continuous]) using scatterplots and correlations. We can also assess the relationship between two continuous variables by using linear regression. In comparison with the regression using a categorical exposure, if we have a continuous variable we interpret the beta coefficient as the “average increase in [outcome] for a 1 unit change in [exposure]’.</p>
<p>We can fit a simple linear regression model to the data using the <code>lm()</code> function as <code>lm(formula, data)</code> and the fitted model can be saved to an object for further analysis. For example <code>my.fit &lt;- lm(Y ~ X, data = my.data)</code> performs a linear regression of Y (response variable) versus X (explanatory variable) by taking them from the dataset my.data. The result is stored on an object called <code>my.fit</code>.</p>
<p>Other different functional forms for the relationship can be specified via <code>formula</code>. The data argument is used to tell R where to look for the variables used in the formula.</p>
<p>When the model is saved in an object we can use the <code>summary()</code> function to extract information about the linear model (estimates of parameters, standard errors, residuals, etc). The function <code>confint()</code> can be used to compute confidence intervals of the estimates in the fitted model.</p>
<section id="question-1.3a" class="level3" data-number="18.1.1">
<h3 data-number="18.1.1" class="anchored" data-anchor-id="question-1.3a"><span class="header-section-number">18.1.1</span> Question 1.3a</h3>
<p>Fit a linear model of SBP versus BMI (continuous) in the Whitehall data and interpret your findings.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp <span class="sc">~</span> bmi, <span class="at">data=</span>whitehall)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sbp ~ bmi, data = whitehall)

Residuals:
    Min      1Q  Median      3Q     Max 
-43.087 -12.169  -1.710   9.831 101.667 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 119.15237    2.07540  57.412  &lt; 2e-16 ***
bmi           0.45902    0.08162   5.624 1.99e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.47 on 4299 degrees of freedom
  (26 observations deleted due to missingness)
Multiple R-squared:  0.007303,  Adjusted R-squared:  0.007072 
F-statistic: 31.62 on 1 and 4299 DF,  p-value: 1.989e-08</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %     97.5 %
(Intercept) 115.083517 123.221220
bmi           0.298996   0.619046</code></pre>
</div>
</div>
<p><strong>For every 1 unit higher BMI, SBP on average increases 0.46 mmHg (95% CI: 0.30-0.62), and this association is statistically significant (p&lt;0.001)</strong></p>
</section>
</section>
<section id="sec-B1.3b" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="sec-B1.3b"><span class="header-section-number">18.2</span> B1.3b: Linear regression with categorical exposure</h2>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgmH0936YIHab0I-m?e=HOF3bz" target="_blank">B1.3 Univariable Linear Regression</a></p>
<p>Instead of conducting multiple pairwise comparisons in an ANOVA, we could run a linear regression to compare the mean difference in each age group compared to a reference category.</p>
<p>First, we need to reclassify our exposure, <code>bmi_grp4</code> and tell R to treat our exposure as a categorical variable:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&lt;</span> <span class="fl">18.5</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="fl">18.5</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>bmi <span class="sc">&lt;</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>bmi <span class="sc">&lt;</span> <span class="dv">30</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="dv">30</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_fact <span class="ot">&lt;-</span> <span class="fu">factor</span>(whitehall<span class="sc">$</span>bmi_grp4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can use <code>is.factor()</code> to check that the new created variable is indeed a factor variable.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(whitehall<span class="sc">$</span>bmi_fact)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Then, we use <code>table()</code> to count the number of participants in each BMI category.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>bmi_fact)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   1    2    3    4 
  50 1793 2091  376 </code></pre>
</div>
</div>
<p>We can use <code>aggregate()</code> to compute summary statistics for SBP by BMI.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(whitehall<span class="sc">$</span>sbp, <span class="fu">list</span>(whitehall<span class="sc">$</span>bmi_fact), <span class="at">FUN=</span>mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Group.1        x
1       1 126.6600
2       2 129.5695
3       3 131.3661
4       4 133.2394</code></pre>
</div>
</div>
<p><strong>The results indicate that there are mean SBP increases across the four categories of BMI.</strong></p>
<p>Now we fit a linear regression model called <code>fit2</code> with SBP as our response and BMI groups as our explanatory variable.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp <span class="sc">~</span> bmi_fact, <span class="at">data=</span>whitehall)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sbp ~ bmi_fact, data = whitehall)

Residuals:
    Min      1Q  Median      3Q     Max 
-43.366 -12.239  -1.570   9.634 100.430 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  126.660      2.474  51.187   &lt;2e-16 ***
bmi_fact2      2.910      2.509   1.160   0.2462    
bmi_fact3      4.706      2.504   1.879   0.0602 .  
bmi_fact4      6.579      2.634   2.498   0.0125 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.5 on 4297 degrees of freedom
  (26 observations deleted due to missingness)
Multiple R-squared:  0.00488,   Adjusted R-squared:  0.004185 
F-statistic: 7.024 on 3 and 4297 DF,  p-value: 0.0001041</code></pre>
</div>
</div>
<p>If we want confidence intervals, we could then type:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit2, <span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  2.5 %     97.5 %
(Intercept) 121.8087587 131.511241
bmi_fact2    -2.0089779   7.828006
bmi_fact3    -0.2029698   9.615215
bmi_fact4     1.4156290  11.743094</code></pre>
</div>
</div>
<p>By default R will use the lowest category of <code>bmi_fact</code> as the reference in a regression. But this category is the smallest and hence it is not a good reference category as all comparisons with it will have large confidence intervals. We can change the reference category using the ‘relevel’ function:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> <span class="fu">within</span>(whitehall, bmi_fact <span class="ot">&lt;-</span> <span class="fu">relevel</span>(bmi_fact,<span class="at">ref=</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we fit the same linear regression again:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp <span class="sc">~</span> bmi_fact, <span class="at">data=</span>whitehall)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sbp ~ bmi_fact, data = whitehall)

Residuals:
    Min      1Q  Median      3Q     Max 
-43.366 -12.239  -1.570   9.634 100.430 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 129.5695     0.4134 313.389  &lt; 2e-16 ***
bmi_fact1    -2.9095     2.5088  -1.160 0.246221    
bmi_fact3     1.7966     0.5638   3.187 0.001449 ** 
bmi_fact4     3.6698     0.9926   3.697 0.000221 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.5 on 4297 degrees of freedom
  (26 observations deleted due to missingness)
Multiple R-squared:  0.00488,   Adjusted R-squared:  0.004185 
F-statistic: 7.024 on 3 and 4297 DF,  p-value: 0.0001041</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit2, <span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  2.5 %     97.5 %
(Intercept) 128.7589451 130.380083
bmi_fact1    -7.8280063   2.008978
bmi_fact3     0.6913165   2.901901
bmi_fact4     1.7239246   5.615770</code></pre>
</div>
</div>
<p><strong>Looking at the output above, the average level of SBP increases as BMI groups get higher. For a BMI group 4 (obese) compared to BMI group 2 (normal weight), the average SBP is 3.7 mmHg higher (95% CI: 1.7-5.6, p&lt;0.001).</strong></p>
</section>
</section>
<section id="sec-B1.4" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> BI.4: Multiple Linear Regression</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explore the data with correlations and scatterplots.</p></li>
<li><p>Use an ANOVA to test for a difference in means across a categorical variable.</p></li>
<li><p><strong>Conduct univariable and multivariable linear regression.</strong></p></li>
<li><p>Check the regression diagnostics of a linear model.</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgmUlCsP5mP3nJGLX?e=5fjJVE" target="_blank">B1.4a Multiple Linear Regression</a></p>
<p>How do we fit a model with more than one explanatory variable?</p>
<p>Here, we will include each covariate one at a time into the model, starting with BMI, then adding <code>age_grp</code> and lastly adding <code>currsmoker</code>. We like to add variables one at time so that we can see how each new additional covariate affects the other variables already in the model- this gives us an idea as to the mechanisms underlying an association.</p>
<p>To build a multivariable model, the command is the same as before:</p>
<pre><code>my.fit &lt;- lm(Y ~ X+ X2 + X3, data = my.data) </code></pre>
<p>Therefore, to examine the impact the association of BMI group on SBP, adjusted for LDL-C, we write:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp <span class="sc">~</span> bmi_fact<span class="sc">+</span>ldlc, <span class="at">data=</span>whitehall)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sbp ~ bmi_fact + ldlc, data = whitehall)

Residuals:
    Min      1Q  Median      3Q     Max 
-43.769 -12.106  -1.685   9.805 100.780 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 133.0774     1.2194 109.131  &lt; 2e-16 ***
bmi_fact1    -3.7999     2.5360  -1.498 0.134107    
bmi_fact3     1.9109     0.5656   3.379 0.000735 ***
bmi_fact4     3.7098     0.9921   3.739 0.000187 ***
ldlc         -1.0539     0.3444  -3.060 0.002227 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.48 on 4271 degrees of freedom
  (51 observations deleted due to missingness)
Multiple R-squared:  0.007247,  Adjusted R-squared:  0.006318 
F-statistic: 7.795 on 4 and 4271 DF,  p-value: 2.958e-06</code></pre>
</div>
</div>
<p><strong>Being overweight (BMI group 3) compared with normal weight (group 2) is associated with a 1.91 mmHg higher SBP on average, once adjusted for LDL-C (95% CI: 0.80-3.02, p=0.001). This is a slightly stronger association for the overweight BMI group than before we adjusted for LDL-C.</strong></p>
<p><strong>Note that each covariate in the model is adjusted for all other covariates in the model. So BMI group is adjusted for LDL-C, and LDL-C is adjusted for BMI group. In other words, we can see the association of BMI group independent of LDL-C, and vice versa.</strong></p>
<section id="question-b1.4a" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="question-b1.4a"><span class="header-section-number">19.1</span> Question B1.4a:</h2>
<p>What is the association of BMI group with SBP, once adjusted for LDL-C and current smoking?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp <span class="sc">~</span> bmi_fact<span class="sc">+</span>ldlc<span class="sc">+</span>currsmoker, <span class="at">data=</span>whitehall)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sbp ~ bmi_fact + ldlc + currsmoker, data = whitehall)

Residuals:
    Min      1Q  Median      3Q     Max 
-43.857 -12.133  -1.698   9.869 101.087 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 133.1638     1.2250 108.709  &lt; 2e-16 ***
bmi_fact1    -3.8183     2.5372  -1.505 0.132420    
bmi_fact3     1.8963     0.5664   3.348 0.000820 ***
bmi_fact4     3.6897     0.9928   3.717 0.000205 ***
ldlc         -1.0536     0.3446  -3.057 0.002248 ** 
currsmoker   -0.5632     0.8072  -0.698 0.485360    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.48 on 4265 degrees of freedom
  (56 observations deleted due to missingness)
Multiple R-squared:  0.007334,  Adjusted R-squared:  0.006171 
F-statistic: 6.303 on 5 and 4265 DF,  p-value: 7.781e-06</code></pre>
</div>
</div>
<p><strong>On average, being obese is associated with a 3.7 mmHg higher SBP than being normal weight, once adjusted for LDL-C and current smoking (95% CI 1.74-5.63, p&lt;0.001). This association was not affected by additional adjustment for current smoking.</strong></p>
<p><strong>Each covariate in the model can be interpreted as adjusted for the other covariates in the model. So being a current smoker is associated with a -0.56 mmHg lower SBP compared to non-smokers, once adjusted for LDL-C and BMI group. The 95% CI crosses the null value (which is 0 in this case, as we are not working with ratios; -2.15-1.02) so this association is not statistically significant.</strong></p>
</section>
<section id="working-example-1" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="working-example-1"><span class="header-section-number">19.2</span> Working example 1</h2>
<p>In the following, we want to investigate the association between body mass index (<em>kg/m^2</em>) and vitamin D (nmol/L) adjusting for HDL cholesterol (mmol/L) in the Whitehall data.</p>
<ul>
<li><p>Fit a linear regression model with vitamin D as the dependent variable and BMI as the independent variable.</p></li>
<li><p>Fit a linear regression model with vitamin D as the dependent variable and BMI as the independent variable adjusting for HDL cholesterol.</p></li>
<li><p>Compare the coefficient of BMI in the two models.</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vitd<span class="sc">~</span>bmi, <span class="at">data=</span>whitehall)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = vitd ~ bmi, data = whitehall)

Residuals:
   Min     1Q Median     3Q    Max 
-37.30 -11.67  -1.28   9.41 363.02 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 60.74523    2.13700  28.425   &lt;2e-16 ***
bmi         -0.13347    0.08404  -1.588    0.112    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 18 on 4308 degrees of freedom
  (17 observations deleted due to missingness)
Multiple R-squared:  0.0005851, Adjusted R-squared:  0.0003531 
F-statistic: 2.522 on 1 and 4308 DF,  p-value: 0.1123</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit5, <span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %      97.5 %
(Intercept) 56.5556026 64.93485072
bmi         -0.2982367  0.03130403</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>fit6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vitd<span class="sc">~</span>bmi <span class="sc">+</span> hdlc, <span class="at">data=</span>whitehall)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = vitd ~ bmi + hdlc, data = whitehall)

Residuals:
   Min     1Q Median     3Q    Max 
-37.00 -11.56  -1.20   9.35 363.06 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 63.26611    2.60935  24.246   &lt;2e-16 ***
bmi         -0.17711    0.08811  -2.010   0.0445 *  
hdlc        -1.32227    0.76558  -1.727   0.0842 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.99 on 4282 degrees of freedom
  (42 observations deleted due to missingness)
Multiple R-squared:  0.001272,  Adjusted R-squared:  0.0008053 
F-statistic: 2.726 on 2 and 4282 DF,  p-value: 0.06557</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit6, <span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %       97.5 %
(Intercept) 58.1504235 68.381798056
bmi         -0.3498436 -0.004380142
hdlc        -2.8231990  0.178663530</code></pre>
</div>
</div>
<p><strong>The association between vitamnin D and BMI was substantially attenuated after adjusting for HDL cholesterol</strong></p>
</section>
</section>
<section id="sec-B1.5" class="level1" data-number="20">
<h1 data-number="20"><span class="header-section-number">20</span> B1.5: Model Selection and F-Tests</h1>
<p>Here we are going to practice using F-tests to help choose the best fitting model for our data.</p>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgmZJg_qKNBqYAvpr?e=9pstRW" target="_blank">B1.5 Testing Regression Coefficients</a></p>
<p><strong>When estimating the effect of a particular exposure, we have seen that it is important to include potential confounding variables in the regression model, and that failure to do so will lead to a biased estimate of the effect.</strong></p>
<p>To assess if we have included important confounders in our model, we can run a statistical test to see if the extra coefficients are significantly contributing to the model fit. This is helpful for testing the overall inclusion of a categorical variable to a model (where some levels may have a significant association and other levels may not), or testing the addition of multiple variables to the model.</p>
<p>We can do this in R using the ‘linearHypothesis’ function within the package ‘car’</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(fit4, <span class="fu">c</span>(<span class="st">"bmi_fact1=0"</span>, <span class="st">"bmi_fact3=0"</span>, <span class="st">"bmi_fact4=0"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Linear hypothesis test:
bmi_fact1 = 0
bmi_fact3 = 0
bmi_fact4 = 0

Model 1: restricted model
Model 2: sbp ~ bmi_fact + ldlc + currsmoker

  Res.Df     RSS Df Sum of Sq      F   Pr(&gt;F)    
1   4268 1310900                                 
2   4265 1303805  3      7095 7.7364 3.76e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><strong>The output reveals that the F-statistic for this joint hypothesis test (that all coefficients of the BMI variable are equal to 0) is about 7.7 and the corresponding p-value is &lt;0.001.</strong></p>
<p><strong>Whilst the main regression output shows that not all levels of BMI group are significantly associated SBP, the F-test shows that overall this variable is significantly explaining variance in the model (F[3,4265]=7.74, p&lt;0.001).</strong></p>
<section id="question-b1.5" class="level4" data-number="20.0.0.1">
<h4 data-number="20.0.0.1" class="anchored" data-anchor-id="question-b1.5"><span class="header-section-number">20.0.0.1</span> Question B1.5:</h4>
<p><strong>Run an F-test to assess if both LDL-C and current smoking are jointly contributing to model fit (i.e.&nbsp;test both these coefficients at the same time).</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(fit4, <span class="fu">c</span>(<span class="st">"ldlc=0"</span>, <span class="st">"currsmoker=0"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Linear hypothesis test:
ldlc = 0
currsmoker = 0

Model 1: restricted model
Model 2: sbp ~ bmi_fact + ldlc + currsmoker

  Res.Df     RSS Df Sum of Sq      F   Pr(&gt;F)   
1   4267 1306812                                
2   4265 1303805  2    3007.2 4.9186 0.007351 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><strong>You can see from the output that the null hypothesis is that both variables have a coefficient equal to 0. However, there is evidence to reject this null hypothesis (F[2,4265]=4.92, p&lt;0.01). These variables are significantly contributing to model fit.</strong></p>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgmg4mzwoUX9L9W6y?e=Rz8lxV" target="&quot;_blank">B1.5b Presentation of Regression Results</a></p>
</section>
</section>
<section id="sec-B1.6" class="level1" data-number="21">
<h1 data-number="21"><span class="header-section-number">21</span> B1.6: Regression Diagnostics</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explore the data with correlations and scatterplots.</p></li>
<li><p>Use an ANOVA to test for a difference in means across a categorical variable.</p></li>
<li><p>Conduct univariable and multivariable linear regression.</p></li>
<li><p><strong>Check the regression diagnostics of a linear model.</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgmmf9sjBWND4KLIF?e=5p0xqb" target="_blank">B1.6 Regression Diagnostics</a></p>
<p>One of the final steps of any linear regression is to check that the model assumptions are met. Satisfying these assumptions allows you to perform statistical hypothesis testing and generate reliable confidence intervals.</p>
<p>Here we are going to practice checking the normality and homoscedasticity of the residuals.</p>
<section id="checking-normality-of-residuals" class="level2" data-number="21.1">
<h2 data-number="21.1" class="anchored" data-anchor-id="checking-normality-of-residuals"><span class="header-section-number">21.1</span> Checking Normality of Residuals</h2>
<p>We need to make sure that our residuals are normally distributed with a mean of 0. This assumption may be checked by looking at a histogram or a Q-Q-Plot.</p>
<p>To look at our residuals, we can use the function <code>resid()</code>. This function extracts the model residuals from the fitted model object (for example, in our case we would type <code>resid(fit1))</code>.</p>
<p>To check our residuals from the model we fit in B1.4 we would type:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(fit4), <span class="at">main=</span><span class="st">"Histogram of the residuals"</span>, <span class="at">xlab=</span><span class="st">"Residuals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">resid</span>(fit4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.186462e-12</code></pre>
</div>
</div>
<p><strong>It appears that our residuals are normally distributed with zero mean.</strong></p>
</section>
<section id="checking-homoscedasticity" class="level2" data-number="21.2">
<h2 data-number="21.2" class="anchored" data-anchor-id="checking-homoscedasticity"><span class="header-section-number">21.2</span> Checking Homoscedasticity</h2>
<p>One of main assumptions of ordinary least squares linear regression is that there is homogeneity of variance (i.e.&nbsp;homoscedasticity) of the residuals. If the variance of our residuals is heteroscedastic then this indicates model misspecification, similar to the reasons discussed before.</p>
<p>To check homogeneity in variance this we plot the values of the residuals against the fitted (predicted) values from the regression model. If the assumptions is satisfied we should see a random scatter of the points with no pattern. If we see a pattern, i.e.&nbsp;the scatterplot gets wider or narrower at a certain range of values, then this indicates heteroscedasticity and we need to re-evaluate our model. To plot the residuals versus the fitted values, we can use <code>plot(resid(fit5) ~ fitted(fit5), …)</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(fit4) <span class="sc">~</span> <span class="fu">fitted</span>(fit4), </span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"The residuals versus the fitted values"</span>, </span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, </span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>, </span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="at">col=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="question-b1.6" class="level3" data-number="21.2.1">
<h3 data-number="21.2.1" class="anchored" data-anchor-id="question-b1.6"><span class="header-section-number">21.2.1</span> Question B1.6:</h3>
<p>Examine your residuals from the multivariable regression in B1.4. Does this model appear to violate the assumptions of homoscedasticity?</p>
<p><strong>There appears to be a random ball of dots, with no pattern. This is what we want. There does not appear to be heteroscedasticity.</strong></p>
</section>
</section>
</section>
<section id="sec-B2.1" class="level1" data-number="22">
<h1 data-number="22"><span class="header-section-number">22</span> B2.1: ANOVA Revisited- Post-Hoc Testing</h1>
<p>In the last module we looked at linear regression to analyse the effect of different explanatory variables on the SBP of the participants.</p>
<p>We are going to revisit this here and look at it through the lens of the ANOVA.</p>
<p>Let’s look at the association of mean SBP across BMI groups again. But now we want to use the ANOVA post-estimation options to compute multiple comparisons with Fisher’s least-significant difference (LSD) test, which does not adjust the confidence intervals or p-values.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The advantage of this method is that all of the comparisons are shown in one table, so you can inspect any pairing you wish.</p>
</div>
</div>
<p>We can use the <code>LSD.test()</code> function of the <code>agricolae</code> package to perform this test in R.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(sbp<span class="sc">~</span>bmi_fact, <span class="at">data=</span>whitehall)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              Df  Sum Sq Mean Sq F value   Pr(&gt;F)    
bmi_fact       3    6451  2150.4   7.024 0.000104 ***
Residuals   4297 1315528   306.2                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
26 observations deleted due to missingness</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># perform Fisher’s LSD</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agricolae)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">LSD.test</span>(model1, <span class="st">"bmi_fact"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$statistics
   MSerror   Df    Mean      CV
  306.1504 4297 130.727 13.3845

$parameters
        test p.ajusted   name.t ntr alpha
  Fisher-LSD      none bmi_fact   4  0.05

$means
       sbp      std    r        se      LCL      UCL Min Max Q25   Q50    Q75
1 126.6600 18.47294   50 2.4744714 121.8088 131.5112  86 176 115 125.5 136.75
2 129.5695 17.49645 1791 0.4134468 128.7589 130.3801  87 230 118 128.0 139.00
3 131.3661 17.59025 2084 0.3832821 130.6147 132.1176  88 218 119 130.0 142.00
4 133.2394 16.83856  376 0.9023469 131.4703 135.0084  94 190 122 132.0 143.00

$comparison
NULL

$groups
       sbp groups
4 133.2394      a
3 131.3661      a
2 129.5695      b
1 126.6600      b

attr(,"class")
[1] "group"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To interpret this output we look at the section headed ‘$groups’. The groups that have different characters listed beside them (i.e.&nbsp;‘a’ or ‘b’) are significantly different.</p>
</div>
</div>
<section id="question-b2.1" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="question-b2.1"><span class="header-section-number">22.1</span> Question B2.1:</h2>
<p>Review your output. What do you notice? What can you conclude about the data from these tests? Compare this to your output from the linear regression on the same data.</p>
<p>In this output, we can see that :</p>
<ul>
<li>Group 4 and group 2 have significantly different mean SBP, since group 4 has a value of ‘a’ and group 2 has a value of ‘b’.</li>
<li>Group 4 and group 1 have significantly different mean SBP, since group 4 has a value of ‘a’ and group 1 has a value of ‘b’.</li>
<li>Group 4 and group 3 do NOT have significant different mean SBP, since they both have a value of ‘a’.</li>
</ul>
</section>
</section>
<section id="sec-B2.2a" class="level1" data-number="23">
<h1 data-number="23"><span class="header-section-number">23</span> B2.2a: Correcting For Multiple Comparisons</h1>
<section id="false-discovery-rate" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="false-discovery-rate"><span class="header-section-number">23.1</span> False Discovery Rate</h2>
<p>To use this method, we must first assign a value for q. Whereas α is the proportion of false positive tests we are willing to accept across the whole sample typically 0.05 (5%), q is the proportion of false positives (false ‘discoveries’) that we are willing to accept within the significant results. In this example we will set q to 0.05 (5%) as well.</p>
<p>Here we are going to apply the Benjamini-Hochberg (BH) method to the data from the Fishers LSD test in the previous practical in <a href="#sec-B2.1" class="quarto-xref">Section&nbsp;22</a></p>
<p>Firstly, take the P values for each comparison of pairs and put them in ascending numerical order. Then assign a rank number in that order (smallest P value is rank 1, next smallest rank 2 and so on).</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Group A</th>
<th>Group B</th>
<th>P</th>
<th>Rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Normal</td>
<td>Obese</td>
<td>&lt;0.001</td>
<td>1</td>
</tr>
<tr class="even">
<td>Normal</td>
<td>Overweight</td>
<td>0.001</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Underweight</td>
<td>Obese</td>
<td>0.013</td>
<td>3</td>
</tr>
<tr class="even">
<td>Overweight</td>
<td>Obese</td>
<td>0.056</td>
<td>4</td>
</tr>
<tr class="odd">
<td>Underweight</td>
<td>Overweight</td>
<td>0.060</td>
<td>5</td>
</tr>
<tr class="even">
<td>Underweight</td>
<td>Normal</td>
<td>0.246</td>
<td>6</td>
</tr>
</tbody>
</table>
<p>Calculate the BH critical value for each P value, using the formula q(i/m), where:</p>
<p>i = the individual p-value’s rank,</p>
<p>m = total number of tests,</p>
<p>q= the false discovery rate you have selected (0.05)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Group A</th>
<th>Group B</th>
<th>P</th>
<th>Rank</th>
<th>BHcrit</th>
<th>Significant</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Normal</td>
<td>Obese</td>
<td>&lt;0.001</td>
<td>1</td>
<td>0.008</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Normal</td>
<td>Overweight</td>
<td>0.001</td>
<td>2</td>
<td>0.016</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>Underweight</td>
<td>Obese</td>
<td>0.013</td>
<td>3</td>
<td>0.025</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Overweight</td>
<td>Obese</td>
<td>0.056</td>
<td>4</td>
<td>0.033</td>
<td>No</td>
</tr>
<tr class="odd">
<td>Underweight</td>
<td>Overweight</td>
<td>0.060</td>
<td>5</td>
<td>0.042</td>
<td>No</td>
</tr>
<tr class="even">
<td>Underweight</td>
<td>Normal</td>
<td>0.246</td>
<td>6</td>
<td>0.050</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>P values which are lower than our BH critical values are considered true ‘discoveries’. The first P value which is higher than the BH critical value and all significant P values below that (below in terms of the table, higher rank numbers) would be considered false ‘discoveries’. P values of ≥0.05 are not treated any differently to normal.</p>
<p>From this we can conclude that all three of our statistically significant differences from out pairwise comparisons are in true ‘discoveries’, and none of them should be discounted.</p>
<p>With small numbers of comparisons like this it is easy to use this method by hand, however where the FDR approach is most useful is when we are making very large numbers (hundreds) of comparisons.</p>
<pre><code>BH(u, alpha = 0.05)</code></pre>
<p>where u is a vector containing all of the P values, and alpha is in fact your specified value for q</p>
<p>There are also online FDR calculator you can use like this one <a href="https://tools.carbocation.com/FDR" target="_blank">https://tools.carbocation.com/FDR</a></p>
<p>In Practical <a href="#sec-B2.1" class="quarto-xref">Section&nbsp;22</a>, we ran the Fisher’s LSD test to compare systolic blood pressure (SBP) between each possible pairing of groups in the BMI group categorical variable. Now we know a little be more about post hoc tests and correcting for multiple comparisons, we are going to go back and conduct the Bonferroni post hoc and Tukey’s HSD post hoc on the same data.</p>
<p><u>Tukey’s test in R</u></p>
<p>The function is ‘TukeyHSD’ (which comes loaded in R already so you do not need to install any packages). You run this function after you fit the ANOVA as you did in <a href="#sec-B2.1" class="quarto-xref">Section&nbsp;22</a> :</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(model1, <span class="at">conf.level =</span> .<span class="dv">95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = sbp ~ bmi_fact, data = whitehall)

$bmi_fact
         diff        lwr       upr     p adj
1-2 -2.909514 -9.3571575  3.538129 0.6523423
3-2  1.796609  0.3476829  3.245534 0.0079012
4-2  3.669847  1.1189404  6.220755 0.0012615
3-1  4.706123 -1.7291986 11.141444 0.2370134
4-1  6.579362 -0.1897670 13.348490 0.0603475
4-3  1.873239 -0.6463616  4.392839 0.2235822</code></pre>
</div>
</div>
<p><u><strong>Bonferroni test in R</strong></u></p>
<p>To perform a Bonferroni correction, you run the post estimation function <code>pairwise.t.test(x, g, p.adjust.method =’bonferroni’)</code>. Here ‘x’ is your response variable, ‘g’ is the grouping variable, and for p.adjust.method you specify ‘bonferroni’.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(whitehall<span class="sc">$</span>sbp, whitehall<span class="sc">$</span>bmi_grp4, <span class="at">p.adjust.method =</span><span class="st">'bonferroni'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pairwise comparisons using t tests with pooled SD 

data:  whitehall$sbp and whitehall$bmi_grp4 

  1      2      3     
2 1.0000 -      -     
3 0.3615 0.0087 -     
4 0.0752 0.0013 0.3366

P value adjustment method: bonferroni </code></pre>
</div>
</div>
<p><strong>Consider the different post hoc tests and the results for each comparison in them. Is one method producing higher or lower p values than the others? Do any previously significant findings become non-significant after correction for multiple comparisons?</strong></p>
<p>The table below shows the outcome for each of the possible pairs, for each of the three different post hoc tests. These have been ordered from smallest to largest p value for ease of comparison.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 15%">
<col style="width: 23%">
<col style="width: 22%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>Group A</th>
<th>Group B</th>
<th>P value</th>
<th>P value</th>
<th>P value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td><strong>Fisher’s LSD</strong></td>
<td><strong>Tukey’s HSD</strong></td>
<td><strong>Bonferroni</strong></td>
</tr>
<tr class="even">
<td>Normal</td>
<td>Obese</td>
<td>&lt;0.001*</td>
<td>0.001*</td>
<td>0.001*</td>
</tr>
<tr class="odd">
<td>Normal</td>
<td>Overweight</td>
<td>0.001*</td>
<td>0.008*</td>
<td>0.009*</td>
</tr>
<tr class="even">
<td>Underweight</td>
<td>Obese</td>
<td>0.013*</td>
<td>0.060</td>
<td>0.075</td>
</tr>
<tr class="odd">
<td>Overweight</td>
<td>Obese</td>
<td>0.056</td>
<td>0.224</td>
<td>0.337</td>
</tr>
<tr class="even">
<td>Underweight</td>
<td>Overweight</td>
<td>0.060</td>
<td>0.237</td>
<td>0.361</td>
</tr>
<tr class="odd">
<td>Underweight</td>
<td>Normal</td>
<td>0.246</td>
<td>0.652</td>
<td>1.000</td>
</tr>
</tbody>
</table>
<p>*= P&lt;0.05- Reject H0</p>
<p><strong>You should notice that the p-vales are lowest for each comparison on the LSD test, and highest in the Bonferroni. Once we apply a correction for multiple comparisons in this way the significant difference in SBP between underweight and obese groups disappears and we fail to reject the null hypothesis for this pairing.</strong></p>
</section>
</section>
<section id="sec-B2.3" class="level1" data-number="24">
<h1 data-number="24"><span class="header-section-number">24</span> B2.3 Two-way ANOVA</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain when and how to use post hoc testing</p></li>
<li><p>Explain the concept of multiple comparisons and be able to correct for it in their analysis</p></li>
<li><p><strong>Apply extensions to the basic ANOVA test and interpret their results</strong></p></li>
<li><p>Explain when and how to use repeated measures statistics</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/b/s!AtvH6PgKXPEDgz3HJp8wKSQNWAY1?e=eanHFp" target="_blank">B2.3 Two-way ANOVA</a></p>
<p>We can also use the ANOVA to further investigate the effect of different categorical explanatory variables on one dependent variable.</p>
<p>To demonstrate this, we are going to use a two-way ANOVA to examine multiple explanatory variables and interactions between them.</p>
<p>To continue our example, we want to examine if there are significant differences in the mean SBP between BMI groups that also smoke (or not).</p>
<p>For a two-way ANOVA the command is the same as in <a href="#sec-B2.1" class="quarto-xref">Section&nbsp;22</a>, but with a second variable:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>smoked<span class="ot">&lt;-</span><span class="fu">factor</span>(whitehall<span class="sc">$</span>currsmoker)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(sbp<span class="sc">~</span>bmi_fact<span class="sc">+</span>smoked, <span class="at">data=</span>whitehall)</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              Df  Sum Sq Mean Sq F value   Pr(&gt;F)    
bmi_fact       3    6415  2138.2   6.978 0.000111 ***
smoked         1     190   189.6   0.619 0.431580    
Residuals   4291 1314840   306.4                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
31 observations deleted due to missingness</code></pre>
</div>
</div>
<p>To make this a two-way factorial ANOVA (i.e with an interaction between the independent variables), we substitute an ‘*’ for the ‘+’ sign:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">aov</span>(sbp<span class="sc">~</span>bmi_fact<span class="sc">*</span>smoked, <span class="at">data=</span>whitehall)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  Df  Sum Sq Mean Sq F value   Pr(&gt;F)    
bmi_fact           3    6415  2138.2   6.981 0.000111 ***
smoked             1     190   189.6   0.619 0.431468    
bmi_fact:smoked    3    1558   519.2   1.695 0.165772    
Residuals       4288 1313282   306.3                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
31 observations deleted due to missingness</code></pre>
</div>
</div>
<section id="question-b2.3a" class="level4" data-number="24.0.0.1">
<h4 data-number="24.0.0.1" class="anchored" data-anchor-id="question-b2.3a"><span class="header-section-number">24.0.0.1</span> Question B2.3a:</h4>
<p><strong>Run the two-way factorial ANOVA and interpret your output. How does this compare to the previous test on these relationships?</strong></p>
<p><strong>Answer B2.3a: Test one, including the interaction term, shows a significant relationship between BMI group and SBP but current smoking and the interaction are non-significant. The interaction is adding the least to the model (has the highest P value).</strong></p>
</section>
<section id="question-b2.3b" class="level4" data-number="24.0.0.2">
<h4 data-number="24.0.0.2" class="anchored" data-anchor-id="question-b2.3b"><span class="header-section-number">24.0.0.2</span> Question B2.3b:</h4>
<p><strong>When we are using interaction terms like this if they do not contribute to the model (i.e.&nbsp;are not significant) we can remove them and see if this makes a difference to the other relationships. Go back and run the test a second time but without the interaction between BMI group and current smoking included. What do you notice?</strong></p>
<p>When we remove the interaction term we see the BMI grouping is still showing a significant relationship on its own, but that current smoker is not. If you go back to practical <a href="#sec-B1.4" class="quarto-xref">Section&nbsp;19</a> you can compare these results to those from the multivariable linear regression which included these two variables plus LDL-C. You can see that ANOVA without the interaction, is very similar to the linear regression. More on this in section <a href="#sec-B2.6" class="quarto-xref">Section&nbsp;26.0.0.1</a></p>
<p><u>Minimal Adequate Model</u></p>
<p>As current smoker is also non-significant on its own, so you could choose to remove this as well and see what happens to the model. This is a simplified method of model optimisation known as the <strong>Minimal Adequate Model</strong>, meaning that you remove variables in order from least significant to most significant, until you end up with the simplest model you can. This can be a helpful process if you need to mentally work through your model and understand what each part is contributing. You never want to remove a variable that is significant on its own, or part of a significant interaction, but you can see how removing other non-significant variables can change the overall model. You can do this with any type of General Linear Model.</p>
</section>
</section>
<section id="sec-B2.4" class="level1" data-number="25">
<h1 data-number="25"><span class="header-section-number">25</span> B2.4 Repeated Measures and the Paired T-Test</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain when and how to use post hoc testing</p></li>
<li><p>Explain the concept of multiple comparisons and be able to correct for it in their analysis</p></li>
<li><p>Apply extensions to the basic ANOVA test and interpret their results</p></li>
<li><p><strong>Explain when and how to use repeated measures statistics</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/b/s!AtvH6PgKXPEDgz6Fz1ErStcsG6ZZ?e=a0OFWL" target="_blank">B2.4 Repeated Measures and the Paired t-test</a></p>
<p>For this test you need a variable that has been measured twice in the same participants, so open the FoSSA Mouse data set.</p>
<p>Most statistical software (as a default) always assumes that each row is a participant, so if you have paired measurements you need to make sure you have stored them as separate variables, and they are matched up correctly so each participants ‘before’ and ‘after’ for example are on the same row in your data set.</p>
<p>Here we are going to do a paired t-test between the mouse weights at the start and end of the trial.</p>
<p>The paired t test command in R is:</p>
<pre><code>ttest(x, y, paired=TRUE)</code></pre>
<p>Here we write:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"FoSSA mouse data(in).csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(mouse<span class="sc">$</span>Weight_baseline, mouse<span class="sc">$</span>Weight_end, <span class="at">paired=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  mouse$Weight_baseline and mouse$Weight_end
t = 0.069672, df = 59, p-value = 0.9447
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 -0.6468068  0.6934734
sample estimates:
mean difference 
     0.02333333 </code></pre>
</div>
</div>
<section id="question-b2.5" class="level4" data-number="25.0.0.1">
<h4 data-number="25.0.0.1" class="anchored" data-anchor-id="question-b2.5"><span class="header-section-number">25.0.0.1</span> Question B2.5:</h4>
<p><strong>Run the test and interpret the output. Is there a significant difference in mouse weight between the beginning and end of the trial?</strong></p>
<p>Our value for t is very small (0.070), which indicates a very small difference between the variables. Looking at the two tailed p-value (which is the default), there is no significant difference in weight between the start and end of the trial (p=0.94). We fail to reject the null hypothesis.</p>
</section>
</section>
<section id="sec-B2.5" class="level1" data-number="26">
<h1 data-number="26"><span class="header-section-number">26</span> B2.5 Repeated Measures ANOVA</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain when and how to use post hoc testing</p></li>
<li><p>Explain the concept of multiple comparisons and be able to correct for it in their analysis</p></li>
<li><p><strong>Apply extensions to the basic ANOVA test and interpret their results</strong></p></li>
<li><p><strong>Explain when and how to use repeated measures statistics</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/b/s!AtvH6PgKXPEDgzxwYn7plemWIqYh?e=oKjXNS" target="_blank">B2.5 Repeated Measures ANOVA.pdf</a></p>
<p>We can also use the ANOVA structure to test for differences between paired or repeated groups. We are going to use the repeated measures ANOVA to compare the mouse weights taken at the beginning, middle, and end of the trial in the FoSSA Mouse data set.</p>
<p>To do this test, you need to reshape your data so that it is in ‘long’ format, rather than ‘wide’ format (as it currently is). Long format means that all the Weight variables are in one column, with a second column specifying which time they were measured at (beginning, middle or end). We need an ID variable to reshape our data, and we need to make sure the Weight variables have a standardised name with a number at the end.</p>
<p>You will need to install and load the packages tidyverse, dplyr, and rstatix to perform the necessary commands.</p>
<p>To create a subject ID variable, we can use:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstatix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>mouse<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mouse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then reshape our data to long format:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>mice <span class="ot">&lt;-</span> mouse <span class="sc">%&gt;%</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"time"</span>, <span class="at">value =</span> <span class="st">"weight"</span>, Weight_baseline, Weight_mid, Weight_end) <span class="sc">%&gt;%</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">convert_as_factor</span>(id, time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, to run the repeated measures ANOVA, we will load the ez package and use the function ezANOVA. The help file contains lots of useful information about where to put the relevant variables. We must specify the data, our dependant variable (dv=weight), our subject OD (wid=id) and the within subject factor (within=time):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ez)</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>repeat1 <span class="ot">&lt;-</span> <span class="fu">ezANOVA</span>(<span class="at">data=</span>mice,<span class="at">dv=</span>weight,<span class="at">wid=</span>id,<span class="at">within=</span>time,<span class="at">type=</span><span class="dv">3</span>)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>repeat1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$ANOVA
  Effect DFn DFd        F         p p&lt;.05         ges
2   time   2 118 0.866249 0.4231827       0.005896862

$`Mauchly's Test for Sphericity`
  Effect         W            p p&lt;.05
2   time 0.7210093 7.590772e-05     *

$`Sphericity Corrections`
  Effect       GGe     p[GG] p[GG]&lt;.05       HFe     p[HF] p[HF]&lt;.05
2   time 0.7818665 0.4000192           0.7993554 0.4021355          </code></pre>
</div>
</div>
<p>The top table provides the results of a one-way repeated measures ANOVA if the assumption of sphericity is not violated. You want to look at the row for ‘time’, which shows that the p=0.42. We fail to reject the null hypothesis for a difference in weight across time.</p>
<p>The middle table indicates whether the assumption of sphericity is violated. As p&lt;0.05, we reject the null hypothesis of sphericity, and so will use the sphericity corrections table below.</p>
<p>The bottom table which presents three types of corrections. We can see that the results are consistent and that we do not find evidence to reject the null hypothesis.</p>
<p><strong>Controlling for between-subjects factors</strong></p>
<p>If we want to run this ANOVA again, but control for ‘strain group’, we must first ensure it is a factor. R currently has coded it as an integer value, so we convert to a factor:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>mice<span class="sc">$</span>Strain_group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mice<span class="sc">$</span>Strain_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can then add the between subject factor into the ezANOVA command, using the between argument as below:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>repeat2 <span class="ot">&lt;-</span><span class="fu">ezANOVA</span>(<span class="at">data=</span>mice,<span class="at">dv=</span>weight,<span class="at">wid=</span>id,<span class="at">within=</span>time, <span class="at">between =</span> Strain_group,<span class="at">type=</span><span class="dv">3</span>)</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>repeat2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$ANOVA
             Effect DFn DFd         F            p p&lt;.05         ges
2      Strain_group   2  57  4.334436 1.768830e-02     * 0.091243692
3              time   2 114  1.269825 2.848232e-01       0.007513324
4 Strain_group:time   4 114 14.743714 9.747582e-10     * 0.149509880

$`Mauchly's Test for Sphericity`
             Effect        W          p p&lt;.05
3              time 0.873398 0.02259129     *
4 Strain_group:time 0.873398 0.02259129     *

$`Sphericity Corrections`
             Effect       GGe        p[GG] p[GG]&lt;.05       HFe        p[HF]
3              time 0.8876249 2.828744e-01           0.9141235 2.834173e-01
4 Strain_group:time 0.8876249 7.067603e-09         * 0.9141235 4.427869e-09
  p[HF]&lt;.05
3          
4         *</code></pre>
</div>
</div>
<section id="sec-B2.6" class="level4" data-number="26.0.0.1">
<h4 data-number="26.0.0.1" class="anchored" data-anchor-id="sec-B2.6"><span class="header-section-number">26.0.0.1</span> Question B2.6</h4>
<p><strong>Run the repeated measures ANOVA for difference in weights across the three time points, but this time add ‘Strain Group’ as a ’Between-Subjects Factor. What difference does this make?</strong></p>
</section>
<section id="answer-b2.6" class="level4" data-number="26.0.0.2">
<h4 data-number="26.0.0.2" class="anchored" data-anchor-id="answer-b2.6"><span class="header-section-number">26.0.0.2</span> Answer B2.6:</h4>
<p>When we review values for time:strain group we see that there is now a statistically significant difference, which holds when we correct for the violated sphericity assumption. This means that there is a significant different in weight when corrected for strain group. This is something that requires more investigation, but as these sample sizes are small and we have not considered whether the FoSSA Mouse data set meets all of the assumptions of our general linear model method. We will investigate these relationships in more detail in Module B3.</p>
</section>
</section>
<section id="sec-B3.1" class="level1" data-number="27">
<h1 data-number="27"><span class="header-section-number">27</span> B3.1 The Parametric Assumptions</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p><strong>Explain the importance of the parametric assumptions and determine if they have been met</strong></p></li>
<li><p>Explain the basic principles of rank based non-parametric statistical tests</p></li>
<li><p>Describe the use of a range of common non-parametric tests</p></li>
<li><p>Conduct and interpret common non-parametric tests</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgn4tIEAOqYlsk7h9?e=cJd8n5" target="_blank">B3.1 The Parametric Assumptions</a></p>
<p><u><strong>Part 1: Normality Testing</strong></u></p>
<p>The Shapiro-Wilk test statistic <span class="math inline">\(( W )\)</span> is given by the formula:</p>
<p><span class="math display">\[
W = \frac{\left( \sum_{i=1}^{n} a_i x_{(i)} \right)^2}{\sum_{i=1}^{n} (x_i - \bar{x})^2}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(x_{(i)}\)</span> are the ordered sample values (sorted from smallest to largest),</li>
<li><span class="math inline">\(\bar{x}\)</span> is the sample mean,</li>
<li><span class="math inline">\(a_i\)</span> are constants that depend on the sample size <span class="math inline">\(n\)</span>.</li>
</ul>
<p>We will need to load the dplyr package for data manipulation, and rstatix for the functions required to perform the tests.</p>
<p>We want to run a <strong>Shapiro-Wilk</strong> Test to examine Normality by each of the strain groups. We must first create a new dataset grouping by Strain, and then use this as the input for our test. To create the dataset, we will run:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>mice_g <span class="ot">&lt;-</span> <span class="fu">group_by</span>(mouse, Strain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, we can test the normality of the three weight variables within each strain group. We specify the dataset, and then the variables we want to test:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro_test</span>(mice_g, Weight_baseline, Weight_mid, Weight_end)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  Strain    variable        statistic      p
  &lt;chr&gt;     &lt;chr&gt;               &lt;dbl&gt;  &lt;dbl&gt;
1 KO Cdkn1a Weight_baseline     0.919 0.0928
2 KO Cdkn1a Weight_end          0.940 0.236 
3 KO Cdkn1a Weight_mid          0.877 0.0154
4 KO N-ras  Weight_baseline     0.961 0.555 
5 KO N-ras  Weight_end          0.897 0.0364
6 KO N-ras  Weight_mid          0.971 0.774 
7 Wild      Weight_baseline     0.915 0.0785
8 Wild      Weight_end          0.941 0.253 
9 Wild      Weight_mid          0.934 0.185 </code></pre>
</div>
</div>
<p><strong>Two of the weight variables are statistically significant different (p&lt;0.05) from a Gaussian or normal distribution (The Cdkn1a KO mice and the mid-point, and the n-RAS KO mice at the end of the trial). This would mean we need to use non-parametric tests when analysing these data.</strong></p>
<p><u><strong>Part 2: Homogeneity of Variances</strong></u></p>
<p>In order to test for homogeneity of variance, we must be testing with respect to a factor variable. We wish to test this by strain group, so must convert this variable:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>mouse<span class="sc">$</span>Strain_group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mouse<span class="sc">$</span>Strain_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can use the levene_test function to test the homogeneity of the variances of baseline weight among the strain groups. We specify the dataset, then the variables in the form dependent variable ~ grouping variable:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levene_test</span>(mouse, Weight_baseline <span class="sc">~</span> Strain_group, <span class="at">center =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
    df1   df2 statistic     p
  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
1     2    57      2.02 0.141</code></pre>
</div>
</div>
<p>Levene’s test statistic <span class="math inline">\(( F )\)</span> is given by the formula:</p>
<p><span class="math display">\[
F = \frac{(N - k)}{(k - 1)} \cdot \frac{\sum_{i=1}^{k} N_i (Z_{i\cdot} - Z_{\cdot\cdot})^2}{\sum_{i=1}^{k} \sum_{j=1}^{N_i} (Z_{ij} - Z_{i\cdot})^2}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(k\)</span> is the number of groups,</li>
<li><span class="math inline">\(N\)</span> is the total number of observations across all groups,</li>
<li><span class="math inline">\(N_i\)</span> is the number of observations in the <span class="math inline">\(i\)</span>-th group,</li>
<li><span class="math inline">\(Z_{ij}\)</span> is the transformed value for the <span class="math inline">\(j\)</span>-th observation in the <span class="math inline">\(i\)</span>-th group,</li>
<li><span class="math inline">\(Z_{i\cdot}\)</span> is the mean of the transformed values in group <span class="math inline">\(i\)</span>,</li>
<li><span class="math inline">\(Z_{\cdot\cdot}\)</span> is the overall mean of all transformed values.</li>
</ul>
<section id="question-b3.1b" class="level3" data-number="27.0.1">
<h3 data-number="27.0.1" class="anchored" data-anchor-id="question-b3.1b"><span class="header-section-number">27.0.1</span> Question B3.1b:</h3>
<p>From the output in R, what can you conclude about the variance of the baseline weight?</p>
<p><strong>This tells us that there is no statistically significant difference (p&gt;0.05) in the variance of the mean baseline weight among the strain groups, so the assumption of homogeneity is met.</strong></p>
</section>
</section>
<section id="sec-B3.2" class="level1" data-number="28">
<h1 data-number="28"><span class="header-section-number">28</span> B3.2 Mann-Whitney U Test</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain the importance of the parametric assumptions and determine if they have been met</p></li>
<li><p><strong>Explain the basic principles of rank based non-parametric statistical tests</strong></p></li>
<li><p><strong>Describe the use of a range of common non-parametric tests</strong></p></li>
<li><p><strong>Conduct and interpret common non-parametric tests</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgnuK75Ezaxe_8bPF?e=OLtmJG" target="_blank">B3.2 Mann-Whitney U Test</a></p>
<p>The Mann-Whitney U test is also sometimes called the Wilcoxon Rank-Sum test.</p>
<p>When first examining your data, you may want to check the distribution of the variables of interest and calculate appropriate summary statistics for them.</p>
<p>The Mann-Whitney U statistic for group <span class="math inline">\(X\)</span> is given by:</p>
<p><span class="math display">\[
U_X = n_X n_Y + \frac{n_X(n_X + 1)}{2} - R_X
\]</span></p>
<p>And for group <span class="math inline">\(Y\)</span>:</p>
<p><span class="math display">\[
U_Y = n_X n_Y + \frac{n_Y(n_Y + 1)}{2} - R_Y
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(n_X\)</span> and <span class="math inline">\(n_Y\)</span> are the sample sizes of groups <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>,</li>
<li><span class="math inline">\(R_Y\)</span> and <span class="math inline">\(R_Y\)</span> are the sums of ranks for groups <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, respectively.</li>
</ul>
<p>Our ultimate Mann-Whitney U value is always lowest value of our two groups.</p>
<p><span class="math inline">\(U_{cal}\)</span> &gt; <span class="math inline">\(U_{critical}\)</span> : Fail to reject the <span class="math inline">\(H_o\)</span>. <strong>No Significant difference</strong></p>
<p><span class="math inline">\(U_{cal}\)</span> &lt; <span class="math inline">\(U_{critical}\)</span> : Reject the <span class="math inline">\(H_o\)</span>. <strong>There is Significant difference</strong></p>
<p>The Mann-Whitney U statistic is the smaller of ( U_X ) and ( U_Y ).</p>
<p>We will use the wilcox_test command to perform this. We must specify the data, and the variables to be considered in the form dependent variable ~ grouping variable.</p>
<p>We want to use the Mann-Whitney U Test to determine if there is a significant difference in body condition score between the wild type mice and the Cdkn1a knockout mice at the start of the study (BCS_baseline).</p>
<p>This test can only have two groups so we need to use the comparisons argument in the function so that it specifies the two groups being compared:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox_test</span>(mouse, BCS_baseline <span class="sc">~</span> Strain, <span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"KO Cdkn1a"</span>, <span class="st">"Wild"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 9
  .y.          group1    group2    n1    n2 statistic     p p.adj p.adj.signif
* &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
1 BCS_baseline KO Cdkn1a Wild      20    20       160 0.084 0.084 ns          </code></pre>
</div>
</div>
<p>There is no significant difference (p&gt;0.05) in body condition score between the wild type mice and the Cdkn1a knockout mice at the baseline.</p>
<p><strong>We can see that there is no significant difference (p&gt;0.05) in body condition score between the wild type mice and the Cdkn1a knockout mice at the baseline.</strong></p>
<section id="question-b3.2" class="level3" data-number="28.0.1">
<h3 data-number="28.0.1" class="anchored" data-anchor-id="question-b3.2"><span class="header-section-number">28.0.1</span> Question B3.2:</h3>
<p><strong>Is there a significant difference in body condition score between the two different knockout strain rat the end of the trial?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox_test</span>(mouse, BCS_.end <span class="sc">~</span> Strain, <span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"KO Cdkn1a"</span>, <span class="st">"KO N-ras"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 9
  .y.      group1    group2      n1    n2 statistic       p   p.adj p.adj.signif
* &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;       
1 BCS_.end KO Cdkn1a KO N-ras    20    20       321 5.42e-4 5.42e-4 ***         </code></pre>
</div>
</div>
<p><strong>We can see that the two knockout strains are significantly different (p&lt;0.05) in body condition score at the end of the study.</strong></p>
</section>
</section>
<section id="sec-B3.3" class="level1" data-number="29">
<h1 data-number="29"><span class="header-section-number">29</span> B3.3 Kruskal-Wallis Test</h1>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain the importance of the parametric assumptions and determine if they have been met</p></li>
<li><p>Explain the basic principles of rank based non-parametric statistical tests</p></li>
<li><p><strong>Describe the use of a range of common non-parametric tests</strong></p></li>
<li><p><strong>Conduct and interpret common non-parametric tests</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgnp-KoVxCsssV6wo?e=BvB1z6" target="_blank">B3.3 Kruskal-Wallis Test</a></p>
<p>We can use the kruskal_test command for a comparison between more than two groups. As there is no constraint on the number of groups for the test, we only need to specify the data, followed by the dependent and independent variables in the same was as the previous module <a href="#sec-B3.2" class="quarto-xref">Section&nbsp;28</a></p>
<p>The Kruskal-Wallis test statistic <span class="math inline">\(H\)</span> is given by:</p>
<p><span class="math display">\[
H = \frac{12}{N(N+1)} \sum_{i=1}^{k} \frac{R_i^2}{n_i} - 3(N+1)
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(N\)</span> is the total number of observations across all groups,</li>
<li><span class="math inline">\(k\)</span> is the number of groups,</li>
<li><span class="math inline">\(n_i\)</span> is the number of observations in the <span class="math inline">\(i\)</span>-th group,</li>
<li><span class="math inline">\(R_i\)</span> is the sum of ranks for the <span class="math inline">\(i\)</span>-th group.</li>
</ul>
<p><strong>Explanation:</strong></p>
<ul>
<li><span class="math inline">\(\sum_{i=1}^{k} \frac{R_i^2}{n_i}\)</span> is the sum of squared ranks for each group divided by the number of observations in that group.</li>
<li>The factor <span class="math inline">\(\frac{12}{N(N+1)}\)</span> scales the sum of the squared ranks.</li>
<li>The term <span class="math inline">\(-3(N+1)\)</span> adjusts for the overall number of observations.</li>
</ul>
<section id="question-b3.3" class="level3" data-number="29.0.1">
<h3 data-number="29.0.1" class="anchored" data-anchor-id="question-b3.3"><span class="header-section-number">29.0.1</span> Question B3.3:</h3>
<p><strong>Is there a significant difference between all three mouse strains on their BCS_baseline score?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal_test</span>(mouse, BCS_baseline <span class="sc">~</span> Strain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  .y.              n statistic    df      p method        
* &lt;chr&gt;        &lt;int&gt;     &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;         
1 BCS_baseline    60      7.65     2 0.0218 Kruskal-Wallis</code></pre>
</div>
</div>
<p><strong>These results show that there is a significant difference (p&lt;0.05), reject the null hypothesis</strong> <span class="math inline">\(H_o\)</span> <strong>in the baseline body condition score when comparing all three strains.</strong></p>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Points
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Kruskal Wallis test <span class="math inline">\(W\)</span> starts out same as Mann Whitney U but includes multiple groups.</p></li>
<li><p>Data ranked and analysis conducted based on ranks.</p></li>
<li><p>Calculate <span class="math inline">\(H\)</span> which follows Chi-squared distribution (varies with df)</p></li>
<li><p>Global test- needs post hoc (That means if we find a significant difference in our test, then we need to do post hoc test)</p></li>
<li><p><span class="math inline">\(H_calc\)</span> &gt; <span class="math inline">\(H_critical\)</span>: Reject the <span class="math inline">\(H_o\)</span>, there is a significant difference. Otherwise for <span class="math inline">\(H_calc\)</span> &lt; <span class="math inline">\(H_critical\)</span></p></li>
</ul>
</div>
</div>
</section>
</section>
<section id="sec-B3.4" class="level1" data-number="30">
<h1 data-number="30"><span class="header-section-number">30</span> B3.4 Wilcoxon Signed Rank Test</h1>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain the importance of the parametric assumptions and determine if they have been met</p></li>
<li><p>Explain the basic principles of rank based non-parametric statistical tests</p></li>
<li><p><strong>Describe the use of a range of common non-parametric tests</strong></p></li>
<li><p><strong>Conduct and interpret common non-parametric tests</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgn0kovet1qdWspcb?e=1HsCI2" target="_blank">B3.4 Wilcoxon Signed Rank Test</a></p>
<p>The Wilcoxon signed-rank test statistic <span class="math inline">\(T\)</span> is given by:</p>
<p><span class="math display">\[
T= \sum \text{(Ranks of the absolute differences of the non-zero differences)}
\]</span></p>
<p>Where:</p>
<ul>
<li><p>For each pair of observations <span class="math inline">\((X_i, Y_i)\)</span>, compute the difference <span class="math inline">\(D_i = X_i - Y_i\)</span>.</p></li>
<li><p>Rank the absolute differences <span class="math inline">\(|D_i|\)</span>, ignoring zeros.</p></li>
<li><p>Assign positive or negative signs to the ranks based on the sign of <span class="math inline">\(D_i\)</span>.</p></li>
<li><p><span class="math inline">\(T\)</span> is the sum of the ranks with the appropriate signs.</p></li>
</ul>
<p>The alternative z-test for the Wilcoxon signed-rank test is used when the sample size is large (typically <span class="math inline">\(𝑛&gt; 20\)</span> and the test statistic T is approximately normally distributed.</p>
<p>The Alternative z-statistic for the Wilcoxon signed-rank test is given by:</p>
<p><span class="math display">\[
z = \frac{T - \mu_T}{\sigma_T}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(T\)</span> is the Wilcoxon signed-rank test statistic,</li>
<li><span class="math inline">\(\mu_T\)</span> is the expected mean of <span class="math inline">\(T\)</span>, calculated as:</li>
</ul>
<p><span class="math display">\[
\mu_T = \frac{n(n+1)}{4}
\]</span></p>
<ul>
<li><span class="math inline">\(\sigma_T\)</span> is the standard deviation of <span class="math inline">\(T\)</span>, calculated as:</li>
</ul>
<p><span class="math display">\[
\sigma_T = \sqrt{\frac{n(n+1)(2n+1)}{24}}
\]</span></p>
<p>Where <span class="math inline">\(n\)</span> is the number of non-zero differences between the paired samples. The test evaluates whether the ranks of the positive and negative differences are significantly different, providing evidence of a difference between the paired groups.</p>
<p>We wish to use the Wilcoxon Signed Rank Test to determine if there is a significant difference in body condition score across all mice in the study between the start (BCS_baseline) and end (BCS_end) of the trial.</p>
<p>We use the wilcox.test command to perform this test in R. We specify the two variables, and must use paired=TRUE since the measurements are coming from the same subject:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(mouse<span class="sc">$</span>BCS_baseline, mouse<span class="sc">$</span>BCS_.end, <span class="at">paired =</span> <span class="cn">TRUE</span>, <span class="at">exact =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank test with continuity correction

data:  mouse$BCS_baseline and mouse$BCS_.end
V = 203, p-value = 1
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p><strong>There is no significant difference (p&gt;0.05) in body condition score of the mice between the start and the end of the study.</strong></p>
<section id="question-b3.4" class="level3" data-number="30.0.1">
<h3 data-number="30.0.1" class="anchored" data-anchor-id="question-b3.4"><span class="header-section-number">30.0.1</span> Question B3.4:</h3>
<p><strong>Is there a significant difference between weight at the beginning and weight at the end?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(mouse<span class="sc">$</span>Weight_baseline, mouse<span class="sc">$</span>Weight_end, <span class="at">paired =</span> <span class="cn">TRUE</span>, <span class="at">exact =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank test with continuity correction

data:  mouse$Weight_baseline and mouse$Weight_end
V = 896.5, p-value = 0.9338
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p><strong>From this, we can conclude that there is no significant difference (p&gt;0.05) in the weight of the mice between the start and the end of the study.</strong></p>
</section>
</section>
<section id="sec-B3.5" class="level1" data-number="31">
<h1 data-number="31"><span class="header-section-number">31</span> B3.5 Friedman Test</h1>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain the importance of the parametric assumptions and determine if they have been met</p></li>
<li><p>Explain the basic principles of rank based non-parametric statistical tests</p></li>
<li><p><strong>Describe the use of a range of common non-parametric tests</strong></p></li>
<li><p><strong>Conduct and interpret common non-parametric tests</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgnnz3IqSNK1yuJWe?e=Hiin6X" target="_blank">B3.5 Friedman Test</a></p>
<p>The Friedman test statistic <span class="math inline">\(Q\)</span> is given by:</p>
<p><span class="math display">\[
Q = \frac{12}{nk(k+1)} \sum_{j=1}^{k} R_j^2 - 3n(k+1)
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(n\)</span> is the number of subjects,</li>
<li><span class="math inline">\(k\)</span> is the number of treatments (or conditions),</li>
<li><span class="math inline">\(R_j\)</span> is the sum of ranks for each treatment <span class="math inline">\(j\)</span>.</li>
</ul>
<p>The test assesses whether there are differences between the treatments or conditions across subjects by comparing rank sums.</p>
<p>We want to examine if there is a significant difference in body condition score among the three measures taken during the study for all mice.</p>
<p>As with the repeated measures ANOVA, before we begin using the Friedman test, we must convert our data into long form. We will do this in a similar manner to before, first by creating a subject id variable, and then reshaping the data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>mouse<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mouse)</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>mice1 <span class="ot">&lt;-</span> mouse <span class="sc">%&gt;%</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"time"</span>, <span class="at">value =</span> <span class="st">"BCS"</span>, BCS_baseline, BCS_mid, BCS_.end) <span class="sc">%&gt;%</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">convert_as_factor</span>(id, time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can now use the friendman.test function – it requires three inputs: the data, the comparison you are doing, and the blocking factor (subject id) and takes the form:</p>
<pre><code>friendman.test(data = name, dependent variable ~ independent variable | id)</code></pre>
<p>In this case, we will use:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">friedman.test</span>(<span class="at">data=</span>mice1, BCS <span class="sc">~</span> time <span class="sc">|</span> id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Friedman rank sum test

data:  BCS and time and id
Friedman chi-squared = 1.7045, df = 2, p-value = 0.4264</code></pre>
</div>
</div>
<p><strong>The body condition score did not significantly (p&gt;0.05) differ between the time points of measurement when consider all the mice.</strong></p>
<p>Next, we may want to consider the different strains individually. Create a subset containing the N-ras knockout mice only:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>mice2 <span class="ot">&lt;-</span> mouse[mouse<span class="sc">$</span>Strain<span class="sc">==</span><span class="st">"KO N-ras"</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The Friedman test must have all of the id variables in ascending order from 1 to n, so we must remake the id variable in the same manner as before, namely:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>mice2<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mice2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then reshape our data into long form again. Note that this is exactly the same code as above aside from changing the dataset names, so can be run very quickly.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>mice.bcs2 <span class="ot">&lt;-</span> mice2 <span class="sc">%&gt;%</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"time"</span>, <span class="at">value =</span> <span class="st">"BCS"</span>, BCS_baseline, BCS_mid, BCS_.end) <span class="sc">%&gt;%</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">convert_as_factor</span>(id, time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We are now able to run the Friedman test on this subset of our data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">friedman.test</span>(<span class="at">data=</span>mice.bcs2, BCS <span class="sc">~</span> time <span class="sc">|</span> id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Friedman rank sum test

data:  BCS and time and id
Friedman chi-squared = 14.105, df = 2, p-value = 0.0008651</code></pre>
</div>
</div>
<p><strong>We can see there is a significant difference (p&lt;0.05) in the body condition score of the N-ras knockout mice between the time points of measurement.</strong></p>
</section>
<section id="sec-B3.6" class="level1" data-number="32">
<h1 data-number="32"><span class="header-section-number">32</span> B3.6 Spearman’s Rank Order Correlation</h1>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Explain the importance of the parametric assumptions and determine if they have been met</p></li>
<li><p>Explain the basic principles of rank based non-parametric statistical tests</p></li>
<li><p><strong>Describe the use of a range of common non-parametric tests</strong></p></li>
<li><p><strong>Conduct and interpret common non-parametric tests</strong></p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgnxcM_MCm6zgY6Cx?e=WEArfh" target="_blank">B3.6 Spearman’s Rank Order Correlation</a></p>
<p>The Spearman rank correlation coefficient <span class="math inline">\(\rho\)</span> is given by:</p>
<p><span class="math display">\[
\rho = 1 - \frac{6 \sum d_i^2}{n(n^2 - 1)}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(d_i\)</span> is the difference between the ranks of each pair of observations,</li>
<li><span class="math inline">\(n\)</span> is the number of paired observations.</li>
</ul>
<p><em>This formula is used to measure the strength and direction of association between two ranked variables.</em></p>
<p>To test the significance of the Spearman rank correlation coefficient <span class="math inline">\(\rho\)</span>, the t-statistic can be calculated as:</p>
<p><span class="math display">\[
t = \frac{\rho \sqrt{n - 2}}{\sqrt{1 - \rho^2}}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(t\)</span> is the t-statistic,</li>
<li><span class="math inline">\(\rho\)</span> is the Spearman rank correlation coefficient,</li>
<li><span class="math inline">\(n\)</span> is the number of paired observations.</li>
</ul>
<p>The t-statistic follows a t-distribution with <span class="math inline">\(n - 2\)</span> degrees of freedom, allowing you to test whether the Spearman correlation is significantly different from zero.</p>
<p>For the last practical in this module, you are going to perform a test of correlation on non-parametric data using the Spearman’s Rank Order Correlation.</p>
<p>This can be conducted using the cor.test command, which has the structure:</p>
<pre><code>cor.test(data$variable 1, data$variable 2, method="spearman")</code></pre>
<p>We can specify spearman as the method to conduct a Spearman’s rank test. If the method is not specified, the default is Pearson’s correlation.</p>
<section id="question-b3.6" class="level3" data-number="32.0.1">
<h3 data-number="32.0.1" class="anchored" data-anchor-id="question-b3.6"><span class="header-section-number">32.0.1</span> Question B3.6:</h3>
<p><strong>What is the spearman correlation between Weight_end and BCS_end?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(mouse<span class="sc">$</span>Weight_end, mouse<span class="sc">$</span>BCS_.end, <span class="at">method =</span> <span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  mouse$Weight_end and mouse$BCS_.end
S = 6700.1, p-value = 2.695e-15
alternative hypothesis: true rho is not equal to 0
sample estimates:
     rho 
0.813835 </code></pre>
</div>
</div>
<p><strong>We can see that there is a significant (p&lt;0.05) correlation between the body condition score and the weight of the mice at the end of the study and their correlation coefficient is 0.81.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Points
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Spearman’s test ranks data, then works out differences between ranks.</p></li>
<li><p>Take sum of squares of differences.</p></li>
<li><p>Use this to calculate correlation coefficient (<span class="math inline">\(\rho\)</span>)</p></li>
<li><p>Interpret in same manner as for parametric test of correlation.</p></li>
<li><p>Use <span class="math inline">\(\rho\)</span> to calculate t.</p></li>
<li><p>T distribution gives p-value.</p></li>
</ul>
</div>
</div>
</section>
</section>
<section id="c1-binary-data-and-logistic-regression" class="level1" data-number="33">
<h1 data-number="33"><span class="header-section-number">33</span> C1: Binary Data and Logistic Regression</h1>
<section id="sec-C1.1" class="level2" data-number="33.1">
<h2 data-number="33.1" class="anchored" data-anchor-id="sec-C1.1"><span class="header-section-number">33.1</span> C1.1 Introduction to Prevalence, Risk, Odds and Rates</h2>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Define and calculate prevalence, risk, odds and rates</p></li>
<li><p>Calculate and interpret risk ratios, odds ratios, rate ratios and their 95% confidence intervals</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgmvzvj557dfR9vVB?e=qDd8VU" target="_blank">C1.1 Introduction to Prevalence, Risk, Odds and Rates</a></p>
<section id="risk" class="level3" data-number="33.1.1">
<h3 data-number="33.1.1" class="anchored" data-anchor-id="risk"><span class="header-section-number">33.1.1</span> Risk</h3>
<ul>
<li><p>Risk describes the probability with which an outcome will occur in at risk population.</p></li>
<li><p>Proportion of new cases of an outcome in an at-risk population</p></li>
</ul>
<p>The formula for risk in epidemiology is given by:</p>
<p><span class="math display">\[
\text{risk (p)} = \frac{\text{Number of new outcomes (e.g., cases of disease)}}{\text{Total population at risk during a specific time period}}
\]</span></p>
<p><strong>Risk of CVD in the Oxford Study</strong></p>
<ul>
<li><p>1000 participants in the Oxford Study</p></li>
<li><p>400 develop CVD</p></li>
<li><p>Risk of CVD in the Oxford Study:</p></li>
</ul>
<p><span class="math display">\[
\text{risk (p)} = \frac{\text{Number of cases CVD}}{\text{Number in Oxford Study}} = \frac{400}{1000} = 0.40 \text{ or } 40\%
\]</span></p>
<p><strong>The risk of CVD in the Oxford Study is 40%</strong></p>
</section>
<section id="odds" class="level3" data-number="33.1.2">
<h3 data-number="33.1.2" class="anchored" data-anchor-id="odds"><span class="header-section-number">33.1.2</span> Odds</h3>
<ul>
<li>Odds is another way of presenting probability (or risk)</li>
</ul>
<p>The formula for odds in epidemiology is given by:</p>
<p><span class="math display">\[
\text{Odds} = \frac{\text{Number of events}}{\text{Number of non-events}} = \frac{\text{Number of Outcome}}{\text{Number of No outcome}}
\]</span></p>
<p><span class="math inline">\(\text{         OR          }\)</span></p>
<p><span class="math display">\[
\frac{\text{Outcome} / \text{Total}}{\text{No Outcome} / \text{Total}} = \frac{\text{Risk (Probability of outcome)}}{\text{1 - Risk (Probability of no outcome)}}
\]</span></p>
<p>Or, if you have the probability <span class="math inline">\(p\)</span> of an event, you can express odds in terms of <span class="math inline">\(p\)</span> as:</p>
<p>Alternatively, if <span class="math inline">\(p\)</span> represents the probability of the outcome, the odds can be expressed as:</p>
<p><span class="math display">\[
\text{Odds} = \frac{p}{1 - p}
\]</span></p>
<p><strong>Odds of CVD in the Oxford Study</strong></p>
<ul>
<li>1000 participants in the Oxford Study</li>
<li>400 develop CVD</li>
<li>Risk of CVD in the Oxford Study <span class="math inline">\((p)\)</span> = 0.40</li>
</ul>
<p><span class="math display">\[
\text{Odds} = \frac{p}{1 - p} = \frac{0.40}{1 - 0.40} = \frac{0.40}{0.60} = 0.667 \text{ or } 67\%
\]</span></p>
<p><strong>The odds of having CVD is 67%</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>The difference between risk and odds are small when there are few events, but when there are more events, the odds and risks are different from each other.</li>
<li>So it is obvious in our calculations above that odds is slightly higher than risk, because there are more common events, 400 events.</li>
</ul>
</div>
</div>
</section>
<section id="rates" class="level3" data-number="33.1.3">
<h3 data-number="33.1.3" class="anchored" data-anchor-id="rates"><span class="header-section-number">33.1.3</span> Rates</h3>
<p><span class="math display">\[
\text{Rate} =  \frac{\text{Number of events}}{\text{Person-time at risk}}
\]</span></p>
<ul>
<li>Rate is the number of new cases of an outcome to the total time a population is at risk.</li>
<li>Longitudinal studies can have variable follow-up time.</li>
<li>Rates incorporate time to the event and take account of how long each person was observed for.</li>
</ul>
<p><strong>Rate of CVD in the Oxford Study</strong></p>
<ul>
<li>1000 participants in the Oxford Study</li>
<li>400 develop CVD</li>
<li>Follow-up was 10 years (137052 person-years)</li>
</ul>
<p><span class="math display">\[
\text{rate} =  \frac{\text{Number of cases of CVD}}{\text{Person - time at risk}} = \frac{400}{137052} = .0029
\]</span></p>
<p><span class="math display">\[
\text{rate} = (0.0029)*1000 = 2.9
\]</span></p>
<p><strong>The rate of CVD in the Oxford Study is 2.9 per 1000 person years</strong></p>
<p>Calculate the overall risk of death by using a combination of <code>table()</code> and <code>prop.table()</code> commands:</p>
<pre><code>table(df$death)

prop.table(table(df$death))</code></pre>
<p>Examine the pattern of <strong>risk</strong> of death in relation to increasing age. The margins option in the <code>prop.table()</code> command needs to be set to “2” because we want to report the proportions per group. For example, for age and death, this command would be:</p>
<pre><code>table(df$age_grp, df$death)

prop.table(table(df$age_grp, df$death), margins=2)</code></pre>
</section>
<section id="question-c1.1a.i" class="level3" data-number="33.1.4">
<h3 data-number="33.1.4" class="anchored" data-anchor-id="question-c1.1a.i"><span class="header-section-number">33.1.4</span> Question C1.1a.i:</h3>
<p><strong>What does your table suggest about the risk of death overall?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>death)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   0    1 
2801 1526 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(whitehall<span class="sc">$</span>death))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
        0         1 
0.6473307 0.3526693 </code></pre>
</div>
</div>
<p><strong>For this cohort the overall risk of death is 1526/(2801+1526) = 0.3527 or 35.3% over the years of follow up.</strong></p>
</section>
<section id="question-c1.1a.ii" class="level3" data-number="33.1.5">
<h3 data-number="33.1.5" class="anchored" data-anchor-id="question-c1.1a.ii"><span class="header-section-number">33.1.5</span> Question C1.1a.ii:</h3>
<p><strong>What does your table suggest about the risk death across levels of age?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>age_grp, whitehall<span class="sc">$</span>death)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
       0    1
  1  713  137
  2 1296  507
  3  607  470
  4  185  412</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(whitehall<span class="sc">$</span>age_grp, whitehall<span class="sc">$</span>death), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
             0          1
  1 0.25455195 0.08977720
  2 0.46269190 0.33224115
  3 0.21670832 0.30799476
  4 0.06604784 0.26998689</code></pre>
</div>
</div>
<p><strong>The risk of death appears to increase as age increases.</strong></p>
<p><strong>The epitools R package</strong></p>
<p>A good R package to calculate basic epidemiologic analysis is the epitools R package, which includes commands for the design of two-way and multi-way contingency tables and epidemiologic measures, such as risk ratios and odds ratios. You can find more details on the commands included in the epitools R package <a href="https://cran.r-project.org/web/packages/epitools/epitools.pdf" target="&quot;_blank">here</a>.</p>
<p>Install and load the epitools R package with the following commands:</p>
<pre><code>install.packages("epitools")

library(epitools)</code></pre>
<p><strong><code>The epitab() command</code></strong></p>
<p>A good command in R to explore risk and odds ratios is the <code>epitab()</code> command from the <em>epitools</em> R package. This command is used to produce epidemiological tables with point estimates and CI for risk ratios, and odds ratios.</p>
<p>The syntax for the command is: <code>epitab(x, y, method)</code></p>
<p>where x is the vector of the exposure, y is the vector of the outcome and method can be either “oddsratio” to calculate an odds ratio or “riskratio” to calculate a risk ratio. This command works with either binary or categorical exposures. For categorical exposures, R uses by default the lowest value of the exposure as the reference category.</p>
<p><strong>Using the epitab() command to calculate a risk ratio</strong></p>
<p>We want to obtain the risk ratio of mortality for individuals that are current smokers compared to non-smokers. We type the command:</p>
<pre><code>epitab(x = whitehall$currsmoker, y = whitehall$death, method = "riskratio")</code></pre>
<p>Use the <a href="https://cran.r-project.org/web/packages/epitools/epitools.pdf" target="_blank">help file</a> for the <code>epitab()</code> command to find out how to obtain an odds ratio.</p>
</section>
<section id="question-c1.1b.i" class="level3" data-number="33.1.6">
<h3 data-number="33.1.6" class="anchored" data-anchor-id="question-c1.1b.i"><span class="header-section-number">33.1.6</span> Question C1.1b.i:</h3>
<p><strong>What is the risk ratio and 95% CI of death for individuals that are current smokers compared with individuals that are non-smokers?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epitools)</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>result1 <span class="ot">&lt;-</span>  <span class="fu">epitab</span>(<span class="at">x =</span> whitehall<span class="sc">$</span>currsmoker, <span class="at">y =</span> whitehall<span class="sc">$</span>death, <span class="at">method =</span> <span class="st">"riskratio"</span>)</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$tab
         Outcome
Predictor    0        p0    1        p1 riskratio    lower    upper    p.value
        0 2473 0.6549258 1303 0.3450742  1.000000       NA       NA         NA
        1  327 0.6000000  218 0.4000000  1.159171 1.036537 1.296314 0.01263365

$measure
[1] "wald"

$conf.level
[1] 0.95

$pvalue
[1] "fisher.exact"</code></pre>
</div>
</div>
<p><strong>The risk ratio for death is 1.16 times higher for current smokers compared to non-smokers. The 95% confidence interval around the risk ratio is 1.04-1.30.</strong></p>
</section>
<section id="question-c1.1b.ii" class="level3" data-number="33.1.7">
<h3 data-number="33.1.7" class="anchored" data-anchor-id="question-c1.1b.ii"><span class="header-section-number">33.1.7</span> Question C1.1b.ii:</h3>
<p><strong>What is the odds ratio for death in individuals that are current smokers vs non-smokers? State and interpret the 95% confidence interval.</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epitools)</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>result2 <span class="ot">&lt;-</span> <span class="fu">epitab</span>(<span class="at">x =</span> whitehall<span class="sc">$</span>currsmoker, <span class="at">y =</span> whitehall<span class="sc">$</span>death, <span class="at">method =</span> <span class="st">"oddsratio"</span>)</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$tab
         Outcome
Predictor    0        p0    1        p1 oddsratio    lower    upper    p.value
        0 2473 0.8832143 1303 0.8566732  1.000000       NA       NA         NA
        1  327 0.1167857  218 0.1433268  1.265285 1.052595 1.520953 0.01263365

$measure
[1] "wald"

$conf.level
[1] 0.95

$pvalue
[1] "fisher.exact"</code></pre>
</div>
</div>
<p><strong>The odds ratio for death in current smokers compared to non-smokers is 1.27 with a 95% confidence interval of 1.05-1.52. Or, you could say: “The odds of death in current smokers are 1.27 times those of non-smokers.”</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>The 95% CI states that there is a 95% chance that the interval containing the true population odds ratio lies between 1.05-1.52. Since this interval does not cross 1, it indicates that there are significantly higher odds death for smokers compared to non-smokers.</strong></p>
</div>
</div>
<p><strong>The ‘ir’ command for rates</strong></p>
<p>Now let’s have a look at the rate ratio for death in smokers vs non-smokers. This will require the ‘rateratio’ method in the <code>epitab()</code> command.</p>
<p>Type the following command to produce the rate and rate ratio:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>death_no_smokers <span class="ot">&lt;-</span> <span class="fu">sum</span>(whitehall<span class="sc">$</span>death[whitehall<span class="sc">$</span>currsmoker<span class="sc">==</span><span class="st">"0"</span>], <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>death_no_smokers </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1303</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>death_smokers <span class="ot">&lt;-</span> <span class="fu">sum</span>(whitehall<span class="sc">$</span>death[whitehall<span class="sc">$</span>currsmoker<span class="sc">==</span><span class="st">"1"</span>], <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>death_smokers </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 218</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>fup_no_smoker <span class="ot">&lt;-</span> <span class="fu">sum</span>(whitehall<span class="sc">$</span>fu_years[whitehall<span class="sc">$</span>currsmoker<span class="sc">==</span><span class="st">"0"</span>], <span class="at">na.rm=</span>T)</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>fup_no_smoker</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25796.28</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>fup_smoker <span class="ot">&lt;-</span> <span class="fu">sum</span>(whitehall<span class="sc">$</span>fu_years[whitehall<span class="sc">$</span>currsmoker<span class="sc">==</span><span class="st">"1"</span>], <span class="at">na.rm=</span>T)</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>fup_smoker</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3645.13</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epitools)</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>result3 <span class="ot">&lt;-</span>  <span class="fu">epitab</span>(<span class="at">x=</span><span class="fu">c</span>(death_no_smokers, death_smokers), <span class="at">y=</span> <span class="fu">c</span>(fup_no_smoker, fup_smoker), <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"rateratio"</span>))</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$tab
          Outcome
Predictor  c(death_no_smokers, death_smokers) c(fup_no_smoker, fup_smoker)
  Exposed1                               1303                     25796.28
  Exposed2                                218                      3645.13
          Outcome
Predictor  rateratio    lower    upper    p.value
  Exposed1  1.000000       NA       NA         NA
  Exposed2  1.184012 1.025815 1.366605 0.02320371

$measure
[1] "wald"

$conf.level
[1] 0.95

$pvalue
[1] "midp.exact"</code></pre>
</div>
</div>
<p><strong>The rate ratio of death in current vs non-smokers is 1.18. This means the rate of death in current smokers is 1.18 times that of non-smokers. Alternatively, you could say the rate of death in smokers was 18% higher than in non-smokers. The 95% CI is 1.02-1.37. This CI does not cross the null value so we know the rate of death in current smokers is significantly higher than that of non-smokers.</strong></p>
</section>
</section>
<section id="sec-C1.2" class="level2" data-number="33.2">
<h2 data-number="33.2" class="anchored" data-anchor-id="sec-C1.2"><span class="header-section-number">33.2</span> C1.2 The Chi-Square Test and the Test For Trend</h2>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Understand the concept of contingency tables (2x2 table, 2xk table, rxc table)</p></li>
<li><p>Calculate and interpret a chi-squared test of association</p></li>
<li><p>Calculate and interpret a chi-squared test for linear trend in proportions (2xk table)</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgm0tmzRh9XlOU7lN?e=0MIWnY" target="_blank">C1.2 The Chi-Square Test and the Test For Trend</a></p>
<section id="x2-contingency-tables" class="level3" data-number="33.2.1">
<h3 data-number="33.2.1" class="anchored" data-anchor-id="x2-contingency-tables"><span class="header-section-number">33.2.1</span> 2x2 Contingency Tables</h3>
<div id="tbl-first" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-first-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Disease Status
</figcaption>
<div aria-describedby="tbl-first-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">Disease</th>
<th style="text-align: center;">No Disease</th>
<th style="text-align: center;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Exposure Status</td>
<td style="text-align: center;">Exposed</td>
<td style="text-align: center;">a</td>
<td style="text-align: center;">b</td>
<td style="text-align: center;">a+b</td>
</tr>
<tr class="even">
<td style="text-align: center;">Exposure Status</td>
<td style="text-align: center;">Unexposed</td>
<td style="text-align: center;">c</td>
<td style="text-align: center;">d</td>
<td style="text-align: center;">c+d</td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">a+c</td>
<td style="text-align: center;">b+d</td>
<td style="text-align: center;">N</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<section id="sec-BMI" class="level4" data-number="33.2.1.1">
<h4 data-number="33.2.1.1" class="anchored" data-anchor-id="sec-BMI"><span class="header-section-number">33.2.1.1</span> Effect of BMI on the Risk of Death</h4>
<div id="tbl-first" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-first-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: BMI X Death
</figcaption>
<div aria-describedby="tbl-first-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">DEATH</th>
<th style="text-align: center;">DEATH</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>Yes</strong></td>
<td style="text-align: center;"><strong>No</strong></td>
<td style="text-align: center;">Total</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>BMI</strong></td>
<td style="text-align: center;">≥25 kg/m2</td>
<td style="text-align: center;">916 (0.21)</td>
<td style="text-align: center;">816 (0.19)</td>
<td style="text-align: center;">1732</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>BMI</strong></td>
<td style="text-align: center;">&lt;25 kg/m2</td>
<td style="text-align: center;">589 (0.14)</td>
<td style="text-align: center;">1945 (0.46)</td>
<td style="text-align: center;">2534</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1505</td>
<td style="text-align: center;">2761</td>
<td style="text-align: center;">4266</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="chi-square-test" class="level3" data-number="33.2.2">
<h3 data-number="33.2.2" class="anchored" data-anchor-id="chi-square-test"><span class="header-section-number">33.2.2</span> Chi-Square Test</h3>
<ul>
<li>Chi-squared test allows us to determine if there is a statistically significant difference between the expected and observed frequencies in one or more categories</li>
<li>If expected frequencies differ from the observed frequencies, there may be an association between the two categories.</li>
<li>Ho: No association between the BMI groups and death</li>
<li>Ha: There is an association between the BMI groups and death</li>
</ul>
<p>Ho: the proportion <span class="math inline">\(\pi\)</span> of death is the same in each group</p>
<p>Ho: <span class="math inline">\(\pi_{{BMI} \geq 25kg/m2} - \pi_{{BMI} &lt; 25kg/m2}\)</span></p>
<p>Ha: the proportion <span class="math inline">\(\pi\)</span> of death is different</p>
<p>Ha: <span class="math inline">\(\pi_{{BMI} \geq 25kg/m2} \neq \pi_{{BMI} &lt; 25kg/m2}\)</span></p>
<section id="observed-frequencies-for-2x2-table" class="level4" data-number="33.2.2.1">
<h4 data-number="33.2.2.1" class="anchored" data-anchor-id="observed-frequencies-for-2x2-table"><span class="header-section-number">33.2.2.1</span> Observed Frequencies for 2x2 Table</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">DEATH</th>
<th style="text-align: center;">DEATH</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>Yes</strong></td>
<td style="text-align: center;"><strong>No</strong></td>
<td style="text-align: center;">Total</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>BMI</strong></td>
<td style="text-align: center;">≥25 kg/m2</td>
<td style="text-align: center;">916 (a)</td>
<td style="text-align: center;">816 (b)</td>
<td style="text-align: center;">1732 (a+b)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>BMI</strong></td>
<td style="text-align: center;">&lt;25 kg/m2</td>
<td style="text-align: center;">589 (c)</td>
<td style="text-align: center;">1945 (d)</td>
<td style="text-align: center;">2534 (c+d)</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1505 (a+c)</td>
<td style="text-align: center;">2761 (b+d)</td>
<td style="text-align: center;">4266 (a+b+c+d)</td>
</tr>
</tbody>
</table>
</section>
<section id="expected-frequencies-for-2x2-table" class="level4" data-number="33.2.2.2">
<h4 data-number="33.2.2.2" class="anchored" data-anchor-id="expected-frequencies-for-2x2-table"><span class="header-section-number">33.2.2.2</span> Expected Frequencies for 2x2 Table</h4>
<p>The expected frequency for each cell in a 2x2 contingency table is given by:</p>
<p><span class="math display">\[
E_{ij} = \frac{\text{Row Total}_i \times \text{Column Total}_j}{\text{Grand Total}}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(E_{ij}\)</span> is the expected frequency for the cell in row <span class="math inline">\(i\)</span> and column <span class="math inline">\(j\)</span>.</li>
<li><span class="math inline">\(\text{Row Total}_i\)</span> is the total sum for row <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\text{Column Total}_j\)</span> is the total sum for column <span class="math inline">\(j\)</span>.</li>
<li><span class="math inline">\(\text{Grand Total}\)</span> is the total count of all observations in the table.</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">DEATH</th>
<th style="text-align: center;">DEATH</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>Yes</strong></td>
<td style="text-align: center;"><strong>No</strong></td>
<td style="text-align: center;">Total</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>BMI</strong></td>
<td style="text-align: center;">≥25 kg/m2</td>
<td style="text-align: center;"><span class="math inline">\(\frac{(a+b)(a+c)}{a+b+c+d}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{(a+b)(b+d)}{a+b+c+d}\)</span></td>
<td style="text-align: center;">a+b</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>BMI</strong></td>
<td style="text-align: center;">&lt;25 kg/m2</td>
<td style="text-align: center;"><span class="math inline">\(\frac{(c+d)(a+c)}{a+b+c+d}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{(c+d)(b+d)}{a+b+c+d}\)</span></td>
<td style="text-align: center;">c+d</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">a+c</td>
<td style="text-align: center;">b+d</td>
<td style="text-align: center;">a+b+c+d</td>
</tr>
</tbody>
</table>
</section>
<section id="observed-and-expected-frequencies" class="level4" data-number="33.2.2.3">
<h4 data-number="33.2.2.3" class="anchored" data-anchor-id="observed-and-expected-frequencies"><span class="header-section-number">33.2.2.3</span> Observed and Expected Frequencies</h4>
<div id="tbl-second" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-second-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: BMI X Death
</figcaption>
<div aria-describedby="tbl-second-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">DEATH</th>
<th style="text-align: center;">DEATH</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>Yes</strong></td>
<td style="text-align: center;"><strong>No</strong></td>
<td style="text-align: center;">Total</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>BMI</strong></td>
<td style="text-align: center;">≥25 kg/m2</td>
<td style="text-align: center;">916 (<em>611</em>)</td>
<td style="text-align: center;">816 (<em>1211</em>)</td>
<td style="text-align: center;">1732</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>BMI</strong></td>
<td style="text-align: center;">&lt;25 kg/m2</td>
<td style="text-align: center;">589 (<em>894</em>)</td>
<td style="text-align: center;">1945 (<em>1640</em>)</td>
<td style="text-align: center;">2534</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1505</td>
<td style="text-align: center;">2761</td>
<td style="text-align: center;">4266</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="chi-squared-formula" class="level4" data-number="33.2.2.4">
<h4 data-number="33.2.2.4" class="anchored" data-anchor-id="chi-squared-formula"><span class="header-section-number">33.2.2.4</span> Chi-Squared Formula</h4>
<p>The chi-squared test statistic is calculated as:</p>
<p><span class="math display">\[
\chi^2 = \sum \frac{(O_i - E_i)^2}{E_i}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(O_i\)</span> is the observed frequency.</li>
<li><span class="math inline">\(E_i\)</span> is the expected frequency.</li>
</ul>
<p>The chi-squared (<span class="math inline">\(\chi^2\)</span>) calculation is as follows:</p>
<p><span class="math display">\[
\chi^2 = \frac{(1945 - 1640)^2}{1640} + \frac{(589 - 894)^2}{894} + \frac{(816 - 1121)^2}{1121} + \frac{(916 - 611)^2}{611}
\]</span></p>
<p><span class="math display">\[
\chi^2 = 395.93
\]</span></p>
</section>
<section id="degrees-of-freedom" class="level4" data-number="33.2.2.5">
<h4 data-number="33.2.2.5" class="anchored" data-anchor-id="degrees-of-freedom"><span class="header-section-number">33.2.2.5</span> Degrees of Freedom</h4>
<p><span class="math display">\[
df = (r-1)(c-1)
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(df\)</span> is the degrees of freedom</li>
<li><span class="math inline">\(r\)</span> is the number of rows</li>
<li><span class="math inline">\(c\)</span> is the number of columns</li>
</ul>
<p><span class="math display">\[
df = (2-1)(2-1) = 1
\]</span></p>
<p><img src="Picture1.jpg" class="img-fluid"></p>
<div id="fig-Picture2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Picture2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Picture2.png" id="fig-Picture2" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-Picture2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
</section>
<section id="performing-the-chi-square-test-for-association" class="level4" data-number="33.2.2.6">
<h4 data-number="33.2.2.6" class="anchored" data-anchor-id="performing-the-chi-square-test-for-association"><span class="header-section-number">33.2.2.6</span> Performing the chi-square test for association</h4>
<p>We want to look at the association of age group with fatal CVD. In order to obtain a chi-square test for association, we use the <code>chisq.test()</code> command, and the code looks like this: <code>chisq.test(df$age_grp, df$cvd_death, correct=FALSE)</code></p>
</section>
<section id="question-c1.2a" class="level4" data-number="33.2.2.7">
<h4 data-number="33.2.2.7" class="anchored" data-anchor-id="question-c1.2a"><span class="header-section-number">33.2.2.7</span> Question C1.2a:</h4>
<p>Is there an association between age group and fatal CVD? Just looking at a cross-tabulation table without doing any additional steps, are you able to tell which age groups are different from each other?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(whitehall<span class="sc">$</span>age_grp, whitehall<span class="sc">$</span>cvd_death, <span class="at">correct=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  whitehall$age_grp and whitehall$cvd_death
X-squared = 221.7, df = 3, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The chi-square test statistic is shown below the table and is X2 = 221.6 on 3 df (chi2(3)) which gives a p-value of Pr &lt;2.2E-16.</p>
<p>The p value of the chi-square test is highly significant (p&lt;0.001), suggesting that we can reject the null hypothesis that there is no difference in true fatal CVD prevalence across different age groups. While we can observe in the row percentages that fatal CVD prevalence is the highest at older ages, and lowest at younger ages, the chi-square test is a <strong>global</strong> test so it just tells us there is a difference somewhere in the table; it does not tell us which groups are different nor does it tell us about the nature of the association (e.g if it is positive or negative).</p>
</section>
</section>
</section>
<section id="sec-linear" class="level2" data-number="33.3">
<h2 data-number="33.3" class="anchored" data-anchor-id="sec-linear"><span class="header-section-number">33.3</span> Test for Linear Trend</h2>
<ul>
<li>We have been discussing 2x2 contigency table see <a href="#tbl-first" class="quarto-xref">Table&nbsp;2</a> and <a href="#tbl-second" class="quarto-xref">Table&nbsp;3</a>. This time if we are interested in seeing if higher levels of BMI increase our risk of death.</li>
<li>We can recode our binary variable into four categories to better explore the relationship between BMI and risk of death.</li>
</ul>
<section id="x2-table" class="level4" data-number="33.3.0.1">
<h4 data-number="33.3.0.1" class="anchored" data-anchor-id="x2-table"><span class="header-section-number">33.3.0.1</span> 4x2 Table</h4>
<table class="caption-top table">
<caption>BMI X RISK OF DEATH{#tbl-second}</caption>
<colgroup>
<col style="width: 29%">
<col style="width: 24%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">DEATH</th>
<th style="text-align: center;">DEATH</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>Yes</strong></td>
<td style="text-align: center;"><strong>No</strong></td>
<td style="text-align: center;">Total</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>BMI Categories</strong></td>
<td style="text-align: center;">&lt;18.5 kg/m2</td>
<td style="text-align: center;">169 (0.11)</td>
<td style="text-align: center;">822 (0.30)</td>
<td style="text-align: center;">991</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>BMI Categories</strong></td>
<td style="text-align: center;">18.5-&lt;25 kg/m2</td>
<td style="text-align: center;">190 (0.13)</td>
<td style="text-align: center;">601(0.22)</td>
<td style="text-align: center;">791</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>BMI Categories</strong></td>
<td style="text-align: center;">25-&lt;30 Kg/m2</td>
<td style="text-align: center;">230 (0.15)</td>
<td style="text-align: center;">522 (0.19)</td>
<td style="text-align: center;">752</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>BMI Categories</strong></td>
<td style="text-align: center;">≥30 kg/m2</td>
<td style="text-align: center;">916 (0.61)</td>
<td style="text-align: center;">816 (0.3)</td>
<td style="text-align: center;">1732</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1505</td>
<td style="text-align: center;">2761</td>
<td style="text-align: center;">4266</td>
</tr>
</tbody>
</table>
<p>If we take a look at the proportions in the table, it would appears that there is a trend where those with higher BMI have a greater risk of death than those a lower BMI.</p>
<p>And we can see here that it seems that those with the highest level of BMI have 61% risk of death. However, this is just an observation, and we would need to use some statistical test to determine if this observation is true.</p>
<ul>
<li><p>The chi-square test for linear trend (Cochran-Armitage) is used to test for trend in proportions</p></li>
<li><p>Typically used between a binary variable and an ordinal variable with&nbsp;k&nbsp;categories</p></li>
</ul>
<p>Ho: there is no trend in the proportion of death across BMI categories</p>
<p>Ha: There. is trend in the proportion of death across BMI categories</p>
<p>The chi-square test for linear trend (also called the Cochran-Armitage test for linear trend) is obtained using the <code>prop.trend.test()</code> command. The setup of this command is: <code>prop.trend.test(x, n)</code></p>
<p>where:</p>
<ul>
<li>x is the number of events per group, and</li>
<li>n is the total sample size per group</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>death_BMI4cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">169</span>, <span class="dv">190</span>, <span class="dv">230</span>, <span class="dv">916</span>) </span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>total_BMI4cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">991</span>,  <span class="dv">791</span>,  <span class="dv">752</span>, <span class="dv">1732</span>)</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.trend.test</span>( <span class="at">x=</span>death_BMI4cat, <span class="at">n=</span>total_BMI4cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared Test for Trend in Proportions

data:  death_BMI4cat out of total_BMI4cat ,
 using scores: 1 2 3 4
X-squared = 400.8, df = 1, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p><strong>We can reject the null hypothesis that there is no linear trend in the proportion of death across the BMI categories</strong></p>
<p><em>If, we plot a line graph that depicts the relationship of risk of death against Categories of BMI, it will showed that those at the lower levels of BMI have about 15% risk of death as compare to 60% for those in the highest levels of BMI.</em></p>
</section>
<section id="question-c1.2b.i" class="level4" data-number="33.3.0.2">
<h4 data-number="33.3.0.2" class="anchored" data-anchor-id="question-c1.2b.i"><span class="header-section-number">33.3.0.2</span> Question C1.2b.i:</h4>
<p>Obtain the prevalence of prior diabetes in the different groups of BMI. What happens to diabetes prevalence as the BMI group increases?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp41 <span class="ot">&lt;-</span> <span class="fu">factor</span>(whitehall<span class="sc">$</span>bmi_grp4, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Underweight"</span>, <span class="st">"Normal"</span>, <span class="st">"Overweight"</span>, <span class="st">"Obese"</span>))</span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(whitehall<span class="sc">$</span>bmi_grp41, whitehall<span class="sc">$</span>prior_t2dm), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             
                       0          1
  Underweight 0.92000000 0.08000000
  Normal      0.94924707 0.05075293
  Overweight  0.93830703 0.06169297
  Obese       0.91223404 0.08776596</code></pre>
</div>
</div>
<p><strong>The prevalence of diabetes increases from 8% (underweight) to 5% (normal weight) to 8.8% in the group with obesity.</strong></p>
</section>
<section id="question-c1.2b.ii" class="level4" data-number="33.3.0.3">
<h4 data-number="33.3.0.3" class="anchored" data-anchor-id="question-c1.2b.ii"><span class="header-section-number">33.3.0.3</span> Question C1.2b.ii:</h4>
<p>Perform a chi-square test of linear trend. What is the null hypothesis and what do the results of this test suggest?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>bmi_grp41, whitehall<span class="sc">$</span>prior_t2dm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             
                 0    1
  Underweight   46    4
  Normal      1702   91
  Overweight  1962  129
  Obese        343   33</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>t2dm_bmig <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">91</span>, <span class="dv">129</span>, <span class="dv">33</span>)</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>bmi_grp41)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Underweight      Normal  Overweight       Obese 
         50        1793        2091         376 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>total_bmig <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">1793</span>, <span class="dv">2091</span>, <span class="dv">376</span>)</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.trend.test</span>(<span class="at">x =</span> t2dm_bmig , <span class="at">n =</span> total_bmig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared Test for Trend in Proportions

data:  t2dm_bmig out of total_bmig ,
 using scores: 1 2 3 4
X-squared = 5.8129, df = 1, p-value = 0.01591</code></pre>
</div>
</div>
<p><em>The chi-square test for linear trend is obtained using the <code>prop.trend.test()</code> command. The chi-square value (for 1 degree of freedom) is 5.8 and the p-value=0.02. There is evidence of a significant linear trend, and we can reject the null hypothesis that there is no association between diabetes status and BMI group.</em></p>
</section>
</section>
<section id="sec-C1.3" class="level2" data-number="33.4">
<h2 data-number="33.4" class="anchored" data-anchor-id="sec-C1.3"><span class="header-section-number">33.4</span> C1.3 Univariable Logistic Regression</h2>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Calculate and interpret a logistic regression for a binary exposure variable</p></li>
<li><p>Calculate and interpret a logistic regression for a categorical exposure variable</p></li>
<li><p>Calculate and interpret a logistic regression for a continuous exposure variable</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgm_KjLNhJ6sxFAos?e=hnVcsy" target="_blank">C1.3a Univariable Logistic Regression</a></p>
<section id="logistic-regression-models-for-binary-exposure" class="level3" data-number="33.4.1">
<h3 data-number="33.4.1" class="anchored" data-anchor-id="logistic-regression-models-for-binary-exposure"><span class="header-section-number">33.4.1</span> Logistic Regression Models for Binary Exposure</h3>
<section id="review-regression-models" class="level4" data-number="33.4.1.1">
<h4 data-number="33.4.1.1" class="anchored" data-anchor-id="review-regression-models"><span class="header-section-number">33.4.1.1</span> Review: Regression Models</h4>
<ul>
<li><strong>Describe:</strong> relationship between 2 or more variables, where one of these is the “outcome”.</li>
<li><strong>Predict</strong> the value of the outcome for a given value of the “explanatory, exposure” variable.</li>
</ul>
<div id="fig-Picture3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Picture3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Picture3.jpg" id="fig-Picture3" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-Picture3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2
</figcaption>
</figure>
</div>
<ul>
<li><p>The scatterplot (<a href="#fig-Picture3" class="quarto-xref">Figure&nbsp;2</a>) describe linear relationship using the following formula: <span class="math inline">\(y = \alpha + \beta x\)</span>.</p></li>
<li><p>Linear relationship between SBP and BMI: <span class="math inline">\(\text{SBP} = \alpha + \beta\text{BMI}\)</span>. <span class="math inline">\(\text{SBP} = 119.1 + 0.46\text{ BMI }\)</span> : Means SBP of 119.1 mmHg when the BMI is 0 and the <span class="math inline">\(\beta\)</span> coefficient for BMI as per 1 unit increase in BMI, SBP increases by 0.46 mmHg.</p></li>
</ul>
<div id="fig-Picture4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Picture4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Picture4.jpg" id="fig-Picture4" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-Picture4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption>
</figure>
</div>
<ul>
<li>But a linear regression may not be appropriate when the SBP(outcome) is binary (high SBP <span class="math inline">\(\geq\)</span> 120 mmHg and low SBP <span class="math inline">\(&lt;\)</span> 120 mmHg), as seen in <a href="#fig-Picture4" class="quarto-xref">Figure&nbsp;3</a>.</li>
</ul>
<div id="fig-Picture6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Picture6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Picture6.jpg" id="fig-Picture6" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-Picture6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4
</figcaption>
</figure>
</div>
<ul>
<li>When the outcome and exposure and <strong>binary</strong> there are only <code>4 possible values</code> in the scatterplot <a href="#fig-Picture6" class="quarto-xref">Figure&nbsp;4</a> between SBP (1 ≥ 120 mmHg and 0 &lt; 120 mmHg) and BMI (1 ≥ 25 kg/m2 and 0 if &lt; 25 kg/m2). So a <code>2x2 table</code> may be more appropriate.</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">SBP</th>
<th style="text-align: center;">SBP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">&lt;120 mmHg</td>
<td style="text-align: center;">≥120 mmHg</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>BMI</strong></td>
<td style="text-align: center;">&lt;25 kg/m2</td>
<td style="text-align: center;">543 (0.30)</td>
<td style="text-align: center;">1277 (0.70)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>BMI</strong></td>
<td style="text-align: center;">≥25 kg/m2</td>
<td style="text-align: center;">613 (0.25)</td>
<td style="text-align: center;">1833 (0.75)</td>
</tr>
</tbody>
</table>
<ul>
<li>Statistical models based on proportions can be problematic because the proportions are constrained to lie between 0 and 1.</li>
</ul>
</section>
<section id="possible-ways-to-model-a-binary-outcome" class="level4" data-number="33.4.1.2">
<h4 data-number="33.4.1.2" class="anchored" data-anchor-id="possible-ways-to-model-a-binary-outcome"><span class="header-section-number">33.4.1.2</span> Possible Ways to Model a Binary Outcome</h4>
<ol type="1">
<li><p><strong>Proportion</strong> of the outcome in exposed and unexposed <code>but constrained</code> to 0 to 1, which posed problematic.</p></li>
<li><p>Odds of the outcome in exposed and unexposed <code>but constrained</code> from 0 to <span class="math inline">\(\infty\)</span>, which is also problematic.</p></li>
<li><p>Log odds of the outcome in exposed and unexposed are unconstrained, also spanned from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span>. Best to use rather than above methods.</p></li>
</ol>
<p><span class="math inline">\(\text{log(odds)} = \alpha + \beta\text{x}\)</span></p>
<ul>
<li><p>y = log odd of disease</p></li>
<li><p><span class="math inline">\(\alpha\)</span> = true intercept (value of y when x = 0)</p></li>
<li><p><span class="math inline">\(\beta\)</span> = true slope (the increase in log odds per unit increase in x)</p></li>
<li><p>Smoking (Binary exposure): 1= current and 0 = never</p></li>
<li><p>Death (Binary outcome): 1= died and 0 = alive</p></li>
</ul>
<p><span class="math inline">\(\text{log(odds of death)} = \alpha + \beta\text{smoking }\)</span></p>
<p><span class="math inline">\(\text{log of disease in the never smokers (unexposed)} = \alpha + \beta(0) = \alpha\)</span></p>
<p><span class="math inline">\(\text{log of disease in the current smokers (exposed)} = \alpha + \beta(1) = \alpha + \beta\)</span></p>
<p>Refer back to <a href="#tbl-first" class="quarto-xref">Table&nbsp;2</a>, <a href="#fig-Picture2" class="quarto-xref">Figure&nbsp;1</a> and <a href="#sec-BMI" class="quarto-xref">Section&nbsp;33.2.1.1</a>.</p>
<ul>
<li><p>This time, we are interested in quantifying the strength of association between BMI and the risk of death, as well as the directional effect.</p></li>
<li><p>To run a logistic regression in R, we use the <code>glm()</code> command. The set up of the command is: <code>glm(formula, family, data)</code></p></li>
</ul>
<p>where:</p>
<ul>
<li>formula has the format <code>outcome ~ exposure</code>,</li>
<li>family is <code>binomial(link = “logit”)</code> for logistic regression, and</li>
<li>data corresponds to the dataframe including our data.</li>
</ul>
<p>To use this command, you need to confirm that your outcome variable is coded as a factor variable. You can find more details on glm() command in <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/glm.html" target="_blank">this help file</a>.</p>
<p>Using the <code>glm()</code> command above, the <code>log OR (Estimate)</code> and its <code>standard error (Std. Error)</code> are printed, and we estimate the <code>OR</code> and the <code>95% confidence intervals</code> by exponentiating the results with this post-estimation command: <code>exp(cbind(coef(model), confint(model)))</code></p>
</section>
<section id="example" class="level4" data-number="33.4.1.3">
<h4 data-number="33.4.1.3" class="anchored" data-anchor-id="example"><span class="header-section-number">33.4.1.3</span> Example:</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame representing the table</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">c</span>(<span class="st">"≥25 kg/m2"</span>, <span class="st">"&lt;25 kg/m2"</span>, <span class="st">"Total"</span>),</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">DEATH_Yes =</span> <span class="fu">c</span>(<span class="st">"916 (611)"</span>, <span class="st">"589 (894)"</span>, <span class="st">"1505"</span>),</span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">DEATH_No =</span> <span class="fu">c</span>(<span class="st">"816 (1211)"</span>, <span class="st">"1945 (1640)"</span>, <span class="st">"2761"</span>),</span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total =</span> <span class="fu">c</span>(<span class="st">"1732"</span>, <span class="st">"2534"</span>, <span class="st">"4266"</span>)</span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        BMI DEATH_Yes    DEATH_No Total
1 ≥25 kg/m2 916 (611)  816 (1211)  1732
2 &lt;25 kg/m2 589 (894) 1945 (1640)  2534
3     Total      1505        2761  4266</code></pre>
</div>
</div>
<p>To run logistic regression on this dataset, you’ll first need to transform it into a format suitable for analysis. The current dataset contains counts in the form of text (e.g., “916 (611)”) and includes a “Total” row that should be excluded. We need to clean this data, extract the numeric values, and set up a binary variable for logistic regression.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">c</span>(<span class="st">"≥25 kg/m2"</span>, <span class="st">"&lt;25 kg/m2"</span>),</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">DEATH_Yes =</span> <span class="fu">c</span>(<span class="st">"916"</span>, <span class="st">"589"</span>),</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">DEATH_No =</span> <span class="fu">c</span>(<span class="st">"816"</span>, <span class="st">"1945"</span>)</span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the count columns to numeric</span></span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>DEATH_Yes <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>DEATH_Yes)</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>DEATH_No <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>DEATH_No)</span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the data to a long format</span></span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">rep</span>(df<span class="sc">$</span>BMI, <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(df)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(df))),</span>
<span id="cb257-15"><a href="#cb257-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Count =</span> <span class="fu">c</span>(df<span class="sc">$</span>DEATH_Yes, df<span class="sc">$</span>DEATH_No)</span>
<span id="cb257-16"><a href="#cb257-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb257-17"><a href="#cb257-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-18"><a href="#cb257-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Run logistic regression</span></span>
<span id="cb257-19"><a href="#cb257-19" aria-hidden="true" tabindex="-1"></a>model4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Death <span class="sc">~</span> BMI, <span class="at">data =</span> df_long, <span class="at">family =</span> binomial, <span class="at">weights =</span> Count)</span>
<span id="cb257-20"><a href="#cb257-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-21"><a href="#cb257-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb257-22"><a href="#cb257-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Death ~ BMI, family = binomial, data = df_long, 
    weights = Count)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -1.19459    0.04703  -25.40   &lt;2e-16 ***
BMI≥25 kg/m2  1.31019    0.06730   19.47   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 5538.6  on 3  degrees of freedom
Residual deviance: 5143.2  on 2  degrees of freedom
AIC: 5147.2

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<ul>
<li><p><strong>The intercept can be explained as the risk of death or the log risk of death in those with BMI of less than 25 kg/m^2 and the BMI coefficient, we can estimate that as the log odds ratio of death for those with a BMI of</strong> <span class="math inline">\(\geq\)</span>.</p></li>
<li><p><strong>The Second column showed the standard error for the test.</strong></p></li>
<li><p><strong>The third and fourth column show the Z statistic for the wald test of the parameter estimates and their corresponding p-values.</strong></p></li>
<li><p><strong>The Z statistic in this model tests the null hypothesis that the true parameter or coefficient equals 0.</strong></p></li>
<li><p><strong>In this test, the null hypothesis is that the</strong> <span class="math inline">\(\beta\)</span> for BMI is 0. However, given the Z statistic for wald test for BMI and the p-value for BMI, we can sufficiently reject the null hypothesis and conclude that the estimates for BMI is significantly different from 1, given that the p-value is 2e-16.</p></li>
<li><p><strong>However, the results given for R for the logistic regression are given on the log scale, which are terribly meaningful.</strong></p></li>
<li><p><strong>Hence, we have to take the exponent of those estimates to get the odds ratio for BMI.</strong></p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model4), <span class="fu">confint</span>(model4)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                           2.5 %    97.5 %
(Intercept)  0.3028278 0.2759467 0.3318232
BMI≥25 kg/m2 3.7068894 3.2501146 4.2313672</code></pre>
</div>
</div>
<p><strong>The odds of death in those with BMI of &lt; 25 kg/m^2 is 30%. The odds of dying is 3.71 times higher in those with a BMI of</strong> <span class="math inline">\(\geq\)</span> 25 kg/m2 vs a BMI of &lt; 25 kg/m2.</p>
</section>
<section id="question-c1.3a" class="level4" data-number="33.4.1.4">
<h4 data-number="33.4.1.4" class="anchored" data-anchor-id="question-c1.3a"><span class="header-section-number">33.4.1.4</span> Question C1.3a:</h4>
<p><strong>Dichotomise the variable ‘sbp’ into below 140 mmHg and greater than or equal to 140 mmHg. Call this variable “hyperten” to indicate “hypertensive”. Use logistic regression to examine the association of hypertensive on your odds of having prior CVD (‘prior_cvd’). Interpret the output</strong></p>
<p>To dichotomise the “sbp” variable, use the following command:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign 0 to "hyperten" where sbp &lt; 140 and sbp is not NA</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>whitehall[<span class="sc">!</span><span class="fu">is.na</span>(whitehall<span class="sc">$</span>sbp) <span class="sc">&amp;</span> whitehall<span class="sc">$</span>sbp <span class="sc">&lt;</span> <span class="dv">140</span>, <span class="st">"hyperten"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign 1 to "hyperten" where sbp &gt;= 140 and sbp is not NA</span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>whitehall[<span class="sc">!</span><span class="fu">is.na</span>(whitehall<span class="sc">$</span>sbp) <span class="sc">&amp;</span> whitehall<span class="sc">$</span>sbp <span class="sc">&gt;=</span> <span class="dv">140</span>, <span class="st">"hyperten"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To run the logistic regression we use the <code>glm()</code> command:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_cvd <span class="sc">~</span> hyperten, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = prior_cvd ~ hyperten, family = binomial(link = "logit"), 
    data = whitehall)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.23835    0.04265 -29.033  &lt; 2e-16 ***
hyperten     0.46809    0.07612   6.149 7.78e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4850.8  on 4317  degrees of freedom
Residual deviance: 4813.9  on 4316  degrees of freedom
  (9 observations deleted due to missingness)
AIC: 4817.9

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>The lnOR (Estimate) and its standard error (Std. Error) are printed, and we estimate the OR and the 95% confidence intervals by exponentiating:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model), <span class="fu">confint</span>(model)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                         2.5 %    97.5 %
(Intercept) 0.289861 0.2664396 0.3149364
hyperten    1.596948 1.3749602 1.8531421</code></pre>
</div>
</div>
<p><strong>The odds of having prior CVD are 1.60 times greater for someone that was hypertensive compared to those who were not (95% CI: 1.38-1.86). This effect is significant (p&lt;0.001), which means that we can reject the null hypothesis that there is no association between hypertension and prior CVD, and that the odds ratio is equal to 1.</strong></p>
</section>
</section>
<section id="logistic-regression-with-a-categorical-exposure" class="level3" data-number="33.4.2">
<h3 data-number="33.4.2" class="anchored" data-anchor-id="logistic-regression-with-a-categorical-exposure"><span class="header-section-number">33.4.2</span> Logistic regression with a categorical exposure</h3>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgm77cgI8m1uaES9R?e=9poXuT" target="_blank">C1.3b Univariable Logistic Regression</a></p>
<p>We may use the <code>glm()</code> command to obtain odds ratios for a categorical variable such as BMI group. By default, the category with the lowest numerical value is treated as reference category.</p>
<section id="research-question" class="level4" data-number="33.4.2.1">
<h4 data-number="33.4.2.1" class="anchored" data-anchor-id="research-question"><span class="header-section-number">33.4.2.1</span> Research Question</h4>
<p>Are categories of BMI (categorical exposure) associated with the risk of death (outcome) ?</p>
<p>Refer back to the table <a href="#tbl-second" class="quarto-xref">Table&nbsp;3</a> used for test for linear trend section <a href="#sec-linear" class="quarto-xref">Section&nbsp;33.3</a></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">c</span>(<span class="st">"&lt;18.5 kg/m2"</span>, <span class="st">"18.5-&lt;25 kg/m2"</span>, <span class="st">"25-&lt;30 kg/m2"</span>, <span class="st">"≥30 kg/m2"</span>),</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death_Yes =</span> <span class="fu">c</span>(<span class="dv">169</span>, <span class="dv">190</span>, <span class="dv">230</span>, <span class="dv">916</span>),</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death_No =</span> <span class="fu">c</span>(<span class="dv">822</span>, <span class="dv">601</span>, <span class="dv">522</span>, <span class="dv">816</span>)</span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape to long format for logistic regression</span></span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>df_long1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">rep</span>(df1<span class="sc">$</span>BMI, <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(df1)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(df1))),</span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Count =</span> <span class="fu">c</span>(df1<span class="sc">$</span>Death_Yes, df1<span class="sc">$</span>Death_No)</span>
<span id="cb266-12"><a href="#cb266-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb266-13"><a href="#cb266-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-14"><a href="#cb266-14" aria-hidden="true" tabindex="-1"></a>df_long1<span class="sc">$</span>BMI_ordinal <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_long1<span class="sc">$</span>BMI)</span>
<span id="cb266-15"><a href="#cb266-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-16"><a href="#cb266-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic regression model</span></span>
<span id="cb266-17"><a href="#cb266-17" aria-hidden="true" tabindex="-1"></a>model5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Death <span class="sc">~</span> BMI, <span class="at">data =</span> df_long1, <span class="at">family =</span> binomial, <span class="at">weights =</span> Count)</span>
<span id="cb266-18"><a href="#cb266-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-19"><a href="#cb266-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the model summary</span></span>
<span id="cb266-20"><a href="#cb266-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Death ~ BMI, family = binomial, data = df_long1, 
    weights = Count)

Coefficients:
                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       -1.58184    0.08446 -18.729  &lt; 2e-16 ***
BMI≥30 kg/m2       1.69744    0.09722  17.461  &lt; 2e-16 ***
BMI18.5-&lt;25 kg/m2  0.43027    0.11858   3.629 0.000285 ***
BMI25-&lt;30 kg/m2    0.76225    0.11575   6.586 4.53e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 5538.6  on 7  degrees of freedom
Residual deviance: 5098.8  on 4  degrees of freedom
AIC: 5106.8

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p><strong>Unlike the previous example, where we fit BMI as a binary variable. We have 3 variables in the model that relate to BMI. So these BMI variables are known as INDICATOR variables, and they are coded as 0 and 1. And each of these variables are comparing the log odds ratio of death to the reference group of BMI, which is the BMI &lt; 18.5 kg/m2.</strong></p>
<p><strong>The intercept is the log odds of death in the unexposed group, so that would be the log odds of death in those with BMI category of 0, which is the reference group for the 4 levels variable of BMI.</strong></p>
<p>The next code will help analyze the results in a form of odds ratio rather than log odds ratio for better interpretation:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model5), <span class="fu">confint</span>(model5)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                2.5 %    97.5 %
(Intercept)       0.2055961 0.1736859 0.2419055
BMI≥30 kg/m2      5.4599722 4.5227171 6.6218289
BMI18.5-&lt;25 kg/m2 1.5376739 1.2191087 1.9410068
BMI25-&lt;30 kg/m2   2.1431000 1.7094246 2.6915133</code></pre>
</div>
</div>
<p><strong>HOW DO WE INTERPRET THESE ODDS RATIO ?</strong></p>
<p>For instance, those with a BMI of 25-&lt;30 kg/m2, they have a 2.14 times higher odds of death than those with a BMI of &lt; 18.5 kg/m2. Those with the BMI of <span class="math inline">\(\geq\)</span> 30 kg/m2 have a 5.5 times higher odds of death than those with a BMI of &lt; 18.5 kg/m2.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>model6 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_cvd <span class="sc">~</span> bmi_grp41, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = prior_cvd ~ bmi_grp41, family = binomial(link = "logit"), 
    data = whitehall)

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)          -1.2657     0.3414  -3.707 0.000209 ***
bmi_grp41Normal       0.1059     0.3459   0.306 0.759502    
bmi_grp41Overweight   0.1880     0.3451   0.545 0.585906    
bmi_grp41Obese        0.3307     0.3601   0.918 0.358485    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4844.0  on 4309  degrees of freedom
Residual deviance: 4840.4  on 4306  degrees of freedom
  (17 observations deleted due to missingness)
AIC: 4848.4

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>Odd ratios in a logistic regression with a categorical variable are interpreted as the odds of the outcome in the specified level compared with a baseline level. The constant refers to the odds of the outcome in the baseline category. We estimate the OR and the 95% confidence intervals by exponentiating:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model6), <span class="fu">confint</span>(model6)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                  2.5 %    97.5 %
(Intercept)         0.2820513 0.1375174 0.5315899
bmi_grp41Normal     1.1116883 0.5841438 2.2973726
bmi_grp41Overweight 1.2068182 0.6352198 2.4906452
bmi_grp41Obese      1.3919192 0.7090235 2.9467805</code></pre>
</div>
</div>
<p>Here, the odds of having prior CVD are 36% higher if a participant has obesity compared to if they have a normal weight (OR:1.39, 95% CI:0.71-2.95). This association is not statistically significant (p=0.40) so we cannot reject the null hypothesis that the OR of obese vs normal weight is 1.</p>
</section>
</section>
<section id="logistic-regression-with-an-ordered-categorical-exposure" class="level3" data-number="33.4.3">
<h3 data-number="33.4.3" class="anchored" data-anchor-id="logistic-regression-with-an-ordered-categorical-exposure"><span class="header-section-number">33.4.3</span> Logistic regression with an ordered categorical exposure</h3>
<p>We can use the logistic command to obtain an odds ratio and a linear trend test for an ordered categorical variable such as BMI group. For this reason, we should tell R that our exposure variable is to be treated as a continuous variable rather than as a categorical variable. We achieve that using the <code>as.numeric()</code> command in the formula.</p>
<section id="research-question-1" class="level4" data-number="33.4.3.1">
<h4 data-number="33.4.3.1" class="anchored" data-anchor-id="research-question-1"><span class="header-section-number">33.4.3.1</span> Research Question</h4>
<p>Are higher levels of BMI (ordered categorical exposure) associated with the risk of death (outcome) ?</p>
<p>Refer back to the table <a href="#tbl-second" class="quarto-xref">Table&nbsp;3</a> used for test for linear trend section <a href="#sec-linear" class="quarto-xref">Section&nbsp;33.3</a></p>
<p>This is similar to the linear trend test <a href="#sec-linear" class="quarto-xref">Section&nbsp;33.3</a>, we want to assess whether there is a linear association between BMI categories with the risk of death. We will be using logistic regression model.</p>
<p><span class="math display">\[
\text{log odds}=\alpha+\beta\text{BMI4cat}
\]</span></p>
<p><span class="math inline">\(\beta\text{BMI4cat}\)</span> = log OR per unit increase in BMI categories.</p>
<p>A unit increase is given by: &lt; 18.5 (1, ref) vs 18.5-&lt;25 kg/m2 (2), or 18.5-&lt;25(2) vs 25-&lt;30 kg/m2 (3), or 25-&lt;30 (3) vs &gt;= 30 kg/m2 (4)</p>
<p>We can perform logistic regression treating our categorical BMI variable as continuous.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">c</span>(<span class="st">"&lt;18.5 kg/m2"</span>, <span class="st">"18.5-&lt;25 kg/m2"</span>, <span class="st">"25-&lt;30 kg/m2"</span>, <span class="st">"≥30 kg/m2"</span>),</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death_Yes =</span> <span class="fu">c</span>(<span class="dv">169</span>, <span class="dv">190</span>, <span class="dv">230</span>, <span class="dv">916</span>),</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death_No =</span> <span class="fu">c</span>(<span class="dv">822</span>, <span class="dv">601</span>, <span class="dv">522</span>, <span class="dv">816</span>)</span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape to long format for logistic regression</span></span>
<span id="cb274-8"><a href="#cb274-8" aria-hidden="true" tabindex="-1"></a>df_long1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb274-9"><a href="#cb274-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">rep</span>(df1<span class="sc">$</span>BMI, <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb274-10"><a href="#cb274-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(df1)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(df1))),</span>
<span id="cb274-11"><a href="#cb274-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Count =</span> <span class="fu">c</span>(df1<span class="sc">$</span>Death_Yes, df1<span class="sc">$</span>Death_No)</span>
<span id="cb274-12"><a href="#cb274-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb274-13"><a href="#cb274-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-14"><a href="#cb274-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert BMI to an ordered factor and then to numeric for ordinal regression</span></span>
<span id="cb274-15"><a href="#cb274-15" aria-hidden="true" tabindex="-1"></a>df_long1<span class="sc">$</span>BMI <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_long1<span class="sc">$</span>BMI, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"&lt;18.5 kg/m2"</span>, <span class="st">"18.5-&lt;25 kg/m2"</span>, <span class="st">"25-&lt;30 kg/m2"</span>, <span class="st">"≥30 kg/m2"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb274-16"><a href="#cb274-16" aria-hidden="true" tabindex="-1"></a>df_long1<span class="sc">$</span>BMI_ordinal <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_long1<span class="sc">$</span>BMI)</span>
<span id="cb274-17"><a href="#cb274-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-18"><a href="#cb274-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic regression model</span></span>
<span id="cb274-19"><a href="#cb274-19" aria-hidden="true" tabindex="-1"></a>model7 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Death <span class="sc">~</span> BMI_ordinal, <span class="at">data =</span> df_long1, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">weights =</span> Count)</span>
<span id="cb274-20"><a href="#cb274-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-21"><a href="#cb274-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the model</span></span>
<span id="cb274-22"><a href="#cb274-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Death ~ BMI_ordinal, family = binomial(link = "logit"), 
    data = df_long1, weights = Count)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.29855    0.09785  -23.49   &lt;2e-16 ***
BMI_ordinal  0.58505    0.03028   19.32   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 5538.6  on 7  degrees of freedom
Residual deviance: 5116.2  on 6  degrees of freedom
AIC: 5120.2

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>We can see that per 1 unit increase across the categorical variables, the log OR is 0.59.</p>
<p>We need to convert the log OR to odds ratio.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model7), <span class="fu">confint</span>(model7)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                         2.5 %   97.5 %
(Intercept) 0.100404 0.0826956 0.121369
BMI_ordinal 1.795078 1.6923953 1.905716</code></pre>
</div>
</div>
<p><strong>How do we interpret an OR of 1.80 for BMI?</strong></p>
<p>OR=1.80 for 18.5-&lt;25 versus &lt; 18.5 kg/m2 OR=1.80 for 25-&lt;30 versus 18.5-&lt;25 kg/m2 OR=1.80 for &gt;= 30 versus 25-&lt;30 kg/m2</p>
<p>It can be interpreted as Per one unit increase in BMI categories, the OR for death is 1.80.</p>
<p>After obtaining our odds ratio, we wants to determine whether BMI as an ordinal variable is significant or not.</p>
<p>The wald test null hypothesis is equivalent to the chi-squared test for linear trend.</p>
<p>The wald test null hypothesis is that there is no association between BMI categories ion death (i.e linear trend OR=1). In our alternative hypothesis, it states that there is an increasing or decreasing linear trend.</p>
<p>In the test, we can see that our Z-value or our wald test is 19.32 and we have p-value of 2e-16, so we have sufficient evidence the null hypothesis and we can interpret these values as there is a statistically significant increasing trend in the log odds of death with linear trend odds ratio of 1.8 and that is significantly different to 1.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>model8 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_cvd <span class="sc">~</span> <span class="fu">as.numeric</span>(bmi_grp41), <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = prior_cvd ~ as.numeric(bmi_grp41), family = binomial(link = "logit"), 
    data = whitehall)

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -1.36810    0.14779  -9.257   &lt;2e-16 ***
as.numeric(bmi_grp41)  0.10066    0.05377   1.872   0.0612 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4844.0  on 4309  degrees of freedom
Residual deviance: 4840.5  on 4308  degrees of freedom
  (17 observations deleted due to missingness)
AIC: 4844.5

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>Note that the Wald test here is equivalent to the chi-square test for linear trend <a href="#sec-linear" class="quarto-xref">Section&nbsp;33.3</a>. The null hypothesis is that there is no association between BMI group and prior CVD (i.e.&nbsp;that the linear trend OR equals 1), and the alternative hypothesis is that there is a linear increasing or decreasing trend. Here, the p-value (p=0.07) indicates that there is not evidence against the null hypothesis (although this is a borderline significant p-value) and we conclude that there is not a statistically significant increasing trend in log odds of prior CVD across groups of BMI.</p>
</section>
<section id="question-c1.3bi." class="level4" data-number="33.4.3.2">
<h4 data-number="33.4.3.2" class="anchored" data-anchor-id="question-c1.3bi."><span class="header-section-number">33.4.3.2</span> Question C1.3bi.:</h4>
<p>Use logistic regression to obtain odds ratios for the association of BMI group on prior diabetes. Try fitting this variable both as a categorical variable and as a linear trend.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp41 <span class="ot">&lt;-</span> <span class="fu">relevel</span>(whitehall<span class="sc">$</span>bmi_grp41, <span class="at">ref =</span> <span class="st">"Normal"</span>)</span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>model9 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_t2dm <span class="sc">~</span> bmi_grp41, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model9)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = prior_t2dm ~ bmi_grp41, family = binomial(link = "logit"), 
    data = whitehall)

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)           -2.9287     0.1076 -27.221  &lt; 2e-16 ***
bmi_grp41Underweight   0.4864     0.5323   0.914  0.36086    
bmi_grp41Overweight    0.2068     0.1408   1.468  0.14204    
bmi_grp41Obese         0.5875     0.2116   2.776  0.00551 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1947.6  on 4309  degrees of freedom
Residual deviance: 1939.8  on 4306  degrees of freedom
  (17 observations deleted due to missingness)
AIC: 1947.8

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>Just to note that the reference group in the model is those with a normal weight. We can estimate the different ORs and their corresponding the 95% confidence intervals from the model by taking the exponential:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model9), <span class="fu">confint</span>(model9)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                     2.5 %    97.5 %
(Intercept)          0.05346651 0.04300229 0.0655958
bmi_grp41Underweight 1.62637362 0.48271514 4.1110344
bmi_grp41Overweight  1.22972745 0.93456038 1.6244822
bmi_grp41Obese       1.79944253 1.17348811 2.6973518</code></pre>
</div>
</div>
<p>The odds ratio of prior diabetes for underweight vs normal weight (as BMI group 2 is the reference group) is 1.63 (95% CI: 0.50-4.11). The z-statistic for this odds ratio is 0.91 and p=0.360 so this odds ratio is not significantly different to 1.</p>
<p>The odds ratio for overweight vs normal weight is 1.23 (95% CI: 0.93-1.62). The z-statistic for this odds ratio is 1.47 and p=0.142 so this odds ratio is not significantly different to 1.</p>
<p>Finally, the odds ratio for obese vs normal weight is 1.80 (95% CI: 1.17-2.70). The z-statistic for this odds ratio is 2.78 and p=0.006 so this odds ratio is significantly different to 1.</p>
</section>
</section>
<section id="logistic-regression-with-a-continuous-exposure" class="level3" data-number="33.4.4">
<h3 data-number="33.4.4" class="anchored" data-anchor-id="logistic-regression-with-a-continuous-exposure"><span class="header-section-number">33.4.4</span> Logistic regression with a continuous exposure</h3>
<p>To fit a logistic regression with a continuous exposure, we type the variable as it is (with no prefix) and we interpret the OR in terms of a 1-unit change in the exposure:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>model10 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_cvd <span class="sc">~</span> hdlc, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = prior_cvd ~ hdlc, family = binomial(link = "logit"), 
    data = whitehall)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -0.3329     0.1102  -3.019  0.00253 ** 
hdlc         -0.7183     0.1002  -7.170 7.49e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4837.2  on 4301  degrees of freedom
Residual deviance: 4783.2  on 4300  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 4787.2

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>We estimate the OR and the 95% confidence intervals by exponentiating:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model10), <span class="fu">confint</span>(model10)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                          2.5 %    97.5 %
(Intercept) 0.7168523 0.5776495 0.8899956
hdlc        0.4875979 0.4000832 0.5925440</code></pre>
</div>
</div>
<p><strong>The odds of having prior CVD were 51% lower for each 1 unit increase in HDL-C (OR: 0.49, 95%CI: 0.40-0.59). This association was statistically significant.</strong></p>
<section id="question-c1.3b.ii" class="level4" data-number="33.4.4.1">
<h4 data-number="33.4.4.1" class="anchored" data-anchor-id="question-c1.3b.ii"><span class="header-section-number">33.4.4.1</span> Question C1.3b.ii:</h4>
<p><strong>Use logistic regression to assess the association between ‘prior_t2dm’ and the continuous exposure variable ‘hdlc’. How would you interpret this output?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>model11 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_t2dm <span class="sc">~</span> hdlc, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = prior_t2dm ~ hdlc, family = binomial(link = "logit"), 
    data = whitehall)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -1.9509     0.1986  -9.824  &lt; 2e-16 ***
hdlc         -0.7691     0.1871  -4.112 3.92e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1946.7  on 4301  degrees of freedom
Residual deviance: 1928.7  on 4300  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 1932.7

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model11), <span class="fu">confint</span>(model11)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                           2.5 %    97.5 %
(Intercept) 0.1421395 0.09611743 0.2093818
hdlc        0.4634117 0.31952668 0.6653126</code></pre>
</div>
</div>
<p><strong>For every 1 unit increase in HDL-C, the odds of having prior diabetes were 54% lower (OR: 0.46 95% CI: 0.32-0.67). This association is statistically significant (p&lt;0.001) so we can reject the null hypothesis that there is no association of HDL-C with prior diabetes.</strong></p>
</section>
</section>
</section>
<section id="sec-C1.4" class="level2" data-number="33.5">
<h2 data-number="33.5" class="anchored" data-anchor-id="sec-C1.4"><span class="header-section-number">33.5</span> C1.4 Multivariable Logistic Regression</h2>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Understand the concepts of confounding</p></li>
<li><p>Use logistic regression to assess for confounding.</p></li>
<li><p>Perform a Wald test on an adjusted odds ratio.</p></li>
<li><p>Control the association of an exposure for additional variables in a logistic regression model.</p></li>
</ul>
</div>
</div>
<p>You can download a copy of the slides here: <a href="https://1drv.ms/p/s!AtvH6PgKXPEDgmzjse6l7obGm4t7?e=YHLEib" target="_blank">C1.4 Multivariable Logistic Regression</a></p>
<section id="controlling-for-confounding-in-logistic-regression-models" class="level3" data-number="33.5.1">
<h3 data-number="33.5.1" class="anchored" data-anchor-id="controlling-for-confounding-in-logistic-regression-models"><span class="header-section-number">33.5.1</span> Controlling for Confounding in Logistic Regression Models</h3>
<section id="research-question-2" class="level4" data-number="33.5.1.1">
<h4 data-number="33.5.1.1" class="anchored" data-anchor-id="research-question-2"><span class="header-section-number">33.5.1.1</span> Research Question</h4>
<p><strong>Is alcohol consumption associated with the risk of heart disease?</strong></p>
</section>
<section id="sec-Alcohol" class="level4" data-number="33.5.1.2">
<h4 data-number="33.5.1.2" class="anchored" data-anchor-id="sec-Alcohol"><span class="header-section-number">33.5.1.2</span> Effect of Alcohol on Heart Disease</h4>
<div id="tbl-third" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-third-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Alcohol Use X Heart Disease
</figcaption>
<div aria-describedby="tbl-third-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">Heart Disease</th>
<th style="text-align: center;">Heart Disease</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>No</strong></td>
<td style="text-align: center;"><strong>Yes</strong></td>
<td style="text-align: center;">Total</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Alcohol Use</strong></td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">815</td>
<td style="text-align: center;">83</td>
<td style="text-align: center;">898</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Alcohol Use</strong></td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;">1664</td>
<td style="text-align: center;">328</td>
<td style="text-align: center;">1972</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">2479</td>
<td style="text-align: center;">411</td>
<td style="text-align: center;">2870</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the raw counts in a data frame</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>df_counts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Alcohol_Use =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Heart_Disease =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Count =</span> <span class="fu">c</span>(<span class="dv">815</span>, <span class="dv">83</span>, <span class="dv">1664</span>, <span class="dv">328</span>)</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand the data frame by repeating rows according to the count</span></span>
<span id="cb292-9"><a href="#cb292-9" aria-hidden="true" tabindex="-1"></a>df_expanded <span class="ot">&lt;-</span> df_counts[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_counts), df_counts<span class="sc">$</span>Count), <span class="fu">c</span>(<span class="st">"Alcohol_Use"</span>, <span class="st">"Heart_Disease"</span>)]</span>
<span id="cb292-10"><a href="#cb292-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-11"><a href="#cb292-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a table format</span></span>
<span id="cb292-12"><a href="#cb292-12" aria-hidden="true" tabindex="-1"></a>table_df <span class="ot">&lt;-</span> <span class="fu">table</span>(df_expanded<span class="sc">$</span>Alcohol_Use, df_expanded<span class="sc">$</span>Heart_Disease)</span>
<span id="cb292-13"><a href="#cb292-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-14"><a href="#cb292-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Chi-squared test</span></span>
<span id="cb292-15"><a href="#cb292-15" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(df_expanded<span class="sc">$</span>Alcohol_Use,  df_expanded<span class="sc">$</span>Heart_Disease,</span>
<span id="cb292-16"><a href="#cb292-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">correct=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  df_expanded$Alcohol_Use and df_expanded$Heart_Disease
X-squared = 26.472, df = 1, p-value = 2.673e-07</code></pre>
</div>
</div>
<p><strong>From the chi-squared test there is a significant association between the two variables. Although, the chi-squared test indicated that there is a difference between alcohol consumption and heart disease. We need to quantify this estimates. So first, we can run a logistic regression test and you can see this output at the top of this fight</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the variables to factors for logistic regression</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>df_expanded<span class="sc">$</span>Alcohol_Use <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_expanded<span class="sc">$</span>Alcohol_Use, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>df_expanded<span class="sc">$</span>Heart_Disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_expanded<span class="sc">$</span>Heart_Disease, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the logistic regression model</span></span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Heart_Disease <span class="sc">~</span> Alcohol_Use, <span class="at">data =</span> df_expanded, <span class="at">family =</span> binomial)</span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Heart_Disease ~ Alcohol_Use, family = binomial, 
    data = df_expanded)

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -2.2843     0.1152 -19.830  &lt; 2e-16 ***
Alcohol_UseYes   0.6604     0.1301   5.077 3.84e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2363.8  on 2889  degrees of freedom
Residual deviance: 2335.5  on 2888  degrees of freedom
AIC: 2339.5

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p><strong>So overall, we can see from the results of this logistic regression that alcohol is significantly associated with heart disease. However, this estimates are on a log scale. So let us take the exponent so we can get the odds ratio</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(m1), <span class="fu">confint</span>(m1)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                              2.5 %    97.5 %
(Intercept)    0.1018405 0.08066848 0.1267961
Alcohol_UseYes 1.9355304 1.50712997 2.5112532</code></pre>
</div>
</div>
<p><strong>We can see that the odds of the heart disease is nearly twice as high (OR = 1.94, 95% CI: 1.51-2.51) in those who consume alcohol versus those who do not consume alcohol</strong></p>
<p><strong>ARE THERE POSSIBLE EXPLANATIONS FOR THIS FINDINGS ?</strong></p>
</section>
<section id="possible-explanations" class="level4" data-number="33.5.1.3">
<h4 data-number="33.5.1.3" class="anchored" data-anchor-id="possible-explanations"><span class="header-section-number">33.5.1.3</span> Possible Explanations</h4>
<ol type="1">
<li><p><strong>Chance</strong> - the z test value of 5.17 gives p&lt;0.001, so chance is very unlikely.</p></li>
<li><p><strong>Bias</strong> - e.g.&nbsp;reporting bias if people with heart disease are more likely to remember risk behaviours.</p></li>
<li><p><strong>Confounding</strong> – that this association is wholly/partly due to another risk factor for heart disease. People who consume alcohol may also be more likely to smoke.</p></li>
<li><p>The association between alcohol use and heart disease is <strong>real</strong></p></li>
</ol>
</section>
<section id="confounders" class="level4" data-number="33.5.1.4">
<h4 data-number="33.5.1.4" class="anchored" data-anchor-id="confounders"><span class="header-section-number">33.5.1.4</span> Confounders</h4>
<ul>
<li><p>A Confounder is a variable that distorts the apparent magnitude of the relationship between an exposure and an outcome.</p></li>
<li><p>For a variable to be a confounder, it needs to be:</p>
<ul>
<li>a risk factor for the outcome, and</li>
<li>associated with the exposure and</li>
<li>not on causal pathway between exposure and outcome.</li>
</ul></li>
<li><p>Smoking is a potential confounder of this association if it is:</p>
<ul>
<li>a risk factor for heart disease and</li>
<li>associated with alcohol consumption.</li>
</ul></li>
</ul>
</section>
<section id="effect-of-smoking-on-heart-disease" class="level4" data-number="33.5.1.5">
<h4 data-number="33.5.1.5" class="anchored" data-anchor-id="effect-of-smoking-on-heart-disease"><span class="header-section-number">33.5.1.5</span> Effect of Smoking on Heart Disease</h4>
<p>To determine if smoking is a risk factor for heart disease, we can perform a logistic regression test to determine if it’s associated with heart disease.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with counts for smoking and heart disease</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">smoke =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">heart_disease =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">count =</span> <span class="fu">c</span>(<span class="dv">1488</span>, <span class="dv">83</span>, <span class="dv">1664</span>, <span class="dv">328</span>)  <span class="co"># These values may need adjusting based on trial and error</span></span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-8"><a href="#cb298-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-9"><a href="#cb298-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand the data frame to use it for logistic regression</span></span>
<span id="cb298-10"><a href="#cb298-10" aria-hidden="true" tabindex="-1"></a>df_exp <span class="ot">&lt;-</span> df4[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df4), df4<span class="sc">$</span>count), <span class="fu">c</span>(<span class="st">"smoke"</span>, <span class="st">"heart_disease"</span>)]</span>
<span id="cb298-11"><a href="#cb298-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-12"><a href="#cb298-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'smoke' and 'heart_disease' to factors</span></span>
<span id="cb298-13"><a href="#cb298-13" aria-hidden="true" tabindex="-1"></a>df_exp<span class="sc">$</span>smoke <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_exp<span class="sc">$</span>smoke, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb298-14"><a href="#cb298-14" aria-hidden="true" tabindex="-1"></a>df_exp<span class="sc">$</span>heart_disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_exp<span class="sc">$</span>heart_disease, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb298-15"><a href="#cb298-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-16"><a href="#cb298-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Run logistic regression</span></span>
<span id="cb298-17"><a href="#cb298-17" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_disease <span class="sc">~</span> smoke, <span class="at">data =</span> df_exp, <span class="at">family =</span> binomial)</span>
<span id="cb298-18"><a href="#cb298-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-19"><a href="#cb298-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb298-20"><a href="#cb298-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = heart_disease ~ smoke, family = binomial, data = df_exp)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -2.8863     0.1128 -25.593   &lt;2e-16 ***
smokeYes      1.2624     0.1279   9.867   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2548.0  on 3562  degrees of freedom
Residual deviance: 2431.8  on 3561  degrees of freedom
AIC: 2435.8

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p><strong>We can see from the logistic regression output that smoking is significantly associated with the risk of heart disease, chi-squared test can also be used</strong></p>
</section>
<section id="effect-of-smoking-on-alcohol-use" class="level4" data-number="33.5.1.6">
<h4 data-number="33.5.1.6" class="anchored" data-anchor-id="effect-of-smoking-on-alcohol-use"><span class="header-section-number">33.5.1.6</span> Effect of Smoking on Alcohol Use</h4>
<p>Next, we want to see whether smoking is associated with alcohol consumption and this can be achieved by creating 2 x 2 table and perfoming a chi-squared test.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">Smoking</th>
<th style="text-align: center;">Smoking</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>No</strong></td>
<td style="text-align: center;"><strong>Yes</strong></td>
<td style="text-align: center;">Total</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Alcohol Use</strong></td>
<td style="text-align: center;">No</td>
<td style="text-align: center;">650</td>
<td style="text-align: center;">83</td>
<td style="text-align: center;">898</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Alcohol Use</strong></td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;">838</td>
<td style="text-align: center;">1134</td>
<td style="text-align: center;">1972</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;">1488</td>
<td style="text-align: center;">1382</td>
<td style="text-align: center;">2870</td>
</tr>
</tbody>
</table>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the raw counts in a data frame</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Alcohol_Use =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Smoking =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Count =</span> <span class="fu">c</span>(<span class="dv">650</span>, <span class="dv">248</span>, <span class="dv">838</span>, <span class="dv">1134</span>)</span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-8"><a href="#cb300-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand the data frame by repeating rows according to the count</span></span>
<span id="cb300-9"><a href="#cb300-9" aria-hidden="true" tabindex="-1"></a>df_exp2 <span class="ot">&lt;-</span> df5[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df5), df5<span class="sc">$</span>Count), <span class="fu">c</span>(<span class="st">"Alcohol_Use"</span>, <span class="st">"Smoking"</span>)]</span>
<span id="cb300-10"><a href="#cb300-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-11"><a href="#cb300-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a table format</span></span>
<span id="cb300-12"><a href="#cb300-12" aria-hidden="true" tabindex="-1"></a>table_df2 <span class="ot">&lt;-</span> <span class="fu">table</span>(df_exp2<span class="sc">$</span>Alcohol_Use, df_exp2<span class="sc">$</span>Smoking)</span>
<span id="cb300-13"><a href="#cb300-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-14"><a href="#cb300-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Chi-squared test</span></span>
<span id="cb300-15"><a href="#cb300-15" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(df_exp2<span class="sc">$</span>Alcohol_Use,  df_exp2<span class="sc">$</span>Smoking,</span>
<span id="cb300-16"><a href="#cb300-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">correct=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  df_exp2$Alcohol_Use and df_exp2$Smoking
X-squared = 220.78, df = 1, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p><strong>We can see that the results of the chi-squared test indicate that smoking is significantly associated with alcohol use. As earlier discussed, we determined that smoking was a risk factor for heart disease and it was associated with alcohol use</strong></p>
<p><strong>So since these assumptions have been meet, then, smoking is a potential confounder</strong></p>
<ul>
<li>So we need to take account of smoking as a confounder:</li>
</ul>
<ol type="1">
<li>Either at the study design stage:</li>
</ol>
<ul>
<li>Randomisation</li>
<li>Restriction</li>
<li>Matching</li>
</ul>
<ol start="2" type="1">
<li>Or the analysis stage:</li>
</ol>
<ul>
<li>Stratification</li>
<li>Regression modelling</li>
</ul>
<ol start="3" type="1">
<li>Failure to account for a confounder means that ORs may be biased</li>
</ol>
<p><strong>In order to control for confounding, we have to use multivariable logistic regression</strong></p>
<ul>
<li><p>Logistic regression models can be extended to include &gt;1 explanatory variable.</p></li>
<li><p>By including 2+ explanatory variables in the same model, we are fitting a model in which each explanatory variable is controlled for the other</p></li>
<li><p>We may fit multivariable models which include:</p>
<ul>
<li><em>&gt;2 variables</em></li>
<li><em>Binary, categorical &amp; continuous (quantitative) variables</em></li>
</ul></li>
</ul>
</section>
<section id="effect-of-alcohol-on-heart-disease---adjusted-for-smoking" class="level4" data-number="33.5.1.7">
<h4 data-number="33.5.1.7" class="anchored" data-anchor-id="effect-of-alcohol-on-heart-disease---adjusted-for-smoking"><span class="header-section-number">33.5.1.7</span> Effect of Alcohol on Heart Disease - Adjusted for Smoking</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with counts for alcohol use, smoking, and heart disease</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">alcohol =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">smoke =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">heart_disease =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">count =</span> <span class="fu">c</span>(<span class="dv">1250</span>, <span class="dv">100</span>, <span class="dv">1250</span>, <span class="dv">300</span>, <span class="dv">900</span>, <span class="dv">150</span>, <span class="dv">1100</span>, <span class="dv">300</span>)  <span class="co"># Adjusted counts to fit approximate output</span></span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb302-8"><a href="#cb302-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-9"><a href="#cb302-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand the data frame by repeating rows according to the count</span></span>
<span id="cb302-10"><a href="#cb302-10" aria-hidden="true" tabindex="-1"></a>df_exp3 <span class="ot">&lt;-</span> df6[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df6), df6<span class="sc">$</span>count), <span class="fu">c</span>(<span class="st">"alcohol"</span>, <span class="st">"smoke"</span>, <span class="st">"heart_disease"</span>)]</span>
<span id="cb302-11"><a href="#cb302-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-12"><a href="#cb302-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'alcohol', 'smoke', and 'heart_disease' to factors</span></span>
<span id="cb302-13"><a href="#cb302-13" aria-hidden="true" tabindex="-1"></a>df_exp3<span class="sc">$</span>alcohol <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_exp3<span class="sc">$</span>alcohol, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb302-14"><a href="#cb302-14" aria-hidden="true" tabindex="-1"></a>df_exp3<span class="sc">$</span>smoke <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_exp3<span class="sc">$</span>smoke, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb302-15"><a href="#cb302-15" aria-hidden="true" tabindex="-1"></a>df_exp3<span class="sc">$</span>heart_disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_exp3<span class="sc">$</span>heart_disease, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb302-16"><a href="#cb302-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-17"><a href="#cb302-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Run logistic regression</span></span>
<span id="cb302-18"><a href="#cb302-18" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_disease <span class="sc">~</span> alcohol <span class="sc">+</span> smoke, <span class="at">data =</span> df_exp3, <span class="at">family =</span> binomial)</span>
<span id="cb302-19"><a href="#cb302-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-20"><a href="#cb302-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb302-21"><a href="#cb302-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = heart_disease ~ alcohol + smoke, family = binomial, 
    data = df_exp3)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.30155    0.07686 -29.943  &lt; 2e-16 ***
alcoholYes   0.31951    0.07567   4.222 2.42e-05 ***
smokeYes     0.77712    0.08111   9.581  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4684.5  on 5349  degrees of freedom
Residual deviance: 4565.9  on 5347  degrees of freedom
AIC: 4571.9

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(m3), <span class="fu">confint</span>(m3)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                           2.5 %    97.5 %
(Intercept) 0.1001038 0.08590003 0.1161161
alcoholYes  1.3764537 1.18684762 1.5968212
smokeYes    2.1752056 1.85774881 2.5534494</code></pre>
</div>
</div>
<p><strong>After taking the exponents of the</strong> <span class="math inline">\(\beta\)</span> <strong>coefficients from our logistic regression model, we can see that the odds ratio for alcohol use is about 1.40. This odds ratio is much smaller than the crude or unadjusted odds ratio (1.94) we had before we add smoking to the model</strong></p>
<p><strong>So we can interpret this odds ratio for alcohol use after adjusting for smoking, the effect of alcohol use on heart disease is similar with an adjusted odds ratio of about 1.40 in the 95% CI: 1.19 - 1.60. And this is statistically significant</strong></p>
</section>
<section id="controlling-for-confounders-in-a-logistic-regression-using-whitehall-data" class="level4" data-number="33.5.1.8">
<h4 data-number="33.5.1.8" class="anchored" data-anchor-id="controlling-for-confounders-in-a-logistic-regression-using-whitehall-data"><span class="header-section-number">33.5.1.8</span> Controlling for confounders in a logistic regression using whitehall data</h4>
<p>Now use the <code>glm()</code> command to obtain the odds ratio for prior CVD with hypertension, adjusted for HDL-C. This may be obtained as follows: <code>model &lt;- glm(prior_cvd ~ hypertens + hdlc, family = binomial(link = "logit"), data = df)</code></p>
<p>Note that the output gives us the odds ratio for ‘hyperten’ adjusted for ‘hdlc’ but it also gives us the odds ratios for ‘hdlc’ adjusted for ‘hyperten’.</p>
</section>
<section id="question-c1.4b" class="level4" data-number="33.5.1.9">
<h4 data-number="33.5.1.9" class="anchored" data-anchor-id="question-c1.4b"><span class="header-section-number">33.5.1.9</span> Question C1.4b:</h4>
<p><strong>What are the odds of having prior CVD if a participant is hypertensive, once you have adjusted for their levels of HDL-C?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_cvd <span class="sc">~</span> hyperten <span class="sc">+</span> hdlc, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = prior_cvd ~ hyperten + hdlc, family = binomial(link = "logit"), 
    data = whitehall)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -0.48531    0.11411  -4.253 2.11e-05 ***
hyperten     0.43917    0.07681   5.718 1.08e-08 ***
hdlc        -0.69387    0.10040  -6.911 4.81e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4829.9  on 4292  degrees of freedom
Residual deviance: 4743.3  on 4290  degrees of freedom
  (34 observations deleted due to missingness)
AIC: 4749.3

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(m4), <span class="fu">confint</span>(m4)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                          2.5 %    97.5 %
(Intercept) 0.6155070 0.4921809 0.7698921
hyperten    1.5514152 1.3339486 1.8026973
hdlc        0.4996366 0.4097819 0.6074451</code></pre>
</div>
</div>
<p><strong>Here, the odds ratio for prior CVD is 1.55 times higher in those with hypertension compared to those without hypertension, after adjusting for HDL-C (OR: 1.55, 95% CI: 1.33-1.80).</strong></p>
</section>
</section>
</section>
</section>
<section id="c2-survival-data" class="level1" data-number="34">
<h1 data-number="34"><span class="header-section-number">34</span> C2: Survival Data</h1>
<section id="sec-C2.1" class="level2" data-number="34.1">
<h2 data-number="34.1" class="anchored" data-anchor-id="sec-C2.1"><span class="header-section-number">34.1</span> C2.1 Introduction to Survival Data</h2>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Understand what <strong>survival data</strong> are</p></li>
<li><p>Understand the notion of <strong>event, time to event</strong> and <strong>censoring</strong> (informative and non-informative)</p></li>
<li><p>Understand <strong>assumptions underpinning censoring</strong> in survival data.</p></li>
<li><p>Definition of <strong>Survival function</strong> and <strong>hazard function</strong>.</p></li>
</ul>
</div>
</div>
<section id="characteristics-of-survival-data" class="level3" data-number="34.1.1">
<h3 data-number="34.1.1" class="anchored" data-anchor-id="characteristics-of-survival-data"><span class="header-section-number">34.1.1</span> Characteristics of Survival Data</h3>
<p>Survival data are <strong>time-to-event:</strong></p>
<ul>
<li>Cohort study on heart disease - time to first heart disease event.</li>
<li>Breast cancer trial time to first recurrence of cancer.</li>
<li>IVF study - time to pregnancy.</li>
</ul>
<p>Special features are <strong>time</strong> and <strong>censoring</strong></p>
<ul>
<li><strong>time</strong> to occurrence of the event of interest.</li>
<li>time to event may not be observed within the timeframe we have, it is therefore <strong>censored</strong></li>
</ul>
<p>Summarized by the <strong>survival function (and hazard function)</strong></p>
<div id="fig-Sur3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Sur3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Survival3.png" id="fig-Sur3" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-Sur3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5
</figcaption>
</figure>
</div>
</section>
<section id="defining-time-to-event" class="level3" data-number="34.1.2">
<h3 data-number="34.1.2" class="anchored" data-anchor-id="defining-time-to-event"><span class="header-section-number">34.1.2</span> Defining time-to event</h3>
<ul>
<li><strong>Event:</strong>
<ul>
<li>e.g.&nbsp;death, recurrence, failure of prosthesis, success of implantation.</li>
<li>Usually a well-defined binary variable for the outcome (e.g, Event: Death- 1=yes, 0=no)</li>
</ul></li>
<li><strong>Time:</strong> Depends on:
<ul>
<li><strong>Origin:</strong> Time when risk of event begins.</li>
<li><strong>entry:</strong> Time when follow-up begins (often origin=entry)</li>
<li><strong>exit:</strong> Time of event or censoring.</li>
<li><strong>Scale:</strong> Units of time e.g Scale days to years by specifying 365.25 as scale if time is measured in days.</li>
</ul></li>
</ul>
<p>Measured in person-time, the sum of observation time contributed by all individuals in the study [<span class="math inline">\(=(\frac{\text{time/origin}}{scale})\)</span>]</p>
</section>
<section id="censoring" class="level3" data-number="34.1.3">
<h3 data-number="34.1.3" class="anchored" data-anchor-id="censoring"><span class="header-section-number">34.1.3</span> Censoring</h3>
<p>Subjects censored at some time t are ignored at all future times.</p>
<section id="assumptions-of-censoring" class="level4" data-number="34.1.3.1">
<h4 data-number="34.1.3.1" class="anchored" data-anchor-id="assumptions-of-censoring"><span class="header-section-number">34.1.3.1</span> Assumptions of censoring</h4>
<ul>
<li>They carry no information about the survival function after t.</li>
<li>If distribution of event-times is similar for censored vs non-censored subjects at a given time, then censoring is “non-informative”</li>
</ul>
</section>
<section id="non-informative-censoring" class="level4" data-number="34.1.3.2">
<h4 data-number="34.1.3.2" class="anchored" data-anchor-id="non-informative-censoring"><span class="header-section-number">34.1.3.2</span> Non-informative Censoring</h4>
<ul>
<li>Censoring at fixed times e.g pre-assigned end of study.</li>
<li>Competing events e.g accidental deaths in a study of death due to MI</li>
</ul>
<p>Loss to follow-up may be informative, e.g if subjects are too ill to continue study - this may be problematic.</p>
<p>Informative censoring usually problematic - carefully check distribution of censoring times.</p>
</section>
</section>
<section id="possible-observations-of-an-individual-being-followed-up-for-time-to-event" class="level3" data-number="34.1.4">
<h3 data-number="34.1.4" class="anchored" data-anchor-id="possible-observations-of-an-individual-being-followed-up-for-time-to-event"><span class="header-section-number">34.1.4</span> Possible Observations of an individual being followed up for time-to-event</h3>
<ol type="1">
<li>They may <code>experience</code> the outcome event - “failure”</li>
<li>They may not <code>experience</code> the outcome event - “survival”</li>
<li>Their event status may <code>not be observed</code> - “censoring”</li>
</ol>
<p>Examples:</p>
<ul>
<li>had other event e.g died</li>
<li>loss to follow-up</li>
<li>overextend to the end of the study and no events was observed for this individual.</li>
</ul>
</section>
<section id="how-censoring-may-arise" class="level3" data-number="34.1.5">
<h3 data-number="34.1.5" class="anchored" data-anchor-id="how-censoring-may-arise"><span class="header-section-number">34.1.5</span> How Censoring may arise</h3>
<ul>
<li>Left censoring: First observation occurs after individual has experienced the outcome, but exact time of outcome is unknown.</li>
<li>Right censoring: The study ends before they experience the event.</li>
<li>Interval censoring: Individual experiences outcome between two observations, but exact time of event is unknown.</li>
</ul>
</section>
<section id="survival-and-hazard-functions" class="level3" data-number="34.1.6">
<h3 data-number="34.1.6" class="anchored" data-anchor-id="survival-and-hazard-functions"><span class="header-section-number">34.1.6</span> Survival and Hazard functions</h3>
<ul>
<li><p>Two functions are very important in survival analysis, and these are the <code>Survival function</code> and <code>Hazard function</code></p></li>
<li><p><code>Survival function:s(t)</code></p>
<ul>
<li>It is the probability that an individual is event-free beyond time (t) also written as <span class="math inline">\(s(t) = P(T\geq t)\)</span></li>
</ul></li>
</ul>
<p>Where: T is the time to event, t = time of event</p>
<ul>
<li><code>Hazard function (hazard rate):</code></li>
</ul>
<p>The hazard function, denoted as <span class="math inline">\(h(t)\)</span>, represents the instantaneous risk of an event occurring after time <span class="math inline">\(t\)</span>, given that the individual is event-free up to time <span class="math inline">\(t\)</span>. In other word, What is the probability that the event will happen between <span class="math inline">\(T\)</span> and the next fraction of time. The formula is:</p>
<p><span class="math display">\[
h(t) = \lim_{\Delta t \to 0} \frac{P(t \leq T &lt; t + \Delta t \mid T \geq t)}{\Delta t}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(h(t)\)</span>: Hazard function at time <span class="math inline">\(t\)</span></li>
<li><span class="math inline">\(T\)</span>: Random variable representing the time to event</li>
<li><span class="math inline">\(\Delta t\)</span>: Infinitesimally small time interval</li>
</ul>
<p>Alternatively, the hazard function can also be expressed in terms of the probability density function <span class="math inline">\(f(t)\)</span> and the survival function <span class="math inline">\(S(t)\)</span> as:</p>
<p><span class="math display">\[
h(t) = \frac{f(t)}{S(t)}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(f(t)\)</span>: Probability density function of time to event</li>
<li><span class="math inline">\(S(t) = P(T &gt; t)\)</span>: Survival function</li>
</ul>
<p>In contrast to the survival function, which focuses on not having an event, the hazard function focuses on the event occurring.</p>
</section>
<section id="why-we-estimate-the-survival-function" class="level3" data-number="34.1.7">
<h3 data-number="34.1.7" class="anchored" data-anchor-id="why-we-estimate-the-survival-function"><span class="header-section-number">34.1.7</span> Why we estimate the Survival function ?</h3>
<ul>
<li><code>Risk(proportion) or odds of events at the end of follow-up</code>
<ul>
<li>Ignore differences in follow-up times across individuals.</li>
<li>Does not deal with censoring appropriately.</li>
</ul></li>
<li><code>Average time-to-event:</code>
<ul>
<li>Event rates may not be constant during follow-up, an ‘average’ would be misleading.</li>
<li>Times-to-event may not follow a know distribution (useful for parametric analysis).</li>
</ul></li>
</ul>
<p><code>The Survival function can overcome these limitations</code></p>
<p>The command <code>Surv</code> is used to create a survival object, which sets up a time to event data structure. When we have only one time period, like in this study, we specify in the form <code>Surv(follow up time, event indicator)</code>.</p>
<p>Since we want to look at the event of “death”, and we have followed participants for several years, the following command is used:</p>
<p><code>library(survival)</code>, <code>surv_object &lt;- Surv(whitehall$fu_years, whitehall$death)</code></p>
<p>The output from R is a matrix with two columns – the first is the survival time, and the second an indicator for death or not.</p>
</section>
<section id="question-c2.1a" class="level3" data-number="34.1.8">
<h3 data-number="34.1.8" class="anchored" data-anchor-id="question-c2.1a"><span class="header-section-number">34.1.8</span> Question C2.1a:</h3>
<p><strong>How many events occurred during the follow up period?</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the number of death events during the follow-up period</span></span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>number_of_deaths <span class="ot">&lt;-</span> <span class="fu">sum</span>(whitehall<span class="sc">$</span>death)</span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>number_of_deaths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1526</code></pre>
</div>
</div>
<p><strong>1,526 deaths</strong></p>
</section>
</section>
<section id="sec-C2.2" class="level2" data-number="34.2">
<h2 data-number="34.2" class="anchored" data-anchor-id="sec-C2.2"><span class="header-section-number">34.2</span> C2.2 Kaplan-Meier Survival Function &amp; the Log Rank Test</h2>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Produce a Kaplan-Meier survival curve and interpret it.</p></li>
<li><p>Test for differences in survival by using a log-rank test.</p></li>
</ul>
</div>
</div>
<section id="sec-C2.2.1" class="level3" data-number="34.2.1">
<h3 data-number="34.2.1" class="anchored" data-anchor-id="sec-C2.2.1"><span class="header-section-number">34.2.1</span> C2.2.1 Kaplan-Meier Survival Function</h3>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li><p>Estimate the survival function using Kaplan-Meier method.</p></li>
<li><p>Plot the estimated survival function.</p></li>
</ul>
</div>
</div>
<section id="kaplan-meier-k-m-method" class="level4" data-number="34.2.1.1">
<h4 data-number="34.2.1.1" class="anchored" data-anchor-id="kaplan-meier-k-m-method"><span class="header-section-number">34.2.1.1</span> Kaplan-Meier (K-M) method</h4>
<ul>
<li>Consider <span class="math inline">\(n\)</span> individuals with observed survival times <span class="math inline">\(t_{1}, t_{2},....,t_{n}\)</span> and suppose there are <span class="math inline">\(r\)</span> events of interest, in our case, we call them deaths.</li>
<li>If we rearrange the death in ascending order <span class="math inline">\(j=1,2,...,r\)</span></li>
</ul>
<p>The <span class="math inline">\(\text{estimated survival function}\)</span> is</p>
<p>The Kaplan-Meier estimator, denoted as <span class="math inline">\(\hat{S}(t)\)</span>, estimates the survival function as:</p>
<p><span class="math display">\[
\hat{S}(t) = \prod_{t_j \leq t} \left(P_{j}\right)
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(P_{j} = 1 - \frac{d_j}{n_j} = \frac{n_{j} - d_{j}}{n_{j}}\)</span></li>
<li><span class="math inline">\(t_j\)</span>: Distinct time points at which events occur</li>
<li><span class="math inline">\(d_j\)</span>: Number of events (deaths) at time <span class="math inline">\(t_j\)</span></li>
<li><span class="math inline">\(n_j\)</span>: Number of individuals at risk just before time <span class="math inline">\(t_j\)</span></li>
</ul>
<p>The <em>estimated survival function</em> is <em>constant between events</em>, so the graph is a <em>step function</em></p>
<p>Recall <a href="#fig-Sur3" class="quarto-xref">Figure&nbsp;5</a>, we have different characteristic of this participants. Some of them died, some of them were lost to follow up, some of them had the event of interest (MI).</p>
<p>Let us compute kaplan-meier estimate of the survival function</p>
<p>To produce a Kaplan-Meier (K-M) Survival Curve for all-cause mortality, we will use the <code>survminer</code> R package which aims to plot time-to-event data using the ggplot R package.</p>
<section id="produce-a-kaplan-meier-curve-for-mortality" class="level5" data-number="34.2.1.1.1">
<h5 data-number="34.2.1.1.1" class="anchored" data-anchor-id="produce-a-kaplan-meier-curve-for-mortality"><span class="header-section-number">34.2.1.1.1</span> Produce a Kaplan-Meier curve for mortality</h5>
<p>The command <code>ggsurvplot()</code> from the <code>survminer</code> R package produces a plot of the K-M survivor function. There are a variety of options that you could use that might make a graph more informative. You can find more details about the <code>survminer</code> R package in <a href="https://rpkgs.datanovia.com/survminer/" target="_blank">this website</a>.</p>
<p>To produce a Kaplan-Meier curve for the total population we run the following command: <code>model &lt;- survfit(Surv(fu_years, death) ~ 1, data = df)</code></p>
<p>To get the risk table at prespecified times, we used the summary() command with the times option: <code>summary(model, times)</code></p>
</section>
<section id="question-c2.2a.i" class="level5" data-number="34.2.1.1.2">
<h5 data-number="34.2.1.1.2" class="anchored" data-anchor-id="question-c2.2a.i"><span class="header-section-number">34.2.1.1.2</span> Question C2.2a.i:</h5>
<p>Use the <code>survfit()</code> and <code>summary()</code> commands and the times option <code>seq(0.5, 9, 0.5)</code> to see what time since re-survey corresponds to 75% survival.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> whitehall)</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m5, <span class="at">times =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">9</span>, <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(fu_years, death) ~ 1, data = whitehall)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
  0.5   4285      41    0.991 0.00147        0.988        0.993
  1.0   4216      69    0.975 0.00239        0.970        0.979
  1.5   4138      78    0.957 0.00310        0.950        0.963
  2.0   4043      95    0.935 0.00376        0.927        0.942
  2.5   3955      88    0.914 0.00426        0.906        0.923
  3.0   3865      89    0.894 0.00469        0.885        0.903
  3.5   3765     100    0.871 0.00510        0.861        0.881
  4.0   3667      97    0.848 0.00546        0.837        0.859
  4.5   3571      96    0.826 0.00577        0.815        0.837
  5.0   3473      97    0.803 0.00604        0.792        0.815
  5.5   3372     100    0.780 0.00630        0.768        0.793
  6.0   3242     129    0.750 0.00658        0.738        0.763
  6.5   3136     106    0.726 0.00678        0.713        0.739
  7.0   3020     114    0.700 0.00697        0.686        0.713
  7.5   2890     125    0.671 0.00715        0.657        0.685
  8.0   1458      48    0.656 0.00732        0.641        0.670
  8.5   1404      54    0.631 0.00776        0.616        0.647</code></pre>
</div>
</div>
<p><em>75% survival occurs at around 6 years, and this agrees with report from stsum below.</em></p>
</section>
<section id="question-c2.2a.ii" class="level5" data-number="34.2.1.1.3">
<h5 data-number="34.2.1.1.3" class="anchored" data-anchor-id="question-c2.2a.ii"><span class="header-section-number">34.2.1.1.3</span> Question C2.2a.ii:</h5>
<p>Use the <code>ggsurvplot()</code> command to plot the cumulative survival, and use the appropriate option to estimate how many participants were at risk going into the 8th year of follow-up.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(m5, <span class="at">risk.table =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-154-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>The graph shows that 1458 participants were at risk going into the 8th year of follow-up.</em></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Time intervals constructed so that each contains 1 event time, which is taken to occur at the start of the interval.</li>
<li>No interval begins at censoring time</li>
<li><span class="math inline">\(\hat{S}(t) = \text{Survival probability * Survival Probability at previous time (t) interval}\)</span></li>
<li>The survival function plot is a step function, with sudden changes in the estimated probability corresponding to times at which an event was observed.</li>
<li>There are vertical lines, which correspond to the times the data were censored, while the horizontal parts correspond to the survival function.</li>
</ul>
</div>
</div>
</section>
</section>
</section>
<section id="confidence-interval-for-survival-function" class="level3" data-number="34.2.2">
<h3 data-number="34.2.2" class="anchored" data-anchor-id="confidence-interval-for-survival-function"><span class="header-section-number">34.2.2</span> Confidence Interval for Survival function</h3>
<ul>
<li>Variance for <span class="math inline">\(\hat{S(t)}\)</span> is usually calculated using <strong>Greenwood’s formula</strong></li>
</ul>
<section id="no-censoring" class="level4" data-number="34.2.2.1">
<h4 data-number="34.2.2.1" class="anchored" data-anchor-id="no-censoring"><span class="header-section-number">34.2.2.1</span> No Censoring</h4>
<p><span class="math display">\[
\hat{S}(t) = \frac{\text{initial number of individuals - number of event up to t}}{\text{initial number of individuals in the study}}
\]</span></p>
<p><span class="math display">\[
\text{Var}(\hat{S}(t)) = \frac{\hat{S}(t)[1 - \hat{S}(t)]}{n}
\]</span></p>
</section>
<section id="with-censoring" class="level4" data-number="34.2.2.2">
<h4 data-number="34.2.2.2" class="anchored" data-anchor-id="with-censoring"><span class="header-section-number">34.2.2.2</span> With Censoring</h4>
<p>The variance of the Kaplan-Meier survival estimate with censoring, using Greenwood’s formula, is:</p>
<p><span class="math display">\[
\text{Var}(\hat{S}(t)) = \hat{S}(t)^2 \sum_{i: t_i \leq t} \frac{d_i}{n_i (n_i - d_i)}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\hat{S}(t)\)</span> is the Kaplan-Meier survival estimate at time <span class="math inline">\(t\)</span>,</li>
<li><span class="math inline">\(d_i\)</span> is the number of observed events at time <span class="math inline">\(t_i\)</span>,</li>
<li><span class="math inline">\(n_i\)</span> is the number of individuals at risk just before <span class="math inline">\(t_i\)</span>.</li>
</ul>
</section>
<section id="confidence-interval-for-the-kaplan-meier-survival-estimate-using-variance" class="level4" data-number="34.2.2.3">
<h4 data-number="34.2.2.3" class="anchored" data-anchor-id="confidence-interval-for-the-kaplan-meier-survival-estimate-using-variance"><span class="header-section-number">34.2.2.3</span> Confidence Interval for the Kaplan-Meier Survival Estimate (Using Variance)</h4>
<p>The approximate <span class="math inline">\(100(1 - \alpha)\%\)</span> confidence interval for the Kaplan-Meier survival estimate <span class="math inline">\(\hat{S}(t)\)</span>, using the variance, is given by:</p>
<p><span class="math display">\[
\left( \hat{S}(t) - z \cdot \sqrt{\text{Var}(\hat{S}(t))}, \hat{S}(t) + z \cdot \sqrt{\text{Var}(\hat{S}(t))} \right)
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\hat{S}(t)\)</span> is the Kaplan-Meier survival estimate at time <span class="math inline">\(t\)</span>,</li>
<li><span class="math inline">\(z\)</span> is the z-score for the desired confidence level (e.g., <span class="math inline">\(z = 1.96\)</span> for a 95% confidence interval),</li>
<li><span class="math inline">\(\text{Var}(\hat{S}(t))\)</span> is the variance of the survival estimate at time <span class="math inline">\(t\)</span>.</li>
</ul>
<p>This formula provides a confidence interval around the survival estimate by directly using the variance, giving an interval centered on <span class="math inline">\(\hat{S}(t)\)</span> with width determined by the variance.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Greenwood formula:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Only asymptomatically correct: It underestimates variance when few subjects remain at risk</li>
<li>Can give CIs outside the range 0 to 1; solution to this problems include:
<ul>
<li>Truncation</li>
<li>Log-transformation</li>
<li>Log-log transformation.</li>
</ul></li>
</ul>
</div>
</div>
</section>
<section id="confidence-interval-for-the-kaplan-meier-survival-estimate-with-log-log-tranformation" class="level4" data-number="34.2.2.4">
<h4 data-number="34.2.2.4" class="anchored" data-anchor-id="confidence-interval-for-the-kaplan-meier-survival-estimate-with-log-log-tranformation"><span class="header-section-number">34.2.2.4</span> Confidence Interval for the Kaplan-Meier Survival Estimate (With log-log tranformation)</h4>
<p>For a Kaplan-Meier survival estimate <span class="math inline">\(\hat{S}(t)\)</span>, the approximate <span class="math inline">\(100(1 - \alpha)\%\)</span> confidence interval is:</p>
<p><span class="math display">\[
\left( \hat{S}(t)^{\exp\left(-z \cdot \text{SE}(\log(-\log(\hat{S}(t))))\right)}, \hat{S}(t)^{\exp\left(z \cdot \text{SE}(\log(-\log(\hat{S}(t))))\right)} \right)
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\hat{S}(t)\)</span> is the Kaplan-Meier survival estimate at time <span class="math inline">\(t\)</span>,</li>
<li><span class="math inline">\(z\)</span> is the z-score for the confidence level (e.g., <span class="math inline">\(z = 1.96\)</span> for 95% confidence),</li>
<li><span class="math inline">\(\text{SE}(\log(-\log(\hat{S}(t))))\)</span> is the standard error of the log-log transformed survival probability.</li>
</ul>
<p>This formula gives a confidence interval for the survival probability at each time point, accounting for the variability in the estimate.</p>
<p>This formula provides an estimate of the variance in survival probability at each observed time point.</p>
</section>
<section id="the-log-rank-test" class="level4" data-number="34.2.2.5">
<h4 data-number="34.2.2.5" class="anchored" data-anchor-id="the-log-rank-test"><span class="header-section-number">34.2.2.5</span> The Log-Rank Test</h4>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li>Understand the log-rank test for comparing the equality of survival functions across groups</li>
</ul>
</div>
</div>
</section>
<section id="comparing-survival-in-two-or-more-grroups" class="level4" data-number="34.2.2.6">
<h4 data-number="34.2.2.6" class="anchored" data-anchor-id="comparing-survival-in-two-or-more-grroups"><span class="header-section-number">34.2.2.6</span> Comparing Survival in Two or More Grroups</h4>
<section id="log-rank-test-test-the-equality-of-the-survival-functions-in-k-groups" class="level5" data-number="34.2.2.6.1">
<h5 data-number="34.2.2.6.1" class="anchored" data-anchor-id="log-rank-test-test-the-equality-of-the-survival-functions-in-k-groups"><span class="header-section-number">34.2.2.6.1</span> Log-rank test (Test the equality of the survival functions in k groups)</h5>
<ul>
<li>Generally, principles of the log-rank test is that their survival function across the key group is the same.</li>
<li>The issue now is that we have certain number of times in which we are looking at this observed events and expected events. And also we not only have the number of times, but we also look at this observed events and expected events across groups.</li>
<li>For example, if we take the case of 2 groups of patients, are there observed events at a particular time <span class="math inline">\(t\)</span> in a group k or we indicated this with <span class="math inline">\(O_{jk}\)</span> when the time is equal to j and then we have expected events at time j for group k and we indicate this with <span class="math inline">\(E_{JK}\)</span>.</li>
<li>If we take the sum of all the observed events across all the times that we have for a particular group, and we take the sum of all expected event across the times that we have in a particular group. And we take the difference of these 2 quantities, and then we take the square. If we divide this by the sum across all the possible times that we have of the various <span class="math inline">\(j\)</span> and we do the same across all the groups that we have, then it can be shown that this test statistics, is distributed as a Chi-Squared distribution with 1 degree of freedom.</li>
</ul>
<p>In the case of <strong>two groups</strong> the formula is:</p>
<p><span class="math display">\[
\sum_{k=1}^2\frac{\left( \sum_{j=1}^{t} O_{jk} - \sum_{j=1}^{t} E_{jk}\right)^2}{\sum_{j=1}^{t} V_j} - \chi_{1}^2
\]</span></p>
<ul>
<li>If we have more than two groups, then it is still distributed as a Chi-Squared distribution, but in this case, the degrees of freedom becomes <span class="math inline">\(k-1\)</span>.</li>
<li>We have to be careful because the log-rank test is just a test of significance, so it doesn’t gives us an estimate of the difference of the groups or it doesn’t provide us with a confidence interval.</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 9%">
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;"><span class="math inline">\(k=1\)</span></th>
<th style="text-align: center;"><span class="math inline">\(K=2\)</span></th>
<th style="text-align: center;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Event at t</strong></td>
<td style="text-align: center;">Yes</td>
<td style="text-align: center;"><span class="math inline">\(d_{t1}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(d_{t2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(d_t\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Event at t</strong></td>
<td style="text-align: center;">No</td>
<td style="text-align: center;"><span class="math inline">\(n_{t1}-d_{t1}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(n_{t2}-d_{t2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(n_{t}-d_{t}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;">Total</td>
<td style="text-align: center;"><span class="math inline">\(n_{t1}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(n_{t2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(n_t\)</span></td>
</tr>
</tbody>
</table>
<p>Where:</p>
<ul>
<li><span class="math inline">\(d_{t1}\)</span> = Observed events for group 1 this will be <span class="math inline">\(O_{t1}\)</span>, i.e, death at time t for group 1</li>
<li><span class="math inline">\(d_{t2}\)</span> = Observed events for group 2 this will be <span class="math inline">\(O_{t2}\)</span>, i.e, death at time t for group 2</li>
</ul>
<p><em>There will be need to calculates the expected events</em> <span class="math inline">\(E_{t1}\)</span> <em>for group 1,</em> <span class="math inline">\(E_{t2}\)</span> <em>for group 2 and variance</em> (<span class="math inline">\(V_t\)</span>)</p>
<p><span class="math display">\[
E_{t1} = \frac{n_{t1}d_t}{n_t}, E_{t2}= \frac{n_{t2}d_t}{n_t} \text{ and}, V_t = \frac{n_{t1}n_{t2}d_t(n_t-d_t)}{(n_t)^2(n_t-1)}
\]</span></p>
<p><em>The above formula is use to calculate expected event and variance in case of Chi-square test</em></p>
<p>First, we will divide the variable vitd at the median (nb: there are several methods you can use to code this correctly in R). We will show a recoding approach based on tidyverse R package. We can use a combination of the <code>mutate()</code> command and <code>case_when()</code> command as follows: <code>df &lt;- df %&gt;% mutate(vitd_med = case_when(vitd &lt;= summary(df$vitd)[3] ~ 0, vitd &gt; summary(df$vitd)[3] ~ 1))</code></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We use the <code>summary()</code> command to estimate the descriptive statistics (i.e., minimum value, 1st quartile, median, mean, 3rd quartile, and maximum value) of the <code>vitd</code> variable. The 3rd element in the output of the <code>summary()</code>command is the median which is used to dichotomise the <code>vitd</code> variable.</p>
</div>
</div>
<p>The <code>survdiff()</code> command compares the survival distrubutions of an exposure variable by performing a log-rank test. The syntax of the <code>survdiff()</code> command is the following: <code>survdiff(Surv(time, event) ~ variable, data)</code></p>
<p>The <code>survdiff()</code> command uses as a dependent variable a survival object which is produced by the <code>Surv()</code> command. To create a survival object, we should define the follow up time <code>(time)</code> and the outcome status <code>(event)</code> in the <code>Surv()</code> command.</p>
</section>
<section id="question-c2.2b" class="level5" data-number="34.2.2.6.2">
<h5 data-number="34.2.2.6.2" class="anchored" data-anchor-id="question-c2.2b"><span class="header-section-number">34.2.2.6.2</span> Question C2.2b:</h5>
<p>Using the <code>survdiff()</code> command, compare the survival distributions for the two categories of VitD. Is there a significant difference in the survival of participants below and above the median of vitamin D concentration?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the median of `vitd` once and store it in a variable</span></span>
<span id="cb315-6"><a href="#cb315-6" aria-hidden="true" tabindex="-1"></a>vitd_median <span class="ot">&lt;-</span> <span class="fu">median</span>(whitehall<span class="sc">$</span>vitd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb315-7"><a href="#cb315-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-8"><a href="#cb315-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the median in your mutate statement</span></span>
<span id="cb315-9"><a href="#cb315-9" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> whitehall <span class="sc">%&gt;%</span></span>
<span id="cb315-10"><a href="#cb315-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vitd_med =</span> <span class="fu">case_when</span>(</span>
<span id="cb315-11"><a href="#cb315-11" aria-hidden="true" tabindex="-1"></a>    vitd <span class="sc">&lt;=</span> vitd_median <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb315-12"><a href="#cb315-12" aria-hidden="true" tabindex="-1"></a>    vitd <span class="sc">&gt;</span> vitd_median <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb315-13"><a href="#cb315-13" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb315-14"><a href="#cb315-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-15"><a href="#cb315-15" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> vitd_med, <span class="at">data =</span> whitehall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(fu_years, death) ~ vitd_med, data = whitehall)

              N Observed Expected (O-E)^2/E (O-E)^2/V
vitd_med=0 2183      940      727      62.7       120
vitd_med=1 2144      586      799      57.0       120

 Chisq= 120  on 1 degrees of freedom, p= &lt;2e-16 </code></pre>
</div>
</div>
<p><em>The log-rank test indicates that we can reject the null hypothesis that the survival distributions for the two categories are the same, as the chi(1)=120 , p&lt;2e-16. There is a statistically significant difference in survival for participants above and below the median of vitamin D concentrations. Looking at the KM plot of the survival functions, we can see that participants with vitamin D above the median tend to survive longer.</em></p>
</section>
</section>
</section>
</section>
<section id="c2.3-cox-proportional-hazards-regression" class="level2" data-number="34.3">
<h2 data-number="34.3" class="anchored" data-anchor-id="c2.3-cox-proportional-hazards-regression"><span class="header-section-number">34.3</span> C2.3 Cox Proportional Hazards Regression</h2>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li>Understand the theory of proportional hazards models (modelling equation)</li>
<li>Calculate and interpret the results of a Cox proportional hazards regression model</li>
<li>Test the assumptions underlying a Cox regression (proportional hazards) model</li>
</ul>
</div>
</div>
<section id="cox-model-cox-1972" class="level3" data-number="34.3.1">
<h3 data-number="34.3.1" class="anchored" data-anchor-id="cox-model-cox-1972"><span class="header-section-number">34.3.1</span> Cox Model (Cox 1972)</h3>
<ul>
<li>It models the hazard function <span class="math inline">\(h(t)\)</span> as</li>
</ul>
<p><span class="math display">\[
h(t | X) = h_0(t) \exp(\beta_1 X_1 + \beta_2 X_2 + \dots + \beta_p X_p)
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(h(t | X)\)</span> is the hazard function at time <span class="math inline">\(t\)</span> for an individual with covariates <span class="math inline">\(X\)</span>,</li>
<li><span class="math inline">\(h_0(t)\)</span> is the baseline hazard function at time <span class="math inline">\(t\)</span>,</li>
<li><span class="math inline">\(\beta_1, \beta_2, \dots, \beta_p\)</span> are the coefficients for the covariates <span class="math inline">\(X_1, X_2, \dots, X_p\)</span>.</li>
</ul>
<p>This model assumes that the effect of covariates on the hazard is multiplicative and proportional over time.</p>
<p>Alternative writing:</p>
<p><span class="math display">\[
\log(\frac{h(t | X)}{h_0(t)})= \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_p X_p
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\log(h(t | X))\)</span> is the log hazard function at time <span class="math inline">\(t\)</span> for an individual with covariates <span class="math inline">\(X\)</span>,</li>
<li><span class="math inline">\(\log(h_0(t))\)</span> is the log of the baseline hazard function at time <span class="math inline">\(t\)</span>,</li>
<li><span class="math inline">\(\beta_1, \beta_2, \dots, \beta_p\)</span> are the coefficients for the covariates <span class="math inline">\(X_1, X_2, \dots, X_p\)</span>.</li>
</ul>
<p>This equation shows that the covariates <span class="math inline">\(X\)</span> have a linear effect on the log of the hazard function, a key assumption in the Cox model.</p>
<section id="characteristics-of-the-cox-model" class="level5" data-number="34.3.1.0.1">
<h5 data-number="34.3.1.0.1" class="anchored" data-anchor-id="characteristics-of-the-cox-model"><span class="header-section-number">34.3.1.0.1</span> Characteristics of the Cox Model</h5>
<ul>
<li>It is a <code>Semi-parametric model</code> because there are no assumptions about the shape of the baseline hazard function and because there is a <code>Non-Parametric</code> part, i.e, the one with log and <code>parametric part</code> that is given by the exponential part of the coefficient.</li>
<li>The coefficients <span class="math inline">\(\beta_1, \beta_2, \dots, \beta_p\)</span> can be estimated by maximizing the partial likelihood.</li>
<li>Confidence intervals and test of hypothesis can be obtained.</li>
<li>There is no assumption needed for the baseline <span class="math inline">\((h_0(t))\)</span> as a function. This is a very strong point because essentially we are able to estimate the coefficient of the model without imposing any shape or constraint on the baseline as a function.</li>
</ul>
<p>Suppose now we have estimated our coefficients intermodal, so we want to see how we can interpret this coefficient <span class="math inline">\(\beta_1 \text{ to } \beta_p\)</span>.</p>
<ol type="1">
<li>If the first covariate <span class="math inline">\(X_1\)</span> corresponds to an indicator variable representing assignment to a treatment group (drug) or a control group (placebo), then the coefficient <span class="math inline">\(\beta_1\)</span> represents the <span class="math inline">\(log-hazards-ratio\)</span> between the two groups after adjusting for other covariates <span class="math inline">\(X_2,\dots,X_p.\)</span></li>
<li>In this case, <span class="math inline">\(\text{the Hazard Ratio(HR) is} \exp(\beta_1)\)</span></li>
</ol>
</section>
<section id="prortional-hazards-assumption" class="level5" data-number="34.3.1.0.2">
<h5 data-number="34.3.1.0.2" class="anchored" data-anchor-id="prortional-hazards-assumption"><span class="header-section-number">34.3.1.0.2</span> Prortional Hazards Assumption</h5>
<ul>
<li>The Cox model is also called the Cox proportional hazards model because there is a very strong and important assumption that the needs to be satisfied, if we want to use this model, and this assumption is called the <strong>Proportional hazards assumption</strong></li>
<li>If we take a group of individuals that are in an exposed group and we take the ratio as a function of this group of exposed individuals with respect to their hazard function, to an unexposed group of individuals, the ratio needs to be constant over time.</li>
</ul>
<p><span class="math display">\[
\text{Proportional hazards assumption:} \frac{h(t)_{exposed}}{h(t)_{unexposed}} \text{ is constant over time.}
\]</span></p>
<ul>
<li>Suppose that a group of cancer patients on an experimental treatment for 10 years.</li>
<li>If the hazard of dying for the <span class="math inline">\(\text{non-treated group}\)</span> is twice the rate as that of the <span class="math inline">\(\text{treated group(HR=2.0)}\)</span>, the proportional-hazards assumption implies that this ratio is the same at 1 year, at 2 years, or at any point on the time scale.</li>
<li>Because the Cox model, by definition, is constrained to follow this assumption, it is important to evaluate its validity.</li>
<li>If there is <em>violation</em> of the Cox proportional hazard assumption, this implies that there are <em>time-varying coefficients</em> in the model, or valid for a particular certain time points but not for all time points in the study.</li>
<li>It is important not to confuse <em>time dependent coefficients</em> with time <em>dependent covariates</em>. They are two different concepts.</li>
</ul>
</section>
<section id="unadjusted-cox-regression" class="level4" data-number="34.3.1.1">
<h4 data-number="34.3.1.1" class="anchored" data-anchor-id="unadjusted-cox-regression"><span class="header-section-number">34.3.1.1</span> Unadjusted Cox regression</h4>
<p>The <code>coxph()</code> command is used to run a Cox proportional hazards regression model in R. The simplified syntax of the <code>coxph()</code> command is the following: <code>coxph(formula, data)</code></p>
<p>The formula used in the <code>coxph()</code> command needs a survival object as dependent variable which is created using the <code>Surv()</code> command. The syntax of the <code>Surv()</code> command is the following: <code>Surv(time, event)</code></p>
<p>where time is the follow-up time per individual and event is the disease/outcome status per individual.</p>
<p>For example, we can examine the effect of frailty on the risk of death. Frailty is measured using a quantitative scale and it would be better to treat it as a categorical variable:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>frailty <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(whitehall<span class="sc">$</span>frailty)</span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> frailty, <span class="at">data =</span> whitehall) </span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-8"><a href="#cb317-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fu_years, death) ~ frailty, data = whitehall)

  n= 4327, number of events= 1526 

            coef exp(coef) se(coef)      z Pr(&gt;|z|)    
frailty2 0.37490   1.45484  0.10467  3.582 0.000341 ***
frailty3 0.66515   1.94478  0.10039  6.626 3.45e-11 ***
frailty4 1.05922   2.88412  0.09164 11.558  &lt; 2e-16 ***
frailty5 1.74762   5.74090  0.08719 20.044  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

         exp(coef) exp(-coef) lower .95 upper .95
frailty2     1.455     0.6874     1.185     1.786
frailty3     1.945     0.5142     1.597     2.368
frailty4     2.884     0.3467     2.410     3.452
frailty5     5.741     0.1742     4.839     6.811

Concordance= 0.671  (se = 0.007 )
Likelihood ratio test= 577.2  on 4 df,   p=&lt;2e-16
Wald test            = 576.4  on 4 df,   p=&lt;2e-16
Score (logrank) test = 667.9  on 4 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p><em>Looking at the output, you can see that the hazard of dying is nearly 6 times greater for participants in frailty level 5 compared with frailty level 1 (HR 5.7, 95% CI:4.8-6.8). This is statistically significant.</em></p>
<section id="question-c2.3a.i" class="level5" data-number="34.3.1.1.1">
<h5 data-number="34.3.1.1.1" class="anchored" data-anchor-id="question-c2.3a.i"><span class="header-section-number">34.3.1.1.1</span> Question C2.3a.i:</h5>
<p>What is association of vitamin D (using the variable coded above and below the median) with the risk (hazard) of dying?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>vitd_med <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(whitehall<span class="sc">$</span>vitd_med)</span>
<span id="cb319-5"><a href="#cb319-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-6"><a href="#cb319-6" aria-hidden="true" tabindex="-1"></a>m7 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> vitd_med, <span class="at">data =</span> whitehall) </span>
<span id="cb319-7"><a href="#cb319-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-8"><a href="#cb319-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fu_years, death) ~ vitd_med, data = whitehall)

  n= 4327, number of events= 1526 

              coef exp(coef) se(coef)     z Pr(&gt;|z|)    
vitd_med1 -0.56864   0.56630  0.05266 -10.8   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

          exp(coef) exp(-coef) lower .95 upper .95
vitd_med1    0.5663      1.766    0.5108    0.6279

Concordance= 0.57  (se = 0.006 )
Likelihood ratio test= 120.3  on 1 df,   p=&lt;2e-16
Wald test            = 116.6  on 1 df,   p=&lt;2e-16
Score (logrank) test = 119.8  on 1 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p><em>Participants that have vitamin D concentrations above the median have a 43% lower hazard (or risk) of dying, and this is statistically significant (HR 0.57, 95% CI: 0.51-0.63).</em></p>
</section>
</section>
</section>
<section id="test-the-proportional-hazards-assumption-pha" class="level3" data-number="34.3.2">
<h3 data-number="34.3.2" class="anchored" data-anchor-id="test-the-proportional-hazards-assumption-pha"><span class="header-section-number">34.3.2</span> Test the Proportional Hazards Assumption (PHA)</h3>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives:
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li>Test Proportionality Hazards Assumption</li>
<li>Learn some solutions in case of violations of proportionality hazards assumption.</li>
</ul>
</div>
</div>
<section id="dealing-with-violation-of-pha" class="level4" data-number="34.3.2.1">
<h4 data-number="34.3.2.1" class="anchored" data-anchor-id="dealing-with-violation-of-pha"><span class="header-section-number">34.3.2.1</span> Dealing with violation of PHA</h4>
<ul>
<li>Violation implies that there are time-varying coefficients in the model. To deal with this:</li>
</ul>
<p>Two solutions:</p>
<ol type="1">
<li><strong>Stratify</strong> by the offending variable- fit separate models across the levels of the variable (Strata option)</li>
</ol>
<p>or</p>
<ol start="2" type="1">
<li><strong>model</strong> the offending variable as the <strong>time-varying coefficient(s).</strong></li>
</ol>
<p>There are many similarities between Cox regression and linear and logistic regression. We have seen that you can adjust for additional variables in the same way. You can also fit interactions using the same commands. However, the one key difference between a Cox regression and other regression models is the <em>proportional hazards assumption</em>.</p>
<p>The proportional hazards assumption states that hazard ratio (comparing levels of an exposure variable) is constant over time. This assumption needs to be tested. The lecture explained 3 ways to do this: fitting an interaction with time, examining the residuals with a log-log plot and testing the residuals for a correlation with time. In practice, generally just choosing one method to use is sufficient.</p>
</section>
<section id="fitting-an-interaction-with-time" class="level4" data-number="34.3.2.2">
<h4 data-number="34.3.2.2" class="anchored" data-anchor-id="fitting-an-interaction-with-time"><span class="header-section-number">34.3.2.2</span> Fitting an interaction with time</h4>
<p>If the PH assumption is violated, it means that the hazard ratio is not constant over time, i.e.&nbsp;there is an interaction between a covariate and time. Thus, we can fit a Cox model with a time interaction in it and see if this is significant. We can also use a likelihood ratio (LR) test to see if a model with a time-varying covariate fits better than one without. In R, the interaction of a covariate with time can be fitted by using the time-transform functionality <code>tt()</code> in the <code>coxph()</code> command.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>age_grp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(whitehall<span class="sc">$</span>age_grp)</span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a>m8 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> frailty <span class="sc">+</span> age_grp <span class="sc">+</span> <span class="fu">tt</span>(age_grp), <span class="at">data =</span> whitehall)</span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fu_years, death) ~ frailty + age_grp + tt(age_grp), 
    data = whitehall)

  n= 4327, number of events= 1526 

               coef exp(coef) se(coef)      z Pr(&gt;|z|)    
frailty2    0.27705   1.31923  0.10488  2.642  0.00825 ** 
frailty3    0.47470   1.60754  0.10115  4.693 2.69e-06 ***
frailty4    0.79874   2.22273  0.09317  8.573  &lt; 2e-16 ***
frailty5    1.41966   4.13570  0.08975 15.817  &lt; 2e-16 ***
age_grp2    0.53277   1.70365  0.09704  5.490 4.01e-08 ***
age_grp3    0.82084   2.27241  0.11049  7.429 1.09e-13 ***
age_grp4    0.68145   1.97674  0.28382  2.401  0.01635 *  
tt(age_grp) 0.04261   1.04353  0.01434  2.971  0.00297 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

            exp(coef) exp(-coef) lower .95 upper .95
frailty2        1.319     0.7580     1.074     1.620
frailty3        1.608     0.6221     1.318     1.960
frailty4        2.223     0.4499     1.852     2.668
frailty5        4.136     0.2418     3.469     4.931
age_grp2        1.704     0.5870     1.409     2.061
age_grp3        2.272     0.4401     1.830     2.822
age_grp4        1.977     0.5059     1.133     3.448
tt(age_grp)     1.044     0.9583     1.015     1.073

Concordance= 0.71  (se = 0.007 )
Likelihood ratio test= 870.4  on 8 df,   p=&lt;2e-16
Wald test            = 880.1  on 8 df,   p=&lt;2e-16
Score (logrank) test = 1045  on 8 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p><em>When we look at the p-value for the coefficient in the tt(age_grp) row, we see that it is significant (p=0.03). This suggests there is a significant interaction with time, which indicates the HR for age group is not constant over time.</em></p>
</section>
<section id="inspecting-log-log-plots" class="level4" data-number="34.3.2.3">
<h4 data-number="34.3.2.3" class="anchored" data-anchor-id="inspecting-log-log-plots"><span class="header-section-number">34.3.2.3</span> Inspecting log-log plots</h4>
<p>To compute a log-log plot, we should compute the survival curves for our variable using the <code>survfit()</code> command and then we can print the log-log plot using the <code>ggsurvplot()</code> command.</p>
<p>A log-log plot for age group is computed using the command below:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a>m9 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> frailty <span class="sc">+</span> <span class="fu">strata</span>(age_grp), <span class="at">data =</span> whitehall)</span>
<span id="cb323-5"><a href="#cb323-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-6"><a href="#cb323-6" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(m9)</span>
<span id="cb323-7"><a href="#cb323-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-8"><a href="#cb323-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">data =</span> whitehall, <span class="at">fun =</span> <span class="st">"cloglog"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-159-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>When we inspect a log-log plot, we want to see that the curves in the main portion of the plot (i.e.&nbsp;not the tails of the plot, where there are few events) are generally parallel over time. If the curves touch or cross, this indicates there is a violation of the PH assumption.</em></p>
<p><em>Looking at the curves for each level of age group above, they appear to be generally parallel with similar slopes over time. This looks acceptable and does not indicate a meaningful violation of the PH assumption. This may contradict the results of the tt() command above as statistical tests will often be significant for small deviations if you have a lot of power (e.g.&nbsp;if you have a large dataset). For this reason, we often prefer to visually inspect the data for obvious violations of the PH assumption.</em></p>
</section>
<section id="testing-the-residuals-for-a-correlation-with-time" class="level4" data-number="34.3.2.4">
<h4 data-number="34.3.2.4" class="anchored" data-anchor-id="testing-the-residuals-for-a-correlation-with-time"><span class="header-section-number">34.3.2.4</span> Testing the residuals for a correlation with time</h4>
<p>The PH assumption can be also assessed using a statistical test based on the scaled Schoenfeld residuals. In principle, Schoenfeld residuals are independent of time. If a plot shows that Schoenfeld residuals are distributed in a non-random pattern against time, this is evidence of violation of the PH assumption.</p>
<p>We can test the proportional hazards assumption for each covariate in a Cox model using the <code>cox.zph()</code> command.</p>
<p>In a cox model including <code>age_grp</code> and <code>frailty</code> as covariates, we can examine if any of these variables violate the PH assumption by running the following command:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>m10 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> frailty <span class="sc">+</span> age_grp, <span class="at">data =</span> whitehall)</span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(m10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        chisq df       p
frailty  9.51  4 0.04945
age_grp 11.47  3 0.00943
GLOBAL  26.33  7 0.00044</code></pre>
</div>
</div>
<p><em>The cox.zph() command has two outputs. The first one is a chi-squared test and a p-value for testing the violation of PH assumption for each one of the variables included in the cox model. The second one is a global chi-squared test and a p-value for testing if there is any variable in our model that violates the PH assumption.</em></p>
<p><em>We observe that both frailty and age_grp variables violate the PH assumption.</em></p>
<section id="question-c2.3b" class="level5" data-number="34.3.2.4.1">
<h5 data-number="34.3.2.4.1" class="anchored" data-anchor-id="question-c2.3b"><span class="header-section-number">34.3.2.4.1</span> Question C2.3b:</h5>
<p>Interpret a log-log plot for frailty (adjusted for age group) and assess if it violates the PH assumption.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a>m11 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> <span class="fu">strata</span>(frailty) <span class="sc">+</span> age_grp, <span class="at">data =</span> whitehall)</span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a>fit7 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(m11)</span>
<span id="cb326-7"><a href="#cb326-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-8"><a href="#cb326-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit7, <span class="at">data =</span> whitehall, <span class="at">fun =</span> <span class="st">"cloglog"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-161-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>In this log-log plot, we see the curves for the different levels of frailty (levels 1-4) criss-cross and touch each other at several points over time. This is a clearer violation of the PH assumption.</em></p>
</section>
</section>
<section id="fixing-violations-in-the-ph-assumption" class="level4" data-number="34.3.2.5">
<h4 data-number="34.3.2.5" class="anchored" data-anchor-id="fixing-violations-in-the-ph-assumption"><span class="header-section-number">34.3.2.5</span> Fixing violations in the PH assumption</h4>
<p>If the PH assumption has been violated for a covariate, we can fit a stratified Cox model where we stratify by the covariate that violates the PH assumption.</p>
<p>To stratify a Cox model by a specific variable, we use the <code>strata()</code> command from the <code>survival</code> R package.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-4"><a href="#cb327-4" aria-hidden="true" tabindex="-1"></a>m12 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> <span class="fu">strata</span>(frailty) <span class="sc">+</span> age_grp, <span class="at">data =</span> whitehall)</span>
<span id="cb327-5"><a href="#cb327-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-6"><a href="#cb327-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fu_years, death) ~ strata(frailty) + age_grp, 
    data = whitehall)

  n= 4327, number of events= 1526 

            coef exp(coef) se(coef)      z Pr(&gt;|z|)    
age_grp2 0.56309   1.75610  0.09646  5.838  5.3e-09 ***
age_grp3 0.97174   2.64253  0.09811  9.904  &lt; 2e-16 ***
age_grp4 1.45530   4.28579  0.10124 14.374  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

         exp(coef) exp(-coef) lower .95 upper .95
age_grp2     1.756     0.5694     1.454     2.122
age_grp3     2.643     0.3784     2.180     3.203
age_grp4     4.286     0.2333     3.514     5.226

Concordance= 0.612  (se = 0.007 )
Likelihood ratio test= 280.8  on 3 df,   p=&lt;2e-16
Wald test            = 272.5  on 3 df,   p=&lt;2e-16
Score (logrank) test = 292.3  on 3 df,   p=&lt;2e-16</code></pre>
</div>
</div>
<p><em>Notice that you do not get any output regarding the variable ‘frailty’ that you stratified on, although R indicates in the formula that you have used this variable in the strata. You would still interpret the HR of age_grp as having been adjusted for frailty, though. So you would say that the hazard of dying was 4.3 times greater in the 81-95 age group compared to the 60-70 age group, once it was adjusted for frailty (as stratifying on a variable is another way to adjust for its association).</em></p>
</section>
</section>
</section>
<section id="c2.4-poisson-regression" class="level2" data-number="34.4">
<h2 data-number="34.4" class="anchored" data-anchor-id="c2.4-poisson-regression"><span class="header-section-number">34.4</span> C2.4 Poisson Regression</h2>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives:
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, students will be able to:</p>
<ul>
<li>Open datasets in their chosen statistical software programme</li>
<li>Explore datasets and understand what data they have</li>
<li>Use basic commands to edit their data</li>
</ul>
</div>
</div>
<section id="use-of-poisson-regression" class="level4" data-number="34.4.0.1">
<h4 data-number="34.4.0.1" class="anchored" data-anchor-id="use-of-poisson-regression"><span class="header-section-number">34.4.0.1</span> Use of Poisson Regression</h4>
<p>There are several situations where Poisson regression can be useful. It can be use to:</p>
<ul>
<li>Obtain rates and their rtios from <strong>Cohort studies or RCTs</strong> in which person-time varies across individuals.
<ul>
<li>It is important to obtain a <strong>value for rates</strong> as well as rate ratios (See Cox regression, in which rates are not estimates).</li>
<li>It is reasonable to assume that <strong>rates are constant</strong> over time, or within time bands.</li>
</ul></li>
<li>Poisson regression can also be used for analysis of count e.g number of admissions per day in a hospital.</li>
</ul>
<p>Here, we show a Poisson regression modelling the log(rate of disease) as the outcome.</p>
<p>In R, we can use the <code>glm()</code> command to fit a Poisson regression model as follows: <code>glm(formula, data, family = poisson(link = “log”))</code></p>
<p>The command <code>glm()</code> is the same command that was used to fit a logistic regression model in the previous module. The only difference is that in Poisson regression we use the family <code>poisson(link = “log”)</code>, whereas in logistic regression we use the family <code>binomial(link = “logit”)</code>. Note that we use the offset(time) when we specify the formula of the Poisson regression to specify follow-up time. If you do not use the <code>offset(time)</code> to specify the period of follow-up time, then you will be analysing a log(count) [rather than rate].</p>
</section>
<section id="for-example" class="level4" data-number="34.4.0.2">
<h4 data-number="34.4.0.2" class="anchored" data-anchor-id="for-example"><span class="header-section-number">34.4.0.2</span> For example</h4>
<p>To estimate the incidence rate ratio of death for current smokers compared to non-smokers, we run the following command:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>model12 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(fu_years)) <span class="sc">+</span> currsmoker, <span class="at">data =</span> whitehall, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = death ~ offset(log(fu_years)) + currsmoker, family = poisson(link = "log"), 
    data = whitehall)

Coefficients:
            Estimate Std. Error  z value Pr(&gt;|z|)    
(Intercept) -2.98556    0.02770 -107.770   &lt;2e-16 ***
currsmoker   0.16891    0.07318    2.308    0.021 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 5138.5  on 4320  degrees of freedom
Residual deviance: 5133.3  on 4319  degrees of freedom
  (6 observations deleted due to missingness)
AIC: 8179.3

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model12), <span class="fu">confint</span>(model12)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            2.5 %     97.5 %
(Intercept) 0.05051116 0.04781793 0.05330358
currsmoker  1.18401207 1.02323123 1.36335855</code></pre>
</div>
</div>
<p><em>The estimate in the row for ‘currsmoker’ is the rate ratio of death for current smokers compared to non-smokers. This output shows that the rate of death is 18% higher in current smokers compared to non-smokers (RR 1.18, 95% CI: 1.03-1.37). This association is statistically significant (p=0.02).</em></p>
</section>
<section id="assumptions-of-poisson-regression" class="level4" data-number="34.4.0.3">
<h4 data-number="34.4.0.3" class="anchored" data-anchor-id="assumptions-of-poisson-regression"><span class="header-section-number">34.4.0.3</span> Assumptions of Poisson regression</h4>
<p>There are some assumptions that needs to be satisfied in order to use a Poisson model.</p>
<p>We can use the Poisson model when:</p>
<ul>
<li>Events (counts) follows a poisson distribution.</li>
<li>Events (counts) are independent of one another.</li>
<li>Rates in different groups are proportional (See also Cox regression).</li>
<li>Also, Poisson regression requires that within an exposure group such as smokers or non-smokers, the rate of the event of interest (such as death) stays constant over time, a very strong assumption. A cohort study often involves follow-up over many years and it is unrealistic, because of changes in age, to assume that the rate stays unchanged over follow-up.</li>
</ul>
</section>
<section id="poisson-regression-model" class="level4" data-number="34.4.0.4">
<h4 data-number="34.4.0.4" class="anchored" data-anchor-id="poisson-regression-model"><span class="header-section-number">34.4.0.4</span> Poisson Regression Model</h4>
<ul>
<li>In Poisson regression, we model the log(rate of disease) as the outcome:</li>
</ul>
<p><span class="math display">\[
log(\text{rate of disease}) = \beta_o + \beta_1X_1
\]</span></p>
<p><span class="math display">\[
\exp(\beta_o) = \text{ratebin unexposed group,} \exp(\beta_1) = \text{rate ratio}
\]</span></p>
<p>Poisson regression model assumes that the events occur following POisson distribution.</p>
</section>
<section id="same-model" class="level4" data-number="34.4.0.5">
<h4 data-number="34.4.0.5" class="anchored" data-anchor-id="same-model"><span class="header-section-number">34.4.0.5</span> Same Model</h4>
<p>A Poisson model can be written in many different ways. For examples, we can represents it as follows:</p>
<p><span class="math display">\[
log(\text{rate of disease}) = \beta_o + \beta_1X_1 + \beta_2X_2+\dots
\]</span></p>
<p><span class="math display">\[
log(\text{events| time}) = \beta_o + \beta_1X_1 + \beta_2X_2+\dots
\]</span></p>
<p><span class="math display">\[
log(events) - log (time) = \beta_o + \beta_1X_1 + \beta_2X_2+\dots
\]</span></p>
<p><span class="math display">\[
log(events) = \beta_o + \beta_1X_1 + \beta_2X_2+\dots + log (time)
\]</span></p>
<section id="question-c2.4" class="level5" data-number="34.4.0.5.1">
<h5 data-number="34.4.0.5.1" class="anchored" data-anchor-id="question-c2.4"><span class="header-section-number">34.4.0.5.1</span> Question C2.4:</h5>
<p>Use a Poisson regression to assess if current smoking associated with the rate of death, once adjusted for age group and frailty?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>m13 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(fu_years)) <span class="sc">+</span> currsmoker <span class="sc">+</span> age_grp <span class="sc">+</span> frailty, <span class="at">data =</span> whitehall, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m13)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = death ~ offset(log(fu_years)) + currsmoker + age_grp + 
    frailty, family = poisson(link = "log"), data = whitehall)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -4.35993    0.10691 -40.783  &lt; 2e-16 ***
currsmoker   0.22259    0.07330   3.037  0.00239 ** 
age_grp2     0.54990    0.09650   5.698 1.21e-08 ***
age_grp3     0.94373    0.09820   9.610  &lt; 2e-16 ***
age_grp4     1.38579    0.10113  13.703  &lt; 2e-16 ***
frailty2     0.26967    0.10491   2.571  0.01015 *  
frailty3     0.46882    0.10116   4.634 3.58e-06 ***
frailty4     0.76742    0.09329   8.226  &lt; 2e-16 ***
frailty5     1.33908    0.08988  14.899  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 5138.5  on 4320  degrees of freedom
Residual deviance: 4352.0  on 4312  degrees of freedom
  (6 observations deleted due to missingness)
AIC: 7412

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(m13), <span class="fu">confint</span>(m13)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                           2.5 %     97.5 %
(Intercept) 0.0127793 0.01031477 0.01568674
currsmoker  1.2493127 1.07940117 1.43892617
age_grp2    1.7330714 1.43907932 2.10137836
age_grp3    2.5695435 2.12622123 3.12556115
age_grp4    3.9979992 3.28848845 4.88987279
frailty2    1.3095324 1.06633005 1.60930782
frailty3    1.5981001 1.31163626 1.95061491
frailty4    2.1542055 1.79745201 2.59165466
frailty5    3.8155486 3.20640181 4.56166911</code></pre>
</div>
</div>
<p><em>The rate of death is 25% higher in current smokers compared to non-smokers, once adjusted for age group and frailty (RR 1.25, 95% CI: 1.09-1.43). This association is statistically significant (p=0.002).</em></p>
<p>The detailed explanation each section of the output from a Poisson regression model is as follows:</p>
<ol type="1">
<li>Model Call</li>
</ol>
<ul>
<li>The model is a Poisson regression using death as the outcome variable, with the log link function.</li>
<li>Predictors include:
<ul>
<li><strong>offset(log(fu_years))</strong>: An offset term that adjusts for follow-up time (<code>fu_years</code>) in log scale, effectively modeling rates instead of simple counts.</li>
<li><strong>currsmoker</strong>: Indicator for current smoking status.</li>
<li><strong>age_grp</strong>: Categorical variable indicating age groups, with several levels (<code>age_grp2</code>, <code>age_grp3</code>, <code>age_grp4</code>) comparing each age group to the reference (likely the youngest age group).</li>
<li><strong>frailty</strong>: Categorical variable indicating frailty levels, with levels (<code>frailty2</code>, <code>frailty3</code>, etc.) compared to a reference group (likely the lowest frailty level).</li>
</ul></li>
</ul>
<ol start="2" type="1">
<li>Deviance Residuals</li>
</ol>
<ul>
<li>These show the distribution of residuals from the model:
<ul>
<li>Residuals range from -2.0348 to 3.2916, with a median near zero, indicating a reasonable but not perfect fit for most observations.</li>
<li>Deviance residuals closer to zero indicate better fit for individual data points.</li>
</ul></li>
</ul>
<ol start="3" type="1">
<li>Coefficients Table</li>
</ol>
<ul>
<li><p>Each predictor has an <strong>Estimate</strong>, <strong>Standard Error</strong>, <strong>z value</strong>, and <strong>Pr(&gt;|z|)</strong> (p-value).</p></li>
<li><p>Here’s what each of these columns represents:</p>
<ul>
<li><strong>Estimate</strong>: The log-rate ratio associated with each predictor.</li>
<li><strong>Std. Error</strong>: The standard error of each estimate.</li>
<li><strong>z value</strong>: The test statistic for each coefficient <span class="math inline">\((Estimate/Std.Error)\)</span>.</li>
<li><strong>Pr(&gt;|z|)</strong>: The p-value indicating statistical significance.*</li>
</ul></li>
</ul>
<p><strong>Interpretation of Key Predictors</strong>:</p>
<ul>
<li><p><strong>(Intercept)</strong>: The intercept is -4.35993. Exponentiating this (<code>exp(-4.35993) ≈ 0.0128</code>) gives the baseline event rate for individuals in the reference categories of <code>currsmoker</code>, <code>age_grp</code>, and <code>frailty</code>.</p></li>
<li><p><strong>currsmoker</strong>: The estimate for currsmoker is 0.22259, indicating that current smokers have a higher death rate compared to non-smokers.</p>
<ul>
<li><strong>Exponentiating</strong> gives <code>exp(0.22259) ≈ 1.25</code>, so current smokers have a 25% higher death rate than non-smokers.</li>
<li>The p-value (0.00239) indicates this effect is statistically significant at the 0.01 level.</li>
</ul></li>
<li><p><strong>age_grp</strong>: The coefficients for <code>age_grp2</code>, <code>age_grp3</code>, and <code>age_grp4</code> indicate that death rates increase with age:</p>
<ul>
<li><strong>age_grp2</strong> (second age group) has a log-rate ratio of 0.5499, or about 73% higher death rate than the reference age group <code>(exp(0.5499) ≈ 1.73)</code>.</li>
<li><strong>age_grp3</strong> has a rate ratio of <code>exp(0.94373) ≈ 2.57</code>, or a 157% higher death rate.</li>
<li><strong>age_grp4</strong> has a rate ratio of <code>exp(1.38579) ≈ 4.00</code>, or a 300% higher death rate.</li>
<li>All age groups have highly significant p-values, showing that increased age is strongly associated with higher death rates.</li>
</ul></li>
<li><p><strong>frailty</strong>: The coefficients for <code>frailty2</code>, <code>frailty3</code>, etc., indicate that higher frailty levels are associated with increasing death rates compared to the reference frailty level:</p>
<ul>
<li><strong>frailty2</strong> has a rate ratio of <code>exp(0.26967) ≈ 1.31</code>, or a 31% higher death rate.</li>
<li><strong>frailty3</strong> has a rate ratio of <code>exp(0.46882) ≈ 1.60</code>.</li>
<li><strong>frailty4</strong> has a rate ratio of <code>exp(0.76742) ≈ 2.15</code>.</li>
<li><strong>frailty5</strong> has the highest rate ratio, <code>exp(1.33908) ≈ 3.82</code>, or a 282% higher death rate.</li>
<li>These coefficients are significant, indicating that as frailty increases, so does the risk of death.</li>
</ul></li>
</ul>
<ol start="4" type="1">
<li>Significance Codes</li>
</ol>
<ul>
<li>The stars next to the p-values indicate the level of significance:
<ul>
<li>*** for p &lt; 0.001, ** for p &lt; 0.01, * for p &lt; 0.05.</li>
</ul></li>
</ul>
<ol start="5" type="1">
<li>Deviance and AIC</li>
</ol>
<ul>
<li><strong>Null deviance</strong>: 5138.5 on 4320 degrees of freedom, representing the deviance for a model with only an intercept.</li>
<li><strong>Residual deviance</strong>: 4352.0 on 4312 degrees of freedom, showing the deviance for the fitted model with all predictors.</li>
<li>A large drop in deviance (from 5138.5 to 4352.0) indicates a substantial improvement in model fit over the null model.</li>
<li><strong>AIC</strong>: 7412, a measure of model quality, with lower values indicating a better fit after accounting for model complexity.</li>
</ul>
<ol start="6" type="1">
<li>Fisher Scoring Iterations</li>
</ol>
<ul>
<li>The model took 6 iterations to converge, suggesting that the fitting process was stable.</li>
</ul>
<section id="summary-interpretation" class="level6" data-number="34.4.0.5.1.1">
<h6 data-number="34.4.0.5.1.1" class="anchored" data-anchor-id="summary-interpretation"><span class="header-section-number">34.4.0.5.1.1</span> Summary Interpretation</h6>
<ul>
<li>The model suggests that current smoking status, age group, and frailty level are all significant predictors of the death rate.</li>
<li>Current smokers, older age groups, and individuals with higher frailty levels have significantly higher death rates, even after accounting for follow-up time.</li>
<li>The model fit (as indicated by the decrease in deviance and the AIC) is much improved over the null model, showing that these predictors are valuable for explaining variations in death rates.</li>
</ul>
</section>
</section>
</section>
</section>
</section>
<section id="reference" class="level1" data-number="35">
<h1 data-number="35"><span class="header-section-number">35</span> Reference</h1>
<ul>
<li>Fundamentals of Statistical Software &amp; Analysis by Oxford Population Health, University of Oxford Medical Sciences Division.</li>
</ul>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb337" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Fundamentals of Statistical Software &amp; Analysis"</span></span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a><span class="an">title-block-banner:</span><span class="co"> SKYBLUE1.jpeg</span></span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "OXFORD POPULATION HEALTH"</span></span>
<span id="cb337-6"><a href="#cb337-6" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: "UNIVERSITY OF OXFORD MEDICAL SCIENCES DIVISION"</span></span>
<span id="cb337-7"><a href="#cb337-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-11-10"</span></span>
<span id="cb337-8"><a href="#cb337-8" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb337-9"><a href="#cb337-9" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb337-10"><a href="#cb337-10" aria-hidden="true" tabindex="-1"></a><span class="an">highlight-style:</span><span class="co"> pygments</span></span>
<span id="cb337-11"><a href="#cb337-11" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb337-12"><a href="#cb337-12" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb337-13"><a href="#cb337-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb337-14"><a href="#cb337-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb337-15"><a href="#cb337-15" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb337-16"><a href="#cb337-16" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb337-17"><a href="#cb337-17" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true   </span></span>
<span id="cb337-18"><a href="#cb337-18" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: true  </span></span>
<span id="cb337-19"><a href="#cb337-19" aria-hidden="true" tabindex="-1"></a><span class="co">  output: true </span></span>
<span id="cb337-20"><a href="#cb337-20" aria-hidden="true" tabindex="-1"></a><span class="co">  error: false </span></span>
<span id="cb337-21"><a href="#cb337-21" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb337-22"><a href="#cb337-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb337-23"><a href="#cb337-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-24"><a href="#cb337-24" aria-hidden="true" tabindex="-1"></a>![](images%20(10).jpeg)</span>
<span id="cb337-25"><a href="#cb337-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-26"><a href="#cb337-26" aria-hidden="true" tabindex="-1"></a>**Welcome to [Fundamentals of Statistical Software and Analysis]{.underline}, or FoSSA for short!** The course comprises of 7 modules:</span>
<span id="cb337-27"><a href="#cb337-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-28"><a href="#cb337-28" aria-hidden="true" tabindex="-1"></a>**A1**: Introduction to Statistics using R, Stata &amp; SPSS</span>
<span id="cb337-29"><a href="#cb337-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-30"><a href="#cb337-30" aria-hidden="true" tabindex="-1"></a>**A2**: Power and Sample Size Calculations</span>
<span id="cb337-31"><a href="#cb337-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-32"><a href="#cb337-32" aria-hidden="true" tabindex="-1"></a>**B1**: Linear Regression</span>
<span id="cb337-33"><a href="#cb337-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-34"><a href="#cb337-34" aria-hidden="true" tabindex="-1"></a>**B2**: Multiple Comparisons and Repeated Measures</span>
<span id="cb337-35"><a href="#cb337-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-36"><a href="#cb337-36" aria-hidden="true" tabindex="-1"></a>**B3**: Non-Parametric Measures</span>
<span id="cb337-37"><a href="#cb337-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-38"><a href="#cb337-38" aria-hidden="true" tabindex="-1"></a>**C1**: Binary Data and Logistic Regression</span>
<span id="cb337-39"><a href="#cb337-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-40"><a href="#cb337-40" aria-hidden="true" tabindex="-1"></a>**C2**: Survival Data</span>
<span id="cb337-41"><a href="#cb337-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-42"><a href="#cb337-42" aria-hidden="true" tabindex="-1"></a>Each module contains short videos to introduce and explain the statistical concepts and tests, along with practical exercises to work through.</span>
<span id="cb337-43"><a href="#cb337-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-44"><a href="#cb337-44" aria-hidden="true" tabindex="-1"></a>The practicals are provided in three different statistical software packages, Stata, R, and SPSS. You can follow through the course using any one of these three packages. If you are unsure which package you would like to use, you may want to work through the introductions to each of them in Module A1 before making your decision.</span>
<span id="cb337-45"><a href="#cb337-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-46"><a href="#cb337-46" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**End of Module Quiz**</span><span class="co">]</span>{.underline} At the end of each module there is a short multiple choice quiz. If you wish to receive a certificate for the course you must visit every page and complete all of the quizzes with an average (mean) mark of 50% or greater. The FoSSA admin team will check quiz completions on a monthly basis and send certificates to any new completers.</span>
<span id="cb337-47"><a href="#cb337-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-48"><a href="#cb337-48" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Proceeding through the Course**</span><span class="co">]</span>{.underline} You should study all of Module A1 before moving on to the other modules to make sure you have a firm grasp of the key concepts. Before you start on the first module, take a look at the Course Information section. Here you will find the data sets you will need for your practicals and other useful information to support you in your studies.</span>
<span id="cb337-49"><a href="#cb337-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-50"><a href="#cb337-50" aria-hidden="true" tabindex="-1"></a><span class="fu"># Course Dataset 1</span></span>
<span id="cb337-51"><a href="#cb337-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-52"><a href="#cb337-52" aria-hidden="true" tabindex="-1"></a>The Whitehall FoSSA Study is a simulated cohort study similar to the original Whitehall Study of Civil Servants, set up in the 1960s, which followed London-based male civil servants with a view to investigating cardiovascular disease and mortality. Participants from the original Whitehall cohort in the 1960s were flagged for mortality at the Office for National Statistics, which provided the date and cause of all deaths occurring until the end of September 2005. The (simulated) Whitehall FoSSA Study was conducted in 1997 to assess risk factors for cardiac and all-cause mortality in a subset of the original cohort that was still being followed. The Whitehall FoSSA Study contains information on 4,327 individuals that were followed-up from 1997 until 2005, and the variables are summarised in the table below. See Clarke et al. (2007), Arch Intern Med, 167(13) for more details on the real data that inspired this dataset.</span>
<span id="cb337-53"><a href="#cb337-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-54"><a href="#cb337-54" aria-hidden="true" tabindex="-1"></a>| Variable name | Description | Type of measure | Coding |</span>
<span id="cb337-55"><a href="#cb337-55" aria-hidden="true" tabindex="-1"></a>|------------------|------------------|------------------|------------------|</span>
<span id="cb337-56"><a href="#cb337-56" aria-hidden="true" tabindex="-1"></a>| whl1_id | Participant ID number | Continuous |  |</span>
<span id="cb337-57"><a href="#cb337-57" aria-hidden="true" tabindex="-1"></a>| age_grp | Age group (years) | Categorical | 1=60-70; 2=71-75; 3=76-80; 4=81-95 |</span>
<span id="cb337-58"><a href="#cb337-58" aria-hidden="true" tabindex="-1"></a>| prior_cvd | Prior CVD | Binary | 0=No; 1=Yes |</span>
<span id="cb337-59"><a href="#cb337-59" aria-hidden="true" tabindex="-1"></a>| prior_t2dm | Prior Type 2 Diabetes | Binary | 0=No; 1=Yes |</span>
<span id="cb337-60"><a href="#cb337-60" aria-hidden="true" tabindex="-1"></a>| prior_cancer | Prior Cancer | Binary | 0=No; 1=Yes |</span>
<span id="cb337-61"><a href="#cb337-61" aria-hidden="true" tabindex="-1"></a>| sbp | Systolic Blood Pressure (mmHg) | Continuous | 86-230 mmHg |</span>
<span id="cb337-62"><a href="#cb337-62" aria-hidden="true" tabindex="-1"></a>| bmi | Body Mass Index (BMI; kg/m2) | Continuous | 15-44 kg/m2 |</span>
<span id="cb337-63"><a href="#cb337-63" aria-hidden="true" tabindex="-1"></a>| bmi_grp4 | BMI, grouped | Categorical | 1=Underweight; 2=Normal; 3=Overweight; 4=Obese |</span>
<span id="cb337-64"><a href="#cb337-64" aria-hidden="true" tabindex="-1"></a>| hdlc | HDL cholesterol (mmol/L) | Continuous | 0.5-3.07 mmol/L |</span>
<span id="cb337-65"><a href="#cb337-65" aria-hidden="true" tabindex="-1"></a>| ldlc | LDL cholesterol (mmol/L) | Continuous | 1.05-6.81 mmol/L |</span>
<span id="cb337-66"><a href="#cb337-66" aria-hidden="true" tabindex="-1"></a>| chol | Total cholesterol (mmol/L) | Continuous | 2.24-10.77 mmol/L |</span>
<span id="cb337-67"><a href="#cb337-67" aria-hidden="true" tabindex="-1"></a>| currsmoker | Current smoker | Binary | 0= Not a current smoker, 1= Current smoker |</span>
<span id="cb337-68"><a href="#cb337-68" aria-hidden="true" tabindex="-1"></a>| frailty | Summary frailty score | Categorical | 1= least frail quintile; 5= most frail quintile |</span>
<span id="cb337-69"><a href="#cb337-69" aria-hidden="true" tabindex="-1"></a>| vitd | Vitamin D <span class="sc">\[</span>25(OH)D<span class="sc">\]</span> |  |  |</span>
<span id="cb337-70"><a href="#cb337-70" aria-hidden="true" tabindex="-1"></a>| nmol/L | Continuous | 18.92-419.89 nmol/L |  |</span>
<span id="cb337-71"><a href="#cb337-71" aria-hidden="true" tabindex="-1"></a>| cvd_death | Fatal CVD | Binary | 0=No; 1=Yes |</span>
<span id="cb337-72"><a href="#cb337-72" aria-hidden="true" tabindex="-1"></a>| death | Death | Binary | 0=No; 1=Yes |</span>
<span id="cb337-73"><a href="#cb337-73" aria-hidden="true" tabindex="-1"></a>| fu_years | Years of follow-up | Continuous | 0.03-8.5 years |</span>
<span id="cb337-74"><a href="#cb337-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-75"><a href="#cb337-75" aria-hidden="true" tabindex="-1"></a>As this is simulated data, some of the associations you may find between variables are not real, nor do they reflect what the current science suggests about risk factors for cardiovascular disease and mortality. Please do not use this dataset for anything beyond the training material in this course.</span>
<span id="cb337-76"><a href="#cb337-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-77"><a href="#cb337-77" aria-hidden="true" tabindex="-1"></a>**Stata Dataset**</span>
<span id="cb337-78"><a href="#cb337-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-79"><a href="#cb337-79" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Whitehall_fossa.dta</span><span class="co">](https://1drv.ms/u/s!AtvH6PgKXPEDgwP2lAgifbZkgIPY?e=aNbXz3)</span>{target="_blank"}</span>
<span id="cb337-80"><a href="#cb337-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-81"><a href="#cb337-81" aria-hidden="true" tabindex="-1"></a>**CSV Dataset**</span>
<span id="cb337-82"><a href="#cb337-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-83"><a href="#cb337-83" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Whitehall_fossa(in).csv</span><span class="co">](https://1drv.ms/u/s!AtvH6PgKXPEDgwJyVUbrcv6Mvhrs?e=tv5mtd)</span>{target="_blank"}</span>
<span id="cb337-84"><a href="#cb337-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-85"><a href="#cb337-85" aria-hidden="true" tabindex="-1"></a><span class="fu"># Course Dataset 2</span></span>
<span id="cb337-86"><a href="#cb337-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-87"><a href="#cb337-87" aria-hidden="true" tabindex="-1"></a>The FoSSA Mouse dataset is a simulated set of health check data of a group of 60 mice throughout a fictional study. The data consist of weights in grams and body condition scores on a 5 point ordinal scale, each taken at three points throughout the trial.</span>
<span id="cb337-88"><a href="#cb337-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-89"><a href="#cb337-89" aria-hidden="true" tabindex="-1"></a>Weights are quite self explanatory, but if you would like a frame of reference for the body condition scores (BCS) then you can see how these are assigned here- <span class="co">[</span><span class="ot">Body Condition Score Mice.pdf</span><span class="co">](https://1drv.ms/b/s!AtvH6PgKXPEDgwS--ub-UbRhAYGa?e=qF1kL3)</span>{target="_blank"}</span>
<span id="cb337-90"><a href="#cb337-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-91"><a href="#cb337-91" aria-hidden="true" tabindex="-1"></a>| Variable name | Description | Type of measure | Coding |</span>
<span id="cb337-92"><a href="#cb337-92" aria-hidden="true" tabindex="-1"></a>|------------------|------------------|------------------|------------------|</span>
<span id="cb337-93"><a href="#cb337-93" aria-hidden="true" tabindex="-1"></a>| Strain | Names of the three strains of mice in the trial, use for reference purposes | Categorical | Names |</span>
<span id="cb337-94"><a href="#cb337-94" aria-hidden="true" tabindex="-1"></a>| Strain_group | Numerical groupings of the three mouse strains | Categorical |  |</span>
<span id="cb337-95"><a href="#cb337-95" aria-hidden="true" tabindex="-1"></a>| 1= Wild type, 2= Cdkn1a knockout, 3= NRAS knockout |  |  |  |</span>
<span id="cb337-96"><a href="#cb337-96" aria-hidden="true" tabindex="-1"></a>| Weight_baseline | Weight measured at the beginning of the study | Continuous | Value in grams |</span>
<span id="cb337-97"><a href="#cb337-97" aria-hidden="true" tabindex="-1"></a>| BCS_baseline | Body condition score assessed at the beginning of the study | Ordinal | 1= lowest body condition (very underweight), 5= highest body condition (obese) |</span>
<span id="cb337-98"><a href="#cb337-98" aria-hidden="true" tabindex="-1"></a>| Weight_mid | Weight measured at the mid point of the study | Continuous | Value in grams |</span>
<span id="cb337-99"><a href="#cb337-99" aria-hidden="true" tabindex="-1"></a>| BCS_mid | Body condition score assessed at the mid point of the study | Ordinal | 1= lowest body condition (very underweight), 5= highest body condition (obese) |</span>
<span id="cb337-100"><a href="#cb337-100" aria-hidden="true" tabindex="-1"></a>| Weight_end | Weight measured at the end of the study | Continuous | Value in grams |</span>
<span id="cb337-101"><a href="#cb337-101" aria-hidden="true" tabindex="-1"></a>| BCS_end | Body condition score assessed at the end of the study | Ordinal | 1= lowest body condition (very underweight), 5= highest body condition (obese) |</span>
<span id="cb337-102"><a href="#cb337-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-103"><a href="#cb337-103" aria-hidden="true" tabindex="-1"></a>**CSV Dataset**</span>
<span id="cb337-104"><a href="#cb337-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-105"><a href="#cb337-105" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">FoSSA mouse data.csv</span><span class="co">](https://1drv.ms/u/s!AtvH6PgKXPEDgwAYD3AGm-u5pqz0?e=dKTNR6)</span>{target="_blank"}</span>
<span id="cb337-106"><a href="#cb337-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-107"><a href="#cb337-107" aria-hidden="true" tabindex="-1"></a>**Stata Dataset**</span>
<span id="cb337-108"><a href="#cb337-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-109"><a href="#cb337-109" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">mouse_data.dta</span><span class="co">](https://1drv.ms/u/s!AtvH6PgKXPEDgwHxCHLZQsUdBIoP?e=wDNy3D)</span>{target="_blank"}</span>
<span id="cb337-110"><a href="#cb337-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-111"><a href="#cb337-111" aria-hidden="true" tabindex="-1"></a><span class="fu"># A1.1 What is Statistics?</span></span>
<span id="cb337-112"><a href="#cb337-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-113"><a href="#cb337-113" aria-hidden="true" tabindex="-1"></a>This course uses three different options for statistical analysis software for the practical exercises. The next lesson @sec-A1.2 is broken up into three subsections. You only need to complete the one for the software you are planning to use throughout the course. These sessions will help you to familiarise yourself with your chosen software, and set up the course datasets. After the initial set up, there will be one lesson for each topic, but then you will have the choice of which statistical software you would like to use for the practical.</span>
<span id="cb337-114"><a href="#cb337-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-115"><a href="#cb337-115" aria-hidden="true" tabindex="-1"></a><span class="fu"># A1.2: Introduction to R, SPSS and Stata {#sec-A1.2}</span></span>
<span id="cb337-116"><a href="#cb337-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-117"><a href="#cb337-117" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Click here</span><span class="co">](https://thegraphcourses.org/courses/fossa/topics/a1-2-2b-introduction-to-r/)</span>{target="_blank"} to go to the introduction to R</span>
<span id="cb337-118"><a href="#cb337-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-119"><a href="#cb337-119" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Click here</span><span class="co">](https://thegraphcourses.org/courses/fossa/topics/a1-2-1a-introduction-to-stata/)</span>{target="_blank"} to go to the introduction to Stata</span>
<span id="cb337-120"><a href="#cb337-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-121"><a href="#cb337-121" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Click here</span><span class="co">](https://thegraphcourses.org/courses/fossa/topics/a1-2-2c-introduction-to-spss/)</span> to go to the introduction to SPSS</span>
<span id="cb337-122"><a href="#cb337-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-123"><a href="#cb337-123" aria-hidden="true" tabindex="-1"></a><span class="fu"># Load dataset</span></span>
<span id="cb337-124"><a href="#cb337-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-127"><a href="#cb337-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-128"><a href="#cb337-128" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Whitehall_fossa(in).csv"</span>)</span>
<span id="cb337-129"><a href="#cb337-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-130"><a href="#cb337-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-131"><a href="#cb337-131" aria-hidden="true" tabindex="-1"></a><span class="fu"># A1.3: Descriptive Statistics {#sec-A1.3}</span></span>
<span id="cb337-132"><a href="#cb337-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-133"><a href="#cb337-133" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false"}</span>
<span id="cb337-134"><a href="#cb337-134" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-135"><a href="#cb337-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-136"><a href="#cb337-136" aria-hidden="true" tabindex="-1"></a>By the end of this session, students will be able to:</span>
<span id="cb337-137"><a href="#cb337-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-138"><a href="#cb337-138" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Continue practicing basic software commands</span>
<span id="cb337-139"><a href="#cb337-139" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Learn how to explore the dataset, identifying the different types of variable stored</span>
<span id="cb337-140"><a href="#cb337-140" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate the different measures of location and spread</span>
<span id="cb337-141"><a href="#cb337-141" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Plot frequency distributions and histograms</span>
<span id="cb337-142"><a href="#cb337-142" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-143"><a href="#cb337-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-144"><a href="#cb337-144" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: 1.3: <span class="co">[</span><span class="ot">Descriptive Statistics</span><span class="co">](https://1drv.ms/f/s!AtvH6PgKXPEDgnWvKjMfvpOKM02i?e=AfGZuY)</span>{target="_blank"}</span>
<span id="cb337-145"><a href="#cb337-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-146"><a href="#cb337-146" aria-hidden="true" tabindex="-1"></a>There are many different ways to generate basic descriptive statistics for your dataset in R, some of which have already been covered.</span>
<span id="cb337-147"><a href="#cb337-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-148"><a href="#cb337-148" aria-hidden="true" tabindex="-1"></a>Here, we will cover several basic functions. Remember that there is always more information to be found online, and many good resources exist only a Google search away!</span>
<span id="cb337-149"><a href="#cb337-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-150"><a href="#cb337-150" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb337-151"><a href="#cb337-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-152"><a href="#cb337-152" aria-hidden="true" tabindex="-1"></a>The summary function can be used to generate a minimum, 1st quartile, median, median, 3rd quartile , maximum, and number of NA datapoints for all numeric variables within a dataset. See the following:</span>
<span id="cb337-153"><a href="#cb337-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-154"><a href="#cb337-154" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-155"><a href="#cb337-155" aria-hidden="true" tabindex="-1"></a><span class="in">summary(object.name)</span></span>
<span id="cb337-156"><a href="#cb337-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-157"><a href="#cb337-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-160"><a href="#cb337-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-161"><a href="#cb337-161" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(whitehall)</span>
<span id="cb337-162"><a href="#cb337-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-163"><a href="#cb337-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-164"><a href="#cb337-164" aria-hidden="true" tabindex="-1"></a>Note that this produces summary statistics for the entire dataset. To focus in on a specific column variable, we can use the \$ operator as previously:</span>
<span id="cb337-165"><a href="#cb337-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-168"><a href="#cb337-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-169"><a href="#cb337-169" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(whitehall<span class="sc">$</span>bmi)</span>
<span id="cb337-170"><a href="#cb337-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-171"><a href="#cb337-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-172"><a href="#cb337-172" aria-hidden="true" tabindex="-1"></a>It is useful here to check that your minimum, maximum and mean are reasonable values. Try to generate some summary statistics for systolic blood pressure (SBP). Are these figures reasonable?</span>
<span id="cb337-173"><a href="#cb337-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-174"><a href="#cb337-174" aria-hidden="true" tabindex="-1"></a>You can also obtain summary statistics that are differentiated by another variable, such as <span class="in">`age group`</span>, using the <span class="in">`by`</span> function, as follows:</span>
<span id="cb337-175"><a href="#cb337-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-176"><a href="#cb337-176" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-177"><a href="#cb337-177" aria-hidden="true" tabindex="-1"></a><span class="in">by(object.name, object.name$variable, summary)</span></span>
<span id="cb337-178"><a href="#cb337-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-179"><a href="#cb337-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-182"><a href="#cb337-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-183"><a href="#cb337-183" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(whitehall, whitehall<span class="sc">$</span>age_grp, summary)</span>
<span id="cb337-184"><a href="#cb337-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-185"><a href="#cb337-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-186"><a href="#cb337-186" aria-hidden="true" tabindex="-1"></a>*Does this generate any interesting information, or do any differences become immediately apparent?*</span>
<span id="cb337-187"><a href="#cb337-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-188"><a href="#cb337-188" aria-hidden="true" tabindex="-1"></a><span class="fu">## Measures of Central Tendency</span></span>
<span id="cb337-189"><a href="#cb337-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-190"><a href="#cb337-190" aria-hidden="true" tabindex="-1"></a><span class="fu">### a) Mean</span></span>
<span id="cb337-191"><a href="#cb337-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-192"><a href="#cb337-192" aria-hidden="true" tabindex="-1"></a>To calculate the mean, we use the following function.</span>
<span id="cb337-193"><a href="#cb337-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-194"><a href="#cb337-194" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-195"><a href="#cb337-195" aria-hidden="true" tabindex="-1"></a><span class="in">mean(object.name$variable)</span></span>
<span id="cb337-196"><a href="#cb337-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-197"><a href="#cb337-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-200"><a href="#cb337-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-201"><a href="#cb337-201" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(whitehall<span class="sc">$</span>sbp)</span>
<span id="cb337-202"><a href="#cb337-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-203"><a href="#cb337-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-204"><a href="#cb337-204" aria-hidden="true" tabindex="-1"></a>The above function may seem complete. We note, from our previous investigation, that there are some NA values within this dataset. Resultantly, we must remember to tell RStudio to calculate the mean without these values, using <span class="in">`na.rm = TRUE`</span> . You can double check the values to see the difference.</span>
<span id="cb337-205"><a href="#cb337-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-206"><a href="#cb337-206" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-207"><a href="#cb337-207" aria-hidden="true" tabindex="-1"></a><span class="in">mean(object.name$variable, na.rm = TRUE)</span></span>
<span id="cb337-208"><a href="#cb337-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-209"><a href="#cb337-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-212"><a href="#cb337-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-213"><a href="#cb337-213" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(whitehall<span class="sc">$</span>sbp, <span class="at">na.rm=</span> <span class="cn">TRUE</span>)</span>
<span id="cb337-214"><a href="#cb337-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-215"><a href="#cb337-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-216"><a href="#cb337-216" aria-hidden="true" tabindex="-1"></a><span class="fu">### b) Median</span></span>
<span id="cb337-217"><a href="#cb337-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-218"><a href="#cb337-218" aria-hidden="true" tabindex="-1"></a>We can compute median using a similar function:</span>
<span id="cb337-219"><a href="#cb337-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-220"><a href="#cb337-220" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-221"><a href="#cb337-221" aria-hidden="true" tabindex="-1"></a><span class="in">median(object.name$variable, na.rm = TRUE)</span></span>
<span id="cb337-222"><a href="#cb337-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-223"><a href="#cb337-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-226"><a href="#cb337-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-227"><a href="#cb337-227" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(whitehall<span class="sc">$</span>sbp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb337-228"><a href="#cb337-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-229"><a href="#cb337-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-230"><a href="#cb337-230" aria-hidden="true" tabindex="-1"></a><span class="fu">### c) Mode</span></span>
<span id="cb337-231"><a href="#cb337-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-232"><a href="#cb337-232" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-233"><a href="#cb337-233" aria-hidden="true" tabindex="-1"></a><span class="in">install.packages("DescTools")</span></span>
<span id="cb337-234"><a href="#cb337-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-235"><a href="#cb337-235" aria-hidden="true" tabindex="-1"></a><span class="in">library(DescTools)</span></span>
<span id="cb337-236"><a href="#cb337-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-237"><a href="#cb337-237" aria-hidden="true" tabindex="-1"></a><span class="in">Mode(x, na.rm = FALSE) </span></span>
<span id="cb337-238"><a href="#cb337-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-239"><a href="#cb337-239" aria-hidden="true" tabindex="-1"></a><span class="in"># if there are missing values you can to make “na.rm = TRUE”</span></span>
<span id="cb337-240"><a href="#cb337-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-241"><a href="#cb337-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-244"><a href="#cb337-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-245"><a href="#cb337-245" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb337-246"><a href="#cb337-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-247"><a href="#cb337-247" aria-hidden="true" tabindex="-1"></a><span class="fu">Mode</span>(whitehall<span class="sc">$</span>bmi_grp4, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb337-248"><a href="#cb337-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-249"><a href="#cb337-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-250"><a href="#cb337-250" aria-hidden="true" tabindex="-1"></a>**The most common category of BMI group is ‘3’, with N=2091.**</span>
<span id="cb337-251"><a href="#cb337-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-252"><a href="#cb337-252" aria-hidden="true" tabindex="-1"></a><span class="fu">### d) Quantiles</span></span>
<span id="cb337-253"><a href="#cb337-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-254"><a href="#cb337-254" aria-hidden="true" tabindex="-1"></a>The quantile function can be used to calculate the median, and first and third quartiles, by using a second argument to define the percentage range ‘probs’ as a decimal figure between 0 and 1.</span>
<span id="cb337-255"><a href="#cb337-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-256"><a href="#cb337-256" aria-hidden="true" tabindex="-1"></a>Remember that the first quartile = 25% of values, and the third = 75%. In this way, we can also use the quantile function to compute any percentile cut-off for our data.</span>
<span id="cb337-257"><a href="#cb337-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-258"><a href="#cb337-258" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-259"><a href="#cb337-259" aria-hidden="true" tabindex="-1"></a><span class="in">quantile(object.name$variable, probs = , na.rm=TRUE)</span></span>
<span id="cb337-260"><a href="#cb337-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-261"><a href="#cb337-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-264"><a href="#cb337-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-265"><a href="#cb337-265" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(whitehall<span class="sc">$</span>sbp, <span class="at">probs=</span><span class="fl">0.25</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb337-266"><a href="#cb337-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-267"><a href="#cb337-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-268"><a href="#cb337-268" aria-hidden="true" tabindex="-1"></a><span class="fu">### e) IQR</span></span>
<span id="cb337-269"><a href="#cb337-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-270"><a href="#cb337-270" aria-hidden="true" tabindex="-1"></a>To calculate IQR, we can simply use the following: <span class="sc">\#</span> Standard Error</span>
<span id="cb337-271"><a href="#cb337-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-272"><a href="#cb337-272" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise</span></span>
<span id="cb337-273"><a href="#cb337-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-274"><a href="#cb337-274" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-275"><a href="#cb337-275" aria-hidden="true" tabindex="-1"></a><span class="in">IQR(object.name$variable)</span></span>
<span id="cb337-276"><a href="#cb337-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-277"><a href="#cb337-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-280"><a href="#cb337-280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-281"><a href="#cb337-281" aria-hidden="true" tabindex="-1"></a><span class="fu">IQR</span>(whitehall<span class="sc">$</span>sbp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb337-282"><a href="#cb337-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-283"><a href="#cb337-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-284"><a href="#cb337-284" aria-hidden="true" tabindex="-1"></a>See if you can figure out how to calculate IQR using the quantile function!</span>
<span id="cb337-285"><a href="#cb337-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-288"><a href="#cb337-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-289"><a href="#cb337-289" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(whitehall<span class="sc">$</span>sbp, <span class="at">probs=</span><span class="fl">0.75</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">quantile</span>(whitehall<span class="sc">$</span>sbp, <span class="at">probs=</span><span class="fl">0.25</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb337-290"><a href="#cb337-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-291"><a href="#cb337-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-292"><a href="#cb337-292" aria-hidden="true" tabindex="-1"></a>Calculate the Sample size, remember to exclude missing values!</span>
<span id="cb337-293"><a href="#cb337-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-294"><a href="#cb337-294" aria-hidden="true" tabindex="-1"></a><span class="fu">### f) Range</span></span>
<span id="cb337-295"><a href="#cb337-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-296"><a href="#cb337-296" aria-hidden="true" tabindex="-1"></a>To calculate range, we simply subtract the maximum from minimum values, as shown:</span>
<span id="cb337-297"><a href="#cb337-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-298"><a href="#cb337-298" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-299"><a href="#cb337-299" aria-hidden="true" tabindex="-1"></a><span class="in">max(object.name$variable) – min(object.name$variable)</span></span>
<span id="cb337-300"><a href="#cb337-300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-301"><a href="#cb337-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-304"><a href="#cb337-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-305"><a href="#cb337-305" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(whitehall<span class="sc">$</span>sbp) <span class="sc">-</span> <span class="fu">min</span>(whitehall<span class="sc">$</span>sbp)</span>
<span id="cb337-306"><a href="#cb337-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-307"><a href="#cb337-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-308"><a href="#cb337-308" aria-hidden="true" tabindex="-1"></a><span class="fu">### g) SD and Variance</span></span>
<span id="cb337-309"><a href="#cb337-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-310"><a href="#cb337-310" aria-hidden="true" tabindex="-1"></a>To calculate standard deviation and variance, you can use the following simple functions:</span>
<span id="cb337-311"><a href="#cb337-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-312"><a href="#cb337-312" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-313"><a href="#cb337-313" aria-hidden="true" tabindex="-1"></a><span class="in">sd(object.name$variable)</span></span>
<span id="cb337-314"><a href="#cb337-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-315"><a href="#cb337-315" aria-hidden="true" tabindex="-1"></a><span class="in">var(object.name$variable)</span></span>
<span id="cb337-316"><a href="#cb337-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-317"><a href="#cb337-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-318"><a href="#cb337-318" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A1.3a.i:</span></span>
<span id="cb337-319"><a href="#cb337-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-320"><a href="#cb337-320" aria-hidden="true" tabindex="-1"></a>**After completing the steps above, can you classify the following variables as Categorical, Binary, Ordinal, Continuous?**</span>
<span id="cb337-321"><a href="#cb337-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-322"><a href="#cb337-322" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Prior CVD</span>
<span id="cb337-323"><a href="#cb337-323" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>SBP</span>
<span id="cb337-324"><a href="#cb337-324" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Frailty</span>
<span id="cb337-325"><a href="#cb337-325" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Death</span>
<span id="cb337-326"><a href="#cb337-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-327"><a href="#cb337-327" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Answer A1.3a.i:</span></span>
<span id="cb337-328"><a href="#cb337-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-329"><a href="#cb337-329" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Prior CV: binary</span>
<span id="cb337-330"><a href="#cb337-330" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>SBP: continuous</span>
<span id="cb337-331"><a href="#cb337-331" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Frailty: ordinal</span>
<span id="cb337-332"><a href="#cb337-332" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Death: binary</span>
<span id="cb337-333"><a href="#cb337-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-334"><a href="#cb337-334" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A1.3a.ii:</span></span>
<span id="cb337-335"><a href="#cb337-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-336"><a href="#cb337-336" aria-hidden="true" tabindex="-1"></a>**What are the measures of central tendency (mean, median and mode) and the measures of spread (range, interquartile range and standard deviation) for the measured cholesterol of participants in our dataset (using the chol variable)?**</span>
<span id="cb337-337"><a href="#cb337-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-338"><a href="#cb337-338" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bar charts and histograms</span></span>
<span id="cb337-339"><a href="#cb337-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-340"><a href="#cb337-340" aria-hidden="true" tabindex="-1"></a>R offers several powerful tools to make easily customisable visualisations of data.</span>
<span id="cb337-341"><a href="#cb337-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-342"><a href="#cb337-342" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Bar Charts</span></span>
<span id="cb337-343"><a href="#cb337-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-344"><a href="#cb337-344" aria-hidden="true" tabindex="-1"></a>To make a simple barplot, we can use the <span class="in">`barplot()`</span> function, and then input code in order to represent the data in different ways. The first step is to load several useful packages which will assist with our graphing. We then load these libraries. These open-source packages contain several additional tools that we can use.</span>
<span id="cb337-345"><a href="#cb337-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-346"><a href="#cb337-346" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-347"><a href="#cb337-347" aria-hidden="true" tabindex="-1"></a><span class="in">install.packages("tidyverse")</span></span>
<span id="cb337-348"><a href="#cb337-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-349"><a href="#cb337-349" aria-hidden="true" tabindex="-1"></a><span class="in">install.packages("RColorBrewer")</span></span>
<span id="cb337-350"><a href="#cb337-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-351"><a href="#cb337-351" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb337-352"><a href="#cb337-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-353"><a href="#cb337-353" aria-hidden="true" tabindex="-1"></a><span class="in">library(RColorBrewer)</span></span>
<span id="cb337-354"><a href="#cb337-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-355"><a href="#cb337-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-356"><a href="#cb337-356" aria-hidden="true" tabindex="-1"></a>We then generate a table, which we will assign as the object <span class="in">`bmi.counts`</span>. It is this object we ask R to generate a barplot for.</span>
<span id="cb337-357"><a href="#cb337-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-360"><a href="#cb337-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-361"><a href="#cb337-361" aria-hidden="true" tabindex="-1"></a>bmi.counts <span class="ot">&lt;-</span> <span class="fu">table</span>(whitehall<span class="sc">$</span>bmi)</span>
<span id="cb337-362"><a href="#cb337-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-363"><a href="#cb337-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-364"><a href="#cb337-364" aria-hidden="true" tabindex="-1"></a>Within the barplot function, we can label the X and Y axis using <span class="in">`xlab=`</span> and <span class="in">`ylab=`</span>, title the graph using <span class="in">`main=`</span>, and change the colour of the bars using <span class="in">`col=`</span>. Here, the package <span class="in">`RColorBrewer`</span> allows us to generate a vector of (20) contiguous colours.</span>
<span id="cb337-365"><a href="#cb337-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-368"><a href="#cb337-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-369"><a href="#cb337-369" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(bmi.counts, <span class="at">xlab =</span> <span class="st">"BMI"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"BMI of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">20</span>))</span>
<span id="cb337-370"><a href="#cb337-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-371"><a href="#cb337-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-372"><a href="#cb337-372" aria-hidden="true" tabindex="-1"></a>There is also opportunity to create stacked bar graphs in R. We can change the orientation by using the argument ‘horiz = TRUE’</span>
<span id="cb337-373"><a href="#cb337-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-374"><a href="#cb337-374" aria-hidden="true" tabindex="-1"></a><span class="fu">### Histograms</span></span>
<span id="cb337-375"><a href="#cb337-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-376"><a href="#cb337-376" aria-hidden="true" tabindex="-1"></a>We can make a simple histogram using the <span class="in">`hist()`</span> function in R. This function takes in a vector of values for which the histogram will be plotted. As with before, we will modify the histogram to add axis labels and a title.</span>
<span id="cb337-377"><a href="#cb337-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-380"><a href="#cb337-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-381"><a href="#cb337-381" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>bmi, <span class="at">xlab =</span> <span class="st">"BMI"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"BMI of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">12</span>), <span class="at">density=</span><span class="dv">100</span>)</span>
<span id="cb337-382"><a href="#cb337-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-383"><a href="#cb337-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-384"><a href="#cb337-384" aria-hidden="true" tabindex="-1"></a><span class="fu">### Grouping Continuous Data</span></span>
<span id="cb337-385"><a href="#cb337-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-386"><a href="#cb337-386" aria-hidden="true" tabindex="-1"></a>Grouping continuous data is simply an extension of the skills we used to earlier create our binary variable. There are many reasons why you would want to categorise a continuous variable, and cut-offs need to be defined for different categories. <span class="in">`BMI`</span> is a skewed variable and different parts of the distribution of BMI may have different relationships with diseases that we investigate.</span>
<span id="cb337-387"><a href="#cb337-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-388"><a href="#cb337-388" aria-hidden="true" tabindex="-1"></a>Our first step is to create a new, empty column, which we will title <span class="in">`bmi.grouped`</span>:</span>
<span id="cb337-389"><a href="#cb337-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-392"><a href="#cb337-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-393"><a href="#cb337-393" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb337-394"><a href="#cb337-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-395"><a href="#cb337-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-396"><a href="#cb337-396" aria-hidden="true" tabindex="-1"></a>Our subsequent code will act to populate this new column we’ve created in our data frame.</span>
<span id="cb337-397"><a href="#cb337-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-398"><a href="#cb337-398" aria-hidden="true" tabindex="-1"></a>Our goal is to get R to assign values to this new column, which will be drawn from the existing BMI data recorded for those rows. Remember that each row is a collection (vector) of data that represents a different individual.</span>
<span id="cb337-399"><a href="#cb337-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-400"><a href="#cb337-400" aria-hidden="true" tabindex="-1"></a>We will define <span class="in">`BMI`</span> of less than 18.5 as 0, between 18 – 25 as 1,between 25-30 as 2, and greater than or equal to 30 as 3. This will be then coded in. This can be achieved with the below simple operators:</span>
<span id="cb337-401"><a href="#cb337-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-404"><a href="#cb337-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-405"><a href="#cb337-405" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped [whitehall<span class="sc">$</span>bmi<span class="sc">&lt;</span><span class="fl">18.5</span>]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb337-406"><a href="#cb337-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-407"><a href="#cb337-407" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped [whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span><span class="fl">18.5</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>bmi<span class="sc">&lt;</span><span class="dv">25</span>]<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb337-408"><a href="#cb337-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-409"><a href="#cb337-409" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped [whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span><span class="dv">25</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>bmi <span class="sc">&lt;</span><span class="dv">30</span>]<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb337-410"><a href="#cb337-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-411"><a href="#cb337-411" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped [whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span><span class="dv">30</span>]<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb337-412"><a href="#cb337-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-413"><a href="#cb337-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-414"><a href="#cb337-414" aria-hidden="true" tabindex="-1"></a>It is important to also check that this variable is in the right format, using <span class="in">`class()`</span>.</span>
<span id="cb337-415"><a href="#cb337-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-416"><a href="#cb337-416" aria-hidden="true" tabindex="-1"></a>class(whitehall.data\$bmi.grouped)</span>
<span id="cb337-417"><a href="#cb337-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-418"><a href="#cb337-418" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span>1<span class="sc">\]</span> “numeric”</span>
<span id="cb337-419"><a href="#cb337-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-420"><a href="#cb337-420" aria-hidden="true" tabindex="-1"></a>R views our new variable as ‘numeric’. Clearly, however, it is an ordered categorical variable. Therefore, we have to ensure that R views the variable as a Factor. Simultaneously, while completing this task, we can also label our groups using the <span class="in">`labels=c()`</span> function, remembering to use “” to denote different category titles. This can be completed as follows:</span>
<span id="cb337-421"><a href="#cb337-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-424"><a href="#cb337-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-425"><a href="#cb337-425" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi.grouped <span class="ot">&lt;-</span> <span class="fu">factor</span> (whitehall<span class="sc">$</span>bmi.grouped, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"&lt;18.5"</span>, <span class="st">"18.5-24.9"</span>, <span class="st">"25-29.9"</span>, <span class="st">"&gt;30"</span>))</span>
<span id="cb337-426"><a href="#cb337-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-427"><a href="#cb337-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-428"><a href="#cb337-428" aria-hidden="true" tabindex="-1"></a>####Question A1.3b.i:</span>
<span id="cb337-429"><a href="#cb337-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-430"><a href="#cb337-430" aria-hidden="true" tabindex="-1"></a>**Which type of variable can you plot with a bar chart? When should you use a histogram?**</span>
<span id="cb337-431"><a href="#cb337-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-432"><a href="#cb337-432" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A1.3b.ii:</span></span>
<span id="cb337-433"><a href="#cb337-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-434"><a href="#cb337-434" aria-hidden="true" tabindex="-1"></a>**Plot the bar chart that counts the number of participants in each BMI group and save it. Can you give this graph a title? Can you label the y axis and change the colour of the bars in the chart?**</span>
<span id="cb337-435"><a href="#cb337-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-436"><a href="#cb337-436" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A1.3b.iii:</span></span>
<span id="cb337-437"><a href="#cb337-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-438"><a href="#cb337-438" aria-hidden="true" tabindex="-1"></a>**Plot a histogram of SBP and describe the distribution.**</span>
<span id="cb337-439"><a href="#cb337-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-440"><a href="#cb337-440" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A1.3b.iv:</span></span>
<span id="cb337-441"><a href="#cb337-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-442"><a href="#cb337-442" aria-hidden="true" tabindex="-1"></a>**Regroup SBP in a different way, and decide which grouping best represents the data.**</span>
<span id="cb337-443"><a href="#cb337-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-444"><a href="#cb337-444" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A1.3b.v:</span></span>
<span id="cb337-445"><a href="#cb337-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-446"><a href="#cb337-446" aria-hidden="true" tabindex="-1"></a>**Can you change the number of bins used to plot the histogram of SBP? What is the effect of changing the number of bins?**</span>
<span id="cb337-447"><a href="#cb337-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-448"><a href="#cb337-448" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Answer A1.3b.i:</span></span>
<span id="cb337-449"><a href="#cb337-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-450"><a href="#cb337-450" aria-hidden="true" tabindex="-1"></a>**Categorical variables (such as our newly created BMI categories) can be visually represented using a bar graph.**</span>
<span id="cb337-451"><a href="#cb337-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-452"><a href="#cb337-452" aria-hidden="true" tabindex="-1"></a>**Histograms should be employed for continuous numerical variables. In our current dataset, variables that could be appropriately represented using a histogram include systolic blood pressure, blood cholesterol, and LDL levels.**</span>
<span id="cb337-453"><a href="#cb337-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-454"><a href="#cb337-454" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Answer A1.3b.ii:</span></span>
<span id="cb337-455"><a href="#cb337-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-456"><a href="#cb337-456" aria-hidden="true" tabindex="-1"></a>**To generate this bar graph, we will follow the same process as we did before we had grouped BMI into the new variable. Note that we’ve changed the number of colours on our contiguous spectrum to 4, to reflect the new number of categories.**</span>
<span id="cb337-457"><a href="#cb337-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-460"><a href="#cb337-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-461"><a href="#cb337-461" aria-hidden="true" tabindex="-1"></a>bmi.grouped.graph <span class="ot">&lt;-</span> <span class="fu">table</span>(whitehall<span class="sc">$</span>bmi.grouped)</span>
<span id="cb337-462"><a href="#cb337-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-463"><a href="#cb337-463" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(bmi.grouped.graph, <span class="at">horiz =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"BMI"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"BMI of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">4</span>))</span>
<span id="cb337-464"><a href="#cb337-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-465"><a href="#cb337-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-466"><a href="#cb337-466" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Answer A1.3b.iii:</span></span>
<span id="cb337-467"><a href="#cb337-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-468"><a href="#cb337-468" aria-hidden="true" tabindex="-1"></a>As above, the code for this histogram is as follows:</span>
<span id="cb337-469"><a href="#cb337-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-472"><a href="#cb337-472" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-473"><a href="#cb337-473" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>sbp, <span class="at">xlab =</span> <span class="st">"SBP"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"Histogram of SBP of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">12</span>), <span class="at">density=</span><span class="dv">100</span>)</span>
<span id="cb337-474"><a href="#cb337-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-475"><a href="#cb337-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-476"><a href="#cb337-476" aria-hidden="true" tabindex="-1"></a>**There appears to be a small right skew (positive skew) to this distribution but it is approximately normally distributed.**</span>
<span id="cb337-477"><a href="#cb337-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-478"><a href="#cb337-478" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Answer A1.3b.iv:</span></span>
<span id="cb337-479"><a href="#cb337-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-480"><a href="#cb337-480" aria-hidden="true" tabindex="-1"></a>We will group SBP according to the American College of Cardiology/American Heart Association guidelines for hypertension management, which classes blood pressure according to the following categories. The process for coding this new variable is near identical to the BMI categorisation — have a go yourself!</span>
<span id="cb337-481"><a href="#cb337-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-482"><a href="#cb337-482" aria-hidden="true" tabindex="-1"></a>| Blood Pressure Caterogory | Systolic Blood Pressure |</span>
<span id="cb337-483"><a href="#cb337-483" aria-hidden="true" tabindex="-1"></a>|---------------------------|-------------------------|</span>
<span id="cb337-484"><a href="#cb337-484" aria-hidden="true" tabindex="-1"></a>| Normal                    | <span class="sc">\&lt;</span>120 mmHg              |</span>
<span id="cb337-485"><a href="#cb337-485" aria-hidden="true" tabindex="-1"></a>| Elevated                  | 120-129 mmHg            |</span>
<span id="cb337-486"><a href="#cb337-486" aria-hidden="true" tabindex="-1"></a>| Hypertension              |                         |</span>
<span id="cb337-487"><a href="#cb337-487" aria-hidden="true" tabindex="-1"></a>| Stage 1                   | 130-139 mmHg            |</span>
<span id="cb337-488"><a href="#cb337-488" aria-hidden="true" tabindex="-1"></a>| Stage 2                   | <span class="sc">\&gt;</span>=140 mmHg             |</span>
<span id="cb337-489"><a href="#cb337-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-492"><a href="#cb337-492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-493"><a href="#cb337-493" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped<span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb337-494"><a href="#cb337-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-495"><a href="#cb337-495" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped [whitehall<span class="sc">$</span>sbp<span class="sc">&lt;</span><span class="dv">120</span>]<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb337-496"><a href="#cb337-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-497"><a href="#cb337-497" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped [whitehall<span class="sc">$</span>sbp <span class="sc">&gt;=</span><span class="dv">120</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>sbp <span class="sc">&lt;</span><span class="dv">130</span>]<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb337-498"><a href="#cb337-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-499"><a href="#cb337-499" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped [whitehall<span class="sc">$</span>sbp <span class="sc">&gt;=</span><span class="dv">130</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>sbp <span class="sc">&lt;</span><span class="dv">140</span>]<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb337-500"><a href="#cb337-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-501"><a href="#cb337-501" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped [whitehall<span class="sc">$</span>sbp <span class="sc">&gt;=</span><span class="dv">140</span>]<span class="ot">&lt;-</span><span class="dv">4</span></span>
<span id="cb337-502"><a href="#cb337-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-503"><a href="#cb337-503" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(whitehall<span class="sc">$</span>sbp.grouped)</span>
<span id="cb337-504"><a href="#cb337-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-505"><a href="#cb337-505" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>sbp.grouped <span class="ot">&lt;-</span> <span class="fu">factor</span>(whitehall<span class="sc">$</span>sbp.grouped, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Normotensive"</span>, <span class="st">"Elevated"</span>, <span class="st">"Stage 1 Hypertension"</span>, <span class="st">"Stage 2 Hypertension"</span>))</span>
<span id="cb337-506"><a href="#cb337-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-507"><a href="#cb337-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-508"><a href="#cb337-508" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Answer A1.3b.v:</span></span>
<span id="cb337-509"><a href="#cb337-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-510"><a href="#cb337-510" aria-hidden="true" tabindex="-1"></a>Normally, R automatically calculates the size of each bin of the histogram. We may not find, however, that the default bins offer an appropriate or sufficient visualisation of the data. We can change the number of bins by adding an additional argument to our <span class="in">`hist()`</span> code, <span class="in">`breaks=()`</span></span>
<span id="cb337-511"><a href="#cb337-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-514"><a href="#cb337-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-515"><a href="#cb337-515" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>sbp, <span class="at">xlab =</span> <span class="st">"SBP"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"Histogram of SBP of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">12</span>), <span class="at">density=</span><span class="dv">100</span>, <span class="at">breaks =</span> <span class="dv">1000</span>)</span>
<span id="cb337-516"><a href="#cb337-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-517"><a href="#cb337-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-518"><a href="#cb337-518" aria-hidden="true" tabindex="-1"></a>If we try two extremes, we end up with two different graphs — and the distribution and skew is easier to assess.</span>
<span id="cb337-519"><a href="#cb337-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-520"><a href="#cb337-520" aria-hidden="true" tabindex="-1"></a>We could say that this appears to be a more ‘normal’ distribution — even though the underlying data hasn’t changed!</span>
<span id="cb337-521"><a href="#cb337-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-524"><a href="#cb337-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-525"><a href="#cb337-525" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>sbp, <span class="at">xlab =</span> <span class="st">"SBP"</span>, <span class="at">ylab =</span> <span class="st">"Number of People"</span>, <span class="at">main =</span> <span class="st">"Histogram of SBP of Whitehall Participants"</span>, <span class="at">col=</span><span class="fu">heat.colors</span>(<span class="dv">12</span>), <span class="at">density=</span><span class="dv">100</span>, <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb337-526"><a href="#cb337-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-527"><a href="#cb337-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-528"><a href="#cb337-528" aria-hidden="true" tabindex="-1"></a>When represented with larger bins, however, the distribution does not seem to be quite as normally distributed. Some of the information at lower levels of SBP and in the far right tail is obscured.</span>
<span id="cb337-529"><a href="#cb337-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-530"><a href="#cb337-530" aria-hidden="true" tabindex="-1"></a><span class="fu"># A1.4: Estimates and Confidence Intervals</span></span>
<span id="cb337-531"><a href="#cb337-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-532"><a href="#cb337-532" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-533"><a href="#cb337-533" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-534"><a href="#cb337-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-535"><a href="#cb337-535" aria-hidden="true" tabindex="-1"></a>By the end of this session, students will be able to:</span>
<span id="cb337-536"><a href="#cb337-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-537"><a href="#cb337-537" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand the concepts of statistical inference and sampling distributions</span>
<span id="cb337-538"><a href="#cb337-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-539"><a href="#cb337-539" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate standard error and confidence intervals by hand</span>
<span id="cb337-540"><a href="#cb337-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-541"><a href="#cb337-541" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate standard error and confidence intervals using statistical software</span>
<span id="cb337-542"><a href="#cb337-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-543"><a href="#cb337-543" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpret confidence intervals for a difference in means</span>
<span id="cb337-544"><a href="#cb337-544" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-545"><a href="#cb337-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-546"><a href="#cb337-546" aria-hidden="true" tabindex="-1"></a>You can download the slides here: <span class="co">[</span><span class="ot">1.4: Estimates and Confidence Intervals</span><span class="co">](https://1drv.ms/f/s!AtvH6PgKXPEDgnY0BpwEnf5fdwSy?e=mUsXfF)</span>{target="_blank"}</span>
<span id="cb337-547"><a href="#cb337-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-548"><a href="#cb337-548" aria-hidden="true" tabindex="-1"></a>**Standard error (SE)** can be defined as the standard deviation of the sampling distribution. The standard error is calculated using the formula: $SE = \frac{\sigma}{\sqrt{n}}$.</span>
<span id="cb337-549"><a href="#cb337-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-550"><a href="#cb337-550" aria-hidden="true" tabindex="-1"></a>**OR**</span>
<span id="cb337-551"><a href="#cb337-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-552"><a href="#cb337-552" aria-hidden="true" tabindex="-1"></a>Standard Deviation (SD) and sample size (n) can be used to calculate SE as per the following formula:</span>
<span id="cb337-553"><a href="#cb337-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-554"><a href="#cb337-554" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-555"><a href="#cb337-555" aria-hidden="true" tabindex="-1"></a>SE = \frac{SD}{\sqrt{n}}</span>
<span id="cb337-556"><a href="#cb337-556" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-557"><a href="#cb337-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-558"><a href="#cb337-558" aria-hidden="true" tabindex="-1"></a>To calculate SE in R, we will need to first calculate both the SD and n and define these calculations as objects. We will then input these calculations into a formula in order to calculate SE. Let’s calculate the SE for SBP, as an example. Remember to name your objects properly and tell R to exclude missing values!</span>
<span id="cb337-559"><a href="#cb337-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-560"><a href="#cb337-560" aria-hidden="true" tabindex="-1"></a>1)  To calculate n, we will use the <span class="in">`sum`</span> function.</span>
<span id="cb337-561"><a href="#cb337-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-564"><a href="#cb337-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-565"><a href="#cb337-565" aria-hidden="true" tabindex="-1"></a>SBP.n <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(whitehall<span class="sc">$</span>sbp))</span>
<span id="cb337-566"><a href="#cb337-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-567"><a href="#cb337-567" aria-hidden="true" tabindex="-1"></a>SBP.n</span>
<span id="cb337-568"><a href="#cb337-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-569"><a href="#cb337-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-570"><a href="#cb337-570" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise</span></span>
<span id="cb337-571"><a href="#cb337-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-572"><a href="#cb337-572" aria-hidden="true" tabindex="-1"></a>Calculate SD, noting again that we are rounding to 3 significant figures and excluding NA values.</span>
<span id="cb337-573"><a href="#cb337-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-576"><a href="#cb337-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-577"><a href="#cb337-577" aria-hidden="true" tabindex="-1"></a>SBP.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(whitehall<span class="sc">$</span>sbp, <span class="at">na.rm=</span>T)</span>
<span id="cb337-578"><a href="#cb337-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-579"><a href="#cb337-579" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(SBP.sd, <span class="at">digits=</span><span class="dv">3</span>)</span>
<span id="cb337-580"><a href="#cb337-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-581"><a href="#cb337-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-582"><a href="#cb337-582" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate SE</span></span>
<span id="cb337-583"><a href="#cb337-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-584"><a href="#cb337-584" aria-hidden="true" tabindex="-1"></a>To calculate SE using the formula we derived above, and have further simplified our digits instructions.</span>
<span id="cb337-585"><a href="#cb337-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-588"><a href="#cb337-588" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-589"><a href="#cb337-589" aria-hidden="true" tabindex="-1"></a>SBP.se <span class="ot">&lt;-</span> SBP.sd<span class="sc">/</span><span class="fu">sqrt</span>(SBP.n)</span>
<span id="cb337-590"><a href="#cb337-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-591"><a href="#cb337-591" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span> (SBP.se, <span class="dv">3</span>)</span>
<span id="cb337-592"><a href="#cb337-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-593"><a href="#cb337-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-594"><a href="#cb337-594" aria-hidden="true" tabindex="-1"></a><span class="fu"># 95% confidence interval</span></span>
<span id="cb337-595"><a href="#cb337-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-596"><a href="#cb337-596" aria-hidden="true" tabindex="-1"></a>The 95% confidence interval is given by the formula: $CI = \bar{x} \pm Z \cdot \frac{\sigma}{\sqrt{n}}$.</span>
<span id="cb337-597"><a href="#cb337-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-598"><a href="#cb337-598" aria-hidden="true" tabindex="-1"></a>The formula for the 95% confidence interval is:</span>
<span id="cb337-599"><a href="#cb337-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-600"><a href="#cb337-600" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-601"><a href="#cb337-601" aria-hidden="true" tabindex="-1"></a>CI = \bar{x} \pm Z \cdot \frac{\sigma}{\sqrt{n}}</span>
<span id="cb337-602"><a href="#cb337-602" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-603"><a href="#cb337-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-604"><a href="#cb337-604" aria-hidden="true" tabindex="-1"></a>Z0.975 is the 97.5% percentile of the standard normal distribution (\~1.96 SD from the mean). We can determine this precisely in R using qnorm(0.975), which equals to <span class="in">`r qnorm(0.975)`</span>, as previously demonstrated.</span>
<span id="cb337-605"><a href="#cb337-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-608"><a href="#cb337-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-609"><a href="#cb337-609" aria-hidden="true" tabindex="-1"></a>Za <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)</span>
<span id="cb337-610"><a href="#cb337-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-611"><a href="#cb337-611" aria-hidden="true" tabindex="-1"></a>SBP.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(whitehall<span class="sc">$</span>sbp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb337-612"><a href="#cb337-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-613"><a href="#cb337-613" aria-hidden="true" tabindex="-1"></a>ci.Z_SBP <span class="ot">&lt;-</span> <span class="fu">c</span>((SBP.mean <span class="sc">-</span> (SBP.se<span class="sc">*</span>Za)), (SBP.mean <span class="sc">+</span> (SBP.se<span class="sc">*</span>Za))) </span>
<span id="cb337-614"><a href="#cb337-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-615"><a href="#cb337-615" aria-hidden="true" tabindex="-1"></a>ci.Z_SBP</span>
<span id="cb337-616"><a href="#cb337-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-617"><a href="#cb337-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-618"><a href="#cb337-618" aria-hidden="true" tabindex="-1"></a>**We can interpret this is as that ‘we are 95% confident that the true mean SBP for this population lies between 130.2276 mmHg and 131.2754 mmHg.**</span>
<span id="cb337-619"><a href="#cb337-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-620"><a href="#cb337-620" aria-hidden="true" tabindex="-1"></a>Notice how <span class="in">`LDLC.sd/sqrt(LDLC.n)`</span> is effectively $\frac{\sigma}{\sqrt{n}}$ which is the SE. The implication of this is that the larger n is (i.e., the sample size), the smaller SE and the narrower the CI will be (i.e., there will be less uncertainty around the estimated mean). We can also plot a histogram, using our knowledge from previous sections, in order to check whether this variable is approximately normally distributed.</span>
<span id="cb337-621"><a href="#cb337-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-622"><a href="#cb337-622" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A1.4.i:</span></span>
<span id="cb337-623"><a href="#cb337-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-624"><a href="#cb337-624" aria-hidden="true" tabindex="-1"></a>Calculate a 95% confidence interval for mean BMI. How would you interpret this interval?</span>
<span id="cb337-625"><a href="#cb337-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-626"><a href="#cb337-626" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate the Sample Size</span></span>
<span id="cb337-627"><a href="#cb337-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-630"><a href="#cb337-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-631"><a href="#cb337-631" aria-hidden="true" tabindex="-1"></a>BMI.n <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(whitehall<span class="sc">$</span>bmi))</span>
<span id="cb337-632"><a href="#cb337-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-633"><a href="#cb337-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-634"><a href="#cb337-634" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate the SD</span></span>
<span id="cb337-635"><a href="#cb337-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-638"><a href="#cb337-638" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-639"><a href="#cb337-639" aria-hidden="true" tabindex="-1"></a>BMI.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(whitehall<span class="sc">$</span>bmi, <span class="at">na.rm =</span> T)</span>
<span id="cb337-640"><a href="#cb337-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-641"><a href="#cb337-641" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(BMI.sd, <span class="dv">3</span>)</span>
<span id="cb337-642"><a href="#cb337-642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-643"><a href="#cb337-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-644"><a href="#cb337-644" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate the SE</span></span>
<span id="cb337-645"><a href="#cb337-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-648"><a href="#cb337-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-649"><a href="#cb337-649" aria-hidden="true" tabindex="-1"></a>BMI.se <span class="ot">&lt;-</span> BMI.sd<span class="sc">/</span><span class="fu">sqrt</span>(BMI.n)</span>
<span id="cb337-650"><a href="#cb337-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-651"><a href="#cb337-651" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(BMI.se, <span class="dv">3</span>)</span>
<span id="cb337-652"><a href="#cb337-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-653"><a href="#cb337-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-654"><a href="#cb337-654" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate the mean BMI</span></span>
<span id="cb337-655"><a href="#cb337-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-658"><a href="#cb337-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-659"><a href="#cb337-659" aria-hidden="true" tabindex="-1"></a>BMI.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(whitehall<span class="sc">$</span>bmi, <span class="at">na.rm =</span> T)</span>
<span id="cb337-660"><a href="#cb337-660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-661"><a href="#cb337-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-662"><a href="#cb337-662" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate the SE</span></span>
<span id="cb337-663"><a href="#cb337-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-666"><a href="#cb337-666" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-667"><a href="#cb337-667" aria-hidden="true" tabindex="-1"></a>Za <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)</span>
<span id="cb337-668"><a href="#cb337-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-669"><a href="#cb337-669" aria-hidden="true" tabindex="-1"></a>ci.z_BMI <span class="ot">&lt;-</span> <span class="fu">c</span>((BMI.mean <span class="sc">-</span> (BMI.se<span class="sc">*</span>Za)), (BMI.mean <span class="sc">+</span> (BMI.se<span class="sc">*</span>Za))) </span>
<span id="cb337-670"><a href="#cb337-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-671"><a href="#cb337-671" aria-hidden="true" tabindex="-1"></a>ci.z_BMI</span>
<span id="cb337-672"><a href="#cb337-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-673"><a href="#cb337-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-674"><a href="#cb337-674" aria-hidden="true" tabindex="-1"></a>**95% of sample means for BMI lie between 25.12 and 25.31**</span>
<span id="cb337-675"><a href="#cb337-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-676"><a href="#cb337-676" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate 99% CI for BMI</span></span>
<span id="cb337-677"><a href="#cb337-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-680"><a href="#cb337-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-681"><a href="#cb337-681" aria-hidden="true" tabindex="-1"></a>ZA <span class="ot">&lt;-</span> <span class="fu">qnorm</span> (<span class="fl">0.995</span>)</span>
<span id="cb337-682"><a href="#cb337-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-683"><a href="#cb337-683" aria-hidden="true" tabindex="-1"></a>ci.z99_BMI <span class="ot">&lt;-</span> <span class="fu">c</span>((BMI.mean <span class="sc">-</span> (BMI.se<span class="sc">*</span>ZA)), (BMI.mean <span class="sc">+</span> (BMI.se<span class="sc">*</span>ZA))) </span>
<span id="cb337-684"><a href="#cb337-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-685"><a href="#cb337-685" aria-hidden="true" tabindex="-1"></a>ci.z99_BMI</span>
<span id="cb337-686"><a href="#cb337-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-687"><a href="#cb337-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-688"><a href="#cb337-688" aria-hidden="true" tabindex="-1"></a>**The 99% CI is wider. This is because only 1% of your sample means will fall outside this range. Therefore, to be more certain, the range of values will increase to allow for this.**</span>
<span id="cb337-689"><a href="#cb337-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-690"><a href="#cb337-690" aria-hidden="true" tabindex="-1"></a><span class="fu"># A1.5: Hypothesis Testing</span></span>
<span id="cb337-691"><a href="#cb337-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-692"><a href="#cb337-692" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-693"><a href="#cb337-693" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-694"><a href="#cb337-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-695"><a href="#cb337-695" aria-hidden="true" tabindex="-1"></a>By the end of this session, students will be able to:</span>
<span id="cb337-696"><a href="#cb337-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-697"><a href="#cb337-697" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpret p-values</span>
<span id="cb337-698"><a href="#cb337-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-699"><a href="#cb337-699" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Describe type I and type II errors</span>
<span id="cb337-700"><a href="#cb337-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-701"><a href="#cb337-701" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate and interpret t-tests for a difference in means</span>
<span id="cb337-702"><a href="#cb337-702" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-703"><a href="#cb337-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-704"><a href="#cb337-704" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">1.5: Hypothesis Testing</span><span class="co">](https://1drv.ms/f/s!AtvH6PgKXPEDgnfMu293w_0JDjiV?e=FHsi8c)</span>{target="_blank"}</span>
<span id="cb337-705"><a href="#cb337-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-706"><a href="#cb337-706" aria-hidden="true" tabindex="-1"></a>A t-test is an inferential statistic that can be calculated in order to determine the relationship and significance of the difference between the mean values of two separate population variables. There are several assumptions that we take to be true when performing a t-test:</span>
<span id="cb337-707"><a href="#cb337-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-708"><a href="#cb337-708" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The data are continuous</span>
<span id="cb337-709"><a href="#cb337-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-710"><a href="#cb337-710" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The sample data have been randomly sampled from a population</span>
<span id="cb337-711"><a href="#cb337-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-712"><a href="#cb337-712" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>There is homogeneity of variance (i.e. the variability of the data in each group is similar)</span>
<span id="cb337-713"><a href="#cb337-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-714"><a href="#cb337-714" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The distribution is approximately normal</span>
<span id="cb337-715"><a href="#cb337-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-716"><a href="#cb337-716" aria-hidden="true" tabindex="-1"></a>The t-statistic $t$ is given by:</span>
<span id="cb337-717"><a href="#cb337-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-718"><a href="#cb337-718" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-719"><a href="#cb337-719" aria-hidden="true" tabindex="-1"></a>t = \frac{\bar{X}_1 - \bar{X}_2}{\sqrt{s_p^2 \left( \frac{1}{n_1} + \frac{1}{n_2} \right)}}</span>
<span id="cb337-720"><a href="#cb337-720" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-721"><a href="#cb337-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-722"><a href="#cb337-722" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-723"><a href="#cb337-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-724"><a href="#cb337-724" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\bar{X}_1$ and $\bar{X}_2$ are the sample means of the two groups,</span>
<span id="cb337-725"><a href="#cb337-725" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n_1$ and $n_2$ are the sample sizes of the two groups,</span>
<span id="cb337-726"><a href="#cb337-726" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$s_p^2$ is the pooled variance, calculated as:</span>
<span id="cb337-727"><a href="#cb337-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-728"><a href="#cb337-728" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-729"><a href="#cb337-729" aria-hidden="true" tabindex="-1"></a>s_p^2 = \frac{(n_1 - 1)s_1^2 + (n_2 - 1)s_2^2}{n_1 + n_2 - 2}</span>
<span id="cb337-730"><a href="#cb337-730" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-731"><a href="#cb337-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-732"><a href="#cb337-732" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$s_1^2$ and $s_2^2$ are the variances of the two groups.</span>
<span id="cb337-733"><a href="#cb337-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-734"><a href="#cb337-734" aria-hidden="true" tabindex="-1"></a>A one-sample t-test (or student’s t-test) is used on a continuous measurement to decide whether a population mean is equal to a specific value — i.e. is the systolic blood pressure of our population 120, or not. In R, to complete a one-sample t-test, the syntax is:</span>
<span id="cb337-735"><a href="#cb337-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-736"><a href="#cb337-736" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-737"><a href="#cb337-737" aria-hidden="true" tabindex="-1"></a><span class="in">t.test(x, conf.level=0.95 , …[options] )</span></span>
<span id="cb337-738"><a href="#cb337-738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-739"><a href="#cb337-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-740"><a href="#cb337-740" aria-hidden="true" tabindex="-1"></a>For a two-sample t-test (independent samples t-test), the following code should be used:</span>
<span id="cb337-741"><a href="#cb337-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-742"><a href="#cb337-742" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-743"><a href="#cb337-743" aria-hidden="true" tabindex="-1"></a><span class="in">t.test(x[group==1], x[group==2] , conf.level=0.95 , …[options] )</span></span>
<span id="cb337-744"><a href="#cb337-744" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-745"><a href="#cb337-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-746"><a href="#cb337-746" aria-hidden="true" tabindex="-1"></a>For a two-sample test, x specifies the variable on which to perform the t-test, while the group variable defines the groups to be compared. An alternative formulation for the two sample t.test is:</span>
<span id="cb337-747"><a href="#cb337-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-748"><a href="#cb337-748" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-749"><a href="#cb337-749" aria-hidden="true" tabindex="-1"></a><span class="in">t.test(x~group, data=)</span></span>
<span id="cb337-750"><a href="#cb337-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-751"><a href="#cb337-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-752"><a href="#cb337-752" aria-hidden="true" tabindex="-1"></a>See <span class="in">`?t.test`</span> for details of the other options within the native R help files.</span>
<span id="cb337-753"><a href="#cb337-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-754"><a href="#cb337-754" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A1.5a:</span></span>
<span id="cb337-755"><a href="#cb337-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-756"><a href="#cb337-756" aria-hidden="true" tabindex="-1"></a>**Recode BMI into a binary variable so that one group has a BMI below 25, and the other group has a BMI of 25 and above. Perform a t-test to compare the mean SBP in those with BMI\&lt;25 and those with BMI≥. Answer the questions:**</span>
<span id="cb337-757"><a href="#cb337-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-760"><a href="#cb337-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-761"><a href="#cb337-761" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb337-762"><a href="#cb337-762" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&lt;</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb337-763"><a href="#cb337-763" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb337-764"><a href="#cb337-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-765"><a href="#cb337-765" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>bmi_grp4)</span>
<span id="cb337-766"><a href="#cb337-766" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-767"><a href="#cb337-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-768"><a href="#cb337-768" aria-hidden="true" tabindex="-1"></a>I. <span class="sc">\*\*</span>What is the mean SBP where BMI <span class="sc">\&lt;</span>25 ($\overline{x_1}$)?</span>
<span id="cb337-769"><a href="#cb337-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-772"><a href="#cb337-772" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-773"><a href="#cb337-773" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sbp<span class="sc">~</span>bmi_grp4, mean, <span class="at">subset =</span> bmi_grp4 <span class="sc">==</span> <span class="dv">1</span>, <span class="at">data =</span> whitehall) </span>
<span id="cb337-774"><a href="#cb337-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-775"><a href="#cb337-775" aria-hidden="true" tabindex="-1"></a>x1</span>
<span id="cb337-776"><a href="#cb337-776" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-777"><a href="#cb337-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-778"><a href="#cb337-778" aria-hidden="true" tabindex="-1"></a>I. 129.49mmHg</span>
<span id="cb337-779"><a href="#cb337-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-780"><a href="#cb337-780" aria-hidden="true" tabindex="-1"></a>II. <span class="sc">\*\*</span>What is the mean SBP where BMI ≥25 ($\overline{x_2}$)?</span>
<span id="cb337-781"><a href="#cb337-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-784"><a href="#cb337-784" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-785"><a href="#cb337-785" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sbp<span class="sc">~</span>bmi_grp4, mean, <span class="at">subset =</span> bmi_grp4 <span class="sc">==</span> <span class="dv">2</span>, <span class="at">data =</span> whitehall) </span>
<span id="cb337-786"><a href="#cb337-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-787"><a href="#cb337-787" aria-hidden="true" tabindex="-1"></a>x2</span>
<span id="cb337-788"><a href="#cb337-788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-789"><a href="#cb337-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-790"><a href="#cb337-790" aria-hidden="true" tabindex="-1"></a>II. 131.65mmHg</span>
<span id="cb337-791"><a href="#cb337-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-792"><a href="#cb337-792" aria-hidden="true" tabindex="-1"></a>III. <span class="sc">\*\*</span>What is the mean difference ($\overline{x_2}-\overline{x_1}$)?</span>
<span id="cb337-793"><a href="#cb337-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-796"><a href="#cb337-796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-797"><a href="#cb337-797" aria-hidden="true" tabindex="-1"></a>mean_diff <span class="ot">&lt;-</span> x1 <span class="sc">-</span> x2 </span>
<span id="cb337-798"><a href="#cb337-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-799"><a href="#cb337-799" aria-hidden="true" tabindex="-1"></a>mean_diff</span>
<span id="cb337-800"><a href="#cb337-800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-801"><a href="#cb337-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-802"><a href="#cb337-802" aria-hidden="true" tabindex="-1"></a>III. Using basic arithmetic in R:131.6524-129.4905 = 2.1619</span>
<span id="cb337-803"><a href="#cb337-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-804"><a href="#cb337-804" aria-hidden="true" tabindex="-1"></a>IV. **What is the test statistic t ?**</span>
<span id="cb337-805"><a href="#cb337-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-808"><a href="#cb337-808" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-809"><a href="#cb337-809" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">t.test</span>(sbp<span class="sc">~</span>bmi_grp4, <span class="at">data =</span> whitehall) </span>
<span id="cb337-810"><a href="#cb337-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-811"><a href="#cb337-811" aria-hidden="true" tabindex="-1"></a>t</span>
<span id="cb337-812"><a href="#cb337-812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-813"><a href="#cb337-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-814"><a href="#cb337-814" aria-hidden="true" tabindex="-1"></a>IV. The t-statistic is the ratio of the departure of the estimated value of a parameter from its hypothesized value to its standard error. It can be utilised to tell us about whether we should support or reject the null hypothesis.t = -4.0068</span>
<span id="cb337-815"><a href="#cb337-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-816"><a href="#cb337-816" aria-hidden="true" tabindex="-1"></a>V. **What is 95% CI for the mean difference?**</span>
<span id="cb337-817"><a href="#cb337-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-818"><a href="#cb337-818" aria-hidden="true" tabindex="-1"></a>**95 percent confidence interval: -3.22, -1.10That is to say, we are 95% confident that the difference in the mean systolic blood pressure between those with BMI \&lt;25 and BMI 25 lies between 1.10 and 3.22 mmHg.**</span>
<span id="cb337-819"><a href="#cb337-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-820"><a href="#cb337-820" aria-hidden="true" tabindex="-1"></a>VI. **What is the p-value for this t-test and what does it mean?**</span>
<span id="cb337-821"><a href="#cb337-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-822"><a href="#cb337-822" aria-hidden="true" tabindex="-1"></a>**The p-value is 6.267e-05 = 0.00006267. Remember that p-values provide us with the probability of getting the mean difference we saw here, or one greater, if the null hypothesis was actually true. In this case, that probability is extremely low.Here, our p-value tells us that there is very strong evidence against the null hypothesis (which would be that there is no difference in SBP between our two BMI groups).Therefore, we can say that there is a significant difference in the mean SBP measures in people who are overweight and those who are not.**</span>
<span id="cb337-823"><a href="#cb337-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-824"><a href="#cb337-824" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A1.5b:</span></span>
<span id="cb337-825"><a href="#cb337-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-826"><a href="#cb337-826" aria-hidden="true" tabindex="-1"></a>**If a clinician has decided that a difference of at least 5 mmHg is considered a clinically worthwhile difference in blood pressure with regard to morbidity associated with high blood pressure, do you consider the result in A1.5a to be clinically significant?**</span>
<span id="cb337-827"><a href="#cb337-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-828"><a href="#cb337-828" aria-hidden="true" tabindex="-1"></a>**Answer A1.5b:**</span>
<span id="cb337-829"><a href="#cb337-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-830"><a href="#cb337-830" aria-hidden="true" tabindex="-1"></a>**No. Note here the difference between clinical and statistical significance. Whilst there is a statistically significant difference between the 2 mean SBP measures, with a mean difference of 2.16 mmHg, the result is not clinically significant.**</span>
<span id="cb337-831"><a href="#cb337-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-832"><a href="#cb337-832" aria-hidden="true" tabindex="-1"></a><span class="fu"># A1.6: Transforming Variables</span></span>
<span id="cb337-833"><a href="#cb337-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-834"><a href="#cb337-834" aria-hidden="true" tabindex="-1"></a>In @sec-A1.3 you learnt about data types and data distributions. Many of the tests that we use for continuous variables assume that the data follow a Gaussian or normal distribution. You have learnt how to create a histogram and use this to assess if the data follow the appropriate distribution. But what do we do if they don’t?</span>
<span id="cb337-835"><a href="#cb337-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-836"><a href="#cb337-836" aria-hidden="true" tabindex="-1"></a>In these situations it is often acceptable to ‘transform’ your variable. This means to apply a mathematical function to each observed value, and then analyse the transformed values. This is a perfectly valid and widely accepted approach to dealing with skewed data. You just need to take care to use it appropriately. For example, you must ensure that if you are comparing means between two or more groups, that you perform the same transformation on all groups in the analysis so that the means are still comparable. Also, you must make sure that you interpret the results of any statistical tests on transformed data appropriately. It is often best to transform any means and mean differences back into the original units.</span>
<span id="cb337-837"><a href="#cb337-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-838"><a href="#cb337-838" aria-hidden="true" tabindex="-1"></a>The table below shows the most useful transformations to deal with different deviations from the normal distribution.</span>
<span id="cb337-839"><a href="#cb337-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-840"><a href="#cb337-840" aria-hidden="true" tabindex="-1"></a>| Form of data            | Transformation      |</span>
<span id="cb337-841"><a href="#cb337-841" aria-hidden="true" tabindex="-1"></a>|-------------------------|---------------------|</span>
<span id="cb337-842"><a href="#cb337-842" aria-hidden="true" tabindex="-1"></a>| Slightly right-skewed   | Square root         |</span>
<span id="cb337-843"><a href="#cb337-843" aria-hidden="true" tabindex="-1"></a>| Moderately right-skewed | Logarithmic         |</span>
<span id="cb337-844"><a href="#cb337-844" aria-hidden="true" tabindex="-1"></a>| Very right-skewed       | Reciprocal          |</span>
<span id="cb337-845"><a href="#cb337-845" aria-hidden="true" tabindex="-1"></a>| Left-skewed             | Square              |</span>
<span id="cb337-846"><a href="#cb337-846" aria-hidden="true" tabindex="-1"></a>| Counts                  | Square root         |</span>
<span id="cb337-847"><a href="#cb337-847" aria-hidden="true" tabindex="-1"></a>| Proportions             | Arcsine square root |</span>
<span id="cb337-848"><a href="#cb337-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-849"><a href="#cb337-849" aria-hidden="true" tabindex="-1"></a>If you have decided to use a transformation it is best to plot your raw data (histogram or Q-Q plot depending on your preference), create a new variable with the transformed data, and then plot the transformed variable in the same way to check that the transformation has had the desired effect.</span>
<span id="cb337-850"><a href="#cb337-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-851"><a href="#cb337-851" aria-hidden="true" tabindex="-1"></a>Sometimes variable transformations do not help. For example, if the measures of central tendency are all at the very extreme values of a variable then it is unlikely that any transformation will be useful. In these cases, non-parametric tests may be preferred. We will cover when and how to use non-parametric tests in Module B3.</span>
<span id="cb337-852"><a href="#cb337-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-853"><a href="#cb337-853" aria-hidden="true" tabindex="-1"></a>The natural log is the log to the base of the constant e (also known as Euler’s number), which is approximately 2.718281828459.</span>
<span id="cb337-854"><a href="#cb337-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-855"><a href="#cb337-855" aria-hidden="true" tabindex="-1"></a>If you are interested in why this number is so important, a quick Google of the term Euler’s number should suffice, but you do not need to know why we use this value in order to run this analysis. (NB: Euler’s number is not to be confused with Euler’s constant, which is a different thing entirely!)</span>
<span id="cb337-856"><a href="#cb337-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-857"><a href="#cb337-857" aria-hidden="true" tabindex="-1"></a>Firstly, plot and inspect a histogram of the variable hdlc. Adding a normal curve might help to see what we are looking at.</span>
<span id="cb337-858"><a href="#cb337-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-859"><a href="#cb337-859" aria-hidden="true" tabindex="-1"></a>To do this in R you write:</span>
<span id="cb337-860"><a href="#cb337-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-861"><a href="#cb337-861" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-862"><a href="#cb337-862" aria-hidden="true" tabindex="-1"></a><span class="in">data$variable_log &lt;- log(data$variable)</span></span>
<span id="cb337-863"><a href="#cb337-863" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-864"><a href="#cb337-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-865"><a href="#cb337-865" aria-hidden="true" tabindex="-1"></a>**Use this function to log transform the ‘hdlc’ variable. Now create a new histogram of your transformed variable. How does this compare to your original? Does this transformation help your data? What might you do differently?**</span>
<span id="cb337-866"><a href="#cb337-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-869"><a href="#cb337-869" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-870"><a href="#cb337-870" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>hdlc.log <span class="ot">&lt;-</span> <span class="fu">log</span>(whitehall<span class="sc">$</span>hdlc)</span>
<span id="cb337-871"><a href="#cb337-871" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-872"><a href="#cb337-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-873"><a href="#cb337-873" aria-hidden="true" tabindex="-1"></a>Then to look at the histogram we write:</span>
<span id="cb337-874"><a href="#cb337-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-877"><a href="#cb337-877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-878"><a href="#cb337-878" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(whitehall<span class="sc">$</span>hdlc.log, <span class="at">breaks =</span> <span class="dv">20</span>)</span>
<span id="cb337-879"><a href="#cb337-879" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-880"><a href="#cb337-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-881"><a href="#cb337-881" aria-hidden="true" tabindex="-1"></a>You can see that the data are closer to following the normal curve in this histogram compared to the previous. In the first histogram the most common values (taller bars) are slightly outside of the normal curve to the left of the mean, and there is a more gradual slope on the right-hand side of the mean (peak of the normal curve). This means there are more values in the bins to the right of the mean than to the left of the mean. This is a (very) slight right skew.</span>
<span id="cb337-882"><a href="#cb337-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-883"><a href="#cb337-883" aria-hidden="true" tabindex="-1"></a>In the histogram of the transformed data the highest points are closer to the mean, so this could be classed as a slight improvement, but we are more seeing some of the most common values slightly to the right of the mean, and a more gradual slop off to the left, so a very minimal left skew. This wouldn’t worry us if we saw a skew this slight in the raw data, but in transformed data this is an ‘over-correction’ and indicates that the log transformation might not be the best option for this variable. Referring back to the table at the top of the page, we would select the square root transformation here instead.</span>
<span id="cb337-884"><a href="#cb337-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-885"><a href="#cb337-885" aria-hidden="true" tabindex="-1"></a>In reality, the original hdlc variable was quite close to normality, and a sufficiently large sample size that we would not be worried, but it is a good candidate to experiment on.</span>
<span id="cb337-886"><a href="#cb337-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-887"><a href="#cb337-887" aria-hidden="true" tabindex="-1"></a><span class="fu">## Custom function to find the mode</span></span>
<span id="cb337-888"><a href="#cb337-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-891"><a href="#cb337-891" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-892"><a href="#cb337-892" aria-hidden="true" tabindex="-1"></a>get_mode <span class="ot">&lt;-</span> <span class="cf">function</span>(v){ </span>
<span id="cb337-893"><a href="#cb337-893" aria-hidden="true" tabindex="-1"></a>  uniq_vals <span class="ot">&lt;-</span> <span class="fu">unique</span>(v) <span class="co"># Get unique values </span></span>
<span id="cb337-894"><a href="#cb337-894" aria-hidden="true" tabindex="-1"></a>  uniq_vals[<span class="fu">which.max</span>(<span class="fu">tabulate</span>(<span class="fu">match</span>(v, uniq_vals)))] <span class="co"># Find the most frequent value</span></span>
<span id="cb337-895"><a href="#cb337-895" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb337-896"><a href="#cb337-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-897"><a href="#cb337-897" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">31</span>, <span class="dv">38</span>, <span class="dv">18</span>, <span class="dv">14</span>, <span class="dv">16</span>, <span class="dv">25</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">27</span>, <span class="dv">42</span>, <span class="dv">30</span>, <span class="dv">32</span>)</span>
<span id="cb337-898"><a href="#cb337-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-899"><a href="#cb337-899" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mode</span></span>
<span id="cb337-900"><a href="#cb337-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-901"><a href="#cb337-901" aria-hidden="true" tabindex="-1"></a>mode_value <span class="ot">&lt;-</span> <span class="fu">get_mode</span>(x) </span>
<span id="cb337-902"><a href="#cb337-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-903"><a href="#cb337-903" aria-hidden="true" tabindex="-1"></a>mode_value</span>
<span id="cb337-904"><a href="#cb337-904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-905"><a href="#cb337-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-906"><a href="#cb337-906" aria-hidden="true" tabindex="-1"></a><span class="fu"># A2.1 Introduction to Power and Sample Size Calculation {#sec-A2.1}</span></span>
<span id="cb337-907"><a href="#cb337-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-908"><a href="#cb337-908" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-909"><a href="#cb337-909" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-910"><a href="#cb337-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-911"><a href="#cb337-911" aria-hidden="true" tabindex="-1"></a>By the end of this session, students will be able to:</span>
<span id="cb337-912"><a href="#cb337-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-913"><a href="#cb337-913" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Continue practicing basic software commands</span>
<span id="cb337-914"><a href="#cb337-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-915"><a href="#cb337-915" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Learn how to explore the dataset, identifying the different types of variable stored</span>
<span id="cb337-916"><a href="#cb337-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-917"><a href="#cb337-917" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate the different measures of location and spread</span>
<span id="cb337-918"><a href="#cb337-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-919"><a href="#cb337-919" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Plot frequency distributions and histograms</span>
<span id="cb337-920"><a href="#cb337-920" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-921"><a href="#cb337-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-922"><a href="#cb337-922" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">A2.1 Key Concepts</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgklIx_PHxzZ6DWAA?e=Zb8cS1)</span>{target="_blank"}</span>
<span id="cb337-923"><a href="#cb337-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-924"><a href="#cb337-924" aria-hidden="true" tabindex="-1"></a>The power package</span>
<span id="cb337-925"><a href="#cb337-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-926"><a href="#cb337-926" aria-hidden="true" tabindex="-1"></a>We can estimate sample size and power using the R package ‘pwr’. First you need to install the package and load the library:</span>
<span id="cb337-927"><a href="#cb337-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-928"><a href="#cb337-928" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-929"><a href="#cb337-929" aria-hidden="true" tabindex="-1"></a><span class="in">install.packages("pwr")</span></span>
<span id="cb337-930"><a href="#cb337-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-931"><a href="#cb337-931" aria-hidden="true" tabindex="-1"></a><span class="in">library(pwr)</span></span>
<span id="cb337-932"><a href="#cb337-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-933"><a href="#cb337-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-934"><a href="#cb337-934" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb337-935"><a href="#cb337-935" aria-hidden="true" tabindex="-1"></a><span class="in"> library(pwr)</span></span>
<span id="cb337-936"><a href="#cb337-936" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-937"><a href="#cb337-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-938"><a href="#cb337-938" aria-hidden="true" tabindex="-1"></a>Once this package is installed, we can start calculating our needed sample size to test hypotheses or we can estimate the amount of power a study had to detect a difference is one existed. The next sections will show you how to do this.</span>
<span id="cb337-939"><a href="#cb337-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-940"><a href="#cb337-940" aria-hidden="true" tabindex="-1"></a>**Look at the help file for the function pwr.t.test. What is the default value for significance level?**</span>
<span id="cb337-941"><a href="#cb337-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-942"><a href="#cb337-942" aria-hidden="true" tabindex="-1"></a>**What information do you need to conduct a sample size estimate for difference between means?**</span>
<span id="cb337-943"><a href="#cb337-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-944"><a href="#cb337-944" aria-hidden="true" tabindex="-1"></a>The default value for significance level (denoted as ‘sig.level‘) in the function is 0.05. This is indicated by sig.level=0.05, and can be changed by specifying a different number in the function. So you can work out the sample size you would need for different significance levels.</span>
<span id="cb337-945"><a href="#cb337-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-946"><a href="#cb337-946" aria-hidden="true" tabindex="-1"></a>To conduct a sample size estimate between means you need the power and alpha values you have decided on, the estimated mean of each group in the population, or the estimated difference between groups in the population, and the estimated population standard deviation.</span>
<span id="cb337-947"><a href="#cb337-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-948"><a href="#cb337-948" aria-hidden="true" tabindex="-1"></a><span class="fu"># A2.2 Power calculations for a difference in means {#sec-A2.2}</span></span>
<span id="cb337-949"><a href="#cb337-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-950"><a href="#cb337-950" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-951"><a href="#cb337-951" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-952"><a href="#cb337-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-953"><a href="#cb337-953" aria-hidden="true" tabindex="-1"></a>By the end of this session, students will be able to:</span>
<span id="cb337-954"><a href="#cb337-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-955"><a href="#cb337-955" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the key concept of power and what impacts it</span>
<span id="cb337-956"><a href="#cb337-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-957"><a href="#cb337-957" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimate the power of a given study</span>
<span id="cb337-958"><a href="#cb337-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-959"><a href="#cb337-959" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimate the sample size needed to test hypotheses in different study designs</span>
<span id="cb337-960"><a href="#cb337-960" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-961"><a href="#cb337-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-962"><a href="#cb337-962" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">A2.2 Power calculations for a difference in means</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgko9OFv6whK6t7Mf?e=10INKQ)</span>{target="_blank"}</span>
<span id="cb337-963"><a href="#cb337-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-964"><a href="#cb337-964" aria-hidden="true" tabindex="-1"></a><span class="fu">## Power calculations for two means</span></span>
<span id="cb337-965"><a href="#cb337-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-966"><a href="#cb337-966" aria-hidden="true" tabindex="-1"></a>Here is an example:</span>
<span id="cb337-967"><a href="#cb337-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-968"><a href="#cb337-968" aria-hidden="true" tabindex="-1"></a>Estimate the sample size needed to compare the mean systolic blood pressure (SBP) in two populations. From a pilot study, you think that the group with lower blood pressure will have a mean SBP of 120 mm Hg, and the standard deviation (SD) of both groups will be 15 mm Hg. You have decided that you are interested in a minimum difference of 5 mm Hg, and you want 90% power, and a 5% significance level.</span>
<span id="cb337-969"><a href="#cb337-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-970"><a href="#cb337-970" aria-hidden="true" tabindex="-1"></a>In R, we need to calculate two statistics to estimate sample size: delta (i.e. the expected difference between groups) and sigma (variance, which in this case is the pooled standard deviation). Once we have delta and sigma, we can calculate the effect size we expect to see, which is Cohen’s d. We can guess delta and sigma from looking at past studies or by running a pilot study. Cohen’s d is estimated by dividing the delta by the sigma.</span>
<span id="cb337-971"><a href="#cb337-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-972"><a href="#cb337-972" aria-hidden="true" tabindex="-1"></a>**Cohen's d**</span>
<span id="cb337-973"><a href="#cb337-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-976"><a href="#cb337-976" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-977"><a href="#cb337-977" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">15</span></span>
<span id="cb337-978"><a href="#cb337-978" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb337-979"><a href="#cb337-979" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-980"><a href="#cb337-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-981"><a href="#cb337-981" aria-hidden="true" tabindex="-1"></a>**Use the ‘pwr.t.test’ command to assess the sample size needed to detect this effect size.**</span>
<span id="cb337-982"><a href="#cb337-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-985"><a href="#cb337-985" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-986"><a href="#cb337-986" aria-hidden="true" tabindex="-1"></a>power1 <span class="ot">&lt;-</span><span class="fu">pwr.t.test</span>(<span class="at">d=</span>d, <span class="at">power=</span><span class="fl">0.9</span>, <span class="at">sig.level =</span><span class="fl">0.05</span> ) </span>
<span id="cb337-987"><a href="#cb337-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-988"><a href="#cb337-988" aria-hidden="true" tabindex="-1"></a>power1</span>
<span id="cb337-989"><a href="#cb337-989" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-990"><a href="#cb337-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-991"><a href="#cb337-991" aria-hidden="true" tabindex="-1"></a>You need approximately 190 participants in each group, and 380 participants overall.</span>
<span id="cb337-992"><a href="#cb337-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-993"><a href="#cb337-993" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb337-994"><a href="#cb337-994" aria-hidden="true" tabindex="-1"></a>n is number in *each* group</span>
<span id="cb337-995"><a href="#cb337-995" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-996"><a href="#cb337-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-997"><a href="#cb337-997" aria-hidden="true" tabindex="-1"></a>**If we want to estimate the power of a given sample size, we omit the ‘power’ option, and instead use the ‘n=’ option:**</span>
<span id="cb337-998"><a href="#cb337-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1001"><a href="#cb337-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1002"><a href="#cb337-1002" aria-hidden="true" tabindex="-1"></a>power2 <span class="ot">&lt;-</span><span class="fu">pwr.t.test</span>(<span class="at">n=</span><span class="dv">190</span>, <span class="at">d=</span>d, <span class="at">sig.level =</span><span class="fl">0.05</span> ) </span>
<span id="cb337-1003"><a href="#cb337-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1004"><a href="#cb337-1004" aria-hidden="true" tabindex="-1"></a>power2</span>
<span id="cb337-1005"><a href="#cb337-1005" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1006"><a href="#cb337-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1007"><a href="#cb337-1007" aria-hidden="true" tabindex="-1"></a>We can see here that recruiting 190 participants in each blood pressure group would enable our study to have 90% power.</span>
<span id="cb337-1008"><a href="#cb337-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1009"><a href="#cb337-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question A2.2:</span></span>
<span id="cb337-1010"><a href="#cb337-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1011"><a href="#cb337-1011" aria-hidden="true" tabindex="-1"></a>how much power would we have ended up with in our study if we only managed to recruit 150 participants in each group, but the variance of our study sample was smaller than what we anticipated (so SD=12) ?</span>
<span id="cb337-1012"><a href="#cb337-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1015"><a href="#cb337-1015" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1016"><a href="#cb337-1016" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">12</span> </span>
<span id="cb337-1017"><a href="#cb337-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1018"><a href="#cb337-1018" aria-hidden="true" tabindex="-1"></a>d1</span>
<span id="cb337-1019"><a href="#cb337-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1020"><a href="#cb337-1020" aria-hidden="true" tabindex="-1"></a>power3 <span class="ot">&lt;-</span> <span class="fu">pwr.t.test</span>(<span class="at">n=</span><span class="dv">150</span>, <span class="at">d=</span>d1, <span class="at">sig.level =</span> <span class="fl">0.05</span>) </span>
<span id="cb337-1021"><a href="#cb337-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1022"><a href="#cb337-1022" aria-hidden="true" tabindex="-1"></a>power3</span>
<span id="cb337-1023"><a href="#cb337-1023" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1024"><a href="#cb337-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1025"><a href="#cb337-1025" aria-hidden="true" tabindex="-1"></a>**We recruited fewer participants, which would decrease our power, but since our variance was lower our power actually increased overall to 95%**</span>
<span id="cb337-1026"><a href="#cb337-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1027"><a href="#cb337-1027" aria-hidden="true" tabindex="-1"></a>#A2.3 Power calculations for two proportions {#sec-A2.3}</span>
<span id="cb337-1028"><a href="#cb337-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1029"><a href="#cb337-1029" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1030"><a href="#cb337-1030" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1031"><a href="#cb337-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1032"><a href="#cb337-1032" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1033"><a href="#cb337-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1034"><a href="#cb337-1034" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the key concept of power and what impacts it</span>
<span id="cb337-1035"><a href="#cb337-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1036"><a href="#cb337-1036" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimate the power of a given study</span>
<span id="cb337-1037"><a href="#cb337-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1038"><a href="#cb337-1038" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimate the sample size needed to test hypotheses in different study designs</span>
<span id="cb337-1039"><a href="#cb337-1039" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1040"><a href="#cb337-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1041"><a href="#cb337-1041" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">A2.3 Power calculations for a difference in proportions</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgkscJs5h1Z49wtOt?e=Zp3dNL)</span>{target="_blank"}</span>
<span id="cb337-1042"><a href="#cb337-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1043"><a href="#cb337-1043" aria-hidden="true" tabindex="-1"></a>Here is an example:</span>
<span id="cb337-1044"><a href="#cb337-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1045"><a href="#cb337-1045" aria-hidden="true" tabindex="-1"></a>Estimate the sample size needed to compare the proportion of people who smoke in two populations. From previous work, you think that 10% of the people in population A smoke, and that an absolute increase of 5% in population B (compared to population A) would be clinically significant. You want 90% power, and a 5% significance level.</span>
<span id="cb337-1046"><a href="#cb337-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1047"><a href="#cb337-1047" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In this scenario we use the <span class="in">`pwr.2p.test`</span> command in the power package.</span>
<span id="cb337-1048"><a href="#cb337-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1049"><a href="#cb337-1049" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>alpha = sig.level option and is equal to 0.05</span>
<span id="cb337-1050"><a href="#cb337-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1051"><a href="#cb337-1051" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>power = 0.90</span>
<span id="cb337-1052"><a href="#cb337-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1053"><a href="#cb337-1053" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>p1 = 0.10</span>
<span id="cb337-1054"><a href="#cb337-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1055"><a href="#cb337-1055" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>p2 = 0.15</span>
<span id="cb337-1056"><a href="#cb337-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1059"><a href="#cb337-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1060"><a href="#cb337-1060" aria-hidden="true" tabindex="-1"></a>power4 <span class="ot">&lt;-</span><span class="fu">pwr.2p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.1</span>, <span class="at">p2=</span><span class="fl">0.15</span>), <span class="at">sig.level=</span><span class="fl">0.05</span>, <span class="at">power=</span><span class="fl">0.9</span>) </span>
<span id="cb337-1061"><a href="#cb337-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1062"><a href="#cb337-1062" aria-hidden="true" tabindex="-1"></a>power4</span>
<span id="cb337-1063"><a href="#cb337-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1064"><a href="#cb337-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1065"><a href="#cb337-1065" aria-hidden="true" tabindex="-1"></a>**You estimate that you need 911 participants from each population, with a total sample of around 1,821.**</span>
<span id="cb337-1066"><a href="#cb337-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1067"><a href="#cb337-1067" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If you wanted different sample sizes in each group, you would use the command <span class="in">`pwr.2p2n.test`</span> instead.</span>
<span id="cb337-1068"><a href="#cb337-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1069"><a href="#cb337-1069" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If we type <span class="in">`plot(power4)`</span> we can see how the power level changes with varying sample sizes:</span>
<span id="cb337-1070"><a href="#cb337-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1073"><a href="#cb337-1073" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1074"><a href="#cb337-1074" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(power4)</span>
<span id="cb337-1075"><a href="#cb337-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1076"><a href="#cb337-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1077"><a href="#cb337-1077" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A2.3:</span></span>
<span id="cb337-1078"><a href="#cb337-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1079"><a href="#cb337-1079" aria-hidden="true" tabindex="-1"></a>Unfortunately, the funding body has informed you, you only have enough resources to recruit a fixed number of people. Can you estimate the power of a study if you only had 500 people in total (with even numbers in each group)?</span>
<span id="cb337-1080"><a href="#cb337-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1083"><a href="#cb337-1083" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1084"><a href="#cb337-1084" aria-hidden="true" tabindex="-1"></a>power5 <span class="ot">&lt;-</span> <span class="fu">pwr.2p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.1</span>, <span class="at">p2=</span><span class="fl">0.15</span>), <span class="at">n =</span> <span class="dv">250</span>, <span class="at">sig.level =</span> <span class="fl">0.05</span>) </span>
<span id="cb337-1085"><a href="#cb337-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1086"><a href="#cb337-1086" aria-hidden="true" tabindex="-1"></a>power5</span>
<span id="cb337-1087"><a href="#cb337-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1088"><a href="#cb337-1088" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1089"><a href="#cb337-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1090"><a href="#cb337-1090" aria-hidden="true" tabindex="-1"></a>**In this scenario, the power of the study would be only 0.40. Most people would regard such a study as under-powered as there is only a 40% chance that the effect will be detected if one truly exists.**</span>
<span id="cb337-1091"><a href="#cb337-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1092"><a href="#cb337-1092" aria-hidden="true" tabindex="-1"></a><span class="fu"># A2.4 Sample Size Calculation for RCTs {#sec-A2.4}</span></span>
<span id="cb337-1093"><a href="#cb337-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1094"><a href="#cb337-1094" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1095"><a href="#cb337-1095" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1096"><a href="#cb337-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1097"><a href="#cb337-1097" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1098"><a href="#cb337-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1099"><a href="#cb337-1099" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the key concept of power and what impacts it</span>
<span id="cb337-1100"><a href="#cb337-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1101"><a href="#cb337-1101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimate the power of a given study</span>
<span id="cb337-1102"><a href="#cb337-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1103"><a href="#cb337-1103" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Estimate the sample size needed to test hypotheses in different study designs**</span>
<span id="cb337-1104"><a href="#cb337-1104" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1105"><a href="#cb337-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1106"><a href="#cb337-1106" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">A2.4: Sample Size Calculations for RCTs</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgk0-hp9s4sp7vf9n?e=saaL89)</span>{target="_blank"}</span>
<span id="cb337-1107"><a href="#cb337-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1108"><a href="#cb337-1108" aria-hidden="true" tabindex="-1"></a>**Sample size calculation for testing a hypothesis (Clinical trials or clinical interventional studies)**</span>
<span id="cb337-1109"><a href="#cb337-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1110"><a href="#cb337-1110" aria-hidden="true" tabindex="-1"></a>The sample size $n$ for each group in an RCT with continuous outcomes is given by:</span>
<span id="cb337-1111"><a href="#cb337-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1112"><a href="#cb337-1112" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-1113"><a href="#cb337-1113" aria-hidden="true" tabindex="-1"></a>n = \frac{{2 \sigma^2 \left(Z_{\frac{\alpha}{2}} + Z_{\beta}\right)^2}}{{\Delta^2}}</span>
<span id="cb337-1114"><a href="#cb337-1114" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-1115"><a href="#cb337-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1116"><a href="#cb337-1116" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-1117"><a href="#cb337-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1118"><a href="#cb337-1118" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n$ is the sample size required in each group,</span>
<span id="cb337-1119"><a href="#cb337-1119" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\sigma^2$ is the population variance (or an estimate based on prior studies or pilot data),</span>
<span id="cb337-1120"><a href="#cb337-1120" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Z_{\frac{\alpha}{2}}$ is the critical value of the standard normal distribution at significance level $\alpha$,(e.g., 95% confidence corresponds to $Z_{\alpha/2} \approx 1.96$).</span>
<span id="cb337-1121"><a href="#cb337-1121" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Z_{\beta}$ is the critical value for power $1 - \beta$,(e.g., 80% power corresponds to $Z_{\beta} \approx 0.84$)</span>
<span id="cb337-1122"><a href="#cb337-1122" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\Delta$ is the effect size (the minimum detectable difference between groups).</span>
<span id="cb337-1123"><a href="#cb337-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1124"><a href="#cb337-1124" aria-hidden="true" tabindex="-1"></a>*This formula is used to ensure the study has enough power to detect a clinically meaningful difference.*</span>
<span id="cb337-1125"><a href="#cb337-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1126"><a href="#cb337-1126" aria-hidden="true" tabindex="-1"></a>Here is an example:</span>
<span id="cb337-1127"><a href="#cb337-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1128"><a href="#cb337-1128" aria-hidden="true" tabindex="-1"></a>In a parallel RCT, 25% of the subjects on the standard therapy had a successful outcome. It is only of clinical relevance if a 40% absolute improvement is observed in the new therapy. How many subjects are required in order to detect this difference with 80% power at the 5% level of significance?</span>
<span id="cb337-1129"><a href="#cb337-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1130"><a href="#cb337-1130" aria-hidden="true" tabindex="-1"></a>In this case we need to assess a difference in proportions again, this time with an effect size that has a 0.40 difference between the groups:</span>
<span id="cb337-1131"><a href="#cb337-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1134"><a href="#cb337-1134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1135"><a href="#cb337-1135" aria-hidden="true" tabindex="-1"></a>power6<span class="ot">&lt;-</span><span class="fu">pwr.2p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.25</span>, <span class="at">p2=</span><span class="fl">0.65</span>), <span class="at">power=</span><span class="fl">0.8</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>)</span>
<span id="cb337-1136"><a href="#cb337-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1137"><a href="#cb337-1137" aria-hidden="true" tabindex="-1"></a>power6</span>
<span id="cb337-1138"><a href="#cb337-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1139"><a href="#cb337-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1140"><a href="#cb337-1140" aria-hidden="true" tabindex="-1"></a>23 subjects per group and 46 subjects are required in total.</span>
<span id="cb337-1141"><a href="#cb337-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1142"><a href="#cb337-1142" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimating sample size for a hypothesis in a cross-sectional study</span></span>
<span id="cb337-1143"><a href="#cb337-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1144"><a href="#cb337-1144" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A2.4:</span></span>
<span id="cb337-1145"><a href="#cb337-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1146"><a href="#cb337-1146" aria-hidden="true" tabindex="-1"></a>In the same parallel trial as described in the example above, we still observe that 25% of the subjects on the standard therapy had a successful outcome, but this time it is only of clinical relevance if a 40% relative improvement is observed in the new therapy. How many subjects are required in order to detect this difference with 80% power at the 5% level of significance?</span>
<span id="cb337-1147"><a href="#cb337-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1148"><a href="#cb337-1148" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Answer A2.4:</span></span>
<span id="cb337-1149"><a href="#cb337-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1150"><a href="#cb337-1150" aria-hidden="true" tabindex="-1"></a>First you need to work out what a 40% relative increase on 25% is: <span class="in">`0.25*1.40=35%`</span> of subjects would need to have a successful outcome for there to be clinical relevance.</span>
<span id="cb337-1151"><a href="#cb337-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1154"><a href="#cb337-1154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1155"><a href="#cb337-1155" aria-hidden="true" tabindex="-1"></a>power7<span class="ot">&lt;-</span><span class="fu">pwr.2p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.25</span>, <span class="at">p2=</span><span class="fl">0.35</span>), <span class="at">power=</span><span class="fl">0.8</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>)</span>
<span id="cb337-1156"><a href="#cb337-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1157"><a href="#cb337-1157" aria-hidden="true" tabindex="-1"></a>power7</span>
<span id="cb337-1158"><a href="#cb337-1158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1159"><a href="#cb337-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1160"><a href="#cb337-1160" aria-hidden="true" tabindex="-1"></a>We need many more patients than in the example above due to the small effect size that we now wish to detect.</span>
<span id="cb337-1161"><a href="#cb337-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1162"><a href="#cb337-1162" aria-hidden="true" tabindex="-1"></a><span class="fu"># A2.5 Sample size calculations for cross-sectional studies (or surveys) {#sec-A2.5}</span></span>
<span id="cb337-1163"><a href="#cb337-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1164"><a href="#cb337-1164" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1165"><a href="#cb337-1165" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1166"><a href="#cb337-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1167"><a href="#cb337-1167" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1168"><a href="#cb337-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1169"><a href="#cb337-1169" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the key concept of power and what impacts it</span>
<span id="cb337-1170"><a href="#cb337-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1171"><a href="#cb337-1171" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimate the power of a given study</span>
<span id="cb337-1172"><a href="#cb337-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1173"><a href="#cb337-1173" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Estimate the sample size needed to test hypotheses in different study designs**</span>
<span id="cb337-1174"><a href="#cb337-1174" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1175"><a href="#cb337-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1176"><a href="#cb337-1176" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">A2.5: Sample size calculations for cross-sectional studies (or surveys)</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgkzY9gcUKlV9CwAA?e=deJFls)</span>{target="_blank"}</span>
<span id="cb337-1177"><a href="#cb337-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1178"><a href="#cb337-1178" aria-hidden="true" tabindex="-1"></a>To determine the sample size $n$ for estimating a population proportion in a cross-sectional study, use the following formula:</span>
<span id="cb337-1179"><a href="#cb337-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1180"><a href="#cb337-1180" aria-hidden="true" tabindex="-1"></a>$$n = \frac{{Z_{\frac{\alpha}{2}}^2 \cdot p \cdot (1 - p)}}{{d^2}}$$</span>
<span id="cb337-1181"><a href="#cb337-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1182"><a href="#cb337-1182" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-1183"><a href="#cb337-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1184"><a href="#cb337-1184" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n$ is the required sample size,</span>
<span id="cb337-1185"><a href="#cb337-1185" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Z_{\frac{\alpha}{2}}$ is the critical value for the desired confidence level (e.g., for 95% confidence, $Z_{\frac{\alpha}{2}} \approx 1.96$),</span>
<span id="cb337-1186"><a href="#cb337-1186" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$p$ is the estimated population proportion (e.g., based on prior data or a pilot study),</span>
<span id="cb337-1187"><a href="#cb337-1187" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$d$ is the desired margin of error or precision (the maximum allowable difference between the sample estimate and population proportion).</span>
<span id="cb337-1188"><a href="#cb337-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1189"><a href="#cb337-1189" aria-hidden="true" tabindex="-1"></a>*This formula helps ensure that the sample size is large enough to accurately estimate the population proportion with a specified confidence level and precision.*</span>
<span id="cb337-1190"><a href="#cb337-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1191"><a href="#cb337-1191" aria-hidden="true" tabindex="-1"></a>**Example of estimating sample size for a hypothesis in a cross-sectional study**</span>
<span id="cb337-1192"><a href="#cb337-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1193"><a href="#cb337-1193" aria-hidden="true" tabindex="-1"></a>You have been asked to help with a power calculation for a cross-sectional study, to estimate the point prevalence of obesity within a population. A study five years ago in this population found that 30% of people were obese, but the government thinks this has increased by 10% (to a point prevalence of 40%). Estimate the sample size needed for this study, assuming that the previous point prevalence of 30% is your 'null hypothesis'. You want 80% power.</span>
<span id="cb337-1194"><a href="#cb337-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1195"><a href="#cb337-1195" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You are calculating a sample size for one proportion here.</span>
<span id="cb337-1196"><a href="#cb337-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1199"><a href="#cb337-1199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1200"><a href="#cb337-1200" aria-hidden="true" tabindex="-1"></a>power8 <span class="ot">&lt;-</span><span class="fu">pwr.p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.3</span>, <span class="at">p2=</span><span class="fl">0.4</span>), <span class="at">power=</span><span class="fl">0.8</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>) </span>
<span id="cb337-1201"><a href="#cb337-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1202"><a href="#cb337-1202" aria-hidden="true" tabindex="-1"></a>power8</span>
<span id="cb337-1203"><a href="#cb337-1203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1204"><a href="#cb337-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1205"><a href="#cb337-1205" aria-hidden="true" tabindex="-1"></a>**You need about 178 participants in your study to estimate this prevalence.**</span>
<span id="cb337-1206"><a href="#cb337-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1207"><a href="#cb337-1207" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A2.5:</span></span>
<span id="cb337-1208"><a href="#cb337-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1209"><a href="#cb337-1209" aria-hidden="true" tabindex="-1"></a>One researcher has suggested that the proportion of the population who is obese may actually have decreased by 10% in the last five years (i.e. to 20%). How would this change your estimate for the sample size needed?</span>
<span id="cb337-1210"><a href="#cb337-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1213"><a href="#cb337-1213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1214"><a href="#cb337-1214" aria-hidden="true" tabindex="-1"></a>power9 <span class="ot">&lt;-</span><span class="fu">pwr.p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.3</span>, <span class="at">p2=</span><span class="fl">0.2</span>), <span class="at">power=</span><span class="fl">0.8</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>) </span>
<span id="cb337-1215"><a href="#cb337-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1216"><a href="#cb337-1216" aria-hidden="true" tabindex="-1"></a>power9</span>
<span id="cb337-1217"><a href="#cb337-1217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1218"><a href="#cb337-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1219"><a href="#cb337-1219" aria-hidden="true" tabindex="-1"></a>**The estimated sample size has now reduced slightly, to 146.**</span>
<span id="cb337-1220"><a href="#cb337-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1221"><a href="#cb337-1221" aria-hidden="true" tabindex="-1"></a>**Based the outputs above, we can conclude that more data are needed to detect a change in proportion from 0.3 to 0.4 than from 0.3 to 0.2. For a fixed absolute difference (here the absolute difference in proportions is 0.1), larger sample sizes are needed to obtain a given level of power as the proportions approach 0.5.**</span>
<span id="cb337-1222"><a href="#cb337-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1223"><a href="#cb337-1223" aria-hidden="true" tabindex="-1"></a>Recall that the standard error (se) of the sampling distribution of p is $SE = \sqrt{\frac{p(1 - p)}{n}}$.</span>
<span id="cb337-1224"><a href="#cb337-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1225"><a href="#cb337-1225" aria-hidden="true" tabindex="-1"></a>Where: - ( p ) is the sample proportion, - ( n ) is the sample size.</span>
<span id="cb337-1226"><a href="#cb337-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1227"><a href="#cb337-1227" aria-hidden="true" tabindex="-1"></a>As p gets closer to 0.5, the amount of variability increases (se is largest when p=0.5) and, therefore, more data are needed to detect a change in proportions of 0.1.</span>
<span id="cb337-1228"><a href="#cb337-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1229"><a href="#cb337-1229" aria-hidden="true" tabindex="-1"></a><span class="fu"># A2.6 Sample size calculations for case-control studies {#sec-A2.6}</span></span>
<span id="cb337-1230"><a href="#cb337-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1231"><a href="#cb337-1231" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1232"><a href="#cb337-1232" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1233"><a href="#cb337-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1234"><a href="#cb337-1234" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1235"><a href="#cb337-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1236"><a href="#cb337-1236" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the key concept of power and what impacts it</span>
<span id="cb337-1237"><a href="#cb337-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1238"><a href="#cb337-1238" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimate the power of a given study</span>
<span id="cb337-1239"><a href="#cb337-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1240"><a href="#cb337-1240" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Estimate the sample size needed to test hypotheses in different study designs**</span>
<span id="cb337-1241"><a href="#cb337-1241" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1242"><a href="#cb337-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1243"><a href="#cb337-1243" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">A2.6: Sample size calculations for case-control studies</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgk4r89kfykscn_0P?e=XnJyGw)</span>{target="_blank"}</span>
<span id="cb337-1244"><a href="#cb337-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1245"><a href="#cb337-1245" aria-hidden="true" tabindex="-1"></a>To calculate the sample size $n$ for each group (cases and controls) in a case-control study, use the following formula: </span>
<span id="cb337-1246"><a href="#cb337-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1247"><a href="#cb337-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1248"><a href="#cb337-1248" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-1249"><a href="#cb337-1249" aria-hidden="true" tabindex="-1"></a>n = \frac{\left(Z_{\frac{\alpha}{2}} + Z_{\beta}\right)^2 \cdot <span class="co">[</span><span class="ot">p_1 (1 - p_1) + p_2 (1 - p_2)</span><span class="co">]</span>}{(p_1 - p_2)^2}</span>
<span id="cb337-1250"><a href="#cb337-1250" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-1251"><a href="#cb337-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1252"><a href="#cb337-1252" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-1253"><a href="#cb337-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1254"><a href="#cb337-1254" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n$ is the sample size required in each group (cases and controls),</span>
<span id="cb337-1255"><a href="#cb337-1255" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Z_{\frac{\alpha}{2}}$ is the critical value for the desired significance level (e.g., for 95% confidence, $Z_{\frac{\alpha}{2}} \approx 1.96$),</span>
<span id="cb337-1256"><a href="#cb337-1256" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Z_{\beta}$ is the critical value for the desired power (e.g., for 80% power, $Z_{\beta} \approx 0.84$),</span>
<span id="cb337-1257"><a href="#cb337-1257" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$p_1$ is the proportion of cases exposed to the risk factor,</span>
<span id="cb337-1258"><a href="#cb337-1258" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$p_2$ is the proportion of controls exposed to the risk factor,</span>
<span id="cb337-1259"><a href="#cb337-1259" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$(p_1 - p_2)$ represents the minimum detectable difference between the proportions of exposure in cases and controls.</span>
<span id="cb337-1260"><a href="#cb337-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1261"><a href="#cb337-1261" aria-hidden="true" tabindex="-1"></a>This formula ensures sufficient power to detect a statistically significant difference in exposure between cases and controls.</span>
<span id="cb337-1262"><a href="#cb337-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1263"><a href="#cb337-1263" aria-hidden="true" tabindex="-1"></a>**Estimating sample size for case-control studies**</span>
<span id="cb337-1264"><a href="#cb337-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1265"><a href="#cb337-1265" aria-hidden="true" tabindex="-1"></a>You have now been asked to help another research group with their power calculations. They want to conduct a case-control study of sterilization (tubal ligation) and ovarian cancer. You could use parameters from a recent paper (reference below). Parameters of interest might include the proportion of cases or controls with tubal ligation, and the odds ratio.</span>
<span id="cb337-1266"><a href="#cb337-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1267"><a href="#cb337-1267" aria-hidden="true" tabindex="-1"></a>Tubal ligation, hysterectomy and epithelial ovarian cancer in the New England Case-Control Study. Rice MS, Murphy MA, Vitonis AF, Cramer DW, Titus LJ, Tworoger SS, Terry KL. Int J Cancer. 2013 Nov 15;133(10):2415-21. doi: 10.1002/ijc.28249. Epub 2013 Jul 9.</span>
<span id="cb337-1268"><a href="#cb337-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1269"><a href="#cb337-1269" aria-hidden="true" tabindex="-1"></a>Looking at the paper, you could extract the following relevant information needed to estimate your sample size:</span>
<span id="cb337-1270"><a href="#cb337-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1271"><a href="#cb337-1271" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Proportion of controls with tubal ligation: 18.5%.</span>
<span id="cb337-1272"><a href="#cb337-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1273"><a href="#cb337-1273" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Proportion of cases with tubal ligation: 12.8%.</span>
<span id="cb337-1274"><a href="#cb337-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1275"><a href="#cb337-1275" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Odds ratio for the association between tubal ligation and ovarian cancer: 0.82.</span>
<span id="cb337-1276"><a href="#cb337-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1277"><a href="#cb337-1277" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This study used 2,265 cases and 2,333 controls.</span>
<span id="cb337-1278"><a href="#cb337-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1279"><a href="#cb337-1279" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb337-1280"><a href="#cb337-1280" aria-hidden="true" tabindex="-1"></a>You probably won’t need to use all of these parameters.</span>
<span id="cb337-1281"><a href="#cb337-1281" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1282"><a href="#cb337-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1283"><a href="#cb337-1283" aria-hidden="true" tabindex="-1"></a>If you want to use a test of proportions to assess how large your sample needs to be for an expected odds ratio of the association between tubal ligation and ovarian cancer, you need to have two proportions for the command. Above we assume that 18% of controls have had tubal ligation, so we then can use this formula to work background from an expected odds ratio to see the other proportion:</span>
<span id="cb337-1284"><a href="#cb337-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1285"><a href="#cb337-1285" aria-hidden="true" tabindex="-1"></a>$$p2 = {\frac{(OR*p1)}{(1+p1(OR-1))}}$$</span>
<span id="cb337-1286"><a href="#cb337-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1287"><a href="#cb337-1287" aria-hidden="true" tabindex="-1"></a>**Example 2.6**</span>
<span id="cb337-1288"><a href="#cb337-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1289"><a href="#cb337-1289" aria-hidden="true" tabindex="-1"></a>**how many people do you need to recruit into your study if your odds ratio is less than 0.8 and you want to have power of at least 80% ?**</span>
<span id="cb337-1290"><a href="#cb337-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1293"><a href="#cb337-1293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1294"><a href="#cb337-1294" aria-hidden="true" tabindex="-1"></a>power10 <span class="ot">&lt;-</span><span class="fu">pwr.p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.9</span>, <span class="at">p2=</span><span class="fl">0.8</span>), <span class="at">power=</span><span class="fl">0.8</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>)</span>
<span id="cb337-1295"><a href="#cb337-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1296"><a href="#cb337-1296" aria-hidden="true" tabindex="-1"></a>power10 </span>
<span id="cb337-1297"><a href="#cb337-1297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1298"><a href="#cb337-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1299"><a href="#cb337-1299" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question A2.6a:</span></span>
<span id="cb337-1300"><a href="#cb337-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1301"><a href="#cb337-1301" aria-hidden="true" tabindex="-1"></a>**Looking at the plot, how many people do you need to recruit into your study if your odds ratio is less than 0.8 and you want to have power of at least 80%?**</span>
<span id="cb337-1302"><a href="#cb337-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1303"><a href="#cb337-1303" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Answer A2.6a:</span></span>
<span id="cb337-1304"><a href="#cb337-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1305"><a href="#cb337-1305" aria-hidden="true" tabindex="-1"></a>**If the odds ratio in this scenario is ≤ 0.8, (i.e. an effect size of 20% -40%) then you can reach a power ≥ 0.8 with a sample size of around 5000 people. If the true odds ratio is closer to 0.9 (i.e. a 10% effect size), then you would require a much larger sample size.**</span>
<span id="cb337-1306"><a href="#cb337-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1307"><a href="#cb337-1307" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Answer A2.6b:</span></span>
<span id="cb337-1308"><a href="#cb337-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1309"><a href="#cb337-1309" aria-hidden="true" tabindex="-1"></a>We substitute a proportion of 18% and an OR of 0.85 into the formula:</span>
<span id="cb337-1310"><a href="#cb337-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1311"><a href="#cb337-1311" aria-hidden="true" tabindex="-1"></a>$$p2 = {\frac{(OR*p1)}{(1+p1(OR-1))}}$$</span>
<span id="cb337-1312"><a href="#cb337-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1313"><a href="#cb337-1313" aria-hidden="true" tabindex="-1"></a>p2= (0.85<span class="sc">\*</span>0.18)/(1+0.18(0.85-1)</span>
<span id="cb337-1314"><a href="#cb337-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1315"><a href="#cb337-1315" aria-hidden="true" tabindex="-1"></a>Using R like a calculator, we get:</span>
<span id="cb337-1316"><a href="#cb337-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1319"><a href="#cb337-1319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1320"><a href="#cb337-1320" aria-hidden="true" tabindex="-1"></a>(<span class="fl">0.85</span><span class="sc">*</span><span class="fl">0.18</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+0.18</span><span class="sc">*</span>(<span class="fl">0.85</span><span class="dv">-1</span>))</span>
<span id="cb337-1321"><a href="#cb337-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1322"><a href="#cb337-1322" aria-hidden="true" tabindex="-1"></a>power11 <span class="ot">&lt;-</span><span class="fu">pwr.2p.test</span>(<span class="at">h=</span><span class="fu">ES.h</span>(<span class="at">p1=</span><span class="fl">0.18</span>, <span class="at">p2=</span><span class="fl">0.1572</span>), <span class="at">power=</span><span class="fl">0.9</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>)</span>
<span id="cb337-1323"><a href="#cb337-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1324"><a href="#cb337-1324" aria-hidden="true" tabindex="-1"></a>power11</span>
<span id="cb337-1325"><a href="#cb337-1325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1326"><a href="#cb337-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1327"><a href="#cb337-1327" aria-hidden="true" tabindex="-1"></a>**You need 5661 cases and 5661 controls, so about 11,322 participants in total, to obtain 90% power if your OR of tubal ligation with ovarian cancer is 0.85.**</span>
<span id="cb337-1328"><a href="#cb337-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1331"><a href="#cb337-1331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1332"><a href="#cb337-1332" aria-hidden="true" tabindex="-1"></a>power12 <span class="ot">&lt;-</span> <span class="fu">power.t.test</span>(<span class="at">delta =</span> <span class="fl">6.0</span> <span class="sc">-</span> <span class="fl">5.5</span>, <span class="at">sd =</span> <span class="dv">1</span>, <span class="at">power =</span> <span class="fl">0.9</span>, <span class="at">sig.level =</span> <span class="fl">0.05</span>, <span class="at">type =</span> <span class="st">"two.sample"</span>, <span class="at">alternative =</span> <span class="st">"two.sided"</span>) </span>
<span id="cb337-1333"><a href="#cb337-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1334"><a href="#cb337-1334" aria-hidden="true" tabindex="-1"></a>power12</span>
<span id="cb337-1335"><a href="#cb337-1335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1336"><a href="#cb337-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1337"><a href="#cb337-1337" aria-hidden="true" tabindex="-1"></a><span class="fu"># B1.1: Correlation and Scatterplots {#sec-B1.1}</span></span>
<span id="cb337-1338"><a href="#cb337-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1339"><a href="#cb337-1339" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1340"><a href="#cb337-1340" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1341"><a href="#cb337-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1342"><a href="#cb337-1342" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1343"><a href="#cb337-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1344"><a href="#cb337-1344" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Explore the data with correlations and scatterplots.**</span>
<span id="cb337-1345"><a href="#cb337-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1346"><a href="#cb337-1346" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use an ANOVA to test for a difference in means across a categorical variable.</span>
<span id="cb337-1347"><a href="#cb337-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1348"><a href="#cb337-1348" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Conduct univariable and multivariable linear regression</span>
<span id="cb337-1349"><a href="#cb337-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1350"><a href="#cb337-1350" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Check the regression diagnostics of a linear model.</span>
<span id="cb337-1351"><a href="#cb337-1351" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1352"><a href="#cb337-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1353"><a href="#cb337-1353" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B1.1 Correlation and Scatterplots</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgmDgs-JMcoXm3eiT?e=JK9ZN2)</span>{target="_blank"}</span>
<span id="cb337-1354"><a href="#cb337-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1355"><a href="#cb337-1355" aria-hidden="true" tabindex="-1"></a>In this section we will use correlations and scatter plots to examine the relationship between two continuous variables.</span>
<span id="cb337-1356"><a href="#cb337-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1357"><a href="#cb337-1357" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise</span></span>
<span id="cb337-1358"><a href="#cb337-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1359"><a href="#cb337-1359" aria-hidden="true" tabindex="-1"></a>Let us now assess if there is a relationship between BMI and SBP. A scatterplot is a quick way to have a first impression on how variables may relate to each other.There are several ways to create a scatterplot in R. The basic function is <span class="in">`plot()`</span>, used as plot(x,y) where x and y denote the (x,y) points to plot.</span>
<span id="cb337-1360"><a href="#cb337-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1363"><a href="#cb337-1363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1364"><a href="#cb337-1364" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(whitehall<span class="sc">$</span>bmi, whitehall<span class="sc">$</span>sbp, <span class="at">xlab=</span><span class="st">"BMI (kg/m2)"</span>,<span class="at">ylab=</span><span class="st">"Systolic blood pressure (mm Hg)"</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb337-1365"><a href="#cb337-1365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1366"><a href="#cb337-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1367"><a href="#cb337-1367" aria-hidden="true" tabindex="-1"></a>**If we look at the plot we can see some vertical lines as BMI was collected at discrete values and each vertical line represent individuals with the same BMI. Also there does not appear to be an obvious relationship between the two variables as the dots all appear in a big clump in the middle, without any direction to them.**</span>
<span id="cb337-1368"><a href="#cb337-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1369"><a href="#cb337-1369" aria-hidden="true" tabindex="-1"></a>**Correlations**</span>
<span id="cb337-1370"><a href="#cb337-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1371"><a href="#cb337-1371" aria-hidden="true" tabindex="-1"></a>We can also assess if there is any relationship between age and SBP by looking at their correlation. In R, you can use <span class="in">`cor()`</span> to obtain correlations. Also <span class="in">`cor.test()`</span> can be used if a test of association is needed.</span>
<span id="cb337-1372"><a href="#cb337-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1373"><a href="#cb337-1373" aria-hidden="true" tabindex="-1"></a>In the presence of missing values it is important to set the argument ‘use‘ to specify the method for computing correlations otherwise <span class="in">`cor()`</span> will not work. If ‘use‘ is set to <span class="in">`use=”complete.obs“`</span> then the correlation is computed after casewise deletion of missing values. If ‘use‘ is set to <span class="in">`use=”pairwise.complete.obs”`</span> then the correlation between each pair of variables is computed using all complete pairs of observations on those variables.</span>
<span id="cb337-1374"><a href="#cb337-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1375"><a href="#cb337-1375" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question B1.1b:</span></span>
<span id="cb337-1376"><a href="#cb337-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1377"><a href="#cb337-1377" aria-hidden="true" tabindex="-1"></a>**Interpret the correlation coefficient between SBP and BMI.**</span>
<span id="cb337-1378"><a href="#cb337-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1381"><a href="#cb337-1381" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1382"><a href="#cb337-1382" aria-hidden="true" tabindex="-1"></a>corrbp_bmi <span class="ot">&lt;-</span> <span class="fu">cor</span>(whitehall[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>], <span class="at">use=</span><span class="st">"complete.obs"</span>) </span>
<span id="cb337-1383"><a href="#cb337-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1384"><a href="#cb337-1384" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(corrbp_bmi, <span class="dv">2</span>)</span>
<span id="cb337-1385"><a href="#cb337-1385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1386"><a href="#cb337-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1387"><a href="#cb337-1387" aria-hidden="true" tabindex="-1"></a>**The correlation between SBP and BMI is 0.09 and it is a weak positive correlation.**</span>
<span id="cb337-1388"><a href="#cb337-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1389"><a href="#cb337-1389" aria-hidden="true" tabindex="-1"></a><span class="fu"># B1.2: Differences Between Means (ANOVA 1) {#sec-B1.2}</span></span>
<span id="cb337-1390"><a href="#cb337-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1391"><a href="#cb337-1391" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1392"><a href="#cb337-1392" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1393"><a href="#cb337-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1394"><a href="#cb337-1394" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1395"><a href="#cb337-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1396"><a href="#cb337-1396" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explore the data with correlations and scatterplots.</span>
<span id="cb337-1397"><a href="#cb337-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1398"><a href="#cb337-1398" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Use an ANOVA to test for a difference in means across a categorical variable.**</span>
<span id="cb337-1399"><a href="#cb337-1399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1400"><a href="#cb337-1400" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Conduct univariable and multivariable linear regression</span>
<span id="cb337-1401"><a href="#cb337-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1402"><a href="#cb337-1402" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Check the regression diagnostics of a linear model.</span>
<span id="cb337-1403"><a href="#cb337-1403" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1404"><a href="#cb337-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1405"><a href="#cb337-1405" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B1.2 Differences Between Means (ANOVA I)</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgmRgQCCQzpD8K_il?e=lfjuje)</span>{target="_blank"}</span>
<span id="cb337-1406"><a href="#cb337-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1407"><a href="#cb337-1407" aria-hidden="true" tabindex="-1"></a>The ANOVA procedure allows us to establish whether there is evidence that the mean SBP values across the BMI groups are not all equal. You use an ANOVA to test for differences in means across levels of a categorical variable (not a continuous one).</span>
<span id="cb337-1408"><a href="#cb337-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1409"><a href="#cb337-1409" aria-hidden="true" tabindex="-1"></a>We use <span class="in">`aov()`</span> to perform ANOVA, and we get a summary of the ANOVA table using <span class="in">`summary()`</span>. aov() can be used in two ways as follows:</span>
<span id="cb337-1410"><a href="#cb337-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1411"><a href="#cb337-1411" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-1412"><a href="#cb337-1412" aria-hidden="true" tabindex="-1"></a><span class="in">fit3 &lt;- aov(y ~ x, data=my.data)</span></span>
<span id="cb337-1413"><a href="#cb337-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1414"><a href="#cb337-1414" aria-hidden="true" tabindex="-1"></a><span class="in">fit3 &lt;- aov(my.data$y ~ my.data$x)</span></span>
<span id="cb337-1415"><a href="#cb337-1415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1416"><a href="#cb337-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1417"><a href="#cb337-1417" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question B1.2:</span></span>
<span id="cb337-1418"><a href="#cb337-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1419"><a href="#cb337-1419" aria-hidden="true" tabindex="-1"></a>We are going to use this to test for a significant difference in mean SBP across the BMI groups.</span>
<span id="cb337-1420"><a href="#cb337-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1423"><a href="#cb337-1423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1424"><a href="#cb337-1424" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_fact<span class="ot">&lt;-</span><span class="fu">factor</span>(whitehall<span class="sc">$</span>bmi_grp4)</span>
<span id="cb337-1425"><a href="#cb337-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1426"><a href="#cb337-1426" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">aov</span>(sbp<span class="sc">~</span>bmi_fact, <span class="at">data=</span>whitehall) </span>
<span id="cb337-1427"><a href="#cb337-1427" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span>
<span id="cb337-1428"><a href="#cb337-1428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1429"><a href="#cb337-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1430"><a href="#cb337-1430" aria-hidden="true" tabindex="-1"></a>**The result indicates there are differences in SBP across the four categories of BMI as the p-value of 0.0001 is highly significant.**</span>
<span id="cb337-1431"><a href="#cb337-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1432"><a href="#cb337-1432" aria-hidden="true" tabindex="-1"></a>**However, an ANOVA a global test and does not tell us which BMI groups are significantly different from each other. You will learn how to produce comparisons of all possible pairings of the BMI groups, as well as many other aspects of the ANOVA test in Module B2.**</span>
<span id="cb337-1433"><a href="#cb337-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1434"><a href="#cb337-1434" aria-hidden="true" tabindex="-1"></a><span class="fu"># B1.3: Univariable Linear Regression {#sec-B1.3}</span></span>
<span id="cb337-1435"><a href="#cb337-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1436"><a href="#cb337-1436" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1437"><a href="#cb337-1437" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1438"><a href="#cb337-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1439"><a href="#cb337-1439" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1440"><a href="#cb337-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1441"><a href="#cb337-1441" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explore the data with correlations and scatterplots.</span>
<span id="cb337-1442"><a href="#cb337-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1443"><a href="#cb337-1443" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use an ANOVA to test for a difference in means across a categorical variable.</span>
<span id="cb337-1444"><a href="#cb337-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1445"><a href="#cb337-1445" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Conduct univariable and multivariable linear regression.**</span>
<span id="cb337-1446"><a href="#cb337-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1447"><a href="#cb337-1447" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Check the regression diagnostics of a linear model.</span>
<span id="cb337-1448"><a href="#cb337-1448" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1449"><a href="#cb337-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1450"><a href="#cb337-1450" aria-hidden="true" tabindex="-1"></a><span class="fu">## B1.3a: Linear regression with continuous exposure {#sec-B1.3a}</span></span>
<span id="cb337-1451"><a href="#cb337-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1452"><a href="#cb337-1452" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B1.3a Univariable Linear Regression</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgl8msjztdiIBftCe?e=FozZzE)</span>{target="_blank"}</span>
<span id="cb337-1453"><a href="#cb337-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1454"><a href="#cb337-1454" aria-hidden="true" tabindex="-1"></a>In section @sec-B1.1 we examined the association between two continuous variables (SBP and BMI <span class="sc">\[</span>continuous<span class="sc">\]</span>) using scatterplots and correlations. We can also assess the relationship between two continuous variables by using linear regression. In comparison with the regression using a categorical exposure, if we have a continuous variable we interpret the beta coefficient as the “average increase in <span class="sc">\[</span>outcome<span class="sc">\]</span> for a 1 unit change in <span class="sc">\[</span>exposure<span class="sc">\]</span>’.</span>
<span id="cb337-1455"><a href="#cb337-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1456"><a href="#cb337-1456" aria-hidden="true" tabindex="-1"></a>We can fit a simple linear regression model to the data using the <span class="in">`lm()`</span> function as <span class="in">`lm(formula, data)`</span> and the fitted model can be saved to an object for further analysis. For example <span class="in">`my.fit &lt;- lm(Y ~ X, data = my.data)`</span> performs a linear regression of Y (response variable) versus X (explanatory variable) by taking them from the dataset my.data. The result is stored on an object called <span class="in">`my.fit`</span>.</span>
<span id="cb337-1457"><a href="#cb337-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1458"><a href="#cb337-1458" aria-hidden="true" tabindex="-1"></a>Other different functional forms for the relationship can be specified via <span class="in">`formula`</span>. The data argument is used to tell R where to look for the variables used in the formula.</span>
<span id="cb337-1459"><a href="#cb337-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1460"><a href="#cb337-1460" aria-hidden="true" tabindex="-1"></a>When the model is saved in an object we can use the <span class="in">`summary()`</span> function to extract information about the linear model (estimates of parameters, standard errors, residuals, etc). The function <span class="in">`confint()`</span> can be used to compute confidence intervals of the estimates in the fitted model.</span>
<span id="cb337-1461"><a href="#cb337-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1462"><a href="#cb337-1462" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question 1.3a</span></span>
<span id="cb337-1463"><a href="#cb337-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1464"><a href="#cb337-1464" aria-hidden="true" tabindex="-1"></a>Fit a linear model of SBP versus BMI (continuous) in the Whitehall data and interpret your findings.</span>
<span id="cb337-1465"><a href="#cb337-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1468"><a href="#cb337-1468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1469"><a href="#cb337-1469" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp <span class="sc">~</span> bmi, <span class="at">data=</span>whitehall)</span>
<span id="cb337-1470"><a href="#cb337-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1471"><a href="#cb337-1471" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1)</span>
<span id="cb337-1472"><a href="#cb337-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1473"><a href="#cb337-1473" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit1)</span>
<span id="cb337-1474"><a href="#cb337-1474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1475"><a href="#cb337-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1476"><a href="#cb337-1476" aria-hidden="true" tabindex="-1"></a>**For every 1 unit higher BMI, SBP on average increases 0.46 mmHg (95% CI: 0.30-0.62), and this association is statistically significant (p\&lt;0.001)**</span>
<span id="cb337-1477"><a href="#cb337-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1478"><a href="#cb337-1478" aria-hidden="true" tabindex="-1"></a><span class="fu">## B1.3b: Linear regression with categorical exposure {#sec-B1.3b}</span></span>
<span id="cb337-1479"><a href="#cb337-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1480"><a href="#cb337-1480" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B1.3 Univariable Linear Regression</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgmH0936YIHab0I-m?e=HOF3bz)</span>{target="_blank"}</span>
<span id="cb337-1481"><a href="#cb337-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1482"><a href="#cb337-1482" aria-hidden="true" tabindex="-1"></a>Instead of conducting multiple pairwise comparisons in an ANOVA, we could run a linear regression to compare the mean difference in each age group compared to a reference category.</span>
<span id="cb337-1483"><a href="#cb337-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1484"><a href="#cb337-1484" aria-hidden="true" tabindex="-1"></a>First, we need to reclassify our exposure, <span class="in">`bmi_grp4`</span> and tell R to treat our exposure as a categorical variable:</span>
<span id="cb337-1485"><a href="#cb337-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1488"><a href="#cb337-1488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1489"><a href="#cb337-1489" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb337-1490"><a href="#cb337-1490" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&lt;</span> <span class="fl">18.5</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb337-1491"><a href="#cb337-1491" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="fl">18.5</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>bmi <span class="sc">&lt;</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb337-1492"><a href="#cb337-1492" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> whitehall<span class="sc">$</span>bmi <span class="sc">&lt;</span> <span class="dv">30</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb337-1493"><a href="#cb337-1493" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp4[whitehall<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="dv">30</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb337-1494"><a href="#cb337-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1495"><a href="#cb337-1495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1496"><a href="#cb337-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1499"><a href="#cb337-1499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1500"><a href="#cb337-1500" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_fact <span class="ot">&lt;-</span> <span class="fu">factor</span>(whitehall<span class="sc">$</span>bmi_grp4)</span>
<span id="cb337-1501"><a href="#cb337-1501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1502"><a href="#cb337-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1503"><a href="#cb337-1503" aria-hidden="true" tabindex="-1"></a>We can use <span class="in">`is.factor()`</span> to check that the new created variable is indeed a factor variable.</span>
<span id="cb337-1504"><a href="#cb337-1504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1507"><a href="#cb337-1507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1508"><a href="#cb337-1508" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(whitehall<span class="sc">$</span>bmi_fact)</span>
<span id="cb337-1509"><a href="#cb337-1509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1510"><a href="#cb337-1510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1511"><a href="#cb337-1511" aria-hidden="true" tabindex="-1"></a>Then, we use <span class="in">`table()`</span> to count the number of participants in each BMI category.</span>
<span id="cb337-1512"><a href="#cb337-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1515"><a href="#cb337-1515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1516"><a href="#cb337-1516" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>bmi_fact)</span>
<span id="cb337-1517"><a href="#cb337-1517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1518"><a href="#cb337-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1519"><a href="#cb337-1519" aria-hidden="true" tabindex="-1"></a>We can use <span class="in">`aggregate()`</span> to compute summary statistics for SBP by BMI.</span>
<span id="cb337-1520"><a href="#cb337-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1523"><a href="#cb337-1523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1524"><a href="#cb337-1524" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(whitehall<span class="sc">$</span>sbp, <span class="fu">list</span>(whitehall<span class="sc">$</span>bmi_fact), <span class="at">FUN=</span>mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb337-1525"><a href="#cb337-1525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1526"><a href="#cb337-1526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1527"><a href="#cb337-1527" aria-hidden="true" tabindex="-1"></a>**The results indicate that there are mean SBP increases across the four categories of BMI.**</span>
<span id="cb337-1528"><a href="#cb337-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1529"><a href="#cb337-1529" aria-hidden="true" tabindex="-1"></a>Now we fit a linear regression model called <span class="in">`fit2`</span> with SBP as our response and BMI groups as our explanatory variable.</span>
<span id="cb337-1530"><a href="#cb337-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1533"><a href="#cb337-1533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1534"><a href="#cb337-1534" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp <span class="sc">~</span> bmi_fact, <span class="at">data=</span>whitehall)</span>
<span id="cb337-1535"><a href="#cb337-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1536"><a href="#cb337-1536" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span>
<span id="cb337-1537"><a href="#cb337-1537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1538"><a href="#cb337-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1539"><a href="#cb337-1539" aria-hidden="true" tabindex="-1"></a>If we want confidence intervals, we could then type:</span>
<span id="cb337-1540"><a href="#cb337-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1543"><a href="#cb337-1543" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1544"><a href="#cb337-1544" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit2, <span class="at">level=</span><span class="fl">0.95</span>)</span>
<span id="cb337-1545"><a href="#cb337-1545" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1546"><a href="#cb337-1546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1547"><a href="#cb337-1547" aria-hidden="true" tabindex="-1"></a>By default R will use the lowest category of <span class="in">`bmi_fact`</span> as the reference in a regression. But this category is the smallest and hence it is not a good reference category as all comparisons with it will have large confidence intervals. We can change the reference category using the ‘relevel’ function:</span>
<span id="cb337-1548"><a href="#cb337-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1551"><a href="#cb337-1551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1552"><a href="#cb337-1552" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> <span class="fu">within</span>(whitehall, bmi_fact <span class="ot">&lt;-</span> <span class="fu">relevel</span>(bmi_fact,<span class="at">ref=</span><span class="dv">2</span>))</span>
<span id="cb337-1553"><a href="#cb337-1553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1554"><a href="#cb337-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1555"><a href="#cb337-1555" aria-hidden="true" tabindex="-1"></a>Then we fit the same linear regression again:</span>
<span id="cb337-1556"><a href="#cb337-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1559"><a href="#cb337-1559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1560"><a href="#cb337-1560" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp <span class="sc">~</span> bmi_fact, <span class="at">data=</span>whitehall)</span>
<span id="cb337-1561"><a href="#cb337-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1562"><a href="#cb337-1562" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span>
<span id="cb337-1563"><a href="#cb337-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1564"><a href="#cb337-1564" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit2, <span class="at">level=</span><span class="fl">0.95</span>)</span>
<span id="cb337-1565"><a href="#cb337-1565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1566"><a href="#cb337-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1567"><a href="#cb337-1567" aria-hidden="true" tabindex="-1"></a>**Looking at the output above, the average level of SBP increases as BMI groups get higher. For a BMI group 4 (obese) compared to BMI group 2 (normal weight), the average SBP is 3.7 mmHg higher (95% CI: 1.7-5.6, p\&lt;0.001).**</span>
<span id="cb337-1568"><a href="#cb337-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1569"><a href="#cb337-1569" aria-hidden="true" tabindex="-1"></a><span class="fu"># BI.4: Multiple Linear Regression {#sec-B1.4}</span></span>
<span id="cb337-1570"><a href="#cb337-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1571"><a href="#cb337-1571" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1572"><a href="#cb337-1572" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1573"><a href="#cb337-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1574"><a href="#cb337-1574" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1575"><a href="#cb337-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1576"><a href="#cb337-1576" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explore the data with correlations and scatterplots.</span>
<span id="cb337-1577"><a href="#cb337-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1578"><a href="#cb337-1578" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use an ANOVA to test for a difference in means across a categorical variable.</span>
<span id="cb337-1579"><a href="#cb337-1579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1580"><a href="#cb337-1580" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Conduct univariable and multivariable linear regression.**</span>
<span id="cb337-1581"><a href="#cb337-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1582"><a href="#cb337-1582" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Check the regression diagnostics of a linear model.</span>
<span id="cb337-1583"><a href="#cb337-1583" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1584"><a href="#cb337-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1585"><a href="#cb337-1585" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B1.4a Multiple Linear Regression</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgmUlCsP5mP3nJGLX?e=5fjJVE)</span>{target="_blank"}</span>
<span id="cb337-1586"><a href="#cb337-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1587"><a href="#cb337-1587" aria-hidden="true" tabindex="-1"></a>How do we fit a model with more than one explanatory variable?</span>
<span id="cb337-1588"><a href="#cb337-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1589"><a href="#cb337-1589" aria-hidden="true" tabindex="-1"></a>Here, we will include each covariate one at a time into the model, starting with BMI, then adding <span class="in">`age_grp`</span> and lastly adding <span class="in">`currsmoker`</span>. We like to add variables one at time so that we can see how each new additional covariate affects the other variables already in the model- this gives us an idea as to the mechanisms underlying an association.</span>
<span id="cb337-1590"><a href="#cb337-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1591"><a href="#cb337-1591" aria-hidden="true" tabindex="-1"></a>To build a multivariable model, the command is the same as before:</span>
<span id="cb337-1592"><a href="#cb337-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1593"><a href="#cb337-1593" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-1594"><a href="#cb337-1594" aria-hidden="true" tabindex="-1"></a><span class="in">my.fit &lt;- lm(Y ~ X+ X2 + X3, data = my.data) </span></span>
<span id="cb337-1595"><a href="#cb337-1595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1596"><a href="#cb337-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1597"><a href="#cb337-1597" aria-hidden="true" tabindex="-1"></a>Therefore, to examine the impact the association of BMI group on SBP, adjusted for LDL-C, we write:</span>
<span id="cb337-1598"><a href="#cb337-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1601"><a href="#cb337-1601" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1602"><a href="#cb337-1602" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp <span class="sc">~</span> bmi_fact<span class="sc">+</span>ldlc, <span class="at">data=</span>whitehall)</span>
<span id="cb337-1603"><a href="#cb337-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1604"><a href="#cb337-1604" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span>
<span id="cb337-1605"><a href="#cb337-1605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1606"><a href="#cb337-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1607"><a href="#cb337-1607" aria-hidden="true" tabindex="-1"></a>**Being overweight (BMI group 3) compared with normal weight (group 2) is associated with a 1.91 mmHg higher SBP on average, once adjusted for LDL-C (95% CI: 0.80-3.02, p=0.001). This is a slightly stronger association for the overweight BMI group than before we adjusted for LDL-C.**</span>
<span id="cb337-1608"><a href="#cb337-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1609"><a href="#cb337-1609" aria-hidden="true" tabindex="-1"></a>**Note that each covariate in the model is adjusted for all other covariates in the model. So BMI group is adjusted for LDL-C, and LDL-C is adjusted for BMI group. In other words, we can see the association of BMI group independent of LDL-C, and vice versa.**</span>
<span id="cb337-1610"><a href="#cb337-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1611"><a href="#cb337-1611" aria-hidden="true" tabindex="-1"></a><span class="fu">## Question B1.4a:</span></span>
<span id="cb337-1612"><a href="#cb337-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1613"><a href="#cb337-1613" aria-hidden="true" tabindex="-1"></a>What is the association of BMI group with SBP, once adjusted for LDL-C and current smoking?</span>
<span id="cb337-1614"><a href="#cb337-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1617"><a href="#cb337-1617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1618"><a href="#cb337-1618" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sbp <span class="sc">~</span> bmi_fact<span class="sc">+</span>ldlc<span class="sc">+</span>currsmoker, <span class="at">data=</span>whitehall)</span>
<span id="cb337-1619"><a href="#cb337-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1620"><a href="#cb337-1620" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit4)</span>
<span id="cb337-1621"><a href="#cb337-1621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1622"><a href="#cb337-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1623"><a href="#cb337-1623" aria-hidden="true" tabindex="-1"></a>**On average, being obese is associated with a 3.7 mmHg higher SBP than being normal weight, once adjusted for LDL-C and current smoking (95% CI 1.74-5.63, p\&lt;0.001). This association was not affected by additional adjustment for current smoking.**</span>
<span id="cb337-1624"><a href="#cb337-1624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1625"><a href="#cb337-1625" aria-hidden="true" tabindex="-1"></a>**Each covariate in the model can be interpreted as adjusted for the other covariates in the model. So being a current smoker is associated with a -0.56 mmHg lower SBP compared to non-smokers, once adjusted for LDL-C and BMI group. The 95% CI crosses the null value (which is 0 in this case, as we are not working with ratios; -2.15-1.02) so this association is not statistically significant.**</span>
<span id="cb337-1626"><a href="#cb337-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1627"><a href="#cb337-1627" aria-hidden="true" tabindex="-1"></a><span class="fu">## Working example 1</span></span>
<span id="cb337-1628"><a href="#cb337-1628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1629"><a href="#cb337-1629" aria-hidden="true" tabindex="-1"></a>In the following, we want to investigate the association between body mass index (*kg/m\^2*) and vitamin D (nmol/L) adjusting for HDL cholesterol (mmol/L) in the Whitehall data.</span>
<span id="cb337-1630"><a href="#cb337-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1631"><a href="#cb337-1631" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fit a linear regression model with vitamin D as the dependent variable and BMI as the independent variable.</span>
<span id="cb337-1632"><a href="#cb337-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1633"><a href="#cb337-1633" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fit a linear regression model with vitamin D as the dependent variable and BMI as the independent variable adjusting for HDL cholesterol.</span>
<span id="cb337-1634"><a href="#cb337-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1635"><a href="#cb337-1635" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Compare the coefficient of BMI in the two models.</span>
<span id="cb337-1636"><a href="#cb337-1636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1639"><a href="#cb337-1639" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1640"><a href="#cb337-1640" aria-hidden="true" tabindex="-1"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vitd<span class="sc">~</span>bmi, <span class="at">data=</span>whitehall)</span>
<span id="cb337-1641"><a href="#cb337-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1642"><a href="#cb337-1642" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit5)</span>
<span id="cb337-1643"><a href="#cb337-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1644"><a href="#cb337-1644" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit5, <span class="at">level=</span><span class="fl">0.95</span>)</span>
<span id="cb337-1645"><a href="#cb337-1645" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1646"><a href="#cb337-1646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1649"><a href="#cb337-1649" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1650"><a href="#cb337-1650" aria-hidden="true" tabindex="-1"></a>fit6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vitd<span class="sc">~</span>bmi <span class="sc">+</span> hdlc, <span class="at">data=</span>whitehall)</span>
<span id="cb337-1651"><a href="#cb337-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1652"><a href="#cb337-1652" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit6)</span>
<span id="cb337-1653"><a href="#cb337-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1654"><a href="#cb337-1654" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit6, <span class="at">level=</span><span class="fl">0.95</span>)</span>
<span id="cb337-1655"><a href="#cb337-1655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1656"><a href="#cb337-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1657"><a href="#cb337-1657" aria-hidden="true" tabindex="-1"></a>**The association between vitamnin D and BMI was substantially attenuated after adjusting for HDL cholesterol**</span>
<span id="cb337-1658"><a href="#cb337-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1659"><a href="#cb337-1659" aria-hidden="true" tabindex="-1"></a><span class="fu"># B1.5: Model Selection and F-Tests {#sec-B1.5}</span></span>
<span id="cb337-1660"><a href="#cb337-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1661"><a href="#cb337-1661" aria-hidden="true" tabindex="-1"></a>Here we are going to practice using F-tests to help choose the best fitting model for our data.</span>
<span id="cb337-1662"><a href="#cb337-1662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1663"><a href="#cb337-1663" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B1.5 Testing Regression Coefficients</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgmZJg_qKNBqYAvpr?e=9pstRW)</span>{target="_blank"}</span>
<span id="cb337-1664"><a href="#cb337-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1665"><a href="#cb337-1665" aria-hidden="true" tabindex="-1"></a>**When estimating the effect of a particular exposure, we have seen that it is important to include potential confounding variables in the regression model, and that failure to do so will lead to a biased estimate of the effect.**</span>
<span id="cb337-1666"><a href="#cb337-1666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1667"><a href="#cb337-1667" aria-hidden="true" tabindex="-1"></a>To assess if we have included important confounders in our model, we can run a statistical test to see if the extra coefficients are significantly contributing to the model fit. This is helpful for testing the overall inclusion of a categorical variable to a model (where some levels may have a significant association and other levels may not), or testing the addition of multiple variables to the model.</span>
<span id="cb337-1668"><a href="#cb337-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1669"><a href="#cb337-1669" aria-hidden="true" tabindex="-1"></a>We can do this in R using the ‘linearHypothesis’ function within the package ‘car’</span>
<span id="cb337-1670"><a href="#cb337-1670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1673"><a href="#cb337-1673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1674"><a href="#cb337-1674" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb337-1675"><a href="#cb337-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1676"><a href="#cb337-1676" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(fit4, <span class="fu">c</span>(<span class="st">"bmi_fact1=0"</span>, <span class="st">"bmi_fact3=0"</span>, <span class="st">"bmi_fact4=0"</span>))</span>
<span id="cb337-1677"><a href="#cb337-1677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1678"><a href="#cb337-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1679"><a href="#cb337-1679" aria-hidden="true" tabindex="-1"></a>**The output reveals that the F-statistic for this joint hypothesis test (that all coefficients of the BMI variable are equal to 0) is about 7.7 and the corresponding p-value is \&lt;0.001.**</span>
<span id="cb337-1680"><a href="#cb337-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1681"><a href="#cb337-1681" aria-hidden="true" tabindex="-1"></a>**Whilst the main regression output shows that not all levels of BMI group are significantly associated SBP, the F-test shows that overall this variable is significantly explaining variance in the model (F\[3,4265\]=7.74, p\&lt;0.001).**</span>
<span id="cb337-1682"><a href="#cb337-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1683"><a href="#cb337-1683" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question B1.5:</span></span>
<span id="cb337-1684"><a href="#cb337-1684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1685"><a href="#cb337-1685" aria-hidden="true" tabindex="-1"></a>**Run an F-test to assess if both LDL-C and current smoking are jointly contributing to model fit (i.e. test both these coefficients at the same time).**</span>
<span id="cb337-1686"><a href="#cb337-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1689"><a href="#cb337-1689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1690"><a href="#cb337-1690" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(fit4, <span class="fu">c</span>(<span class="st">"ldlc=0"</span>, <span class="st">"currsmoker=0"</span>))</span>
<span id="cb337-1691"><a href="#cb337-1691" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1692"><a href="#cb337-1692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1693"><a href="#cb337-1693" aria-hidden="true" tabindex="-1"></a>**You can see from the output that the null hypothesis is that both variables have a coefficient equal to 0. However, there is evidence to reject this null hypothesis (F\[2,4265\]=4.92, p\&lt;0.01). These variables are significantly contributing to model fit.**</span>
<span id="cb337-1694"><a href="#cb337-1694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1695"><a href="#cb337-1695" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B1.5b Presentation of Regression Results</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgmg4mzwoUX9L9W6y?e=Rz8lxV)</span>{target="\"_blank"}</span>
<span id="cb337-1696"><a href="#cb337-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1697"><a href="#cb337-1697" aria-hidden="true" tabindex="-1"></a><span class="fu"># B1.6: Regression Diagnostics {#sec-B1.6}</span></span>
<span id="cb337-1698"><a href="#cb337-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1699"><a href="#cb337-1699" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1700"><a href="#cb337-1700" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1701"><a href="#cb337-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1702"><a href="#cb337-1702" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1703"><a href="#cb337-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1704"><a href="#cb337-1704" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explore the data with correlations and scatterplots.</span>
<span id="cb337-1705"><a href="#cb337-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1706"><a href="#cb337-1706" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use an ANOVA to test for a difference in means across a categorical variable.</span>
<span id="cb337-1707"><a href="#cb337-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1708"><a href="#cb337-1708" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Conduct univariable and multivariable linear regression.</span>
<span id="cb337-1709"><a href="#cb337-1709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1710"><a href="#cb337-1710" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Check the regression diagnostics of a linear model.**</span>
<span id="cb337-1711"><a href="#cb337-1711" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1712"><a href="#cb337-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1713"><a href="#cb337-1713" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B1.6 Regression Diagnostics</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgmmf9sjBWND4KLIF?e=5p0xqb)</span>{target="_blank"}</span>
<span id="cb337-1714"><a href="#cb337-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1715"><a href="#cb337-1715" aria-hidden="true" tabindex="-1"></a>One of the final steps of any linear regression is to check that the model assumptions are met. Satisfying these assumptions allows you to perform statistical hypothesis testing and generate reliable confidence intervals.</span>
<span id="cb337-1716"><a href="#cb337-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1717"><a href="#cb337-1717" aria-hidden="true" tabindex="-1"></a>Here we are going to practice checking the normality and homoscedasticity of the residuals.</span>
<span id="cb337-1718"><a href="#cb337-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1719"><a href="#cb337-1719" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking Normality of Residuals</span></span>
<span id="cb337-1720"><a href="#cb337-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1721"><a href="#cb337-1721" aria-hidden="true" tabindex="-1"></a>We need to make sure that our residuals are normally distributed with a mean of 0. This assumption may be checked by looking at a histogram or a Q-Q-Plot.</span>
<span id="cb337-1722"><a href="#cb337-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1723"><a href="#cb337-1723" aria-hidden="true" tabindex="-1"></a>To look at our residuals, we can use the function <span class="in">`resid()`</span>. This function extracts the model residuals from the fitted model object (for example, in our case we would type <span class="in">`resid(fit1))`</span>.</span>
<span id="cb337-1724"><a href="#cb337-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1725"><a href="#cb337-1725" aria-hidden="true" tabindex="-1"></a>To check our residuals from the model we fit in B1.4 we would type:</span>
<span id="cb337-1726"><a href="#cb337-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1729"><a href="#cb337-1729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1730"><a href="#cb337-1730" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(fit4), <span class="at">main=</span><span class="st">"Histogram of the residuals"</span>, <span class="at">xlab=</span><span class="st">"Residuals"</span>)</span>
<span id="cb337-1731"><a href="#cb337-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1732"><a href="#cb337-1732" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">resid</span>(fit4))</span>
<span id="cb337-1733"><a href="#cb337-1733" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1734"><a href="#cb337-1734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1735"><a href="#cb337-1735" aria-hidden="true" tabindex="-1"></a>**It appears that our residuals are normally distributed with zero mean.**</span>
<span id="cb337-1736"><a href="#cb337-1736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1737"><a href="#cb337-1737" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking Homoscedasticity</span></span>
<span id="cb337-1738"><a href="#cb337-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1739"><a href="#cb337-1739" aria-hidden="true" tabindex="-1"></a>One of main assumptions of ordinary least squares linear regression is that there is homogeneity of variance (i.e. homoscedasticity) of the residuals. If the variance of our residuals is heteroscedastic then this indicates model misspecification, similar to the reasons discussed before.</span>
<span id="cb337-1740"><a href="#cb337-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1741"><a href="#cb337-1741" aria-hidden="true" tabindex="-1"></a>To check homogeneity in variance this we plot the values of the residuals against the fitted (predicted) values from the regression model. If the assumptions is satisfied we should see a random scatter of the points with no pattern. If we see a pattern, i.e. the scatterplot gets wider or narrower at a certain range of values, then this indicates heteroscedasticity and we need to re-evaluate our model. To plot the residuals versus the fitted values, we can use <span class="in">`plot(resid(fit5) ~ fitted(fit5), …)`</span>.</span>
<span id="cb337-1742"><a href="#cb337-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1745"><a href="#cb337-1745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1746"><a href="#cb337-1746" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(fit4) <span class="sc">~</span> <span class="fu">fitted</span>(fit4), </span>
<span id="cb337-1747"><a href="#cb337-1747" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"The residuals versus the fitted values"</span>, </span>
<span id="cb337-1748"><a href="#cb337-1748" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, </span>
<span id="cb337-1749"><a href="#cb337-1749" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>, </span>
<span id="cb337-1750"><a href="#cb337-1750" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb337-1751"><a href="#cb337-1751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1752"><a href="#cb337-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1753"><a href="#cb337-1753" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb337-1754"><a href="#cb337-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1755"><a href="#cb337-1755" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1756"><a href="#cb337-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1757"><a href="#cb337-1757" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question B1.6:</span></span>
<span id="cb337-1758"><a href="#cb337-1758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1759"><a href="#cb337-1759" aria-hidden="true" tabindex="-1"></a>Examine your residuals from the multivariable regression in B1.4. Does this model appear to violate the assumptions of homoscedasticity?</span>
<span id="cb337-1760"><a href="#cb337-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1761"><a href="#cb337-1761" aria-hidden="true" tabindex="-1"></a>**There appears to be a random ball of dots, with no pattern. This is what we want. There does not appear to be heteroscedasticity.**</span>
<span id="cb337-1762"><a href="#cb337-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1763"><a href="#cb337-1763" aria-hidden="true" tabindex="-1"></a><span class="fu"># B2.1: ANOVA Revisited- Post-Hoc Testing {#sec-B2.1}</span></span>
<span id="cb337-1764"><a href="#cb337-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1765"><a href="#cb337-1765" aria-hidden="true" tabindex="-1"></a>In the last module we looked at linear regression to analyse the effect of different explanatory variables on the SBP of the participants.</span>
<span id="cb337-1766"><a href="#cb337-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1767"><a href="#cb337-1767" aria-hidden="true" tabindex="-1"></a>We are going to revisit this here and look at it through the lens of the ANOVA.</span>
<span id="cb337-1768"><a href="#cb337-1768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1769"><a href="#cb337-1769" aria-hidden="true" tabindex="-1"></a>Let’s look at the association of mean SBP across BMI groups again. But now we want to use the ANOVA post-estimation options to compute multiple comparisons with Fisher’s least-significant difference (LSD) test, which does not adjust the confidence intervals or p-values.</span>
<span id="cb337-1770"><a href="#cb337-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1771"><a href="#cb337-1771" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb337-1772"><a href="#cb337-1772" aria-hidden="true" tabindex="-1"></a>The advantage of this method is that all of the comparisons are shown in one table, so you can inspect any pairing you wish.</span>
<span id="cb337-1773"><a href="#cb337-1773" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1774"><a href="#cb337-1774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1775"><a href="#cb337-1775" aria-hidden="true" tabindex="-1"></a>We can use the <span class="in">`LSD.test()`</span> function of the <span class="in">`agricolae`</span> package to perform this test in R.</span>
<span id="cb337-1776"><a href="#cb337-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1779"><a href="#cb337-1779" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1780"><a href="#cb337-1780" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(sbp<span class="sc">~</span>bmi_fact, <span class="at">data=</span>whitehall)</span>
<span id="cb337-1781"><a href="#cb337-1781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1782"><a href="#cb337-1782" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span>
<span id="cb337-1783"><a href="#cb337-1783" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1784"><a href="#cb337-1784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1787"><a href="#cb337-1787" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1788"><a href="#cb337-1788" aria-hidden="true" tabindex="-1"></a><span class="co"># perform Fisher’s LSD</span></span>
<span id="cb337-1789"><a href="#cb337-1789" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agricolae)</span>
<span id="cb337-1790"><a href="#cb337-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1791"><a href="#cb337-1791" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">LSD.test</span>(model1, <span class="st">"bmi_fact"</span>)) </span>
<span id="cb337-1792"><a href="#cb337-1792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1793"><a href="#cb337-1793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1794"><a href="#cb337-1794" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb337-1795"><a href="#cb337-1795" aria-hidden="true" tabindex="-1"></a>To interpret this output we look at the section headed '\$groups'. The groups that have different characters listed beside them (i.e. 'a' or 'b') are significantly different.</span>
<span id="cb337-1796"><a href="#cb337-1796" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1797"><a href="#cb337-1797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1798"><a href="#cb337-1798" aria-hidden="true" tabindex="-1"></a><span class="fu">## Question B2.1:</span></span>
<span id="cb337-1799"><a href="#cb337-1799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1800"><a href="#cb337-1800" aria-hidden="true" tabindex="-1"></a>Review your output. What do you notice? What can you conclude about the data from these tests? Compare this to your output from the linear regression on the same data.</span>
<span id="cb337-1801"><a href="#cb337-1801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1802"><a href="#cb337-1802" aria-hidden="true" tabindex="-1"></a>In this output, we can see that :</span>
<span id="cb337-1803"><a href="#cb337-1803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1804"><a href="#cb337-1804" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Group 4 and group 2 have significantly different mean SBP, since group 4 has a value of 'a' and group 2 has a value of 'b'.</span>
<span id="cb337-1805"><a href="#cb337-1805" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Group 4 and group 1 have significantly different mean SBP, since group 4 has a value of ‘a’ and group 1 has a value of 'b'.</span>
<span id="cb337-1806"><a href="#cb337-1806" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Group 4 and group 3 do NOT have significant different mean SBP, since they both have a value of 'a'.</span>
<span id="cb337-1807"><a href="#cb337-1807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1808"><a href="#cb337-1808" aria-hidden="true" tabindex="-1"></a><span class="fu"># B2.2a: Correcting For Multiple Comparisons {#sec-B2.2a}</span></span>
<span id="cb337-1809"><a href="#cb337-1809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1810"><a href="#cb337-1810" aria-hidden="true" tabindex="-1"></a><span class="fu">## False Discovery Rate</span></span>
<span id="cb337-1811"><a href="#cb337-1811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1812"><a href="#cb337-1812" aria-hidden="true" tabindex="-1"></a>To use this method, we must first assign a value for q. Whereas α is the proportion of false positive tests we are willing to accept across the whole sample typically 0.05 (5%), q is the proportion of false positives (false ‘discoveries’) that we are willing to accept within the significant results. In this example we will set q to 0.05 (5%) as well.</span>
<span id="cb337-1813"><a href="#cb337-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1814"><a href="#cb337-1814" aria-hidden="true" tabindex="-1"></a>Here we are going to apply the Benjamini-Hochberg (BH) method to the data from the Fishers LSD test in the previous practical in @sec-B2.1</span>
<span id="cb337-1815"><a href="#cb337-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1816"><a href="#cb337-1816" aria-hidden="true" tabindex="-1"></a>Firstly, take the P values for each comparison of pairs and put them in ascending numerical order. Then assign a rank number in that order (smallest P value is rank 1, next smallest rank 2 and so on).</span>
<span id="cb337-1817"><a href="#cb337-1817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1818"><a href="#cb337-1818" aria-hidden="true" tabindex="-1"></a>| Group A     | Group B    | P       | Rank |</span>
<span id="cb337-1819"><a href="#cb337-1819" aria-hidden="true" tabindex="-1"></a>|-------------|------------|---------|------|</span>
<span id="cb337-1820"><a href="#cb337-1820" aria-hidden="true" tabindex="-1"></a>| Normal      | Obese      | <span class="sc">\&lt;</span>0.001 | 1    |</span>
<span id="cb337-1821"><a href="#cb337-1821" aria-hidden="true" tabindex="-1"></a>| Normal      | Overweight | 0.001   | 2    |</span>
<span id="cb337-1822"><a href="#cb337-1822" aria-hidden="true" tabindex="-1"></a>| Underweight | Obese      | 0.013   | 3    |</span>
<span id="cb337-1823"><a href="#cb337-1823" aria-hidden="true" tabindex="-1"></a>| Overweight  | Obese      | 0.056   | 4    |</span>
<span id="cb337-1824"><a href="#cb337-1824" aria-hidden="true" tabindex="-1"></a>| Underweight | Overweight | 0.060   | 5    |</span>
<span id="cb337-1825"><a href="#cb337-1825" aria-hidden="true" tabindex="-1"></a>| Underweight | Normal     | 0.246   | 6    |</span>
<span id="cb337-1826"><a href="#cb337-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1827"><a href="#cb337-1827" aria-hidden="true" tabindex="-1"></a>Calculate the BH critical value for each P value, using the formula q(i/m), where:</span>
<span id="cb337-1828"><a href="#cb337-1828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1829"><a href="#cb337-1829" aria-hidden="true" tabindex="-1"></a>i = the individual p-value’s rank,</span>
<span id="cb337-1830"><a href="#cb337-1830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1831"><a href="#cb337-1831" aria-hidden="true" tabindex="-1"></a>m = total number of tests,</span>
<span id="cb337-1832"><a href="#cb337-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1833"><a href="#cb337-1833" aria-hidden="true" tabindex="-1"></a>q= the false discovery rate you have selected (0.05)</span>
<span id="cb337-1834"><a href="#cb337-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1835"><a href="#cb337-1835" aria-hidden="true" tabindex="-1"></a>| Group A     | Group B    | P       | Rank | BHcrit | Significant |</span>
<span id="cb337-1836"><a href="#cb337-1836" aria-hidden="true" tabindex="-1"></a>|-------------|------------|---------|------|--------|-------------|</span>
<span id="cb337-1837"><a href="#cb337-1837" aria-hidden="true" tabindex="-1"></a>| Normal      | Obese      | <span class="sc">\&lt;</span>0.001 | 1    | 0.008  | Yes         |</span>
<span id="cb337-1838"><a href="#cb337-1838" aria-hidden="true" tabindex="-1"></a>| Normal      | Overweight | 0.001   | 2    | 0.016  | Yes         |</span>
<span id="cb337-1839"><a href="#cb337-1839" aria-hidden="true" tabindex="-1"></a>| Underweight | Obese      | 0.013   | 3    | 0.025  | Yes         |</span>
<span id="cb337-1840"><a href="#cb337-1840" aria-hidden="true" tabindex="-1"></a>| Overweight  | Obese      | 0.056   | 4    | 0.033  | No          |</span>
<span id="cb337-1841"><a href="#cb337-1841" aria-hidden="true" tabindex="-1"></a>| Underweight | Overweight | 0.060   | 5    | 0.042  | No          |</span>
<span id="cb337-1842"><a href="#cb337-1842" aria-hidden="true" tabindex="-1"></a>| Underweight | Normal     | 0.246   | 6    | 0.050  | No          |</span>
<span id="cb337-1843"><a href="#cb337-1843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1844"><a href="#cb337-1844" aria-hidden="true" tabindex="-1"></a>P values which are lower than our BH critical values are considered true ‘discoveries’. The first P value which is higher than the BH critical value and all significant P values below that (below in terms of the table, higher rank numbers) would be considered false ‘discoveries’. P values of ≥0.05 are not treated any differently to normal.</span>
<span id="cb337-1845"><a href="#cb337-1845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1846"><a href="#cb337-1846" aria-hidden="true" tabindex="-1"></a>From this we can conclude that all three of our statistically significant differences from out pairwise comparisons are in true ‘discoveries’, and none of them should be discounted.</span>
<span id="cb337-1847"><a href="#cb337-1847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1848"><a href="#cb337-1848" aria-hidden="true" tabindex="-1"></a>With small numbers of comparisons like this it is easy to use this method by hand, however where the FDR approach is most useful is when we are making very large numbers (hundreds) of comparisons.</span>
<span id="cb337-1849"><a href="#cb337-1849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1850"><a href="#cb337-1850" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-1851"><a href="#cb337-1851" aria-hidden="true" tabindex="-1"></a><span class="in">BH(u, alpha = 0.05)</span></span>
<span id="cb337-1852"><a href="#cb337-1852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1853"><a href="#cb337-1853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1854"><a href="#cb337-1854" aria-hidden="true" tabindex="-1"></a>where u is a vector containing all of the P values, and alpha is in fact your specified value for q</span>
<span id="cb337-1855"><a href="#cb337-1855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1856"><a href="#cb337-1856" aria-hidden="true" tabindex="-1"></a>There are also online FDR calculator you can use like this one <span class="co">[</span><span class="ot">https://tools.carbocation.com/FDR</span><span class="co">](https://tools.carbocation.com/FDR)</span>{target="_blank"}</span>
<span id="cb337-1857"><a href="#cb337-1857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1858"><a href="#cb337-1858" aria-hidden="true" tabindex="-1"></a>In Practical @sec-B2.1, we ran the Fisher’s LSD test to compare systolic blood pressure (SBP) between each possible pairing of groups in the BMI group categorical variable. Now we know a little be more about post hoc tests and correcting for multiple comparisons, we are going to go back and conduct the Bonferroni post hoc and Tukey’s HSD post hoc on the same data.</span>
<span id="cb337-1859"><a href="#cb337-1859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1860"><a href="#cb337-1860" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Tukey’s test in R</span><span class="co">]</span>{.underline}</span>
<span id="cb337-1861"><a href="#cb337-1861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1862"><a href="#cb337-1862" aria-hidden="true" tabindex="-1"></a>The function is ‘TukeyHSD’ (which comes loaded in R already so you do not need to install any packages). You run this function after you fit the ANOVA as you did in @sec-B2.1 :</span>
<span id="cb337-1863"><a href="#cb337-1863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1866"><a href="#cb337-1866" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1867"><a href="#cb337-1867" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(model1, <span class="at">conf.level =</span> .<span class="dv">95</span>)</span>
<span id="cb337-1868"><a href="#cb337-1868" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1869"><a href="#cb337-1869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1870"><a href="#cb337-1870" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Bonferroni test in R**</span><span class="co">]</span>{.underline}</span>
<span id="cb337-1871"><a href="#cb337-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1872"><a href="#cb337-1872" aria-hidden="true" tabindex="-1"></a>To perform a Bonferroni correction, you run the post estimation function <span class="in">`pairwise.t.test(x, g, p.adjust.method =’bonferroni’)`</span>. Here ‘x’ is your response variable, ‘g’ is the grouping variable, and for p.adjust.method you specify ‘bonferroni’.</span>
<span id="cb337-1873"><a href="#cb337-1873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1876"><a href="#cb337-1876" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1877"><a href="#cb337-1877" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(whitehall<span class="sc">$</span>sbp, whitehall<span class="sc">$</span>bmi_grp4, <span class="at">p.adjust.method =</span><span class="st">'bonferroni'</span>) </span>
<span id="cb337-1878"><a href="#cb337-1878" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1879"><a href="#cb337-1879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1880"><a href="#cb337-1880" aria-hidden="true" tabindex="-1"></a>**Consider the different post hoc tests and the results for each comparison in them. Is one method producing higher or lower p values than the others? Do any previously significant findings become non-significant after correction for multiple comparisons?**</span>
<span id="cb337-1881"><a href="#cb337-1881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1882"><a href="#cb337-1882" aria-hidden="true" tabindex="-1"></a>The table below shows the outcome for each of the possible pairs, for each of the three different post hoc tests. These have been ordered from smallest to largest p value for ease of comparison.</span>
<span id="cb337-1883"><a href="#cb337-1883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1884"><a href="#cb337-1884" aria-hidden="true" tabindex="-1"></a>| Group A     | Group B    | P value          | P value         | P value        |</span>
<span id="cb337-1885"><a href="#cb337-1885" aria-hidden="true" tabindex="-1"></a>|-------------|------------|------------------|-----------------|----------------|</span>
<span id="cb337-1886"><a href="#cb337-1886" aria-hidden="true" tabindex="-1"></a>|             |            | **Fisher’s LSD** | **Tukey’s HSD** | **Bonferroni** |</span>
<span id="cb337-1887"><a href="#cb337-1887" aria-hidden="true" tabindex="-1"></a>| Normal      | Obese      | <span class="sc">\&lt;</span>0.001<span class="sc">\*</span>        | 0.001<span class="sc">\*</span>         | 0.001<span class="sc">\*</span>        |</span>
<span id="cb337-1888"><a href="#cb337-1888" aria-hidden="true" tabindex="-1"></a>| Normal      | Overweight | 0.001<span class="sc">\*</span>          | 0.008<span class="sc">\*</span>         | 0.009<span class="sc">\*</span>        |</span>
<span id="cb337-1889"><a href="#cb337-1889" aria-hidden="true" tabindex="-1"></a>| Underweight | Obese      | 0.013<span class="sc">\*</span>          | 0.060           | 0.075          |</span>
<span id="cb337-1890"><a href="#cb337-1890" aria-hidden="true" tabindex="-1"></a>| Overweight  | Obese      | 0.056            | 0.224           | 0.337          |</span>
<span id="cb337-1891"><a href="#cb337-1891" aria-hidden="true" tabindex="-1"></a>| Underweight | Overweight | 0.060            | 0.237           | 0.361          |</span>
<span id="cb337-1892"><a href="#cb337-1892" aria-hidden="true" tabindex="-1"></a>| Underweight | Normal     | 0.246            | 0.652           | 1.000          |</span>
<span id="cb337-1893"><a href="#cb337-1893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1894"><a href="#cb337-1894" aria-hidden="true" tabindex="-1"></a><span class="sc">\*</span>= P<span class="sc">\&lt;</span>0.05- Reject H0</span>
<span id="cb337-1895"><a href="#cb337-1895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1896"><a href="#cb337-1896" aria-hidden="true" tabindex="-1"></a>**You should notice that the p-vales are lowest for each comparison on the LSD test, and highest in the Bonferroni. Once we apply a correction for multiple comparisons in this way the significant difference in SBP between underweight and obese groups disappears and we fail to reject the null hypothesis for this pairing.**</span>
<span id="cb337-1897"><a href="#cb337-1897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1898"><a href="#cb337-1898" aria-hidden="true" tabindex="-1"></a><span class="fu"># B2.3 Two-way ANOVA {#sec-B2.3}</span></span>
<span id="cb337-1899"><a href="#cb337-1899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1900"><a href="#cb337-1900" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1901"><a href="#cb337-1901" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1902"><a href="#cb337-1902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1903"><a href="#cb337-1903" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1904"><a href="#cb337-1904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1905"><a href="#cb337-1905" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain when and how to use post hoc testing</span>
<span id="cb337-1906"><a href="#cb337-1906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1907"><a href="#cb337-1907" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the concept of multiple comparisons and be able to correct for it in their analysis</span>
<span id="cb337-1908"><a href="#cb337-1908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1909"><a href="#cb337-1909" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Apply extensions to the basic ANOVA test and interpret their results**</span>
<span id="cb337-1910"><a href="#cb337-1910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1911"><a href="#cb337-1911" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain when and how to use repeated measures statistics</span>
<span id="cb337-1912"><a href="#cb337-1912" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1913"><a href="#cb337-1913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1914"><a href="#cb337-1914" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B2.3 Two-way ANOVA</span><span class="co">](https://1drv.ms/b/s!AtvH6PgKXPEDgz3HJp8wKSQNWAY1?e=eanHFp)</span>{target="_blank"}</span>
<span id="cb337-1915"><a href="#cb337-1915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1916"><a href="#cb337-1916" aria-hidden="true" tabindex="-1"></a>We can also use the ANOVA to further investigate the effect of different categorical explanatory variables on one dependent variable.</span>
<span id="cb337-1917"><a href="#cb337-1917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1918"><a href="#cb337-1918" aria-hidden="true" tabindex="-1"></a>To demonstrate this, we are going to use a two-way ANOVA to examine multiple explanatory variables and interactions between them.</span>
<span id="cb337-1919"><a href="#cb337-1919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1920"><a href="#cb337-1920" aria-hidden="true" tabindex="-1"></a>To continue our example, we want to examine if there are significant differences in the mean SBP between BMI groups that also smoke (or not).</span>
<span id="cb337-1921"><a href="#cb337-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1922"><a href="#cb337-1922" aria-hidden="true" tabindex="-1"></a>For a two-way ANOVA the command is the same as in @sec-B2.1, but with a second variable:</span>
<span id="cb337-1923"><a href="#cb337-1923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1926"><a href="#cb337-1926" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1927"><a href="#cb337-1927" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>smoked<span class="ot">&lt;-</span><span class="fu">factor</span>(whitehall<span class="sc">$</span>currsmoker)</span>
<span id="cb337-1928"><a href="#cb337-1928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1929"><a href="#cb337-1929" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(sbp<span class="sc">~</span>bmi_fact<span class="sc">+</span>smoked, <span class="at">data=</span>whitehall)</span>
<span id="cb337-1930"><a href="#cb337-1930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1931"><a href="#cb337-1931" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span>
<span id="cb337-1932"><a href="#cb337-1932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1933"><a href="#cb337-1933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1934"><a href="#cb337-1934" aria-hidden="true" tabindex="-1"></a>To make this a two-way factorial ANOVA (i.e with an interaction between the independent variables), we substitute an ‘<span class="sc">\*</span>’ for the ‘+’ sign:</span>
<span id="cb337-1935"><a href="#cb337-1935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1938"><a href="#cb337-1938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1939"><a href="#cb337-1939" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">aov</span>(sbp<span class="sc">~</span>bmi_fact<span class="sc">*</span>smoked, <span class="at">data=</span>whitehall)</span>
<span id="cb337-1940"><a href="#cb337-1940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1941"><a href="#cb337-1941" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span>
<span id="cb337-1942"><a href="#cb337-1942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1943"><a href="#cb337-1943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1944"><a href="#cb337-1944" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question B2.3a:</span></span>
<span id="cb337-1945"><a href="#cb337-1945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1946"><a href="#cb337-1946" aria-hidden="true" tabindex="-1"></a>**Run the two-way factorial ANOVA and interpret your output. How does this compare to the previous test on these relationships?**</span>
<span id="cb337-1947"><a href="#cb337-1947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1948"><a href="#cb337-1948" aria-hidden="true" tabindex="-1"></a>**Answer B2.3a: Test one, including the interaction term, shows a significant relationship between BMI group and SBP but current smoking and the interaction are non-significant. The interaction is adding the least to the model (has the highest P value).**</span>
<span id="cb337-1949"><a href="#cb337-1949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1950"><a href="#cb337-1950" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question B2.3b:</span></span>
<span id="cb337-1951"><a href="#cb337-1951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1952"><a href="#cb337-1952" aria-hidden="true" tabindex="-1"></a>**When we are using interaction terms like this if they do not contribute to the model (i.e. are not significant) we can remove them and see if this makes a difference to the other relationships. Go back and run the test a second time but without the interaction between BMI group and current smoking included. What do you notice?**</span>
<span id="cb337-1953"><a href="#cb337-1953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1954"><a href="#cb337-1954" aria-hidden="true" tabindex="-1"></a>When we remove the interaction term we see the BMI grouping is still showing a significant relationship on its own, but that current smoker is not. If you go back to practical @sec-B1.4 you can compare these results to those from the multivariable linear regression which included these two variables plus LDL-C. You can see that ANOVA without the interaction, is very similar to the linear regression. More on this in section @sec-B2.6</span>
<span id="cb337-1955"><a href="#cb337-1955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1956"><a href="#cb337-1956" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Minimal Adequate Model</span><span class="co">]</span>{.underline}</span>
<span id="cb337-1957"><a href="#cb337-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1958"><a href="#cb337-1958" aria-hidden="true" tabindex="-1"></a>As current smoker is also non-significant on its own, so you could choose to remove this as well and see what happens to the model. This is a simplified method of model optimisation known as the **Minimal Adequate Model**, meaning that you remove variables in order from least significant to most significant, until you end up with the simplest model you can. This can be a helpful process if you need to mentally work through your model and understand what each part is contributing. You never want to remove a variable that is significant on its own, or part of a significant interaction, but you can see how removing other non-significant variables can change the overall model. You can do this with any type of General Linear Model.</span>
<span id="cb337-1959"><a href="#cb337-1959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1960"><a href="#cb337-1960" aria-hidden="true" tabindex="-1"></a><span class="fu"># B2.4 Repeated Measures and the Paired T-Test {#sec-B2.4}</span></span>
<span id="cb337-1961"><a href="#cb337-1961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1962"><a href="#cb337-1962" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-1963"><a href="#cb337-1963" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-1964"><a href="#cb337-1964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1965"><a href="#cb337-1965" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-1966"><a href="#cb337-1966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1967"><a href="#cb337-1967" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain when and how to use post hoc testing</span>
<span id="cb337-1968"><a href="#cb337-1968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1969"><a href="#cb337-1969" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the concept of multiple comparisons and be able to correct for it in their analysis</span>
<span id="cb337-1970"><a href="#cb337-1970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1971"><a href="#cb337-1971" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Apply extensions to the basic ANOVA test and interpret their results</span>
<span id="cb337-1972"><a href="#cb337-1972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1973"><a href="#cb337-1973" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Explain when and how to use repeated measures statistics**</span>
<span id="cb337-1974"><a href="#cb337-1974" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-1975"><a href="#cb337-1975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1976"><a href="#cb337-1976" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B2.4 Repeated Measures and the Paired t-test</span><span class="co">](https://1drv.ms/b/s!AtvH6PgKXPEDgz6Fz1ErStcsG6ZZ?e=a0OFWL)</span>{target="_blank"}</span>
<span id="cb337-1977"><a href="#cb337-1977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1978"><a href="#cb337-1978" aria-hidden="true" tabindex="-1"></a>For this test you need a variable that has been measured twice in the same participants, so open the FoSSA Mouse data set.</span>
<span id="cb337-1979"><a href="#cb337-1979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1980"><a href="#cb337-1980" aria-hidden="true" tabindex="-1"></a>Most statistical software (as a default) always assumes that each row is a participant, so if you have paired measurements you need to make sure you have stored them as separate variables, and they are matched up correctly so each participants ‘before’ and ‘after’ for example are on the same row in your data set.</span>
<span id="cb337-1981"><a href="#cb337-1981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1982"><a href="#cb337-1982" aria-hidden="true" tabindex="-1"></a>Here we are going to do a paired t-test between the mouse weights at the start and end of the trial.</span>
<span id="cb337-1983"><a href="#cb337-1983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1984"><a href="#cb337-1984" aria-hidden="true" tabindex="-1"></a>The paired t test command in R is:</span>
<span id="cb337-1985"><a href="#cb337-1985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1986"><a href="#cb337-1986" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-1987"><a href="#cb337-1987" aria-hidden="true" tabindex="-1"></a><span class="in">ttest(x, y, paired=TRUE)</span></span>
<span id="cb337-1988"><a href="#cb337-1988" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1989"><a href="#cb337-1989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1990"><a href="#cb337-1990" aria-hidden="true" tabindex="-1"></a>Here we write:</span>
<span id="cb337-1991"><a href="#cb337-1991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-1994"><a href="#cb337-1994" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-1995"><a href="#cb337-1995" aria-hidden="true" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"FoSSA mouse data(in).csv"</span>)</span>
<span id="cb337-1996"><a href="#cb337-1996" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-1997"><a href="#cb337-1997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2000"><a href="#cb337-2000" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2001"><a href="#cb337-2001" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(mouse<span class="sc">$</span>Weight_baseline, mouse<span class="sc">$</span>Weight_end, <span class="at">paired=</span><span class="cn">TRUE</span>)</span>
<span id="cb337-2002"><a href="#cb337-2002" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2003"><a href="#cb337-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2004"><a href="#cb337-2004" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question B2.5:</span></span>
<span id="cb337-2005"><a href="#cb337-2005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2006"><a href="#cb337-2006" aria-hidden="true" tabindex="-1"></a>**Run the test and interpret the output. Is there a significant difference in mouse weight between the beginning and end of the trial?**</span>
<span id="cb337-2007"><a href="#cb337-2007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2008"><a href="#cb337-2008" aria-hidden="true" tabindex="-1"></a>Our value for t is very small (0.070), which indicates a very small difference between the variables. Looking at the two tailed p-value (which is the default), there is no significant difference in weight between the start and end of the trial (p=0.94). We fail to reject the null hypothesis.</span>
<span id="cb337-2009"><a href="#cb337-2009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2010"><a href="#cb337-2010" aria-hidden="true" tabindex="-1"></a><span class="fu"># B2.5 Repeated Measures ANOVA {#sec-B2.5}</span></span>
<span id="cb337-2011"><a href="#cb337-2011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2012"><a href="#cb337-2012" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-2013"><a href="#cb337-2013" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-2014"><a href="#cb337-2014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2015"><a href="#cb337-2015" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-2016"><a href="#cb337-2016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2017"><a href="#cb337-2017" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain when and how to use post hoc testing</span>
<span id="cb337-2018"><a href="#cb337-2018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2019"><a href="#cb337-2019" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the concept of multiple comparisons and be able to correct for it in their analysis</span>
<span id="cb337-2020"><a href="#cb337-2020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2021"><a href="#cb337-2021" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Apply extensions to the basic ANOVA test and interpret their results**</span>
<span id="cb337-2022"><a href="#cb337-2022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2023"><a href="#cb337-2023" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Explain when and how to use repeated measures statistics**</span>
<span id="cb337-2024"><a href="#cb337-2024" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2025"><a href="#cb337-2025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2026"><a href="#cb337-2026" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B2.5 Repeated Measures ANOVA.pdf</span><span class="co">](https://1drv.ms/b/s!AtvH6PgKXPEDgzxwYn7plemWIqYh?e=oKjXNS)</span>{target="_blank"}</span>
<span id="cb337-2027"><a href="#cb337-2027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2028"><a href="#cb337-2028" aria-hidden="true" tabindex="-1"></a>We can also use the ANOVA structure to test for differences between paired or repeated groups. We are going to use the repeated measures ANOVA to compare the mouse weights taken at the beginning, middle, and end of the trial in the FoSSA Mouse data set.</span>
<span id="cb337-2029"><a href="#cb337-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2030"><a href="#cb337-2030" aria-hidden="true" tabindex="-1"></a>To do this test, you need to reshape your data so that it is in ‘long’ format, rather than ‘wide’ format (as it currently is). Long format means that all the Weight variables are in one column, with a second column specifying which time they were measured at (beginning, middle or end). We need an ID variable to reshape our data, and we need to make sure the Weight variables have a standardised name with a number at the end.</span>
<span id="cb337-2031"><a href="#cb337-2031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2032"><a href="#cb337-2032" aria-hidden="true" tabindex="-1"></a>You will need to install and load the packages tidyverse, dplyr, and rstatix to perform the necessary commands.</span>
<span id="cb337-2033"><a href="#cb337-2033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2034"><a href="#cb337-2034" aria-hidden="true" tabindex="-1"></a>To create a subject ID variable, we can use:</span>
<span id="cb337-2035"><a href="#cb337-2035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2038"><a href="#cb337-2038" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2039"><a href="#cb337-2039" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb337-2040"><a href="#cb337-2040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2041"><a href="#cb337-2041" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstatix)</span>
<span id="cb337-2042"><a href="#cb337-2042" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2043"><a href="#cb337-2043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2046"><a href="#cb337-2046" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2047"><a href="#cb337-2047" aria-hidden="true" tabindex="-1"></a>mouse<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mouse)</span>
<span id="cb337-2048"><a href="#cb337-2048" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2049"><a href="#cb337-2049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2050"><a href="#cb337-2050" aria-hidden="true" tabindex="-1"></a>We then reshape our data to long format:</span>
<span id="cb337-2051"><a href="#cb337-2051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2054"><a href="#cb337-2054" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2055"><a href="#cb337-2055" aria-hidden="true" tabindex="-1"></a>mice <span class="ot">&lt;-</span> mouse <span class="sc">%&gt;%</span></span>
<span id="cb337-2056"><a href="#cb337-2056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"time"</span>, <span class="at">value =</span> <span class="st">"weight"</span>, Weight_baseline, Weight_mid, Weight_end) <span class="sc">%&gt;%</span></span>
<span id="cb337-2057"><a href="#cb337-2057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">convert_as_factor</span>(id, time)</span>
<span id="cb337-2058"><a href="#cb337-2058" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2059"><a href="#cb337-2059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2060"><a href="#cb337-2060" aria-hidden="true" tabindex="-1"></a>Then, to run the repeated measures ANOVA, we will load the ez package and use the function ezANOVA. The help file contains lots of useful information about where to put the relevant variables. We must specify the data, our dependant variable (dv=weight), our subject OD (wid=id) and the within subject factor (within=time):</span>
<span id="cb337-2061"><a href="#cb337-2061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2064"><a href="#cb337-2064" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2065"><a href="#cb337-2065" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ez)</span>
<span id="cb337-2066"><a href="#cb337-2066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2067"><a href="#cb337-2067" aria-hidden="true" tabindex="-1"></a>repeat1 <span class="ot">&lt;-</span> <span class="fu">ezANOVA</span>(<span class="at">data=</span>mice,<span class="at">dv=</span>weight,<span class="at">wid=</span>id,<span class="at">within=</span>time,<span class="at">type=</span><span class="dv">3</span>)</span>
<span id="cb337-2068"><a href="#cb337-2068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2069"><a href="#cb337-2069" aria-hidden="true" tabindex="-1"></a>repeat1</span>
<span id="cb337-2070"><a href="#cb337-2070" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2071"><a href="#cb337-2071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2072"><a href="#cb337-2072" aria-hidden="true" tabindex="-1"></a>The top table provides the results of a one-way repeated measures ANOVA if the assumption of sphericity is not violated. You want to look at the row for ‘time’, which shows that the p=0.42. We fail to reject the null hypothesis for a difference in weight across time.</span>
<span id="cb337-2073"><a href="#cb337-2073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2074"><a href="#cb337-2074" aria-hidden="true" tabindex="-1"></a>The middle table indicates whether the assumption of sphericity is violated. As p<span class="sc">\&lt;</span>0.05, we reject the null hypothesis of sphericity, and so will use the sphericity corrections table below.</span>
<span id="cb337-2075"><a href="#cb337-2075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2076"><a href="#cb337-2076" aria-hidden="true" tabindex="-1"></a>The bottom table which presents three types of corrections. We can see that the results are consistent and that we do not find evidence to reject the null hypothesis.</span>
<span id="cb337-2077"><a href="#cb337-2077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2078"><a href="#cb337-2078" aria-hidden="true" tabindex="-1"></a>**Controlling for between-subjects factors**</span>
<span id="cb337-2079"><a href="#cb337-2079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2080"><a href="#cb337-2080" aria-hidden="true" tabindex="-1"></a>If we want to run this ANOVA again, but control for ‘strain group’, we must first ensure it is a factor. R currently has coded it as an integer value, so we convert to a factor:</span>
<span id="cb337-2081"><a href="#cb337-2081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2084"><a href="#cb337-2084" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2085"><a href="#cb337-2085" aria-hidden="true" tabindex="-1"></a>mice<span class="sc">$</span>Strain_group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mice<span class="sc">$</span>Strain_group)</span>
<span id="cb337-2086"><a href="#cb337-2086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2087"><a href="#cb337-2087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2088"><a href="#cb337-2088" aria-hidden="true" tabindex="-1"></a>We can then add the between subject factor into the ezANOVA command, using the between argument as below:</span>
<span id="cb337-2089"><a href="#cb337-2089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2092"><a href="#cb337-2092" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2093"><a href="#cb337-2093" aria-hidden="true" tabindex="-1"></a>repeat2 <span class="ot">&lt;-</span><span class="fu">ezANOVA</span>(<span class="at">data=</span>mice,<span class="at">dv=</span>weight,<span class="at">wid=</span>id,<span class="at">within=</span>time, <span class="at">between =</span> Strain_group,<span class="at">type=</span><span class="dv">3</span>)</span>
<span id="cb337-2094"><a href="#cb337-2094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2095"><a href="#cb337-2095" aria-hidden="true" tabindex="-1"></a>repeat2</span>
<span id="cb337-2096"><a href="#cb337-2096" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2097"><a href="#cb337-2097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2098"><a href="#cb337-2098" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question B2.6 {#sec-B2.6}</span></span>
<span id="cb337-2099"><a href="#cb337-2099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2100"><a href="#cb337-2100" aria-hidden="true" tabindex="-1"></a>**Run the repeated measures ANOVA for difference in weights across the three time points, but this time add ‘Strain Group’ as a ‘Between-Subjects Factor. What difference does this make?**</span>
<span id="cb337-2101"><a href="#cb337-2101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2102"><a href="#cb337-2102" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Answer B2.6:</span></span>
<span id="cb337-2103"><a href="#cb337-2103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2104"><a href="#cb337-2104" aria-hidden="true" tabindex="-1"></a>When we review values for time:strain group we see that there is now a statistically significant difference, which holds when we correct for the violated sphericity assumption. This means that there is a significant different in weight when corrected for strain group. This is something that requires more investigation, but as these sample sizes are small and we have not considered whether the FoSSA Mouse data set meets all of the assumptions of our general linear model method. We will investigate these relationships in more detail in Module B3.</span>
<span id="cb337-2105"><a href="#cb337-2105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2106"><a href="#cb337-2106" aria-hidden="true" tabindex="-1"></a><span class="fu"># B3.1 The Parametric Assumptions {#sec-B3.1}</span></span>
<span id="cb337-2107"><a href="#cb337-2107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2108"><a href="#cb337-2108" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-2109"><a href="#cb337-2109" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-2110"><a href="#cb337-2110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2111"><a href="#cb337-2111" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-2112"><a href="#cb337-2112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2113"><a href="#cb337-2113" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Explain the importance of the parametric assumptions and determine if they have been met**</span>
<span id="cb337-2114"><a href="#cb337-2114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2115"><a href="#cb337-2115" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the basic principles of rank based non-parametric statistical tests</span>
<span id="cb337-2116"><a href="#cb337-2116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2117"><a href="#cb337-2117" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Describe the use of a range of common non-parametric tests</span>
<span id="cb337-2118"><a href="#cb337-2118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2119"><a href="#cb337-2119" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Conduct and interpret common non-parametric tests</span>
<span id="cb337-2120"><a href="#cb337-2120" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2121"><a href="#cb337-2121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2122"><a href="#cb337-2122" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B3.1 The Parametric Assumptions</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgn4tIEAOqYlsk7h9?e=cJd8n5)</span>{target="_blank"}</span>
<span id="cb337-2123"><a href="#cb337-2123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2124"><a href="#cb337-2124" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Part 1: Normality Testing**</span><span class="co">]</span>{.underline}</span>
<span id="cb337-2125"><a href="#cb337-2125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2126"><a href="#cb337-2126" aria-hidden="true" tabindex="-1"></a>The Shapiro-Wilk test statistic $( W )$ is given by the formula:</span>
<span id="cb337-2127"><a href="#cb337-2127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2128"><a href="#cb337-2128" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2129"><a href="#cb337-2129" aria-hidden="true" tabindex="-1"></a>W = \frac{\left( \sum_{i=1}^{n} a_i x_{(i)} \right)^2}{\sum_{i=1}^{n} (x_i - \bar{x})^2}</span>
<span id="cb337-2130"><a href="#cb337-2130" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2131"><a href="#cb337-2131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2132"><a href="#cb337-2132" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-2133"><a href="#cb337-2133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2134"><a href="#cb337-2134" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$x_{(i)}$ are the ordered sample values (sorted from smallest to largest),</span>
<span id="cb337-2135"><a href="#cb337-2135" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\bar{x}$ is the sample mean,</span>
<span id="cb337-2136"><a href="#cb337-2136" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$a_i$ are constants that depend on the sample size $n$.</span>
<span id="cb337-2137"><a href="#cb337-2137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2138"><a href="#cb337-2138" aria-hidden="true" tabindex="-1"></a>We will need to load the dplyr package for data manipulation, and rstatix for the functions required to perform the tests.</span>
<span id="cb337-2139"><a href="#cb337-2139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2140"><a href="#cb337-2140" aria-hidden="true" tabindex="-1"></a>We want to run a **Shapiro-Wilk** Test to examine Normality by each of the strain groups. We must first create a new dataset grouping by Strain, and then use this as the input for our test. To create the dataset, we will run:</span>
<span id="cb337-2141"><a href="#cb337-2141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2144"><a href="#cb337-2144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2145"><a href="#cb337-2145" aria-hidden="true" tabindex="-1"></a>mice_g <span class="ot">&lt;-</span> <span class="fu">group_by</span>(mouse, Strain)</span>
<span id="cb337-2146"><a href="#cb337-2146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2147"><a href="#cb337-2147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2148"><a href="#cb337-2148" aria-hidden="true" tabindex="-1"></a>Now, we can test the normality of the three weight variables within each strain group. We specify the dataset, and then the variables we want to test:</span>
<span id="cb337-2149"><a href="#cb337-2149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2152"><a href="#cb337-2152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2153"><a href="#cb337-2153" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro_test</span>(mice_g, Weight_baseline, Weight_mid, Weight_end)</span>
<span id="cb337-2154"><a href="#cb337-2154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2155"><a href="#cb337-2155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2156"><a href="#cb337-2156" aria-hidden="true" tabindex="-1"></a>**Two of the weight variables are statistically significant different (p\&lt;0.05) from a Gaussian or normal distribution (The Cdkn1a KO mice and the mid-point, and the n-RAS KO mice at the end of the trial). This would mean we need to use non-parametric tests when analysing these data.**</span>
<span id="cb337-2157"><a href="#cb337-2157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2158"><a href="#cb337-2158" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Part 2: Homogeneity of Variances**</span><span class="co">]</span>{.underline}</span>
<span id="cb337-2159"><a href="#cb337-2159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2160"><a href="#cb337-2160" aria-hidden="true" tabindex="-1"></a>In order to test for homogeneity of variance, we must be testing with respect to a factor variable. We wish to test this by strain group, so must convert this variable:</span>
<span id="cb337-2161"><a href="#cb337-2161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2164"><a href="#cb337-2164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2165"><a href="#cb337-2165" aria-hidden="true" tabindex="-1"></a>mouse<span class="sc">$</span>Strain_group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mouse<span class="sc">$</span>Strain_group)</span>
<span id="cb337-2166"><a href="#cb337-2166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2167"><a href="#cb337-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2168"><a href="#cb337-2168" aria-hidden="true" tabindex="-1"></a>Now we can use the levene_test function to test the homogeneity of the variances of baseline weight among the strain groups. We specify the dataset, then the variables in the form dependent variable \~ grouping variable:</span>
<span id="cb337-2169"><a href="#cb337-2169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2172"><a href="#cb337-2172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2173"><a href="#cb337-2173" aria-hidden="true" tabindex="-1"></a><span class="fu">levene_test</span>(mouse, Weight_baseline <span class="sc">~</span> Strain_group, <span class="at">center =</span> mean)</span>
<span id="cb337-2174"><a href="#cb337-2174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2175"><a href="#cb337-2175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2176"><a href="#cb337-2176" aria-hidden="true" tabindex="-1"></a>Levene's test statistic $( F )$ is given by the formula:</span>
<span id="cb337-2177"><a href="#cb337-2177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2178"><a href="#cb337-2178" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2179"><a href="#cb337-2179" aria-hidden="true" tabindex="-1"></a>F = \frac{(N - k)}{(k - 1)} \cdot \frac{\sum_{i=1}^{k} N_i (Z_{i\cdot} - Z_{\cdot\cdot})^2}{\sum_{i=1}^{k} \sum_{j=1}^{N_i} (Z_{ij} - Z_{i\cdot})^2}</span>
<span id="cb337-2180"><a href="#cb337-2180" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2181"><a href="#cb337-2181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2182"><a href="#cb337-2182" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-2183"><a href="#cb337-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2184"><a href="#cb337-2184" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$k$ is the number of groups,</span>
<span id="cb337-2185"><a href="#cb337-2185" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$N$ is the total number of observations across all groups,</span>
<span id="cb337-2186"><a href="#cb337-2186" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$N_i$ is the number of observations in the $i$-th group,</span>
<span id="cb337-2187"><a href="#cb337-2187" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Z_{ij}$ is the transformed value for the $j$-th observation in the $i$-th group,</span>
<span id="cb337-2188"><a href="#cb337-2188" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Z_{i\cdot}$ is the mean of the transformed values in group $i$,</span>
<span id="cb337-2189"><a href="#cb337-2189" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Z_{\cdot\cdot}$ is the overall mean of all transformed values.</span>
<span id="cb337-2190"><a href="#cb337-2190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2191"><a href="#cb337-2191" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question B3.1b:</span></span>
<span id="cb337-2192"><a href="#cb337-2192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2193"><a href="#cb337-2193" aria-hidden="true" tabindex="-1"></a>From the output in R, what can you conclude about the variance of the baseline weight?</span>
<span id="cb337-2194"><a href="#cb337-2194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2195"><a href="#cb337-2195" aria-hidden="true" tabindex="-1"></a>**This tells us that there is no statistically significant difference (p\&gt;0.05) in the variance of the mean baseline weight among the strain groups, so the assumption of homogeneity is met.**</span>
<span id="cb337-2196"><a href="#cb337-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2197"><a href="#cb337-2197" aria-hidden="true" tabindex="-1"></a><span class="fu"># B3.2 Mann-Whitney U Test {#sec-B3.2}</span></span>
<span id="cb337-2198"><a href="#cb337-2198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2199"><a href="#cb337-2199" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-2200"><a href="#cb337-2200" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-2201"><a href="#cb337-2201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2202"><a href="#cb337-2202" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-2203"><a href="#cb337-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2204"><a href="#cb337-2204" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the importance of the parametric assumptions and determine if they have been met</span>
<span id="cb337-2205"><a href="#cb337-2205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2206"><a href="#cb337-2206" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Explain the basic principles of rank based non-parametric statistical tests**</span>
<span id="cb337-2207"><a href="#cb337-2207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2208"><a href="#cb337-2208" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Describe the use of a range of common non-parametric tests**</span>
<span id="cb337-2209"><a href="#cb337-2209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2210"><a href="#cb337-2210" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Conduct and interpret common non-parametric tests**</span>
<span id="cb337-2211"><a href="#cb337-2211" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2212"><a href="#cb337-2212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2213"><a href="#cb337-2213" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B3.2 Mann-Whitney U Test</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgnuK75Ezaxe_8bPF?e=OLtmJG)</span>{target="_blank"}</span>
<span id="cb337-2214"><a href="#cb337-2214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2215"><a href="#cb337-2215" aria-hidden="true" tabindex="-1"></a>The Mann-Whitney U test is also sometimes called the Wilcoxon Rank-Sum test.</span>
<span id="cb337-2216"><a href="#cb337-2216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2217"><a href="#cb337-2217" aria-hidden="true" tabindex="-1"></a>When first examining your data, you may want to check the distribution of the variables of interest and calculate appropriate summary statistics for them.</span>
<span id="cb337-2218"><a href="#cb337-2218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2219"><a href="#cb337-2219" aria-hidden="true" tabindex="-1"></a>The Mann-Whitney U statistic for group $X$ is given by:</span>
<span id="cb337-2220"><a href="#cb337-2220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2221"><a href="#cb337-2221" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2222"><a href="#cb337-2222" aria-hidden="true" tabindex="-1"></a>U_X = n_X n_Y + \frac{n_X(n_X + 1)}{2} - R_X</span>
<span id="cb337-2223"><a href="#cb337-2223" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2224"><a href="#cb337-2224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2225"><a href="#cb337-2225" aria-hidden="true" tabindex="-1"></a>And for group $Y$:</span>
<span id="cb337-2226"><a href="#cb337-2226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2227"><a href="#cb337-2227" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2228"><a href="#cb337-2228" aria-hidden="true" tabindex="-1"></a>U_Y = n_X n_Y + \frac{n_Y(n_Y + 1)}{2} - R_Y</span>
<span id="cb337-2229"><a href="#cb337-2229" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2230"><a href="#cb337-2230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2231"><a href="#cb337-2231" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-2232"><a href="#cb337-2232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2233"><a href="#cb337-2233" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n_X$ and $n_Y$ are the sample sizes of groups $X$ and $Y$,</span>
<span id="cb337-2234"><a href="#cb337-2234" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$R_Y$ and $R_Y$ are the sums of ranks for groups $X$ and $Y$, respectively.</span>
<span id="cb337-2235"><a href="#cb337-2235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2236"><a href="#cb337-2236" aria-hidden="true" tabindex="-1"></a>Our ultimate Mann-Whitney U value is always lowest value of our two groups.</span>
<span id="cb337-2237"><a href="#cb337-2237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2238"><a href="#cb337-2238" aria-hidden="true" tabindex="-1"></a>$U_{cal}$ <span class="sc">\&gt;</span> $U_{critical}$ : Fail to reject the $H_o$. **No Significant difference**</span>
<span id="cb337-2239"><a href="#cb337-2239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2240"><a href="#cb337-2240" aria-hidden="true" tabindex="-1"></a>$U_{cal}$ <span class="sc">\&lt;</span> $U_{critical}$ : Reject the $H_o$. **There is Significant difference**</span>
<span id="cb337-2241"><a href="#cb337-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2242"><a href="#cb337-2242" aria-hidden="true" tabindex="-1"></a>The Mann-Whitney U statistic is the smaller of ( U_X ) and ( U_Y ).</span>
<span id="cb337-2243"><a href="#cb337-2243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2244"><a href="#cb337-2244" aria-hidden="true" tabindex="-1"></a>We will use the wilcox_test command to perform this. We must specify the data, and the variables to be considered in the form dependent variable \~ grouping variable.</span>
<span id="cb337-2245"><a href="#cb337-2245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2246"><a href="#cb337-2246" aria-hidden="true" tabindex="-1"></a>We want to use the Mann-Whitney U Test to determine if there is a significant difference in body condition score between the wild type mice and the Cdkn1a knockout mice at the start of the study (BCS_baseline).</span>
<span id="cb337-2247"><a href="#cb337-2247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2248"><a href="#cb337-2248" aria-hidden="true" tabindex="-1"></a>This test can only have two groups so we need to use the comparisons argument in the function so that it specifies the two groups being compared:</span>
<span id="cb337-2249"><a href="#cb337-2249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2252"><a href="#cb337-2252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2253"><a href="#cb337-2253" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox_test</span>(mouse, BCS_baseline <span class="sc">~</span> Strain, <span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"KO Cdkn1a"</span>, <span class="st">"Wild"</span>)))</span>
<span id="cb337-2254"><a href="#cb337-2254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2255"><a href="#cb337-2255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2256"><a href="#cb337-2256" aria-hidden="true" tabindex="-1"></a>There is no significant difference (p<span class="sc">\&gt;</span>0.05) in body condition score between the wild type mice and the Cdkn1a knockout mice at the baseline.</span>
<span id="cb337-2257"><a href="#cb337-2257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2258"><a href="#cb337-2258" aria-hidden="true" tabindex="-1"></a>**We can see that there is no significant difference (p\&gt;0.05) in body condition score between the wild type mice and the Cdkn1a knockout mice at the baseline.**</span>
<span id="cb337-2259"><a href="#cb337-2259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2260"><a href="#cb337-2260" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question B3.2:</span></span>
<span id="cb337-2261"><a href="#cb337-2261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2262"><a href="#cb337-2262" aria-hidden="true" tabindex="-1"></a>**Is there a significant difference in body condition score between the two different knockout strain rat the end of the trial?**</span>
<span id="cb337-2263"><a href="#cb337-2263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2266"><a href="#cb337-2266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2267"><a href="#cb337-2267" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox_test</span>(mouse, BCS_.end <span class="sc">~</span> Strain, <span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"KO Cdkn1a"</span>, <span class="st">"KO N-ras"</span>)))</span>
<span id="cb337-2268"><a href="#cb337-2268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2269"><a href="#cb337-2269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2270"><a href="#cb337-2270" aria-hidden="true" tabindex="-1"></a>**We can see that the two knockout strains are significantly different (p\&lt;0.05) in body condition score at the end of the study.**</span>
<span id="cb337-2271"><a href="#cb337-2271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2272"><a href="#cb337-2272" aria-hidden="true" tabindex="-1"></a><span class="fu"># B3.3 Kruskal-Wallis Test {#sec-B3.3}</span></span>
<span id="cb337-2273"><a href="#cb337-2273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2274"><a href="#cb337-2274" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false"}</span>
<span id="cb337-2275"><a href="#cb337-2275" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-2276"><a href="#cb337-2276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2277"><a href="#cb337-2277" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-2278"><a href="#cb337-2278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2279"><a href="#cb337-2279" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the importance of the parametric assumptions and determine if they have been met</span>
<span id="cb337-2280"><a href="#cb337-2280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2281"><a href="#cb337-2281" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the basic principles of rank based non-parametric statistical tests</span>
<span id="cb337-2282"><a href="#cb337-2282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2283"><a href="#cb337-2283" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Describe the use of a range of common non-parametric tests**</span>
<span id="cb337-2284"><a href="#cb337-2284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2285"><a href="#cb337-2285" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Conduct and interpret common non-parametric tests**</span>
<span id="cb337-2286"><a href="#cb337-2286" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2287"><a href="#cb337-2287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2288"><a href="#cb337-2288" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B3.3 Kruskal-Wallis Test</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgnp-KoVxCsssV6wo?e=BvB1z6)</span>{target="_blank"}</span>
<span id="cb337-2289"><a href="#cb337-2289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2290"><a href="#cb337-2290" aria-hidden="true" tabindex="-1"></a>We can use the kruskal_test command for a comparison between more than two groups. As there is no constraint on the number of groups for the test, we only need to specify the data, followed by the dependent and independent variables in the same was as the previous module @sec-B3.2</span>
<span id="cb337-2291"><a href="#cb337-2291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2292"><a href="#cb337-2292" aria-hidden="true" tabindex="-1"></a>The Kruskal-Wallis test statistic $H$ is given by:</span>
<span id="cb337-2293"><a href="#cb337-2293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2294"><a href="#cb337-2294" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2295"><a href="#cb337-2295" aria-hidden="true" tabindex="-1"></a>H = \frac{12}{N(N+1)} \sum_{i=1}^{k} \frac{R_i^2}{n_i} - 3(N+1)</span>
<span id="cb337-2296"><a href="#cb337-2296" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2297"><a href="#cb337-2297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2298"><a href="#cb337-2298" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-2299"><a href="#cb337-2299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2300"><a href="#cb337-2300" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$N$ is the total number of observations across all groups,</span>
<span id="cb337-2301"><a href="#cb337-2301" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$k$ is the number of groups,</span>
<span id="cb337-2302"><a href="#cb337-2302" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n_i$ is the number of observations in the $i$-th group,</span>
<span id="cb337-2303"><a href="#cb337-2303" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$R_i$ is the sum of ranks for the $i$-th group.</span>
<span id="cb337-2304"><a href="#cb337-2304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2305"><a href="#cb337-2305" aria-hidden="true" tabindex="-1"></a>**Explanation:**</span>
<span id="cb337-2306"><a href="#cb337-2306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2307"><a href="#cb337-2307" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\sum_{i=1}^{k} \frac{R_i^2}{n_i}$ is the sum of squared ranks for each group divided by the number of observations in that group.</span>
<span id="cb337-2308"><a href="#cb337-2308" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The factor $\frac{12}{N(N+1)}$ scales the sum of the squared ranks.</span>
<span id="cb337-2309"><a href="#cb337-2309" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The term $-3(N+1)$ adjusts for the overall number of observations.</span>
<span id="cb337-2310"><a href="#cb337-2310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2311"><a href="#cb337-2311" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question B3.3:</span></span>
<span id="cb337-2312"><a href="#cb337-2312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2313"><a href="#cb337-2313" aria-hidden="true" tabindex="-1"></a>**Is there a significant difference between all three mouse strains on their BCS_baseline score?**</span>
<span id="cb337-2314"><a href="#cb337-2314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2317"><a href="#cb337-2317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2318"><a href="#cb337-2318" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal_test</span>(mouse, BCS_baseline <span class="sc">~</span> Strain)</span>
<span id="cb337-2319"><a href="#cb337-2319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2320"><a href="#cb337-2320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2321"><a href="#cb337-2321" aria-hidden="true" tabindex="-1"></a>**These results show that there is a significant difference (p\&lt;0.05), reject the null hypothesis** $H_o$ **in the baseline body condition score when comparing all three strains.**</span>
<span id="cb337-2322"><a href="#cb337-2322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2323"><a href="#cb337-2323" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false"}</span>
<span id="cb337-2324"><a href="#cb337-2324" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Points</span></span>
<span id="cb337-2325"><a href="#cb337-2325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2326"><a href="#cb337-2326" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Kruskal Wallis test $W$ starts out same as Mann Whitney U but includes multiple groups.</span>
<span id="cb337-2327"><a href="#cb337-2327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2328"><a href="#cb337-2328" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Data ranked and analysis conducted based on ranks.</span>
<span id="cb337-2329"><a href="#cb337-2329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2330"><a href="#cb337-2330" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate $H$ which follows Chi-squared distribution (varies with df)</span>
<span id="cb337-2331"><a href="#cb337-2331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2332"><a href="#cb337-2332" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Global test- needs post hoc (That means if we find a significant difference in our test, then we need to do post hoc test)</span>
<span id="cb337-2333"><a href="#cb337-2333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2334"><a href="#cb337-2334" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$H_calc$ <span class="sc">\&gt;</span> $H_critical$: Reject the $H_o$, there is a significant difference. Otherwise for $H_calc$ <span class="sc">\&lt;</span> $H_critical$</span>
<span id="cb337-2335"><a href="#cb337-2335" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2336"><a href="#cb337-2336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2337"><a href="#cb337-2337" aria-hidden="true" tabindex="-1"></a><span class="fu"># B3.4 Wilcoxon Signed Rank Test {#sec-B3.4}</span></span>
<span id="cb337-2338"><a href="#cb337-2338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2339"><a href="#cb337-2339" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb337-2340"><a href="#cb337-2340" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-2341"><a href="#cb337-2341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2342"><a href="#cb337-2342" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-2343"><a href="#cb337-2343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2344"><a href="#cb337-2344" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the importance of the parametric assumptions and determine if they have been met</span>
<span id="cb337-2345"><a href="#cb337-2345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2346"><a href="#cb337-2346" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the basic principles of rank based non-parametric statistical tests</span>
<span id="cb337-2347"><a href="#cb337-2347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2348"><a href="#cb337-2348" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Describe the use of a range of common non-parametric tests**</span>
<span id="cb337-2349"><a href="#cb337-2349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2350"><a href="#cb337-2350" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Conduct and interpret common non-parametric tests**</span>
<span id="cb337-2351"><a href="#cb337-2351" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2352"><a href="#cb337-2352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2353"><a href="#cb337-2353" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B3.4 Wilcoxon Signed Rank Test</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgn0kovet1qdWspcb?e=1HsCI2)</span>{target="_blank"}</span>
<span id="cb337-2354"><a href="#cb337-2354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2355"><a href="#cb337-2355" aria-hidden="true" tabindex="-1"></a>The Wilcoxon signed-rank test statistic $T$ is given by:</span>
<span id="cb337-2356"><a href="#cb337-2356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2357"><a href="#cb337-2357" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2358"><a href="#cb337-2358" aria-hidden="true" tabindex="-1"></a>T= \sum \text{(Ranks of the absolute differences of the non-zero differences)}</span>
<span id="cb337-2359"><a href="#cb337-2359" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2360"><a href="#cb337-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2361"><a href="#cb337-2361" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-2362"><a href="#cb337-2362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2363"><a href="#cb337-2363" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For each pair of observations $(X_i, Y_i)$, compute the difference $D_i = X_i - Y_i$.</span>
<span id="cb337-2364"><a href="#cb337-2364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2365"><a href="#cb337-2365" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Rank the absolute differences $|D_i|$, ignoring zeros.</span>
<span id="cb337-2366"><a href="#cb337-2366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2367"><a href="#cb337-2367" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Assign positive or negative signs to the ranks based on the sign of $D_i$.</span>
<span id="cb337-2368"><a href="#cb337-2368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2369"><a href="#cb337-2369" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$T$ is the sum of the ranks with the appropriate signs.</span>
<span id="cb337-2370"><a href="#cb337-2370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2371"><a href="#cb337-2371" aria-hidden="true" tabindex="-1"></a>The alternative z-test for the Wilcoxon signed-rank test is used when the sample size is large (typically $𝑛&gt; 20$ and the test statistic T is approximately normally distributed.</span>
<span id="cb337-2372"><a href="#cb337-2372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2373"><a href="#cb337-2373" aria-hidden="true" tabindex="-1"></a>The Alternative z-statistic for the Wilcoxon signed-rank test is given by:</span>
<span id="cb337-2374"><a href="#cb337-2374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2375"><a href="#cb337-2375" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2376"><a href="#cb337-2376" aria-hidden="true" tabindex="-1"></a>z = \frac{T - \mu_T}{\sigma_T}</span>
<span id="cb337-2377"><a href="#cb337-2377" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2378"><a href="#cb337-2378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2379"><a href="#cb337-2379" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-2380"><a href="#cb337-2380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2381"><a href="#cb337-2381" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$T$ is the Wilcoxon signed-rank test statistic,</span>
<span id="cb337-2382"><a href="#cb337-2382" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\mu_T$ is the expected mean of $T$, calculated as:</span>
<span id="cb337-2383"><a href="#cb337-2383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2384"><a href="#cb337-2384" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2385"><a href="#cb337-2385" aria-hidden="true" tabindex="-1"></a>\mu_T = \frac{n(n+1)}{4}</span>
<span id="cb337-2386"><a href="#cb337-2386" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2387"><a href="#cb337-2387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2388"><a href="#cb337-2388" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\sigma_T$ is the standard deviation of $T$, calculated as:</span>
<span id="cb337-2389"><a href="#cb337-2389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2390"><a href="#cb337-2390" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2391"><a href="#cb337-2391" aria-hidden="true" tabindex="-1"></a>\sigma_T = \sqrt{\frac{n(n+1)(2n+1)}{24}}</span>
<span id="cb337-2392"><a href="#cb337-2392" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2393"><a href="#cb337-2393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2394"><a href="#cb337-2394" aria-hidden="true" tabindex="-1"></a>Where $n$ is the number of non-zero differences between the paired samples. The test evaluates whether the ranks of the positive and negative differences are significantly different, providing evidence of a difference between the paired groups.</span>
<span id="cb337-2395"><a href="#cb337-2395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2396"><a href="#cb337-2396" aria-hidden="true" tabindex="-1"></a>We wish to use the Wilcoxon Signed Rank Test to determine if there is a significant difference in body condition score across all mice in the study between the start (BCS_baseline) and end (BCS_end) of the trial.</span>
<span id="cb337-2397"><a href="#cb337-2397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2398"><a href="#cb337-2398" aria-hidden="true" tabindex="-1"></a>We use the wilcox.test command to perform this test in R. We specify the two variables, and must use paired=TRUE since the measurements are coming from the same subject:</span>
<span id="cb337-2399"><a href="#cb337-2399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2402"><a href="#cb337-2402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2403"><a href="#cb337-2403" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(mouse<span class="sc">$</span>BCS_baseline, mouse<span class="sc">$</span>BCS_.end, <span class="at">paired =</span> <span class="cn">TRUE</span>, <span class="at">exact =</span> <span class="cn">FALSE</span>)</span>
<span id="cb337-2404"><a href="#cb337-2404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2405"><a href="#cb337-2405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2406"><a href="#cb337-2406" aria-hidden="true" tabindex="-1"></a>**There is no significant difference (p\&gt;0.05) in body condition score of the mice between the start and the end of the study.**</span>
<span id="cb337-2407"><a href="#cb337-2407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2408"><a href="#cb337-2408" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question B3.4:</span></span>
<span id="cb337-2409"><a href="#cb337-2409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2410"><a href="#cb337-2410" aria-hidden="true" tabindex="-1"></a>**Is there a significant difference between weight at the beginning and weight at the end?**</span>
<span id="cb337-2411"><a href="#cb337-2411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2414"><a href="#cb337-2414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2415"><a href="#cb337-2415" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(mouse<span class="sc">$</span>Weight_baseline, mouse<span class="sc">$</span>Weight_end, <span class="at">paired =</span> <span class="cn">TRUE</span>, <span class="at">exact =</span> <span class="cn">FALSE</span>)</span>
<span id="cb337-2416"><a href="#cb337-2416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2417"><a href="#cb337-2417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2418"><a href="#cb337-2418" aria-hidden="true" tabindex="-1"></a>**From this, we can conclude that there is no significant difference (p\&gt;0.05) in the weight of the mice between the start and the end of the study.**</span>
<span id="cb337-2419"><a href="#cb337-2419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2420"><a href="#cb337-2420" aria-hidden="true" tabindex="-1"></a><span class="fu"># B3.5 Friedman Test {#sec-B3.5}</span></span>
<span id="cb337-2421"><a href="#cb337-2421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2422"><a href="#cb337-2422" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb337-2423"><a href="#cb337-2423" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-2424"><a href="#cb337-2424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2425"><a href="#cb337-2425" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-2426"><a href="#cb337-2426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2427"><a href="#cb337-2427" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the importance of the parametric assumptions and determine if they have been met</span>
<span id="cb337-2428"><a href="#cb337-2428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2429"><a href="#cb337-2429" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the basic principles of rank based non-parametric statistical tests</span>
<span id="cb337-2430"><a href="#cb337-2430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2431"><a href="#cb337-2431" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Describe the use of a range of common non-parametric tests**</span>
<span id="cb337-2432"><a href="#cb337-2432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2433"><a href="#cb337-2433" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Conduct and interpret common non-parametric tests**</span>
<span id="cb337-2434"><a href="#cb337-2434" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2435"><a href="#cb337-2435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2436"><a href="#cb337-2436" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B3.5 Friedman Test</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgnnz3IqSNK1yuJWe?e=Hiin6X)</span>{target="_blank"}</span>
<span id="cb337-2437"><a href="#cb337-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2438"><a href="#cb337-2438" aria-hidden="true" tabindex="-1"></a>The Friedman test statistic $Q$ is given by:</span>
<span id="cb337-2439"><a href="#cb337-2439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2440"><a href="#cb337-2440" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2441"><a href="#cb337-2441" aria-hidden="true" tabindex="-1"></a>Q = \frac{12}{nk(k+1)} \sum_{j=1}^{k} R_j^2 - 3n(k+1)</span>
<span id="cb337-2442"><a href="#cb337-2442" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2443"><a href="#cb337-2443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2444"><a href="#cb337-2444" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-2445"><a href="#cb337-2445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2446"><a href="#cb337-2446" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n$ is the number of subjects,</span>
<span id="cb337-2447"><a href="#cb337-2447" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$k$ is the number of treatments (or conditions),</span>
<span id="cb337-2448"><a href="#cb337-2448" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$R_j$ is the sum of ranks for each treatment $j$.</span>
<span id="cb337-2449"><a href="#cb337-2449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2450"><a href="#cb337-2450" aria-hidden="true" tabindex="-1"></a>The test assesses whether there are differences between the treatments or conditions across subjects by comparing rank sums.</span>
<span id="cb337-2451"><a href="#cb337-2451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2452"><a href="#cb337-2452" aria-hidden="true" tabindex="-1"></a>We want to examine if there is a significant difference in body condition score among the three measures taken during the study for all mice.</span>
<span id="cb337-2453"><a href="#cb337-2453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2454"><a href="#cb337-2454" aria-hidden="true" tabindex="-1"></a>As with the repeated measures ANOVA, before we begin using the Friedman test, we must convert our data into long form. We will do this in a similar manner to before, first by creating a subject id variable, and then reshaping the data:</span>
<span id="cb337-2455"><a href="#cb337-2455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2458"><a href="#cb337-2458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2459"><a href="#cb337-2459" aria-hidden="true" tabindex="-1"></a>mouse<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mouse)</span>
<span id="cb337-2460"><a href="#cb337-2460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2461"><a href="#cb337-2461" aria-hidden="true" tabindex="-1"></a>mice1 <span class="ot">&lt;-</span> mouse <span class="sc">%&gt;%</span></span>
<span id="cb337-2462"><a href="#cb337-2462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"time"</span>, <span class="at">value =</span> <span class="st">"BCS"</span>, BCS_baseline, BCS_mid, BCS_.end) <span class="sc">%&gt;%</span></span>
<span id="cb337-2463"><a href="#cb337-2463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">convert_as_factor</span>(id, time)</span>
<span id="cb337-2464"><a href="#cb337-2464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2465"><a href="#cb337-2465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2466"><a href="#cb337-2466" aria-hidden="true" tabindex="-1"></a>We can now use the friendman.test function – it requires three inputs: the data, the comparison you are doing, and the blocking factor (subject id) and takes the form:</span>
<span id="cb337-2467"><a href="#cb337-2467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2468"><a href="#cb337-2468" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-2469"><a href="#cb337-2469" aria-hidden="true" tabindex="-1"></a><span class="in">friendman.test(data = name, dependent variable ~ independent variable | id)</span></span>
<span id="cb337-2470"><a href="#cb337-2470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2471"><a href="#cb337-2471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2472"><a href="#cb337-2472" aria-hidden="true" tabindex="-1"></a>In this case, we will use:</span>
<span id="cb337-2473"><a href="#cb337-2473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2476"><a href="#cb337-2476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2477"><a href="#cb337-2477" aria-hidden="true" tabindex="-1"></a><span class="fu">friedman.test</span>(<span class="at">data=</span>mice1, BCS <span class="sc">~</span> time <span class="sc">|</span> id)</span>
<span id="cb337-2478"><a href="#cb337-2478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2479"><a href="#cb337-2479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2480"><a href="#cb337-2480" aria-hidden="true" tabindex="-1"></a>**The body condition score did not significantly (p\&gt;0.05) differ between the time points of measurement when consider all the mice.**</span>
<span id="cb337-2481"><a href="#cb337-2481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2482"><a href="#cb337-2482" aria-hidden="true" tabindex="-1"></a>Next, we may want to consider the different strains individually. Create a subset containing the N-ras knockout mice only:</span>
<span id="cb337-2483"><a href="#cb337-2483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2486"><a href="#cb337-2486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2487"><a href="#cb337-2487" aria-hidden="true" tabindex="-1"></a>mice2 <span class="ot">&lt;-</span> mouse[mouse<span class="sc">$</span>Strain<span class="sc">==</span><span class="st">"KO N-ras"</span>,]</span>
<span id="cb337-2488"><a href="#cb337-2488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2489"><a href="#cb337-2489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2490"><a href="#cb337-2490" aria-hidden="true" tabindex="-1"></a>The Friedman test must have all of the id variables in ascending order from 1 to n, so we must remake the id variable in the same manner as before, namely:</span>
<span id="cb337-2491"><a href="#cb337-2491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2494"><a href="#cb337-2494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2495"><a href="#cb337-2495" aria-hidden="true" tabindex="-1"></a>mice2<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mice2)</span>
<span id="cb337-2496"><a href="#cb337-2496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2497"><a href="#cb337-2497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2498"><a href="#cb337-2498" aria-hidden="true" tabindex="-1"></a>We then reshape our data into long form again. Note that this is exactly the same code as above aside from changing the dataset names, so can be run very quickly.</span>
<span id="cb337-2499"><a href="#cb337-2499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2502"><a href="#cb337-2502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2503"><a href="#cb337-2503" aria-hidden="true" tabindex="-1"></a>mice.bcs2 <span class="ot">&lt;-</span> mice2 <span class="sc">%&gt;%</span></span>
<span id="cb337-2504"><a href="#cb337-2504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"time"</span>, <span class="at">value =</span> <span class="st">"BCS"</span>, BCS_baseline, BCS_mid, BCS_.end) <span class="sc">%&gt;%</span></span>
<span id="cb337-2505"><a href="#cb337-2505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">convert_as_factor</span>(id, time)</span>
<span id="cb337-2506"><a href="#cb337-2506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2507"><a href="#cb337-2507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2508"><a href="#cb337-2508" aria-hidden="true" tabindex="-1"></a>We are now able to run the Friedman test on this subset of our data.</span>
<span id="cb337-2509"><a href="#cb337-2509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2512"><a href="#cb337-2512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2513"><a href="#cb337-2513" aria-hidden="true" tabindex="-1"></a><span class="fu">friedman.test</span>(<span class="at">data=</span>mice.bcs2, BCS <span class="sc">~</span> time <span class="sc">|</span> id)</span>
<span id="cb337-2514"><a href="#cb337-2514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2515"><a href="#cb337-2515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2516"><a href="#cb337-2516" aria-hidden="true" tabindex="-1"></a>**We can see there is a significant difference (p\&lt;0.05) in the body condition score of the N-ras knockout mice between the time points of measurement.**</span>
<span id="cb337-2517"><a href="#cb337-2517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2518"><a href="#cb337-2518" aria-hidden="true" tabindex="-1"></a><span class="fu"># B3.6 Spearman’s Rank Order Correlation {#sec-B3.6}</span></span>
<span id="cb337-2519"><a href="#cb337-2519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2520"><a href="#cb337-2520" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false"}</span>
<span id="cb337-2521"><a href="#cb337-2521" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-2522"><a href="#cb337-2522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2523"><a href="#cb337-2523" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-2524"><a href="#cb337-2524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2525"><a href="#cb337-2525" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the importance of the parametric assumptions and determine if they have been met</span>
<span id="cb337-2526"><a href="#cb337-2526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2527"><a href="#cb337-2527" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the basic principles of rank based non-parametric statistical tests</span>
<span id="cb337-2528"><a href="#cb337-2528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2529"><a href="#cb337-2529" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Describe the use of a range of common non-parametric tests**</span>
<span id="cb337-2530"><a href="#cb337-2530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2531"><a href="#cb337-2531" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Conduct and interpret common non-parametric tests**</span>
<span id="cb337-2532"><a href="#cb337-2532" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2533"><a href="#cb337-2533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2534"><a href="#cb337-2534" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">B3.6 Spearman’s Rank Order Correlation</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgnxcM_MCm6zgY6Cx?e=WEArfh)</span>{target="_blank"}</span>
<span id="cb337-2535"><a href="#cb337-2535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2536"><a href="#cb337-2536" aria-hidden="true" tabindex="-1"></a>The Spearman rank correlation coefficient $\rho$ is given by:</span>
<span id="cb337-2537"><a href="#cb337-2537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2538"><a href="#cb337-2538" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2539"><a href="#cb337-2539" aria-hidden="true" tabindex="-1"></a>\rho = 1 - \frac{6 \sum d_i^2}{n(n^2 - 1)}</span>
<span id="cb337-2540"><a href="#cb337-2540" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2541"><a href="#cb337-2541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2542"><a href="#cb337-2542" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-2543"><a href="#cb337-2543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2544"><a href="#cb337-2544" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$d_i$ is the difference between the ranks of each pair of observations,</span>
<span id="cb337-2545"><a href="#cb337-2545" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n$ is the number of paired observations.</span>
<span id="cb337-2546"><a href="#cb337-2546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2547"><a href="#cb337-2547" aria-hidden="true" tabindex="-1"></a>*This formula is used to measure the strength and direction of association between two ranked variables.*</span>
<span id="cb337-2548"><a href="#cb337-2548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2549"><a href="#cb337-2549" aria-hidden="true" tabindex="-1"></a>To test the significance of the Spearman rank correlation coefficient $\rho$, the t-statistic can be calculated as:</span>
<span id="cb337-2550"><a href="#cb337-2550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2551"><a href="#cb337-2551" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2552"><a href="#cb337-2552" aria-hidden="true" tabindex="-1"></a>t = \frac{\rho \sqrt{n - 2}}{\sqrt{1 - \rho^2}}</span>
<span id="cb337-2553"><a href="#cb337-2553" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2554"><a href="#cb337-2554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2555"><a href="#cb337-2555" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-2556"><a href="#cb337-2556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2557"><a href="#cb337-2557" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$t$ is the t-statistic,</span>
<span id="cb337-2558"><a href="#cb337-2558" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\rho$ is the Spearman rank correlation coefficient,</span>
<span id="cb337-2559"><a href="#cb337-2559" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n$ is the number of paired observations.</span>
<span id="cb337-2560"><a href="#cb337-2560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2561"><a href="#cb337-2561" aria-hidden="true" tabindex="-1"></a>The t-statistic follows a t-distribution with $n - 2$ degrees of freedom, allowing you to test whether the Spearman correlation is significantly different from zero.</span>
<span id="cb337-2562"><a href="#cb337-2562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2563"><a href="#cb337-2563" aria-hidden="true" tabindex="-1"></a>For the last practical in this module, you are going to perform a test of correlation on non-parametric data using the Spearman’s Rank Order Correlation.</span>
<span id="cb337-2564"><a href="#cb337-2564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2565"><a href="#cb337-2565" aria-hidden="true" tabindex="-1"></a>This can be conducted using the cor.test command, which has the structure:</span>
<span id="cb337-2566"><a href="#cb337-2566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2567"><a href="#cb337-2567" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-2568"><a href="#cb337-2568" aria-hidden="true" tabindex="-1"></a><span class="in">cor.test(data$variable 1, data$variable 2, method="spearman")</span></span>
<span id="cb337-2569"><a href="#cb337-2569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2570"><a href="#cb337-2570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2571"><a href="#cb337-2571" aria-hidden="true" tabindex="-1"></a>We can specify spearman as the method to conduct a Spearman’s rank test. If the method is not specified, the default is Pearson’s correlation.</span>
<span id="cb337-2572"><a href="#cb337-2572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2573"><a href="#cb337-2573" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question B3.6:</span></span>
<span id="cb337-2574"><a href="#cb337-2574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2575"><a href="#cb337-2575" aria-hidden="true" tabindex="-1"></a>**What is the spearman correlation between Weight_end and BCS_end?**</span>
<span id="cb337-2576"><a href="#cb337-2576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2577"><a href="#cb337-2577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb337-2578"><a href="#cb337-2578" aria-hidden="true" tabindex="-1"></a><span class="in">cor.test(mouse$Weight_end, mouse$BCS_.end, method = "spearman")</span></span>
<span id="cb337-2579"><a href="#cb337-2579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2580"><a href="#cb337-2580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2581"><a href="#cb337-2581" aria-hidden="true" tabindex="-1"></a>**We can see that there is a significant (p\&lt;0.05) correlation between the body condition score and the weight of the mice at the end of the study and their correlation coefficient is 0.81.**</span>
<span id="cb337-2582"><a href="#cb337-2582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2583"><a href="#cb337-2583" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon="false"}</span>
<span id="cb337-2584"><a href="#cb337-2584" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Points</span></span>
<span id="cb337-2585"><a href="#cb337-2585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2586"><a href="#cb337-2586" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spearman's test ranks data, then works out differences between ranks.</span>
<span id="cb337-2587"><a href="#cb337-2587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2588"><a href="#cb337-2588" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Take sum of squares of differences.</span>
<span id="cb337-2589"><a href="#cb337-2589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2590"><a href="#cb337-2590" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use this to calculate correlation coefficient ($\rho$)</span>
<span id="cb337-2591"><a href="#cb337-2591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2592"><a href="#cb337-2592" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpret in same manner as for parametric test of correlation.</span>
<span id="cb337-2593"><a href="#cb337-2593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2594"><a href="#cb337-2594" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use $\rho$ to calculate t.</span>
<span id="cb337-2595"><a href="#cb337-2595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2596"><a href="#cb337-2596" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>T distribution gives p-value.</span>
<span id="cb337-2597"><a href="#cb337-2597" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2598"><a href="#cb337-2598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2599"><a href="#cb337-2599" aria-hidden="true" tabindex="-1"></a><span class="fu"># C1: Binary Data and Logistic Regression</span></span>
<span id="cb337-2600"><a href="#cb337-2600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2601"><a href="#cb337-2601" aria-hidden="true" tabindex="-1"></a><span class="fu">## C1.1 Introduction to Prevalence, Risk, Odds and Rates {#sec-C1.1}</span></span>
<span id="cb337-2602"><a href="#cb337-2602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2603"><a href="#cb337-2603" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false"}</span>
<span id="cb337-2604"><a href="#cb337-2604" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-2605"><a href="#cb337-2605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2606"><a href="#cb337-2606" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-2607"><a href="#cb337-2607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2608"><a href="#cb337-2608" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define and calculate prevalence, risk, odds and rates</span>
<span id="cb337-2609"><a href="#cb337-2609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2610"><a href="#cb337-2610" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate and interpret risk ratios, odds ratios, rate ratios and their 95% confidence intervals</span>
<span id="cb337-2611"><a href="#cb337-2611" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2612"><a href="#cb337-2612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2613"><a href="#cb337-2613" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">C1.1 Introduction to Prevalence, Risk, Odds and Rates</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgmvzvj557dfR9vVB?e=qDd8VU)</span>{target="_blank"}</span>
<span id="cb337-2614"><a href="#cb337-2614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2615"><a href="#cb337-2615" aria-hidden="true" tabindex="-1"></a><span class="fu">### Risk</span></span>
<span id="cb337-2616"><a href="#cb337-2616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2617"><a href="#cb337-2617" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Risk describes the probability with which an outcome will occur in at risk population.</span>
<span id="cb337-2618"><a href="#cb337-2618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2619"><a href="#cb337-2619" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Proportion of new cases of an outcome in an at-risk population</span>
<span id="cb337-2620"><a href="#cb337-2620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2621"><a href="#cb337-2621" aria-hidden="true" tabindex="-1"></a>The formula for risk in epidemiology is given by:</span>
<span id="cb337-2622"><a href="#cb337-2622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2623"><a href="#cb337-2623" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2624"><a href="#cb337-2624" aria-hidden="true" tabindex="-1"></a>\text{risk (p)} = \frac{\text{Number of new outcomes (e.g., cases of disease)}}{\text{Total population at risk during a specific time period}}</span>
<span id="cb337-2625"><a href="#cb337-2625" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2626"><a href="#cb337-2626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2627"><a href="#cb337-2627" aria-hidden="true" tabindex="-1"></a>**Risk of CVD in the Oxford Study**</span>
<span id="cb337-2628"><a href="#cb337-2628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2629"><a href="#cb337-2629" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1000 participants in the Oxford Study</span>
<span id="cb337-2630"><a href="#cb337-2630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2631"><a href="#cb337-2631" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>400 develop CVD</span>
<span id="cb337-2632"><a href="#cb337-2632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2633"><a href="#cb337-2633" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Risk of CVD in the Oxford Study:</span>
<span id="cb337-2634"><a href="#cb337-2634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2635"><a href="#cb337-2635" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2636"><a href="#cb337-2636" aria-hidden="true" tabindex="-1"></a>\text{risk (p)} = \frac{\text{Number of cases CVD}}{\text{Number in Oxford Study}} = \frac{400}{1000} = 0.40 \text{ or } 40\%</span>
<span id="cb337-2637"><a href="#cb337-2637" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2638"><a href="#cb337-2638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2639"><a href="#cb337-2639" aria-hidden="true" tabindex="-1"></a>**The risk of CVD in the Oxford Study is 40%**</span>
<span id="cb337-2640"><a href="#cb337-2640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2641"><a href="#cb337-2641" aria-hidden="true" tabindex="-1"></a><span class="fu">### Odds</span></span>
<span id="cb337-2642"><a href="#cb337-2642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2643"><a href="#cb337-2643" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Odds is another way of presenting probability (or risk)</span>
<span id="cb337-2644"><a href="#cb337-2644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2645"><a href="#cb337-2645" aria-hidden="true" tabindex="-1"></a>The formula for odds in epidemiology is given by:</span>
<span id="cb337-2646"><a href="#cb337-2646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2647"><a href="#cb337-2647" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2648"><a href="#cb337-2648" aria-hidden="true" tabindex="-1"></a>\text{Odds} = \frac{\text{Number of events}}{\text{Number of non-events}} = \frac{\text{Number of Outcome}}{\text{Number of No outcome}}</span>
<span id="cb337-2649"><a href="#cb337-2649" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2650"><a href="#cb337-2650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2651"><a href="#cb337-2651" aria-hidden="true" tabindex="-1"></a>$\text{         OR          }$</span>
<span id="cb337-2652"><a href="#cb337-2652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2653"><a href="#cb337-2653" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2654"><a href="#cb337-2654" aria-hidden="true" tabindex="-1"></a>\frac{\text{Outcome} / \text{Total}}{\text{No Outcome} / \text{Total}} = \frac{\text{Risk (Probability of outcome)}}{\text{1 - Risk (Probability of no outcome)}}</span>
<span id="cb337-2655"><a href="#cb337-2655" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2656"><a href="#cb337-2656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2657"><a href="#cb337-2657" aria-hidden="true" tabindex="-1"></a>Or, if you have the probability $p$ of an event, you can express odds in terms of $p$ as:</span>
<span id="cb337-2658"><a href="#cb337-2658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2659"><a href="#cb337-2659" aria-hidden="true" tabindex="-1"></a>Alternatively, if $p$ represents the probability of the outcome, the odds can be expressed as:</span>
<span id="cb337-2660"><a href="#cb337-2660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2661"><a href="#cb337-2661" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2662"><a href="#cb337-2662" aria-hidden="true" tabindex="-1"></a>\text{Odds} = \frac{p}{1 - p}</span>
<span id="cb337-2663"><a href="#cb337-2663" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2664"><a href="#cb337-2664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2665"><a href="#cb337-2665" aria-hidden="true" tabindex="-1"></a>**Odds of CVD in the Oxford Study**</span>
<span id="cb337-2666"><a href="#cb337-2666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2667"><a href="#cb337-2667" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1000 participants in the Oxford Study</span>
<span id="cb337-2668"><a href="#cb337-2668" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>400 develop CVD</span>
<span id="cb337-2669"><a href="#cb337-2669" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Risk of CVD in the Oxford Study $(p)$ = 0.40</span>
<span id="cb337-2670"><a href="#cb337-2670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2671"><a href="#cb337-2671" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2672"><a href="#cb337-2672" aria-hidden="true" tabindex="-1"></a>\text{Odds} = \frac{p}{1 - p} = \frac{0.40}{1 - 0.40} = \frac{0.40}{0.60} = 0.667 \text{ or } 67\%</span>
<span id="cb337-2673"><a href="#cb337-2673" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2674"><a href="#cb337-2674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2675"><a href="#cb337-2675" aria-hidden="true" tabindex="-1"></a>**The odds of having CVD is 67%**</span>
<span id="cb337-2676"><a href="#cb337-2676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2677"><a href="#cb337-2677" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb337-2678"><a href="#cb337-2678" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The difference between risk and odds are small when there are few events, but when there are more events, the odds and risks are different from each other.</span>
<span id="cb337-2679"><a href="#cb337-2679" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>So it is obvious in our calculations above that odds is slightly higher than risk, because there are more common events, 400 events.</span>
<span id="cb337-2680"><a href="#cb337-2680" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2681"><a href="#cb337-2681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2682"><a href="#cb337-2682" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rates</span></span>
<span id="cb337-2683"><a href="#cb337-2683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2684"><a href="#cb337-2684" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2685"><a href="#cb337-2685" aria-hidden="true" tabindex="-1"></a>\text{Rate} =  \frac{\text{Number of events}}{\text{Person-time at risk}}</span>
<span id="cb337-2686"><a href="#cb337-2686" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2687"><a href="#cb337-2687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2688"><a href="#cb337-2688" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Rate is the number of new cases of an outcome to the total time a population is at risk.</span>
<span id="cb337-2689"><a href="#cb337-2689" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Longitudinal studies can have variable follow-up time.</span>
<span id="cb337-2690"><a href="#cb337-2690" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Rates incorporate time to the event and take account of how long each person was observed for.</span>
<span id="cb337-2691"><a href="#cb337-2691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2692"><a href="#cb337-2692" aria-hidden="true" tabindex="-1"></a>**Rate of CVD in the Oxford Study**</span>
<span id="cb337-2693"><a href="#cb337-2693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2694"><a href="#cb337-2694" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1000 participants in the Oxford Study</span>
<span id="cb337-2695"><a href="#cb337-2695" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>400 develop CVD</span>
<span id="cb337-2696"><a href="#cb337-2696" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Follow-up was 10 years (137052 person-years)</span>
<span id="cb337-2697"><a href="#cb337-2697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2698"><a href="#cb337-2698" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2699"><a href="#cb337-2699" aria-hidden="true" tabindex="-1"></a>\text{rate} =  \frac{\text{Number of cases of CVD}}{\text{Person - time at risk}} = \frac{400}{137052} = .0029</span>
<span id="cb337-2700"><a href="#cb337-2700" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2701"><a href="#cb337-2701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2702"><a href="#cb337-2702" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2703"><a href="#cb337-2703" aria-hidden="true" tabindex="-1"></a>\text{rate} = (0.0029)*1000 = 2.9</span>
<span id="cb337-2704"><a href="#cb337-2704" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2705"><a href="#cb337-2705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2706"><a href="#cb337-2706" aria-hidden="true" tabindex="-1"></a>**The rate of CVD in the Oxford Study is 2.9 per 1000 person years**</span>
<span id="cb337-2707"><a href="#cb337-2707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2708"><a href="#cb337-2708" aria-hidden="true" tabindex="-1"></a>Calculate the overall risk of death by using a combination of <span class="in">`table()`</span> and <span class="in">`prop.table()`</span> commands:</span>
<span id="cb337-2709"><a href="#cb337-2709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2710"><a href="#cb337-2710" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-2711"><a href="#cb337-2711" aria-hidden="true" tabindex="-1"></a><span class="in">table(df$death)</span></span>
<span id="cb337-2712"><a href="#cb337-2712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2713"><a href="#cb337-2713" aria-hidden="true" tabindex="-1"></a><span class="in">prop.table(table(df$death))</span></span>
<span id="cb337-2714"><a href="#cb337-2714" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2715"><a href="#cb337-2715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2716"><a href="#cb337-2716" aria-hidden="true" tabindex="-1"></a>Examine the pattern of **risk** of death in relation to increasing age. The margins option in the <span class="in">`prop.table()`</span> command needs to be set to "2" because we want to report the proportions per group. For example, for age and death, this command would be:</span>
<span id="cb337-2717"><a href="#cb337-2717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2718"><a href="#cb337-2718" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-2719"><a href="#cb337-2719" aria-hidden="true" tabindex="-1"></a><span class="in">table(df$age_grp, df$death)</span></span>
<span id="cb337-2720"><a href="#cb337-2720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2721"><a href="#cb337-2721" aria-hidden="true" tabindex="-1"></a><span class="in">prop.table(table(df$age_grp, df$death), margins=2)</span></span>
<span id="cb337-2722"><a href="#cb337-2722" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2723"><a href="#cb337-2723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2724"><a href="#cb337-2724" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question C1.1a.i:</span></span>
<span id="cb337-2725"><a href="#cb337-2725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2726"><a href="#cb337-2726" aria-hidden="true" tabindex="-1"></a>**What does your table suggest about the risk of death overall?**</span>
<span id="cb337-2727"><a href="#cb337-2727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2730"><a href="#cb337-2730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2731"><a href="#cb337-2731" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>death)</span>
<span id="cb337-2732"><a href="#cb337-2732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2733"><a href="#cb337-2733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2736"><a href="#cb337-2736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2737"><a href="#cb337-2737" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(whitehall<span class="sc">$</span>death))</span>
<span id="cb337-2738"><a href="#cb337-2738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2739"><a href="#cb337-2739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2740"><a href="#cb337-2740" aria-hidden="true" tabindex="-1"></a>**For this cohort the overall risk of death is 1526/(2801+1526) = 0.3527 or 35.3% over the years of follow up.**</span>
<span id="cb337-2741"><a href="#cb337-2741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2742"><a href="#cb337-2742" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question C1.1a.ii:</span></span>
<span id="cb337-2743"><a href="#cb337-2743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2744"><a href="#cb337-2744" aria-hidden="true" tabindex="-1"></a>**What does your table suggest about the risk death across levels of age?**</span>
<span id="cb337-2745"><a href="#cb337-2745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2748"><a href="#cb337-2748" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2749"><a href="#cb337-2749" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>age_grp, whitehall<span class="sc">$</span>death)</span>
<span id="cb337-2750"><a href="#cb337-2750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2751"><a href="#cb337-2751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2754"><a href="#cb337-2754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2755"><a href="#cb337-2755" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(whitehall<span class="sc">$</span>age_grp, whitehall<span class="sc">$</span>death), <span class="dv">2</span>)</span>
<span id="cb337-2756"><a href="#cb337-2756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2757"><a href="#cb337-2757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2758"><a href="#cb337-2758" aria-hidden="true" tabindex="-1"></a>**The risk of death appears to increase as age increases.**</span>
<span id="cb337-2759"><a href="#cb337-2759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2760"><a href="#cb337-2760" aria-hidden="true" tabindex="-1"></a>**The epitools R package**</span>
<span id="cb337-2761"><a href="#cb337-2761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2762"><a href="#cb337-2762" aria-hidden="true" tabindex="-1"></a>A good R package to calculate basic epidemiologic analysis is the epitools R package, which includes commands for the design of two-way and multi-way contingency tables and epidemiologic measures, such as risk ratios and odds ratios. You can find more details on the commands included in the epitools R package <span class="co">[</span><span class="ot">here</span><span class="co">](https://cran.r-project.org/web/packages/epitools/epitools.pdf)</span>{target="\"_blank"}.</span>
<span id="cb337-2763"><a href="#cb337-2763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2764"><a href="#cb337-2764" aria-hidden="true" tabindex="-1"></a>Install and load the epitools R package with the following commands:</span>
<span id="cb337-2765"><a href="#cb337-2765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2766"><a href="#cb337-2766" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-2767"><a href="#cb337-2767" aria-hidden="true" tabindex="-1"></a><span class="in">install.packages("epitools")</span></span>
<span id="cb337-2768"><a href="#cb337-2768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2769"><a href="#cb337-2769" aria-hidden="true" tabindex="-1"></a><span class="in">library(epitools)</span></span>
<span id="cb337-2770"><a href="#cb337-2770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2771"><a href="#cb337-2771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2772"><a href="#cb337-2772" aria-hidden="true" tabindex="-1"></a>**`The epitab() command`**</span>
<span id="cb337-2773"><a href="#cb337-2773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2774"><a href="#cb337-2774" aria-hidden="true" tabindex="-1"></a>A good command in R to explore risk and odds ratios is the <span class="in">`epitab()`</span> command from the *epitools* R package. This command is used to produce epidemiological tables with point estimates and CI for risk ratios, and odds ratios.</span>
<span id="cb337-2775"><a href="#cb337-2775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2776"><a href="#cb337-2776" aria-hidden="true" tabindex="-1"></a>The syntax for the command is: <span class="in">`epitab(x, y, method)`</span></span>
<span id="cb337-2777"><a href="#cb337-2777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2778"><a href="#cb337-2778" aria-hidden="true" tabindex="-1"></a>where x is the vector of the exposure, y is the vector of the outcome and method can be either “oddsratio” to calculate an odds ratio or “riskratio” to calculate a risk ratio. This command works with either binary or categorical exposures. For categorical exposures, R uses by default the lowest value of the exposure as the reference category.</span>
<span id="cb337-2779"><a href="#cb337-2779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2780"><a href="#cb337-2780" aria-hidden="true" tabindex="-1"></a>**Using the epitab() command to calculate a risk ratio**</span>
<span id="cb337-2781"><a href="#cb337-2781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2782"><a href="#cb337-2782" aria-hidden="true" tabindex="-1"></a>We want to obtain the risk ratio of mortality for individuals that are current smokers compared to non-smokers. We type the command:</span>
<span id="cb337-2783"><a href="#cb337-2783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2784"><a href="#cb337-2784" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb337-2785"><a href="#cb337-2785" aria-hidden="true" tabindex="-1"></a><span class="in">epitab(x = whitehall$currsmoker, y = whitehall$death, method = "riskratio")</span></span>
<span id="cb337-2786"><a href="#cb337-2786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2787"><a href="#cb337-2787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2788"><a href="#cb337-2788" aria-hidden="true" tabindex="-1"></a>Use the <span class="co">[</span><span class="ot">help file</span><span class="co">](https://cran.r-project.org/web/packages/epitools/epitools.pdf)</span>{target="_blank"} for the <span class="in">`epitab()`</span> command to find out how to obtain an odds ratio.</span>
<span id="cb337-2789"><a href="#cb337-2789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2790"><a href="#cb337-2790" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question C1.1b.i:</span></span>
<span id="cb337-2791"><a href="#cb337-2791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2792"><a href="#cb337-2792" aria-hidden="true" tabindex="-1"></a>**What is the risk ratio and 95% CI of death for individuals that are current smokers compared with individuals that are non-smokers?**</span>
<span id="cb337-2793"><a href="#cb337-2793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2796"><a href="#cb337-2796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2797"><a href="#cb337-2797" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epitools)</span>
<span id="cb337-2798"><a href="#cb337-2798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2799"><a href="#cb337-2799" aria-hidden="true" tabindex="-1"></a>result1 <span class="ot">&lt;-</span>  <span class="fu">epitab</span>(<span class="at">x =</span> whitehall<span class="sc">$</span>currsmoker, <span class="at">y =</span> whitehall<span class="sc">$</span>death, <span class="at">method =</span> <span class="st">"riskratio"</span>)</span>
<span id="cb337-2800"><a href="#cb337-2800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2801"><a href="#cb337-2801" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result1)</span>
<span id="cb337-2802"><a href="#cb337-2802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2803"><a href="#cb337-2803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2804"><a href="#cb337-2804" aria-hidden="true" tabindex="-1"></a>**The risk ratio for death is 1.16 times higher for current smokers compared to non-smokers. The 95% confidence interval around the risk ratio is 1.04-1.30.**</span>
<span id="cb337-2805"><a href="#cb337-2805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2806"><a href="#cb337-2806" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question C1.1b.ii:</span></span>
<span id="cb337-2807"><a href="#cb337-2807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2808"><a href="#cb337-2808" aria-hidden="true" tabindex="-1"></a>**What is the odds ratio for death in individuals that are current smokers vs non-smokers? State and interpret the 95% confidence interval.**</span>
<span id="cb337-2809"><a href="#cb337-2809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2812"><a href="#cb337-2812" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2813"><a href="#cb337-2813" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epitools)</span>
<span id="cb337-2814"><a href="#cb337-2814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2815"><a href="#cb337-2815" aria-hidden="true" tabindex="-1"></a>result2 <span class="ot">&lt;-</span> <span class="fu">epitab</span>(<span class="at">x =</span> whitehall<span class="sc">$</span>currsmoker, <span class="at">y =</span> whitehall<span class="sc">$</span>death, <span class="at">method =</span> <span class="st">"oddsratio"</span>)</span>
<span id="cb337-2816"><a href="#cb337-2816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2817"><a href="#cb337-2817" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result2)</span>
<span id="cb337-2818"><a href="#cb337-2818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2819"><a href="#cb337-2819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2820"><a href="#cb337-2820" aria-hidden="true" tabindex="-1"></a>**The odds ratio for death in current smokers compared to non-smokers is 1.27 with a 95% confidence interval of 1.05-1.52. Or, you could say: "The odds of death in current smokers are 1.27 times those of non-smokers."**</span>
<span id="cb337-2821"><a href="#cb337-2821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2822"><a href="#cb337-2822" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb337-2823"><a href="#cb337-2823" aria-hidden="true" tabindex="-1"></a>**The 95% CI states that there is a 95% chance that the interval containing the true population odds ratio lies between 1.05-1.52. Since this interval does not cross 1, it indicates that there are significantly higher odds death for smokers compared to non-smokers.**</span>
<span id="cb337-2824"><a href="#cb337-2824" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2825"><a href="#cb337-2825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2826"><a href="#cb337-2826" aria-hidden="true" tabindex="-1"></a>**The ‘ir’ command for rates**</span>
<span id="cb337-2827"><a href="#cb337-2827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2828"><a href="#cb337-2828" aria-hidden="true" tabindex="-1"></a>Now let’s have a look at the rate ratio for death in smokers vs non-smokers. This will require the 'rateratio' method in the <span class="in">`epitab()`</span> command.</span>
<span id="cb337-2829"><a href="#cb337-2829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2830"><a href="#cb337-2830" aria-hidden="true" tabindex="-1"></a>Type the following command to produce the rate and rate ratio:</span>
<span id="cb337-2831"><a href="#cb337-2831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2834"><a href="#cb337-2834" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2835"><a href="#cb337-2835" aria-hidden="true" tabindex="-1"></a>death_no_smokers <span class="ot">&lt;-</span> <span class="fu">sum</span>(whitehall<span class="sc">$</span>death[whitehall<span class="sc">$</span>currsmoker<span class="sc">==</span><span class="st">"0"</span>], <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb337-2836"><a href="#cb337-2836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2837"><a href="#cb337-2837" aria-hidden="true" tabindex="-1"></a>death_no_smokers </span>
<span id="cb337-2838"><a href="#cb337-2838" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2839"><a href="#cb337-2839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2842"><a href="#cb337-2842" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2843"><a href="#cb337-2843" aria-hidden="true" tabindex="-1"></a>death_smokers <span class="ot">&lt;-</span> <span class="fu">sum</span>(whitehall<span class="sc">$</span>death[whitehall<span class="sc">$</span>currsmoker<span class="sc">==</span><span class="st">"1"</span>], <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb337-2844"><a href="#cb337-2844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2845"><a href="#cb337-2845" aria-hidden="true" tabindex="-1"></a>death_smokers </span>
<span id="cb337-2846"><a href="#cb337-2846" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2847"><a href="#cb337-2847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2850"><a href="#cb337-2850" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2851"><a href="#cb337-2851" aria-hidden="true" tabindex="-1"></a>fup_no_smoker <span class="ot">&lt;-</span> <span class="fu">sum</span>(whitehall<span class="sc">$</span>fu_years[whitehall<span class="sc">$</span>currsmoker<span class="sc">==</span><span class="st">"0"</span>], <span class="at">na.rm=</span>T)</span>
<span id="cb337-2852"><a href="#cb337-2852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2853"><a href="#cb337-2853" aria-hidden="true" tabindex="-1"></a>fup_no_smoker</span>
<span id="cb337-2854"><a href="#cb337-2854" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2855"><a href="#cb337-2855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2858"><a href="#cb337-2858" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2859"><a href="#cb337-2859" aria-hidden="true" tabindex="-1"></a>fup_smoker <span class="ot">&lt;-</span> <span class="fu">sum</span>(whitehall<span class="sc">$</span>fu_years[whitehall<span class="sc">$</span>currsmoker<span class="sc">==</span><span class="st">"1"</span>], <span class="at">na.rm=</span>T)</span>
<span id="cb337-2860"><a href="#cb337-2860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2861"><a href="#cb337-2861" aria-hidden="true" tabindex="-1"></a>fup_smoker</span>
<span id="cb337-2862"><a href="#cb337-2862" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2863"><a href="#cb337-2863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2866"><a href="#cb337-2866" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-2867"><a href="#cb337-2867" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epitools)</span>
<span id="cb337-2868"><a href="#cb337-2868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2869"><a href="#cb337-2869" aria-hidden="true" tabindex="-1"></a>result3 <span class="ot">&lt;-</span>  <span class="fu">epitab</span>(<span class="at">x=</span><span class="fu">c</span>(death_no_smokers, death_smokers), <span class="at">y=</span> <span class="fu">c</span>(fup_no_smoker, fup_smoker), <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"rateratio"</span>))</span>
<span id="cb337-2870"><a href="#cb337-2870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2871"><a href="#cb337-2871" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result3)</span>
<span id="cb337-2872"><a href="#cb337-2872" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-2873"><a href="#cb337-2873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2874"><a href="#cb337-2874" aria-hidden="true" tabindex="-1"></a>**The rate ratio of death in current vs non-smokers is 1.18. This means the rate of death in current smokers is 1.18 times that of non-smokers. Alternatively, you could say the rate of death in smokers was 18% higher than in non-smokers. The 95% CI is 1.02-1.37. This CI does not cross the null value so we know the rate of death in current smokers is significantly higher than that of non-smokers.**</span>
<span id="cb337-2875"><a href="#cb337-2875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2876"><a href="#cb337-2876" aria-hidden="true" tabindex="-1"></a><span class="fu">## C1.2 The Chi-Square Test and the Test For Trend {#sec-C1.2}</span></span>
<span id="cb337-2877"><a href="#cb337-2877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2878"><a href="#cb337-2878" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false"}</span>
<span id="cb337-2879"><a href="#cb337-2879" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-2880"><a href="#cb337-2880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2881"><a href="#cb337-2881" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-2882"><a href="#cb337-2882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2883"><a href="#cb337-2883" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand the concept of contingency tables (2x2 table, 2xk table, rxc table)</span>
<span id="cb337-2884"><a href="#cb337-2884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2885"><a href="#cb337-2885" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate and interpret a chi-squared test of association</span>
<span id="cb337-2886"><a href="#cb337-2886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2887"><a href="#cb337-2887" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate and interpret a chi-squared test for linear trend in proportions (2xk table)</span>
<span id="cb337-2888"><a href="#cb337-2888" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-2889"><a href="#cb337-2889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2890"><a href="#cb337-2890" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">C1.2 The Chi-Square Test and the Test For Trend</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgm0tmzRh9XlOU7lN?e=0MIWnY)</span>{target="_blank"}</span>
<span id="cb337-2891"><a href="#cb337-2891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2892"><a href="#cb337-2892" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2x2 Contingency Tables</span></span>
<span id="cb337-2893"><a href="#cb337-2893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2894"><a href="#cb337-2894" aria-hidden="true" tabindex="-1"></a>|                 |           | Disease | No Disease | Total |</span>
<span id="cb337-2895"><a href="#cb337-2895" aria-hidden="true" tabindex="-1"></a>|:---------------:|:---------:|:-------:|:----------:|:-----:|</span>
<span id="cb337-2896"><a href="#cb337-2896" aria-hidden="true" tabindex="-1"></a>| Exposure Status |  Exposed  |    a    |     b      |  a+b  |</span>
<span id="cb337-2897"><a href="#cb337-2897" aria-hidden="true" tabindex="-1"></a>| Exposure Status | Unexposed |    c    |     d      |  c+d  |</span>
<span id="cb337-2898"><a href="#cb337-2898" aria-hidden="true" tabindex="-1"></a>|                 |   Total   |   a+c   |    b+d     |   N   |</span>
<span id="cb337-2899"><a href="#cb337-2899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2900"><a href="#cb337-2900" aria-hidden="true" tabindex="-1"></a>: Disease Status {#tbl-first}</span>
<span id="cb337-2901"><a href="#cb337-2901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2902"><a href="#cb337-2902" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Effect of BMI on the Risk of Death {#sec-BMI}</span></span>
<span id="cb337-2903"><a href="#cb337-2903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2904"><a href="#cb337-2904" aria-hidden="true" tabindex="-1"></a>|         |            |   DEATH    |    DEATH    |       |</span>
<span id="cb337-2905"><a href="#cb337-2905" aria-hidden="true" tabindex="-1"></a>|:-------:|:----------:|:----------:|:-----------:|:-----:|</span>
<span id="cb337-2906"><a href="#cb337-2906" aria-hidden="true" tabindex="-1"></a>|         |            |  **Yes**   |   **No**    | Total |</span>
<span id="cb337-2907"><a href="#cb337-2907" aria-hidden="true" tabindex="-1"></a>| **BMI** | ≥25 kg/m2  | 916 (0.21) | 816 (0.19)  | 1732  |</span>
<span id="cb337-2908"><a href="#cb337-2908" aria-hidden="true" tabindex="-1"></a>| **BMI** | <span class="sc">\&lt;</span>25 kg/m2 | 589 (0.14) | 1945 (0.46) | 2534  |</span>
<span id="cb337-2909"><a href="#cb337-2909" aria-hidden="true" tabindex="-1"></a>|         |   Total    |    1505    |    2761     | 4266  |</span>
<span id="cb337-2910"><a href="#cb337-2910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2911"><a href="#cb337-2911" aria-hidden="true" tabindex="-1"></a>: BMI X Death {#tbl-first}</span>
<span id="cb337-2912"><a href="#cb337-2912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2913"><a href="#cb337-2913" aria-hidden="true" tabindex="-1"></a><span class="fu">### Chi-Square Test</span></span>
<span id="cb337-2914"><a href="#cb337-2914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2915"><a href="#cb337-2915" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Chi-squared test allows us to determine if there is a statistically significant difference between the expected and observed frequencies in one or more categories</span>
<span id="cb337-2916"><a href="#cb337-2916" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If expected frequencies differ from the observed frequencies, there may be an association between the two categories.</span>
<span id="cb337-2917"><a href="#cb337-2917" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ho: No association between the BMI groups and death</span>
<span id="cb337-2918"><a href="#cb337-2918" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ha: There is an association between the BMI groups and death</span>
<span id="cb337-2919"><a href="#cb337-2919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2920"><a href="#cb337-2920" aria-hidden="true" tabindex="-1"></a>Ho: the proportion $\pi$ of death is the same in each group</span>
<span id="cb337-2921"><a href="#cb337-2921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2922"><a href="#cb337-2922" aria-hidden="true" tabindex="-1"></a>Ho: $\pi_{{BMI} \geq 25kg/m2} - \pi_{{BMI} &lt; 25kg/m2}$</span>
<span id="cb337-2923"><a href="#cb337-2923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2924"><a href="#cb337-2924" aria-hidden="true" tabindex="-1"></a>Ha: the proportion $\pi$ of death is different</span>
<span id="cb337-2925"><a href="#cb337-2925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2926"><a href="#cb337-2926" aria-hidden="true" tabindex="-1"></a>Ha: $\pi_{{BMI} \geq 25kg/m2} \neq \pi_{{BMI} &lt; 25kg/m2}$</span>
<span id="cb337-2927"><a href="#cb337-2927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2928"><a href="#cb337-2928" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Observed Frequencies for 2x2 Table</span></span>
<span id="cb337-2929"><a href="#cb337-2929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2930"><a href="#cb337-2930" aria-hidden="true" tabindex="-1"></a>|         |            |   DEATH    |   DEATH    |                |</span>
<span id="cb337-2931"><a href="#cb337-2931" aria-hidden="true" tabindex="-1"></a>|:-------:|:----------:|:----------:|:----------:|:--------------:|</span>
<span id="cb337-2932"><a href="#cb337-2932" aria-hidden="true" tabindex="-1"></a>|         |            |  **Yes**   |   **No**   |     Total      |</span>
<span id="cb337-2933"><a href="#cb337-2933" aria-hidden="true" tabindex="-1"></a>| **BMI** | ≥25 kg/m2  |  916 (a)   |  816 (b)   |   1732 (a+b)   |</span>
<span id="cb337-2934"><a href="#cb337-2934" aria-hidden="true" tabindex="-1"></a>| **BMI** | <span class="sc">\&lt;</span>25 kg/m2 |  589 (c)   |  1945 (d)  |   2534 (c+d)   |</span>
<span id="cb337-2935"><a href="#cb337-2935" aria-hidden="true" tabindex="-1"></a>|         |   Total    | 1505 (a+c) | 2761 (b+d) | 4266 (a+b+c+d) |</span>
<span id="cb337-2936"><a href="#cb337-2936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2937"><a href="#cb337-2937" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expected Frequencies for 2x2 Table</span></span>
<span id="cb337-2938"><a href="#cb337-2938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2939"><a href="#cb337-2939" aria-hidden="true" tabindex="-1"></a>The expected frequency for each cell in a 2x2 contingency table is given by:</span>
<span id="cb337-2940"><a href="#cb337-2940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2941"><a href="#cb337-2941" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2942"><a href="#cb337-2942" aria-hidden="true" tabindex="-1"></a>E_{ij} = \frac{\text{Row Total}_i \times \text{Column Total}_j}{\text{Grand Total}}</span>
<span id="cb337-2943"><a href="#cb337-2943" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2944"><a href="#cb337-2944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2945"><a href="#cb337-2945" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-2946"><a href="#cb337-2946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2947"><a href="#cb337-2947" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$E_{ij}$ is the expected frequency for the cell in row $i$ and column $j$.</span>
<span id="cb337-2948"><a href="#cb337-2948" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\text{Row Total}_i$ is the total sum for row $i$.</span>
<span id="cb337-2949"><a href="#cb337-2949" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\text{Column Total}_j$ is the total sum for column $j$.</span>
<span id="cb337-2950"><a href="#cb337-2950" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\text{Grand Total}$ is the total count of all observations in the table.</span>
<span id="cb337-2951"><a href="#cb337-2951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2952"><a href="#cb337-2952" aria-hidden="true" tabindex="-1"></a>|   |   | DEATH | DEATH |   |</span>
<span id="cb337-2953"><a href="#cb337-2953" aria-hidden="true" tabindex="-1"></a>|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|</span>
<span id="cb337-2954"><a href="#cb337-2954" aria-hidden="true" tabindex="-1"></a>|  |  | **Yes** | **No** | Total |</span>
<span id="cb337-2955"><a href="#cb337-2955" aria-hidden="true" tabindex="-1"></a>| **BMI** | ≥25 kg/m2 | $\frac{(a+b)(a+c)}{a+b+c+d}$ | $\frac{(a+b)(b+d)}{a+b+c+d}$ | a+b |</span>
<span id="cb337-2956"><a href="#cb337-2956" aria-hidden="true" tabindex="-1"></a>| **BMI** | <span class="sc">\&lt;</span>25 kg/m2 | $\frac{(c+d)(a+c)}{a+b+c+d}$ | $\frac{(c+d)(b+d)}{a+b+c+d}$ | c+d |</span>
<span id="cb337-2957"><a href="#cb337-2957" aria-hidden="true" tabindex="-1"></a>|  | Total | a+c | b+d | a+b+c+d |</span>
<span id="cb337-2958"><a href="#cb337-2958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2959"><a href="#cb337-2959" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Observed and Expected Frequencies</span></span>
<span id="cb337-2960"><a href="#cb337-2960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2961"><a href="#cb337-2961" aria-hidden="true" tabindex="-1"></a>|         |            |    DEATH    |     DEATH     |       |</span>
<span id="cb337-2962"><a href="#cb337-2962" aria-hidden="true" tabindex="-1"></a>|:-------:|:----------:|:-----------:|:-------------:|:-----:|</span>
<span id="cb337-2963"><a href="#cb337-2963" aria-hidden="true" tabindex="-1"></a>|         |            |   **Yes**   |    **No**     | Total |</span>
<span id="cb337-2964"><a href="#cb337-2964" aria-hidden="true" tabindex="-1"></a>| **BMI** | ≥25 kg/m2  | 916 (*611*) | 816 (*1211*)  | 1732  |</span>
<span id="cb337-2965"><a href="#cb337-2965" aria-hidden="true" tabindex="-1"></a>| **BMI** | <span class="sc">\&lt;</span>25 kg/m2 | 589 (*894*) | 1945 (*1640*) | 2534  |</span>
<span id="cb337-2966"><a href="#cb337-2966" aria-hidden="true" tabindex="-1"></a>|         |   Total    |    1505     |     2761      | 4266  |</span>
<span id="cb337-2967"><a href="#cb337-2967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2968"><a href="#cb337-2968" aria-hidden="true" tabindex="-1"></a>: BMI X Death {#tbl-second}</span>
<span id="cb337-2969"><a href="#cb337-2969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2970"><a href="#cb337-2970" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Chi-Squared Formula</span></span>
<span id="cb337-2971"><a href="#cb337-2971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2972"><a href="#cb337-2972" aria-hidden="true" tabindex="-1"></a>The chi-squared test statistic is calculated as:</span>
<span id="cb337-2973"><a href="#cb337-2973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2974"><a href="#cb337-2974" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2975"><a href="#cb337-2975" aria-hidden="true" tabindex="-1"></a>\chi^2 = \sum \frac{(O_i - E_i)^2}{E_i}</span>
<span id="cb337-2976"><a href="#cb337-2976" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2977"><a href="#cb337-2977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2978"><a href="#cb337-2978" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-2979"><a href="#cb337-2979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2980"><a href="#cb337-2980" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$O_i$ is the observed frequency.</span>
<span id="cb337-2981"><a href="#cb337-2981" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$E_i$ is the expected frequency.</span>
<span id="cb337-2982"><a href="#cb337-2982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2983"><a href="#cb337-2983" aria-hidden="true" tabindex="-1"></a>The chi-squared ($\chi^2$) calculation is as follows:</span>
<span id="cb337-2984"><a href="#cb337-2984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2985"><a href="#cb337-2985" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2986"><a href="#cb337-2986" aria-hidden="true" tabindex="-1"></a>\chi^2 = \frac{(1945 - 1640)^2}{1640} + \frac{(589 - 894)^2}{894} + \frac{(816 - 1121)^2}{1121} + \frac{(916 - 611)^2}{611}</span>
<span id="cb337-2987"><a href="#cb337-2987" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2988"><a href="#cb337-2988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2989"><a href="#cb337-2989" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2990"><a href="#cb337-2990" aria-hidden="true" tabindex="-1"></a>\chi^2 = 395.93</span>
<span id="cb337-2991"><a href="#cb337-2991" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2992"><a href="#cb337-2992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2993"><a href="#cb337-2993" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Degrees of Freedom</span></span>
<span id="cb337-2994"><a href="#cb337-2994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2995"><a href="#cb337-2995" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2996"><a href="#cb337-2996" aria-hidden="true" tabindex="-1"></a>df = (r-1)(c-1)</span>
<span id="cb337-2997"><a href="#cb337-2997" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-2998"><a href="#cb337-2998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2999"><a href="#cb337-2999" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-3000"><a href="#cb337-3000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3001"><a href="#cb337-3001" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$df$ is the degrees of freedom</span>
<span id="cb337-3002"><a href="#cb337-3002" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$r$ is the number of rows</span>
<span id="cb337-3003"><a href="#cb337-3003" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$c$ is the number of columns</span>
<span id="cb337-3004"><a href="#cb337-3004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3005"><a href="#cb337-3005" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-3006"><a href="#cb337-3006" aria-hidden="true" tabindex="-1"></a>df = (2-1)(2-1) = 1</span>
<span id="cb337-3007"><a href="#cb337-3007" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-3008"><a href="#cb337-3008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3009"><a href="#cb337-3009" aria-hidden="true" tabindex="-1"></a><span class="al">![](Picture1.jpg)</span></span>
<span id="cb337-3010"><a href="#cb337-3010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3011"><a href="#cb337-3011" aria-hidden="true" tabindex="-1"></a><span class="al">![](Picture2.png)</span>{#fig-Picture2}</span>
<span id="cb337-3012"><a href="#cb337-3012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3013"><a href="#cb337-3013" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Performing the chi-square test for association</span></span>
<span id="cb337-3014"><a href="#cb337-3014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3015"><a href="#cb337-3015" aria-hidden="true" tabindex="-1"></a>We want to look at the association of age group with fatal CVD. In order to obtain a chi-square test for association, we use the <span class="in">`chisq.test()`</span> command, and the code looks like this: <span class="in">`chisq.test(df$age_grp, df$cvd_death, correct=FALSE)`</span></span>
<span id="cb337-3016"><a href="#cb337-3016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3017"><a href="#cb337-3017" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question C1.2a:</span></span>
<span id="cb337-3018"><a href="#cb337-3018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3019"><a href="#cb337-3019" aria-hidden="true" tabindex="-1"></a>Is there an association between age group and fatal CVD? Just looking at a cross-tabulation table without doing any additional steps, are you able to tell which age groups are different from each other?</span>
<span id="cb337-3020"><a href="#cb337-3020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3023"><a href="#cb337-3023" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3024"><a href="#cb337-3024" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(whitehall<span class="sc">$</span>age_grp, whitehall<span class="sc">$</span>cvd_death, <span class="at">correct=</span><span class="cn">FALSE</span>)</span>
<span id="cb337-3025"><a href="#cb337-3025" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3026"><a href="#cb337-3026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3027"><a href="#cb337-3027" aria-hidden="true" tabindex="-1"></a>The chi-square test statistic is shown below the table and is X2 = 221.6 on 3 df (chi2(3)) which gives a p-value of Pr <span class="sc">\&lt;</span>2.2E-16.</span>
<span id="cb337-3028"><a href="#cb337-3028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3029"><a href="#cb337-3029" aria-hidden="true" tabindex="-1"></a>The p value of the chi-square test is highly significant (p<span class="sc">\&lt;</span>0.001), suggesting that we can reject the null hypothesis that there is no difference in true fatal CVD prevalence across different age groups. While we can observe in the row percentages that fatal CVD prevalence is the highest at older ages, and lowest at younger ages, the chi-square test is a **global** test so it just tells us there is a difference somewhere in the table; it does not tell us which groups are different nor does it tell us about the nature of the association (e.g if it is positive or negative).</span>
<span id="cb337-3030"><a href="#cb337-3030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3031"><a href="#cb337-3031" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test for Linear Trend {#sec-linear}</span></span>
<span id="cb337-3032"><a href="#cb337-3032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3033"><a href="#cb337-3033" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We have been discussing 2x2 contigency table see @tbl-first and @tbl-second. This time if we are interested in seeing if higher levels of BMI increase our risk of death.</span>
<span id="cb337-3034"><a href="#cb337-3034" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can recode our binary variable into four categories to better explore the relationship between BMI and risk of death.</span>
<span id="cb337-3035"><a href="#cb337-3035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3036"><a href="#cb337-3036" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 4x2 Table</span></span>
<span id="cb337-3037"><a href="#cb337-3037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3038"><a href="#cb337-3038" aria-hidden="true" tabindex="-1"></a>|                    |                 |   DEATH    |   DEATH    |       |</span>
<span id="cb337-3039"><a href="#cb337-3039" aria-hidden="true" tabindex="-1"></a>|:------------------:|:---------------:|:----------:|:----------:|:-----:|</span>
<span id="cb337-3040"><a href="#cb337-3040" aria-hidden="true" tabindex="-1"></a>|                    |                 |  **Yes**   |   **No**   | Total |</span>
<span id="cb337-3041"><a href="#cb337-3041" aria-hidden="true" tabindex="-1"></a>| **BMI Categories** |  <span class="sc">\&lt;</span>18.5 kg/m2   | 169 (0.11) | 822 (0.30) |  991  |</span>
<span id="cb337-3042"><a href="#cb337-3042" aria-hidden="true" tabindex="-1"></a>| **BMI Categories** | 18.5-<span class="sc">\&lt;</span>25 kg/m2 | 190 (0.13) | 601(0.22)  |  791  |</span>
<span id="cb337-3043"><a href="#cb337-3043" aria-hidden="true" tabindex="-1"></a>| **BMI Categories** |  25-<span class="sc">\&lt;</span>30 Kg/m2  | 230 (0.15) | 522 (0.19) |  752  |</span>
<span id="cb337-3044"><a href="#cb337-3044" aria-hidden="true" tabindex="-1"></a>| **BMI Categories** |    ≥30 kg/m2    | 916 (0.61) | 816 (0.3)  | 1732  |</span>
<span id="cb337-3045"><a href="#cb337-3045" aria-hidden="true" tabindex="-1"></a>|                    |      Total      |    1505    |    2761    | 4266  |</span>
<span id="cb337-3046"><a href="#cb337-3046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3047"><a href="#cb337-3047" aria-hidden="true" tabindex="-1"></a>: BMI X RISK OF DEATH{#tbl-second}</span>
<span id="cb337-3048"><a href="#cb337-3048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3049"><a href="#cb337-3049" aria-hidden="true" tabindex="-1"></a>If we take a look at the proportions in the table, it would appears that there is a trend where those with higher BMI have a greater risk of death than those a lower BMI.</span>
<span id="cb337-3050"><a href="#cb337-3050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3051"><a href="#cb337-3051" aria-hidden="true" tabindex="-1"></a>And we can see here that it seems that those with the highest level of BMI have 61% risk of death. However, this is just an observation, and we would need to use some statistical test to determine if this observation is true.</span>
<span id="cb337-3052"><a href="#cb337-3052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3053"><a href="#cb337-3053" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The chi-square test for linear trend (Cochran-Armitage) is used to test for trend in proportions</span>
<span id="cb337-3054"><a href="#cb337-3054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3055"><a href="#cb337-3055" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Typically used between a binary variable and an ordinal variable with&nbsp;k&nbsp;categories</span>
<span id="cb337-3056"><a href="#cb337-3056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3057"><a href="#cb337-3057" aria-hidden="true" tabindex="-1"></a>Ho: there is no trend in the proportion of death across BMI categories</span>
<span id="cb337-3058"><a href="#cb337-3058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3059"><a href="#cb337-3059" aria-hidden="true" tabindex="-1"></a>Ha: There. is trend in the proportion of death across BMI categories</span>
<span id="cb337-3060"><a href="#cb337-3060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3061"><a href="#cb337-3061" aria-hidden="true" tabindex="-1"></a>The chi-square test for linear trend (also called the Cochran-Armitage test for linear trend) is obtained using the <span class="in">`prop.trend.test()`</span> command. The setup of this command is: <span class="in">`prop.trend.test(x, n)`</span></span>
<span id="cb337-3062"><a href="#cb337-3062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3063"><a href="#cb337-3063" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-3064"><a href="#cb337-3064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3065"><a href="#cb337-3065" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>x is the number of events per group, and</span>
<span id="cb337-3066"><a href="#cb337-3066" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>n is the total sample size per group</span>
<span id="cb337-3067"><a href="#cb337-3067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3070"><a href="#cb337-3070" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3071"><a href="#cb337-3071" aria-hidden="true" tabindex="-1"></a>death_BMI4cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">169</span>, <span class="dv">190</span>, <span class="dv">230</span>, <span class="dv">916</span>) </span>
<span id="cb337-3072"><a href="#cb337-3072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3073"><a href="#cb337-3073" aria-hidden="true" tabindex="-1"></a>total_BMI4cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">991</span>,  <span class="dv">791</span>,  <span class="dv">752</span>, <span class="dv">1732</span>)</span>
<span id="cb337-3074"><a href="#cb337-3074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3075"><a href="#cb337-3075" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.trend.test</span>( <span class="at">x=</span>death_BMI4cat, <span class="at">n=</span>total_BMI4cat)</span>
<span id="cb337-3076"><a href="#cb337-3076" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3077"><a href="#cb337-3077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3078"><a href="#cb337-3078" aria-hidden="true" tabindex="-1"></a>**We can reject the null hypothesis that there is no linear trend in the proportion of death across the BMI categories**</span>
<span id="cb337-3079"><a href="#cb337-3079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3080"><a href="#cb337-3080" aria-hidden="true" tabindex="-1"></a>*If, we plot a line graph that depicts the relationship of risk of death against Categories of BMI, it will showed that those at the lower levels of BMI have about 15% risk of death as compare to 60% for those in the highest levels of BMI.*</span>
<span id="cb337-3081"><a href="#cb337-3081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3082"><a href="#cb337-3082" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question C1.2b.i:</span></span>
<span id="cb337-3083"><a href="#cb337-3083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3084"><a href="#cb337-3084" aria-hidden="true" tabindex="-1"></a>Obtain the prevalence of prior diabetes in the different groups of BMI. What happens to diabetes prevalence as the BMI group increases?</span>
<span id="cb337-3085"><a href="#cb337-3085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3088"><a href="#cb337-3088" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3089"><a href="#cb337-3089" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp41 <span class="ot">&lt;-</span> <span class="fu">factor</span>(whitehall<span class="sc">$</span>bmi_grp4, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Underweight"</span>, <span class="st">"Normal"</span>, <span class="st">"Overweight"</span>, <span class="st">"Obese"</span>))</span>
<span id="cb337-3090"><a href="#cb337-3090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3091"><a href="#cb337-3091" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(whitehall<span class="sc">$</span>bmi_grp41, whitehall<span class="sc">$</span>prior_t2dm), <span class="dv">1</span>)</span>
<span id="cb337-3092"><a href="#cb337-3092" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3093"><a href="#cb337-3093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3094"><a href="#cb337-3094" aria-hidden="true" tabindex="-1"></a>**The prevalence of diabetes increases from 8% (underweight) to 5% (normal weight) to 8.8% in the group with obesity.**</span>
<span id="cb337-3095"><a href="#cb337-3095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3096"><a href="#cb337-3096" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question C1.2b.ii:</span></span>
<span id="cb337-3097"><a href="#cb337-3097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3098"><a href="#cb337-3098" aria-hidden="true" tabindex="-1"></a>Perform a chi-square test of linear trend. What is the null hypothesis and what do the results of this test suggest?</span>
<span id="cb337-3099"><a href="#cb337-3099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3102"><a href="#cb337-3102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3103"><a href="#cb337-3103" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>bmi_grp41, whitehall<span class="sc">$</span>prior_t2dm)</span>
<span id="cb337-3104"><a href="#cb337-3104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3105"><a href="#cb337-3105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3108"><a href="#cb337-3108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3109"><a href="#cb337-3109" aria-hidden="true" tabindex="-1"></a>t2dm_bmig <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">91</span>, <span class="dv">129</span>, <span class="dv">33</span>)</span>
<span id="cb337-3110"><a href="#cb337-3110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3111"><a href="#cb337-3111" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(whitehall<span class="sc">$</span>bmi_grp41)</span>
<span id="cb337-3112"><a href="#cb337-3112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3113"><a href="#cb337-3113" aria-hidden="true" tabindex="-1"></a>total_bmig <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">1793</span>, <span class="dv">2091</span>, <span class="dv">376</span>)</span>
<span id="cb337-3114"><a href="#cb337-3114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3115"><a href="#cb337-3115" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.trend.test</span>(<span class="at">x =</span> t2dm_bmig , <span class="at">n =</span> total_bmig)</span>
<span id="cb337-3116"><a href="#cb337-3116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3117"><a href="#cb337-3117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3118"><a href="#cb337-3118" aria-hidden="true" tabindex="-1"></a>*The chi-square test for linear trend is obtained using the `prop.trend.test()` command. The chi-square value (for 1 degree of freedom) is 5.8 and the p-value=0.02. There is evidence of a significant linear trend, and we can reject the null hypothesis that there is no association between diabetes status and BMI group.*</span>
<span id="cb337-3119"><a href="#cb337-3119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3120"><a href="#cb337-3120" aria-hidden="true" tabindex="-1"></a><span class="fu">## C1.3 Univariable Logistic Regression {#sec-C1.3}</span></span>
<span id="cb337-3121"><a href="#cb337-3121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3122"><a href="#cb337-3122" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false"}</span>
<span id="cb337-3123"><a href="#cb337-3123" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-3124"><a href="#cb337-3124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3125"><a href="#cb337-3125" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-3126"><a href="#cb337-3126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3127"><a href="#cb337-3127" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate and interpret a logistic regression for a binary exposure variable</span>
<span id="cb337-3128"><a href="#cb337-3128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3129"><a href="#cb337-3129" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate and interpret a logistic regression for a categorical exposure variable</span>
<span id="cb337-3130"><a href="#cb337-3130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3131"><a href="#cb337-3131" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate and interpret a logistic regression for a continuous exposure variable</span>
<span id="cb337-3132"><a href="#cb337-3132" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-3133"><a href="#cb337-3133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3134"><a href="#cb337-3134" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">C1.3a Univariable Logistic Regression</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgm_KjLNhJ6sxFAos?e=hnVcsy)</span>{target="_blank"}</span>
<span id="cb337-3135"><a href="#cb337-3135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3136"><a href="#cb337-3136" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic Regression Models for Binary Exposure</span></span>
<span id="cb337-3137"><a href="#cb337-3137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3138"><a href="#cb337-3138" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Review: Regression Models</span></span>
<span id="cb337-3139"><a href="#cb337-3139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3140"><a href="#cb337-3140" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Describe:** relationship between 2 or more variables, where one of these is the "outcome".</span>
<span id="cb337-3141"><a href="#cb337-3141" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Predict** the value of the outcome for a given value of the "explanatory, exposure" variable.</span>
<span id="cb337-3142"><a href="#cb337-3142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3143"><a href="#cb337-3143" aria-hidden="true" tabindex="-1"></a><span class="al">![](Picture3.jpg)</span>{#fig-Picture3}</span>
<span id="cb337-3144"><a href="#cb337-3144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3145"><a href="#cb337-3145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The scatterplot (@fig-Picture3) describe linear relationship using the following formula: $y = \alpha + \beta x$.</span>
<span id="cb337-3146"><a href="#cb337-3146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3147"><a href="#cb337-3147" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Linear relationship between SBP and BMI: $\text{SBP} = \alpha + \beta\text{BMI}$. $\text{SBP} = 119.1 + 0.46\text{ BMI }$ : Means SBP of 119.1 mmHg when the BMI is 0 and the $\beta$ coefficient for BMI as per 1 unit increase in BMI, SBP increases by 0.46 mmHg.</span>
<span id="cb337-3148"><a href="#cb337-3148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3149"><a href="#cb337-3149" aria-hidden="true" tabindex="-1"></a><span class="al">![](Picture4.jpg)</span>{#fig-Picture4}</span>
<span id="cb337-3150"><a href="#cb337-3150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3151"><a href="#cb337-3151" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>But a linear regression may not be appropriate when the SBP(outcome) is binary (high SBP $\geq$ 120 mmHg and low SBP $&lt;$ 120 mmHg), as seen in @fig-Picture4.</span>
<span id="cb337-3152"><a href="#cb337-3152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3153"><a href="#cb337-3153" aria-hidden="true" tabindex="-1"></a><span class="al">![](Picture6.jpg)</span>{#fig-Picture6}</span>
<span id="cb337-3154"><a href="#cb337-3154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3155"><a href="#cb337-3155" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When the outcome and exposure and **binary** there are only <span class="in">`4 possible values`</span> in the scatterplot @fig-Picture6 between SBP (1 ≥ 120 mmHg and 0 <span class="sc">\&lt;</span> 120 mmHg) and BMI (1 ≥ 25 kg/m2 and 0 if <span class="sc">\&lt;</span> 25 kg/m2). So a <span class="in">`2x2 table`</span> may be more appropriate.</span>
<span id="cb337-3156"><a href="#cb337-3156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3157"><a href="#cb337-3157" aria-hidden="true" tabindex="-1"></a>|         |            |    SBP     |     SBP     |</span>
<span id="cb337-3158"><a href="#cb337-3158" aria-hidden="true" tabindex="-1"></a>|:-------:|:----------:|:----------:|:-----------:|</span>
<span id="cb337-3159"><a href="#cb337-3159" aria-hidden="true" tabindex="-1"></a>|         |            | <span class="sc">\&lt;</span>120 mmHg |  ≥120 mmHg  |</span>
<span id="cb337-3160"><a href="#cb337-3160" aria-hidden="true" tabindex="-1"></a>| **BMI** | <span class="sc">\&lt;</span>25 kg/m2 | 543 (0.30) | 1277 (0.70) |</span>
<span id="cb337-3161"><a href="#cb337-3161" aria-hidden="true" tabindex="-1"></a>| **BMI** | ≥25 kg/m2  | 613 (0.25) | 1833 (0.75) |</span>
<span id="cb337-3162"><a href="#cb337-3162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3163"><a href="#cb337-3163" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Statistical models based on proportions can be problematic because the proportions are constrained to lie between 0 and 1.</span>
<span id="cb337-3164"><a href="#cb337-3164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3165"><a href="#cb337-3165" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Possible Ways to Model a Binary Outcome</span></span>
<span id="cb337-3166"><a href="#cb337-3166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3167"><a href="#cb337-3167" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Proportion** of the outcome in exposed and unexposed <span class="in">`but constrained`</span> to 0 to 1, which posed problematic.</span>
<span id="cb337-3168"><a href="#cb337-3168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3169"><a href="#cb337-3169" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Odds of the outcome in exposed and unexposed <span class="in">`but constrained`</span> from 0 to $\infty$, which is also problematic.</span>
<span id="cb337-3170"><a href="#cb337-3170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3171"><a href="#cb337-3171" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Log odds of the outcome in exposed and unexposed are unconstrained, also spanned from $-\infty$ to $\infty$. Best to use rather than above methods.</span>
<span id="cb337-3172"><a href="#cb337-3172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3173"><a href="#cb337-3173" aria-hidden="true" tabindex="-1"></a>$\text{log(odds)} = \alpha + \beta\text{x}$</span>
<span id="cb337-3174"><a href="#cb337-3174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3175"><a href="#cb337-3175" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>y = log odd of disease</span>
<span id="cb337-3176"><a href="#cb337-3176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3177"><a href="#cb337-3177" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\alpha$ = true intercept (value of y when x = 0)</span>
<span id="cb337-3178"><a href="#cb337-3178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3179"><a href="#cb337-3179" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\beta$ = true slope (the increase in log odds per unit increase in x)</span>
<span id="cb337-3180"><a href="#cb337-3180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3181"><a href="#cb337-3181" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Smoking (Binary exposure): 1= current and 0 = never</span>
<span id="cb337-3182"><a href="#cb337-3182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3183"><a href="#cb337-3183" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Death (Binary outcome): 1= died and 0 = alive</span>
<span id="cb337-3184"><a href="#cb337-3184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3185"><a href="#cb337-3185" aria-hidden="true" tabindex="-1"></a>$\text{log(odds of death)} = \alpha + \beta\text{smoking }$</span>
<span id="cb337-3186"><a href="#cb337-3186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3187"><a href="#cb337-3187" aria-hidden="true" tabindex="-1"></a>$\text{log of disease in the never smokers (unexposed)} = \alpha + \beta(0) = \alpha$</span>
<span id="cb337-3188"><a href="#cb337-3188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3189"><a href="#cb337-3189" aria-hidden="true" tabindex="-1"></a>$\text{log of disease in the current smokers (exposed)} = \alpha + \beta(1) = \alpha + \beta$</span>
<span id="cb337-3190"><a href="#cb337-3190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3191"><a href="#cb337-3191" aria-hidden="true" tabindex="-1"></a>Refer back to @tbl-first, @fig-Picture2 and @sec-BMI.</span>
<span id="cb337-3192"><a href="#cb337-3192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3193"><a href="#cb337-3193" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This time, we are interested in quantifying the strength of association between BMI and the risk of death, as well as the directional effect.</span>
<span id="cb337-3194"><a href="#cb337-3194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3195"><a href="#cb337-3195" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>To run a logistic regression in R, we use the <span class="in">`glm()`</span> command. The set up of the command is: <span class="in">`glm(formula, family, data)`</span></span>
<span id="cb337-3196"><a href="#cb337-3196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3197"><a href="#cb337-3197" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-3198"><a href="#cb337-3198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3199"><a href="#cb337-3199" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>formula has the format <span class="in">`outcome ~ exposure`</span>,</span>
<span id="cb337-3200"><a href="#cb337-3200" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>family is <span class="in">`binomial(link = “logit”)`</span> for logistic regression, and</span>
<span id="cb337-3201"><a href="#cb337-3201" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>data corresponds to the dataframe including our data.</span>
<span id="cb337-3202"><a href="#cb337-3202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3203"><a href="#cb337-3203" aria-hidden="true" tabindex="-1"></a>To use this command, you need to confirm that your outcome variable is coded as a factor variable. You can find more details on glm() command in <span class="co">[</span><span class="ot">this help file</span><span class="co">](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/glm.html)</span>{target="_blank"}.</span>
<span id="cb337-3204"><a href="#cb337-3204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3205"><a href="#cb337-3205" aria-hidden="true" tabindex="-1"></a>Using the <span class="in">`glm()`</span> command above, the <span class="in">`log OR (Estimate)`</span> and its <span class="in">`standard error (Std. Error)`</span> are printed, and we estimate the <span class="in">`OR`</span> and the <span class="in">`95% confidence intervals`</span> by exponentiating the results with this post-estimation command: <span class="in">`exp(cbind(coef(model), confint(model)))`</span></span>
<span id="cb337-3206"><a href="#cb337-3206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3207"><a href="#cb337-3207" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example:</span></span>
<span id="cb337-3208"><a href="#cb337-3208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3211"><a href="#cb337-3211" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3212"><a href="#cb337-3212" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame representing the table</span></span>
<span id="cb337-3213"><a href="#cb337-3213" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3214"><a href="#cb337-3214" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">c</span>(<span class="st">"≥25 kg/m2"</span>, <span class="st">"&lt;25 kg/m2"</span>, <span class="st">"Total"</span>),</span>
<span id="cb337-3215"><a href="#cb337-3215" aria-hidden="true" tabindex="-1"></a>  <span class="at">DEATH_Yes =</span> <span class="fu">c</span>(<span class="st">"916 (611)"</span>, <span class="st">"589 (894)"</span>, <span class="st">"1505"</span>),</span>
<span id="cb337-3216"><a href="#cb337-3216" aria-hidden="true" tabindex="-1"></a>  <span class="at">DEATH_No =</span> <span class="fu">c</span>(<span class="st">"816 (1211)"</span>, <span class="st">"1945 (1640)"</span>, <span class="st">"2761"</span>),</span>
<span id="cb337-3217"><a href="#cb337-3217" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total =</span> <span class="fu">c</span>(<span class="st">"1732"</span>, <span class="st">"2534"</span>, <span class="st">"4266"</span>)</span>
<span id="cb337-3218"><a href="#cb337-3218" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3219"><a href="#cb337-3219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3220"><a href="#cb337-3220" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span>
<span id="cb337-3221"><a href="#cb337-3221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3222"><a href="#cb337-3222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3223"><a href="#cb337-3223" aria-hidden="true" tabindex="-1"></a>To run logistic regression on this dataset, you'll first need to transform it into a format suitable for analysis. The current dataset contains counts in the form of text (e.g., "916 (611)") and includes a "Total" row that should be excluded. We need to clean this data, extract the numeric values, and set up a binary variable for logistic regression.</span>
<span id="cb337-3224"><a href="#cb337-3224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3227"><a href="#cb337-3227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3228"><a href="#cb337-3228" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3229"><a href="#cb337-3229" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">c</span>(<span class="st">"≥25 kg/m2"</span>, <span class="st">"&lt;25 kg/m2"</span>),</span>
<span id="cb337-3230"><a href="#cb337-3230" aria-hidden="true" tabindex="-1"></a>  <span class="at">DEATH_Yes =</span> <span class="fu">c</span>(<span class="st">"916"</span>, <span class="st">"589"</span>),</span>
<span id="cb337-3231"><a href="#cb337-3231" aria-hidden="true" tabindex="-1"></a>  <span class="at">DEATH_No =</span> <span class="fu">c</span>(<span class="st">"816"</span>, <span class="st">"1945"</span>)</span>
<span id="cb337-3232"><a href="#cb337-3232" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3233"><a href="#cb337-3233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3234"><a href="#cb337-3234" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the count columns to numeric</span></span>
<span id="cb337-3235"><a href="#cb337-3235" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>DEATH_Yes <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>DEATH_Yes)</span>
<span id="cb337-3236"><a href="#cb337-3236" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>DEATH_No <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>DEATH_No)</span>
<span id="cb337-3237"><a href="#cb337-3237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3238"><a href="#cb337-3238" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the data to a long format</span></span>
<span id="cb337-3239"><a href="#cb337-3239" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3240"><a href="#cb337-3240" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">rep</span>(df<span class="sc">$</span>BMI, <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb337-3241"><a href="#cb337-3241" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(df)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(df))),</span>
<span id="cb337-3242"><a href="#cb337-3242" aria-hidden="true" tabindex="-1"></a>  <span class="at">Count =</span> <span class="fu">c</span>(df<span class="sc">$</span>DEATH_Yes, df<span class="sc">$</span>DEATH_No)</span>
<span id="cb337-3243"><a href="#cb337-3243" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3244"><a href="#cb337-3244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3245"><a href="#cb337-3245" aria-hidden="true" tabindex="-1"></a><span class="co"># Run logistic regression</span></span>
<span id="cb337-3246"><a href="#cb337-3246" aria-hidden="true" tabindex="-1"></a>model4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Death <span class="sc">~</span> BMI, <span class="at">data =</span> df_long, <span class="at">family =</span> binomial, <span class="at">weights =</span> Count)</span>
<span id="cb337-3247"><a href="#cb337-3247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3248"><a href="#cb337-3248" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb337-3249"><a href="#cb337-3249" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model4)</span>
<span id="cb337-3250"><a href="#cb337-3250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3251"><a href="#cb337-3251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3252"><a href="#cb337-3252" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**The intercept can be explained as the risk of death or the log risk of death in those with BMI of less than 25 kg/m\^2 and the BMI coefficient, we can estimate that as the log odds ratio of death for those with a BMI of** $\geq$.</span>
<span id="cb337-3253"><a href="#cb337-3253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3254"><a href="#cb337-3254" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**The Second column showed the standard error for the test.**</span>
<span id="cb337-3255"><a href="#cb337-3255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3256"><a href="#cb337-3256" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**The third and fourth column show the Z statistic for the wald test of the parameter estimates and their corresponding p-values.**</span>
<span id="cb337-3257"><a href="#cb337-3257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3258"><a href="#cb337-3258" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**The Z statistic in this model tests the null hypothesis that the true parameter or coefficient equals 0.**</span>
<span id="cb337-3259"><a href="#cb337-3259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3260"><a href="#cb337-3260" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**In this test, the null hypothesis is that the** $\beta$ for BMI is 0. However, given the Z statistic for wald test for BMI and the p-value for BMI, we can sufficiently reject the null hypothesis and conclude that the estimates for BMI is significantly different from 1, given that the p-value is 2e-16.</span>
<span id="cb337-3261"><a href="#cb337-3261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3262"><a href="#cb337-3262" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**However, the results given for R for the logistic regression are given on the log scale, which are terribly meaningful.**</span>
<span id="cb337-3263"><a href="#cb337-3263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3264"><a href="#cb337-3264" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Hence, we have to take the exponent of those estimates to get the odds ratio for BMI.**</span>
<span id="cb337-3265"><a href="#cb337-3265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3268"><a href="#cb337-3268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3269"><a href="#cb337-3269" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model4), <span class="fu">confint</span>(model4)))</span>
<span id="cb337-3270"><a href="#cb337-3270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3271"><a href="#cb337-3271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3272"><a href="#cb337-3272" aria-hidden="true" tabindex="-1"></a>**The odds of death in those with BMI of \&lt; 25 kg/m\^2 is 30%. The odds of dying is 3.71 times higher in those with a BMI of** $\geq$ 25 kg/m2 vs a BMI of <span class="sc">\&lt;</span> 25 kg/m2.</span>
<span id="cb337-3273"><a href="#cb337-3273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3274"><a href="#cb337-3274" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question C1.3a:</span></span>
<span id="cb337-3275"><a href="#cb337-3275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3276"><a href="#cb337-3276" aria-hidden="true" tabindex="-1"></a>**Dichotomise the variable ‘sbp’ into below 140 mmHg and greater than or equal to 140 mmHg. Call this variable “hyperten” to indicate “hypertensive”. Use logistic regression to examine the association of hypertensive on your odds of having prior CVD (‘prior_cvd’). Interpret the output**</span>
<span id="cb337-3277"><a href="#cb337-3277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3278"><a href="#cb337-3278" aria-hidden="true" tabindex="-1"></a>To dichotomise the “sbp” variable, use the following command:</span>
<span id="cb337-3279"><a href="#cb337-3279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3282"><a href="#cb337-3282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3283"><a href="#cb337-3283" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign 0 to "hyperten" where sbp &lt; 140 and sbp is not NA</span></span>
<span id="cb337-3284"><a href="#cb337-3284" aria-hidden="true" tabindex="-1"></a>whitehall[<span class="sc">!</span><span class="fu">is.na</span>(whitehall<span class="sc">$</span>sbp) <span class="sc">&amp;</span> whitehall<span class="sc">$</span>sbp <span class="sc">&lt;</span> <span class="dv">140</span>, <span class="st">"hyperten"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb337-3285"><a href="#cb337-3285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3286"><a href="#cb337-3286" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign 1 to "hyperten" where sbp &gt;= 140 and sbp is not NA</span></span>
<span id="cb337-3287"><a href="#cb337-3287" aria-hidden="true" tabindex="-1"></a>whitehall[<span class="sc">!</span><span class="fu">is.na</span>(whitehall<span class="sc">$</span>sbp) <span class="sc">&amp;</span> whitehall<span class="sc">$</span>sbp <span class="sc">&gt;=</span> <span class="dv">140</span>, <span class="st">"hyperten"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb337-3288"><a href="#cb337-3288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3289"><a href="#cb337-3289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3290"><a href="#cb337-3290" aria-hidden="true" tabindex="-1"></a>To run the logistic regression we use the <span class="in">`glm()`</span> command:</span>
<span id="cb337-3291"><a href="#cb337-3291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3294"><a href="#cb337-3294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3295"><a href="#cb337-3295" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_cvd <span class="sc">~</span> hyperten, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb337-3296"><a href="#cb337-3296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3297"><a href="#cb337-3297" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb337-3298"><a href="#cb337-3298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3299"><a href="#cb337-3299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3300"><a href="#cb337-3300" aria-hidden="true" tabindex="-1"></a>The lnOR (Estimate) and its standard error (Std. Error) are printed, and we estimate the OR and the 95% confidence intervals by exponentiating:</span>
<span id="cb337-3301"><a href="#cb337-3301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3302"><a href="#cb337-3302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb337-3303"><a href="#cb337-3303" aria-hidden="true" tabindex="-1"></a><span class="in">exp(cbind(coef(model), confint(model)))</span></span>
<span id="cb337-3304"><a href="#cb337-3304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3305"><a href="#cb337-3305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3306"><a href="#cb337-3306" aria-hidden="true" tabindex="-1"></a>**The odds of having prior CVD are 1.60 times greater for someone that was hypertensive compared to those who were not (95% CI: 1.38-1.86). This effect is significant (p\&lt;0.001), which means that we can reject the null hypothesis that there is no association between hypertension and prior CVD, and that the odds ratio is equal to 1.**</span>
<span id="cb337-3307"><a href="#cb337-3307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3308"><a href="#cb337-3308" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression with a categorical exposure</span></span>
<span id="cb337-3309"><a href="#cb337-3309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3310"><a href="#cb337-3310" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">C1.3b Univariable Logistic Regression</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgm77cgI8m1uaES9R?e=9poXuT)</span>{target="_blank"}</span>
<span id="cb337-3311"><a href="#cb337-3311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3312"><a href="#cb337-3312" aria-hidden="true" tabindex="-1"></a>We may use the <span class="in">`glm()`</span> command to obtain odds ratios for a categorical variable such as BMI group. By default, the category with the lowest numerical value is treated as reference category.</span>
<span id="cb337-3313"><a href="#cb337-3313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3314"><a href="#cb337-3314" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Research Question</span></span>
<span id="cb337-3315"><a href="#cb337-3315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3316"><a href="#cb337-3316" aria-hidden="true" tabindex="-1"></a>Are categories of BMI (categorical exposure) associated with the risk of death (outcome) ?</span>
<span id="cb337-3317"><a href="#cb337-3317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3318"><a href="#cb337-3318" aria-hidden="true" tabindex="-1"></a>Refer back to the table @tbl-second used for test for linear trend section @sec-linear</span>
<span id="cb337-3319"><a href="#cb337-3319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3322"><a href="#cb337-3322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3323"><a href="#cb337-3323" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3324"><a href="#cb337-3324" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">c</span>(<span class="st">"&lt;18.5 kg/m2"</span>, <span class="st">"18.5-&lt;25 kg/m2"</span>, <span class="st">"25-&lt;30 kg/m2"</span>, <span class="st">"≥30 kg/m2"</span>),</span>
<span id="cb337-3325"><a href="#cb337-3325" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death_Yes =</span> <span class="fu">c</span>(<span class="dv">169</span>, <span class="dv">190</span>, <span class="dv">230</span>, <span class="dv">916</span>),</span>
<span id="cb337-3326"><a href="#cb337-3326" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death_No =</span> <span class="fu">c</span>(<span class="dv">822</span>, <span class="dv">601</span>, <span class="dv">522</span>, <span class="dv">816</span>)</span>
<span id="cb337-3327"><a href="#cb337-3327" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3328"><a href="#cb337-3328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3329"><a href="#cb337-3329" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape to long format for logistic regression</span></span>
<span id="cb337-3330"><a href="#cb337-3330" aria-hidden="true" tabindex="-1"></a>df_long1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3331"><a href="#cb337-3331" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">rep</span>(df1<span class="sc">$</span>BMI, <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb337-3332"><a href="#cb337-3332" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(df1)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(df1))),</span>
<span id="cb337-3333"><a href="#cb337-3333" aria-hidden="true" tabindex="-1"></a>  <span class="at">Count =</span> <span class="fu">c</span>(df1<span class="sc">$</span>Death_Yes, df1<span class="sc">$</span>Death_No)</span>
<span id="cb337-3334"><a href="#cb337-3334" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3335"><a href="#cb337-3335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3336"><a href="#cb337-3336" aria-hidden="true" tabindex="-1"></a>df_long1<span class="sc">$</span>BMI_ordinal <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_long1<span class="sc">$</span>BMI)</span>
<span id="cb337-3337"><a href="#cb337-3337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3338"><a href="#cb337-3338" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic regression model</span></span>
<span id="cb337-3339"><a href="#cb337-3339" aria-hidden="true" tabindex="-1"></a>model5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Death <span class="sc">~</span> BMI, <span class="at">data =</span> df_long1, <span class="at">family =</span> binomial, <span class="at">weights =</span> Count)</span>
<span id="cb337-3340"><a href="#cb337-3340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3341"><a href="#cb337-3341" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the model summary</span></span>
<span id="cb337-3342"><a href="#cb337-3342" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model5)</span>
<span id="cb337-3343"><a href="#cb337-3343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3344"><a href="#cb337-3344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3345"><a href="#cb337-3345" aria-hidden="true" tabindex="-1"></a>**Unlike the previous example, where we fit BMI as a binary variable. We have 3 variables in the model that relate to BMI. So these BMI variables are known as INDICATOR variables, and they are coded as 0 and 1. And each of these variables are comparing the log odds ratio of death to the reference group of BMI, which is the BMI \&lt; 18.5 kg/m2.**</span>
<span id="cb337-3346"><a href="#cb337-3346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3347"><a href="#cb337-3347" aria-hidden="true" tabindex="-1"></a>**The intercept is the log odds of death in the unexposed group, so that would be the log odds of death in those with BMI category of 0, which is the reference group for the 4 levels variable of BMI.**</span>
<span id="cb337-3348"><a href="#cb337-3348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3349"><a href="#cb337-3349" aria-hidden="true" tabindex="-1"></a>The next code will help analyze the results in a form of odds ratio rather than log odds ratio for better interpretation:</span>
<span id="cb337-3350"><a href="#cb337-3350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3353"><a href="#cb337-3353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3354"><a href="#cb337-3354" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model5), <span class="fu">confint</span>(model5)))</span>
<span id="cb337-3355"><a href="#cb337-3355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3356"><a href="#cb337-3356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3357"><a href="#cb337-3357" aria-hidden="true" tabindex="-1"></a>**HOW DO WE INTERPRET THESE ODDS RATIO ?**</span>
<span id="cb337-3358"><a href="#cb337-3358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3359"><a href="#cb337-3359" aria-hidden="true" tabindex="-1"></a>For instance, those with a BMI of 25-<span class="sc">\&lt;</span>30 kg/m2, they have a 2.14 times higher odds of death than those with a BMI of <span class="sc">\&lt;</span> 18.5 kg/m2. Those with the BMI of $\geq$ 30 kg/m2 have a 5.5 times higher odds of death than those with a BMI of <span class="sc">\&lt;</span> 18.5 kg/m2.</span>
<span id="cb337-3360"><a href="#cb337-3360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3363"><a href="#cb337-3363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3364"><a href="#cb337-3364" aria-hidden="true" tabindex="-1"></a>model6 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_cvd <span class="sc">~</span> bmi_grp41, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb337-3365"><a href="#cb337-3365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3366"><a href="#cb337-3366" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model6)</span>
<span id="cb337-3367"><a href="#cb337-3367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3368"><a href="#cb337-3368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3369"><a href="#cb337-3369" aria-hidden="true" tabindex="-1"></a>Odd ratios in a logistic regression with a categorical variable are interpreted as the odds of the outcome in the specified level compared with a baseline level. The constant refers to the odds of the outcome in the baseline category. We estimate the OR and the 95% confidence intervals by exponentiating:</span>
<span id="cb337-3370"><a href="#cb337-3370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3373"><a href="#cb337-3373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3374"><a href="#cb337-3374" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model6), <span class="fu">confint</span>(model6)))</span>
<span id="cb337-3375"><a href="#cb337-3375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3376"><a href="#cb337-3376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3377"><a href="#cb337-3377" aria-hidden="true" tabindex="-1"></a>Here, the odds of having prior CVD are 36% higher if a participant has obesity compared to if they have a normal weight (OR:1.39, 95% CI:0.71-2.95). This association is not statistically significant (p=0.40) so we cannot reject the null hypothesis that the OR of obese vs normal weight is 1.</span>
<span id="cb337-3378"><a href="#cb337-3378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3379"><a href="#cb337-3379" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression with an ordered categorical exposure</span></span>
<span id="cb337-3380"><a href="#cb337-3380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3381"><a href="#cb337-3381" aria-hidden="true" tabindex="-1"></a>We can use the logistic command to obtain an odds ratio and a linear trend test for an ordered categorical variable such as BMI group. For this reason, we should tell R that our exposure variable is to be treated as a continuous variable rather than as a categorical variable. We achieve that using the <span class="in">`as.numeric()`</span> command in the formula.</span>
<span id="cb337-3382"><a href="#cb337-3382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3383"><a href="#cb337-3383" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Research Question</span></span>
<span id="cb337-3384"><a href="#cb337-3384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3385"><a href="#cb337-3385" aria-hidden="true" tabindex="-1"></a>Are higher levels of BMI (ordered categorical exposure) associated with the risk of death (outcome) ?</span>
<span id="cb337-3386"><a href="#cb337-3386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3387"><a href="#cb337-3387" aria-hidden="true" tabindex="-1"></a>Refer back to the table @tbl-second used for test for linear trend section @sec-linear</span>
<span id="cb337-3388"><a href="#cb337-3388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3389"><a href="#cb337-3389" aria-hidden="true" tabindex="-1"></a>This is similar to the linear trend test @sec-linear, we want to assess whether there is a linear association between BMI categories with the risk of death. We will be using logistic regression model.</span>
<span id="cb337-3390"><a href="#cb337-3390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3391"><a href="#cb337-3391" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-3392"><a href="#cb337-3392" aria-hidden="true" tabindex="-1"></a>\text{log odds}=\alpha+\beta\text{BMI4cat}</span>
<span id="cb337-3393"><a href="#cb337-3393" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-3394"><a href="#cb337-3394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3395"><a href="#cb337-3395" aria-hidden="true" tabindex="-1"></a>$\beta\text{BMI4cat}$ = log OR per unit increase in BMI categories.</span>
<span id="cb337-3396"><a href="#cb337-3396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3397"><a href="#cb337-3397" aria-hidden="true" tabindex="-1"></a>A unit increase is given by: <span class="sc">\&lt;</span> 18.5 (1, ref) vs 18.5-<span class="sc">\&lt;</span>25 kg/m2 (2), or 18.5-<span class="sc">\&lt;</span>25(2) vs 25-<span class="sc">\&lt;</span>30 kg/m2 (3), or 25-<span class="sc">\&lt;</span>30 (3) vs <span class="sc">\&gt;</span>= 30 kg/m2 (4)</span>
<span id="cb337-3398"><a href="#cb337-3398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3399"><a href="#cb337-3399" aria-hidden="true" tabindex="-1"></a>We can perform logistic regression treating our categorical BMI variable as continuous.</span>
<span id="cb337-3400"><a href="#cb337-3400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3403"><a href="#cb337-3403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3404"><a href="#cb337-3404" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3405"><a href="#cb337-3405" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">c</span>(<span class="st">"&lt;18.5 kg/m2"</span>, <span class="st">"18.5-&lt;25 kg/m2"</span>, <span class="st">"25-&lt;30 kg/m2"</span>, <span class="st">"≥30 kg/m2"</span>),</span>
<span id="cb337-3406"><a href="#cb337-3406" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death_Yes =</span> <span class="fu">c</span>(<span class="dv">169</span>, <span class="dv">190</span>, <span class="dv">230</span>, <span class="dv">916</span>),</span>
<span id="cb337-3407"><a href="#cb337-3407" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death_No =</span> <span class="fu">c</span>(<span class="dv">822</span>, <span class="dv">601</span>, <span class="dv">522</span>, <span class="dv">816</span>)</span>
<span id="cb337-3408"><a href="#cb337-3408" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3409"><a href="#cb337-3409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3410"><a href="#cb337-3410" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape to long format for logistic regression</span></span>
<span id="cb337-3411"><a href="#cb337-3411" aria-hidden="true" tabindex="-1"></a>df_long1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3412"><a href="#cb337-3412" aria-hidden="true" tabindex="-1"></a>  <span class="at">BMI =</span> <span class="fu">rep</span>(df1<span class="sc">$</span>BMI, <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb337-3413"><a href="#cb337-3413" aria-hidden="true" tabindex="-1"></a>  <span class="at">Death =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(df1)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(df1))),</span>
<span id="cb337-3414"><a href="#cb337-3414" aria-hidden="true" tabindex="-1"></a>  <span class="at">Count =</span> <span class="fu">c</span>(df1<span class="sc">$</span>Death_Yes, df1<span class="sc">$</span>Death_No)</span>
<span id="cb337-3415"><a href="#cb337-3415" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3416"><a href="#cb337-3416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3417"><a href="#cb337-3417" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert BMI to an ordered factor and then to numeric for ordinal regression</span></span>
<span id="cb337-3418"><a href="#cb337-3418" aria-hidden="true" tabindex="-1"></a>df_long1<span class="sc">$</span>BMI <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_long1<span class="sc">$</span>BMI, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"&lt;18.5 kg/m2"</span>, <span class="st">"18.5-&lt;25 kg/m2"</span>, <span class="st">"25-&lt;30 kg/m2"</span>, <span class="st">"≥30 kg/m2"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb337-3419"><a href="#cb337-3419" aria-hidden="true" tabindex="-1"></a>df_long1<span class="sc">$</span>BMI_ordinal <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_long1<span class="sc">$</span>BMI)</span>
<span id="cb337-3420"><a href="#cb337-3420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3421"><a href="#cb337-3421" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic regression model</span></span>
<span id="cb337-3422"><a href="#cb337-3422" aria-hidden="true" tabindex="-1"></a>model7 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Death <span class="sc">~</span> BMI_ordinal, <span class="at">data =</span> df_long1, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">weights =</span> Count)</span>
<span id="cb337-3423"><a href="#cb337-3423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3424"><a href="#cb337-3424" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the model</span></span>
<span id="cb337-3425"><a href="#cb337-3425" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model7)</span>
<span id="cb337-3426"><a href="#cb337-3426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3427"><a href="#cb337-3427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3428"><a href="#cb337-3428" aria-hidden="true" tabindex="-1"></a>We can see that per 1 unit increase across the categorical variables, the log OR is 0.59.</span>
<span id="cb337-3429"><a href="#cb337-3429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3430"><a href="#cb337-3430" aria-hidden="true" tabindex="-1"></a>We need to convert the log OR to odds ratio.</span>
<span id="cb337-3431"><a href="#cb337-3431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3434"><a href="#cb337-3434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3435"><a href="#cb337-3435" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model7), <span class="fu">confint</span>(model7)))</span>
<span id="cb337-3436"><a href="#cb337-3436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3437"><a href="#cb337-3437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3438"><a href="#cb337-3438" aria-hidden="true" tabindex="-1"></a>**How do we interpret an OR of 1.80 for BMI?**</span>
<span id="cb337-3439"><a href="#cb337-3439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3440"><a href="#cb337-3440" aria-hidden="true" tabindex="-1"></a>OR=1.80 for 18.5-<span class="sc">\&lt;</span>25 versus <span class="sc">\&lt;</span> 18.5 kg/m2 OR=1.80 for 25-<span class="sc">\&lt;</span>30 versus 18.5-<span class="sc">\&lt;</span>25 kg/m2 OR=1.80 for <span class="sc">\&gt;</span>= 30 versus 25-<span class="sc">\&lt;</span>30 kg/m2</span>
<span id="cb337-3441"><a href="#cb337-3441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3442"><a href="#cb337-3442" aria-hidden="true" tabindex="-1"></a>It can be interpreted as Per one unit increase in BMI categories, the OR for death is 1.80.</span>
<span id="cb337-3443"><a href="#cb337-3443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3444"><a href="#cb337-3444" aria-hidden="true" tabindex="-1"></a>After obtaining our odds ratio, we wants to determine whether BMI as an ordinal variable is significant or not.</span>
<span id="cb337-3445"><a href="#cb337-3445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3446"><a href="#cb337-3446" aria-hidden="true" tabindex="-1"></a>The wald test null hypothesis is equivalent to the chi-squared test for linear trend.</span>
<span id="cb337-3447"><a href="#cb337-3447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3448"><a href="#cb337-3448" aria-hidden="true" tabindex="-1"></a>The wald test null hypothesis is that there is no association between BMI categories ion death (i.e linear trend OR=1). In our alternative hypothesis, it states that there is an increasing or decreasing linear trend.</span>
<span id="cb337-3449"><a href="#cb337-3449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3450"><a href="#cb337-3450" aria-hidden="true" tabindex="-1"></a>In the test, we can see that our Z-value or our wald test is 19.32 and we have p-value of 2e-16, so we have sufficient evidence the null hypothesis and we can interpret these values as there is a statistically significant increasing trend in the log odds of death with linear trend odds ratio of 1.8 and that is significantly different to 1.</span>
<span id="cb337-3451"><a href="#cb337-3451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3454"><a href="#cb337-3454" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3455"><a href="#cb337-3455" aria-hidden="true" tabindex="-1"></a>model8 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_cvd <span class="sc">~</span> <span class="fu">as.numeric</span>(bmi_grp41), <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb337-3456"><a href="#cb337-3456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3457"><a href="#cb337-3457" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model8)</span>
<span id="cb337-3458"><a href="#cb337-3458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3459"><a href="#cb337-3459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3460"><a href="#cb337-3460" aria-hidden="true" tabindex="-1"></a>Note that the Wald test here is equivalent to the chi-square test for linear trend @sec-linear. The null hypothesis is that there is no association between BMI group and prior CVD (i.e. that the linear trend OR equals 1), and the alternative hypothesis is that there is a linear increasing or decreasing trend. Here, the p-value (p=0.07) indicates that there is not evidence against the null hypothesis (although this is a borderline significant p-value) and we conclude that there is not a statistically significant increasing trend in log odds of prior CVD across groups of BMI.</span>
<span id="cb337-3461"><a href="#cb337-3461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3462"><a href="#cb337-3462" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question C1.3bi.:</span></span>
<span id="cb337-3463"><a href="#cb337-3463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3464"><a href="#cb337-3464" aria-hidden="true" tabindex="-1"></a>Use logistic regression to obtain odds ratios for the association of BMI group on prior diabetes. Try fitting this variable both as a categorical variable and as a linear trend.</span>
<span id="cb337-3465"><a href="#cb337-3465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3468"><a href="#cb337-3468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3469"><a href="#cb337-3469" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>bmi_grp41 <span class="ot">&lt;-</span> <span class="fu">relevel</span>(whitehall<span class="sc">$</span>bmi_grp41, <span class="at">ref =</span> <span class="st">"Normal"</span>)</span>
<span id="cb337-3470"><a href="#cb337-3470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3471"><a href="#cb337-3471" aria-hidden="true" tabindex="-1"></a>model9 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_t2dm <span class="sc">~</span> bmi_grp41, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb337-3472"><a href="#cb337-3472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3473"><a href="#cb337-3473" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model9)</span>
<span id="cb337-3474"><a href="#cb337-3474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3475"><a href="#cb337-3475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3476"><a href="#cb337-3476" aria-hidden="true" tabindex="-1"></a>Just to note that the reference group in the model is those with a normal weight. We can estimate the different ORs and their corresponding the 95% confidence intervals from the model by taking the exponential:</span>
<span id="cb337-3477"><a href="#cb337-3477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3480"><a href="#cb337-3480" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3481"><a href="#cb337-3481" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model9), <span class="fu">confint</span>(model9)))</span>
<span id="cb337-3482"><a href="#cb337-3482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3483"><a href="#cb337-3483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3484"><a href="#cb337-3484" aria-hidden="true" tabindex="-1"></a>The odds ratio of prior diabetes for underweight vs normal weight (as BMI group 2 is the reference group) is 1.63 (95% CI: 0.50-4.11). The z-statistic for this odds ratio is 0.91 and p=0.360 so this odds ratio is not significantly different to 1.</span>
<span id="cb337-3485"><a href="#cb337-3485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3486"><a href="#cb337-3486" aria-hidden="true" tabindex="-1"></a>The odds ratio for overweight vs normal weight is 1.23 (95% CI: 0.93-1.62). The z-statistic for this odds ratio is 1.47 and p=0.142 so this odds ratio is not significantly different to 1.</span>
<span id="cb337-3487"><a href="#cb337-3487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3488"><a href="#cb337-3488" aria-hidden="true" tabindex="-1"></a>Finally, the odds ratio for obese vs normal weight is 1.80 (95% CI: 1.17-2.70). The z-statistic for this odds ratio is 2.78 and p=0.006 so this odds ratio is significantly different to 1.</span>
<span id="cb337-3489"><a href="#cb337-3489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3490"><a href="#cb337-3490" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression with a continuous exposure</span></span>
<span id="cb337-3491"><a href="#cb337-3491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3492"><a href="#cb337-3492" aria-hidden="true" tabindex="-1"></a>To fit a logistic regression with a continuous exposure, we type the variable as it is (with no prefix) and we interpret the OR in terms of a 1-unit change in the exposure:</span>
<span id="cb337-3493"><a href="#cb337-3493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3496"><a href="#cb337-3496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3497"><a href="#cb337-3497" aria-hidden="true" tabindex="-1"></a>model10 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_cvd <span class="sc">~</span> hdlc, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb337-3498"><a href="#cb337-3498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3499"><a href="#cb337-3499" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model10)</span>
<span id="cb337-3500"><a href="#cb337-3500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3501"><a href="#cb337-3501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3502"><a href="#cb337-3502" aria-hidden="true" tabindex="-1"></a>We estimate the OR and the 95% confidence intervals by exponentiating:</span>
<span id="cb337-3503"><a href="#cb337-3503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3506"><a href="#cb337-3506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3507"><a href="#cb337-3507" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model10), <span class="fu">confint</span>(model10)))</span>
<span id="cb337-3508"><a href="#cb337-3508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3509"><a href="#cb337-3509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3510"><a href="#cb337-3510" aria-hidden="true" tabindex="-1"></a>**The odds of having prior CVD were 51% lower for each 1 unit increase in HDL-C (OR: 0.49, 95%CI: 0.40-0.59). This association was statistically significant.**</span>
<span id="cb337-3511"><a href="#cb337-3511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3512"><a href="#cb337-3512" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question C1.3b.ii:</span></span>
<span id="cb337-3513"><a href="#cb337-3513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3514"><a href="#cb337-3514" aria-hidden="true" tabindex="-1"></a>**Use logistic regression to assess the association between ‘prior_t2dm’ and the continuous exposure variable ‘hdlc’. How would you interpret this output?**</span>
<span id="cb337-3515"><a href="#cb337-3515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3518"><a href="#cb337-3518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3519"><a href="#cb337-3519" aria-hidden="true" tabindex="-1"></a>model11 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_t2dm <span class="sc">~</span> hdlc, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb337-3520"><a href="#cb337-3520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3521"><a href="#cb337-3521" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model11)</span>
<span id="cb337-3522"><a href="#cb337-3522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3523"><a href="#cb337-3523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3526"><a href="#cb337-3526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3527"><a href="#cb337-3527" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model11), <span class="fu">confint</span>(model11)))</span>
<span id="cb337-3528"><a href="#cb337-3528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3529"><a href="#cb337-3529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3530"><a href="#cb337-3530" aria-hidden="true" tabindex="-1"></a>**For every 1 unit increase in HDL-C, the odds of having prior diabetes were 54% lower (OR: 0.46 95% CI: 0.32-0.67). This association is statistically significant (p\&lt;0.001) so we can reject the null hypothesis that there is no association of HDL-C with prior diabetes.**</span>
<span id="cb337-3531"><a href="#cb337-3531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3532"><a href="#cb337-3532" aria-hidden="true" tabindex="-1"></a><span class="fu">## C1.4 Multivariable Logistic Regression {#sec-C1.4}</span></span>
<span id="cb337-3533"><a href="#cb337-3533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3534"><a href="#cb337-3534" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false"}</span>
<span id="cb337-3535"><a href="#cb337-3535" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-3536"><a href="#cb337-3536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3537"><a href="#cb337-3537" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-3538"><a href="#cb337-3538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3539"><a href="#cb337-3539" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand the concepts of confounding</span>
<span id="cb337-3540"><a href="#cb337-3540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3541"><a href="#cb337-3541" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use logistic regression to assess for confounding.</span>
<span id="cb337-3542"><a href="#cb337-3542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3543"><a href="#cb337-3543" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Perform a Wald test on an adjusted odds ratio.</span>
<span id="cb337-3544"><a href="#cb337-3544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3545"><a href="#cb337-3545" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Control the association of an exposure for additional variables in a logistic regression model.</span>
<span id="cb337-3546"><a href="#cb337-3546" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-3547"><a href="#cb337-3547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3548"><a href="#cb337-3548" aria-hidden="true" tabindex="-1"></a>You can download a copy of the slides here: <span class="co">[</span><span class="ot">C1.4 Multivariable Logistic Regression</span><span class="co">](https://1drv.ms/p/s!AtvH6PgKXPEDgmzjse6l7obGm4t7?e=YHLEib)</span>{target="_blank"}</span>
<span id="cb337-3549"><a href="#cb337-3549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3550"><a href="#cb337-3550" aria-hidden="true" tabindex="-1"></a><span class="fu">### Controlling for Confounding in Logistic Regression Models</span></span>
<span id="cb337-3551"><a href="#cb337-3551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3552"><a href="#cb337-3552" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Research Question</span></span>
<span id="cb337-3553"><a href="#cb337-3553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3554"><a href="#cb337-3554" aria-hidden="true" tabindex="-1"></a>**Is alcohol consumption associated with the risk of heart disease?**</span>
<span id="cb337-3555"><a href="#cb337-3555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3556"><a href="#cb337-3556" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Effect of Alcohol on Heart Disease {#sec-Alcohol}</span></span>
<span id="cb337-3557"><a href="#cb337-3557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3558"><a href="#cb337-3558" aria-hidden="true" tabindex="-1"></a>|                 |       | Heart Disease | Heart Disease |       |</span>
<span id="cb337-3559"><a href="#cb337-3559" aria-hidden="true" tabindex="-1"></a>|:---------------:|:-----:|:-------------:|:-------------:|:-----:|</span>
<span id="cb337-3560"><a href="#cb337-3560" aria-hidden="true" tabindex="-1"></a>|                 |       |    **No**     |    **Yes**    | Total |</span>
<span id="cb337-3561"><a href="#cb337-3561" aria-hidden="true" tabindex="-1"></a>| **Alcohol Use** |  No   |      815      |      83       |  898  |</span>
<span id="cb337-3562"><a href="#cb337-3562" aria-hidden="true" tabindex="-1"></a>| **Alcohol Use** |  Yes  |     1664      |      328      | 1972  |</span>
<span id="cb337-3563"><a href="#cb337-3563" aria-hidden="true" tabindex="-1"></a>|                 | Total |     2479      |      411      | 2870  |</span>
<span id="cb337-3564"><a href="#cb337-3564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3565"><a href="#cb337-3565" aria-hidden="true" tabindex="-1"></a>: Alcohol Use X Heart Disease {#tbl-third}</span>
<span id="cb337-3566"><a href="#cb337-3566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3569"><a href="#cb337-3569" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3570"><a href="#cb337-3570" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the raw counts in a data frame</span></span>
<span id="cb337-3571"><a href="#cb337-3571" aria-hidden="true" tabindex="-1"></a>df_counts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3572"><a href="#cb337-3572" aria-hidden="true" tabindex="-1"></a>  <span class="at">Alcohol_Use =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb337-3573"><a href="#cb337-3573" aria-hidden="true" tabindex="-1"></a>  <span class="at">Heart_Disease =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb337-3574"><a href="#cb337-3574" aria-hidden="true" tabindex="-1"></a>  <span class="at">Count =</span> <span class="fu">c</span>(<span class="dv">815</span>, <span class="dv">83</span>, <span class="dv">1664</span>, <span class="dv">328</span>)</span>
<span id="cb337-3575"><a href="#cb337-3575" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3576"><a href="#cb337-3576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3577"><a href="#cb337-3577" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand the data frame by repeating rows according to the count</span></span>
<span id="cb337-3578"><a href="#cb337-3578" aria-hidden="true" tabindex="-1"></a>df_expanded <span class="ot">&lt;-</span> df_counts[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_counts), df_counts<span class="sc">$</span>Count), <span class="fu">c</span>(<span class="st">"Alcohol_Use"</span>, <span class="st">"Heart_Disease"</span>)]</span>
<span id="cb337-3579"><a href="#cb337-3579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3580"><a href="#cb337-3580" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a table format</span></span>
<span id="cb337-3581"><a href="#cb337-3581" aria-hidden="true" tabindex="-1"></a>table_df <span class="ot">&lt;-</span> <span class="fu">table</span>(df_expanded<span class="sc">$</span>Alcohol_Use, df_expanded<span class="sc">$</span>Heart_Disease)</span>
<span id="cb337-3582"><a href="#cb337-3582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3583"><a href="#cb337-3583" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Chi-squared test</span></span>
<span id="cb337-3584"><a href="#cb337-3584" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(df_expanded<span class="sc">$</span>Alcohol_Use,  df_expanded<span class="sc">$</span>Heart_Disease,</span>
<span id="cb337-3585"><a href="#cb337-3585" aria-hidden="true" tabindex="-1"></a>           <span class="at">correct=</span>F)</span>
<span id="cb337-3586"><a href="#cb337-3586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3587"><a href="#cb337-3587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3588"><a href="#cb337-3588" aria-hidden="true" tabindex="-1"></a>**From the chi-squared test there is a significant association between the two variables. Although, the chi-squared test indicated that there is a difference between alcohol consumption and heart disease. We need to quantify this estimates. So first, we can run a logistic regression test and you can see this output at the top of this fight**</span>
<span id="cb337-3589"><a href="#cb337-3589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3592"><a href="#cb337-3592" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3593"><a href="#cb337-3593" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the variables to factors for logistic regression</span></span>
<span id="cb337-3594"><a href="#cb337-3594" aria-hidden="true" tabindex="-1"></a>df_expanded<span class="sc">$</span>Alcohol_Use <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_expanded<span class="sc">$</span>Alcohol_Use, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb337-3595"><a href="#cb337-3595" aria-hidden="true" tabindex="-1"></a>df_expanded<span class="sc">$</span>Heart_Disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_expanded<span class="sc">$</span>Heart_Disease, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb337-3596"><a href="#cb337-3596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3597"><a href="#cb337-3597" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the logistic regression model</span></span>
<span id="cb337-3598"><a href="#cb337-3598" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Heart_Disease <span class="sc">~</span> Alcohol_Use, <span class="at">data =</span> df_expanded, <span class="at">family =</span> binomial)</span>
<span id="cb337-3599"><a href="#cb337-3599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3600"><a href="#cb337-3600" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb337-3601"><a href="#cb337-3601" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span>
<span id="cb337-3602"><a href="#cb337-3602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3603"><a href="#cb337-3603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3604"><a href="#cb337-3604" aria-hidden="true" tabindex="-1"></a>**So overall, we can see from the results of this logistic regression that alcohol is significantly associated with heart disease. However, this estimates are on a log scale. So let us take the exponent so we can get the odds ratio**</span>
<span id="cb337-3605"><a href="#cb337-3605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3608"><a href="#cb337-3608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3609"><a href="#cb337-3609" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(m1), <span class="fu">confint</span>(m1)))</span>
<span id="cb337-3610"><a href="#cb337-3610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3611"><a href="#cb337-3611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3612"><a href="#cb337-3612" aria-hidden="true" tabindex="-1"></a>**We can see that the odds of the heart disease is nearly twice as high (OR = 1.94, 95% CI: 1.51-2.51) in those who consume alcohol versus those who do not consume alcohol**</span>
<span id="cb337-3613"><a href="#cb337-3613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3614"><a href="#cb337-3614" aria-hidden="true" tabindex="-1"></a>**ARE THERE POSSIBLE EXPLANATIONS FOR THIS FINDINGS ?**</span>
<span id="cb337-3615"><a href="#cb337-3615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3616"><a href="#cb337-3616" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Possible Explanations</span></span>
<span id="cb337-3617"><a href="#cb337-3617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3618"><a href="#cb337-3618" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Chance** - the z test value of 5.17 gives p<span class="sc">\&lt;</span>0.001, so chance is very unlikely.</span>
<span id="cb337-3619"><a href="#cb337-3619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3620"><a href="#cb337-3620" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Bias** - e.g. reporting bias if people with heart disease are more likely to remember risk behaviours.</span>
<span id="cb337-3621"><a href="#cb337-3621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3622"><a href="#cb337-3622" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Confounding** – that this association is wholly/partly due to another risk factor for heart disease. People who consume alcohol may also be more likely to smoke.</span>
<span id="cb337-3623"><a href="#cb337-3623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3624"><a href="#cb337-3624" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>The association between alcohol use and heart disease is **real**</span>
<span id="cb337-3625"><a href="#cb337-3625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3626"><a href="#cb337-3626" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Confounders</span></span>
<span id="cb337-3627"><a href="#cb337-3627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3628"><a href="#cb337-3628" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A Confounder is a variable that distorts the apparent magnitude of the relationship between an exposure and an outcome.</span>
<span id="cb337-3629"><a href="#cb337-3629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3630"><a href="#cb337-3630" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For a variable to be a confounder, it needs to be:</span>
<span id="cb337-3631"><a href="#cb337-3631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3632"><a href="#cb337-3632" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>a risk factor for the outcome, and</span>
<span id="cb337-3633"><a href="#cb337-3633" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>associated with the exposure and</span>
<span id="cb337-3634"><a href="#cb337-3634" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>not on causal pathway between exposure and outcome.</span>
<span id="cb337-3635"><a href="#cb337-3635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3636"><a href="#cb337-3636" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Smoking is a potential confounder of this association if it is:</span>
<span id="cb337-3637"><a href="#cb337-3637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3638"><a href="#cb337-3638" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>a risk factor for heart disease and</span>
<span id="cb337-3639"><a href="#cb337-3639" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>associated with alcohol consumption.</span>
<span id="cb337-3640"><a href="#cb337-3640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3641"><a href="#cb337-3641" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Effect of Smoking on Heart Disease</span></span>
<span id="cb337-3642"><a href="#cb337-3642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3643"><a href="#cb337-3643" aria-hidden="true" tabindex="-1"></a>To determine if smoking is a risk factor for heart disease, we can perform a logistic regression test to determine if it's associated with heart disease.</span>
<span id="cb337-3644"><a href="#cb337-3644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3647"><a href="#cb337-3647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3648"><a href="#cb337-3648" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with counts for smoking and heart disease</span></span>
<span id="cb337-3649"><a href="#cb337-3649" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3650"><a href="#cb337-3650" aria-hidden="true" tabindex="-1"></a>  <span class="at">smoke =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb337-3651"><a href="#cb337-3651" aria-hidden="true" tabindex="-1"></a>  <span class="at">heart_disease =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb337-3652"><a href="#cb337-3652" aria-hidden="true" tabindex="-1"></a>  <span class="at">count =</span> <span class="fu">c</span>(<span class="dv">1488</span>, <span class="dv">83</span>, <span class="dv">1664</span>, <span class="dv">328</span>)  <span class="co"># These values may need adjusting based on trial and error</span></span>
<span id="cb337-3653"><a href="#cb337-3653" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3654"><a href="#cb337-3654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3655"><a href="#cb337-3655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3656"><a href="#cb337-3656" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand the data frame to use it for logistic regression</span></span>
<span id="cb337-3657"><a href="#cb337-3657" aria-hidden="true" tabindex="-1"></a>df_exp <span class="ot">&lt;-</span> df4[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df4), df4<span class="sc">$</span>count), <span class="fu">c</span>(<span class="st">"smoke"</span>, <span class="st">"heart_disease"</span>)]</span>
<span id="cb337-3658"><a href="#cb337-3658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3659"><a href="#cb337-3659" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'smoke' and 'heart_disease' to factors</span></span>
<span id="cb337-3660"><a href="#cb337-3660" aria-hidden="true" tabindex="-1"></a>df_exp<span class="sc">$</span>smoke <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_exp<span class="sc">$</span>smoke, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb337-3661"><a href="#cb337-3661" aria-hidden="true" tabindex="-1"></a>df_exp<span class="sc">$</span>heart_disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_exp<span class="sc">$</span>heart_disease, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb337-3662"><a href="#cb337-3662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3663"><a href="#cb337-3663" aria-hidden="true" tabindex="-1"></a><span class="co"># Run logistic regression</span></span>
<span id="cb337-3664"><a href="#cb337-3664" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_disease <span class="sc">~</span> smoke, <span class="at">data =</span> df_exp, <span class="at">family =</span> binomial)</span>
<span id="cb337-3665"><a href="#cb337-3665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3666"><a href="#cb337-3666" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb337-3667"><a href="#cb337-3667" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span>
<span id="cb337-3668"><a href="#cb337-3668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3669"><a href="#cb337-3669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3670"><a href="#cb337-3670" aria-hidden="true" tabindex="-1"></a>**We can see from the logistic regression output that smoking is significantly associated with the risk of heart disease, chi-squared test can also be used**</span>
<span id="cb337-3671"><a href="#cb337-3671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3672"><a href="#cb337-3672" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Effect of Smoking on Alcohol Use</span></span>
<span id="cb337-3673"><a href="#cb337-3673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3674"><a href="#cb337-3674" aria-hidden="true" tabindex="-1"></a>Next, we want to see whether smoking is associated with alcohol consumption and this can be achieved by creating 2 x 2 table and perfoming a chi-squared test.</span>
<span id="cb337-3675"><a href="#cb337-3675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3676"><a href="#cb337-3676" aria-hidden="true" tabindex="-1"></a>|                 |       | Smoking | Smoking |       |</span>
<span id="cb337-3677"><a href="#cb337-3677" aria-hidden="true" tabindex="-1"></a>|:---------------:|:-----:|:-------:|:-------:|:-----:|</span>
<span id="cb337-3678"><a href="#cb337-3678" aria-hidden="true" tabindex="-1"></a>|                 |       | **No**  | **Yes** | Total |</span>
<span id="cb337-3679"><a href="#cb337-3679" aria-hidden="true" tabindex="-1"></a>| **Alcohol Use** |  No   |   650   |   83    |  898  |</span>
<span id="cb337-3680"><a href="#cb337-3680" aria-hidden="true" tabindex="-1"></a>| **Alcohol Use** |  Yes  |   838   |  1134   | 1972  |</span>
<span id="cb337-3681"><a href="#cb337-3681" aria-hidden="true" tabindex="-1"></a>|                 | Total |  1488   |  1382   | 2870  |</span>
<span id="cb337-3682"><a href="#cb337-3682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3685"><a href="#cb337-3685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3686"><a href="#cb337-3686" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the raw counts in a data frame</span></span>
<span id="cb337-3687"><a href="#cb337-3687" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3688"><a href="#cb337-3688" aria-hidden="true" tabindex="-1"></a>  <span class="at">Alcohol_Use =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb337-3689"><a href="#cb337-3689" aria-hidden="true" tabindex="-1"></a>  <span class="at">Smoking =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb337-3690"><a href="#cb337-3690" aria-hidden="true" tabindex="-1"></a>  <span class="at">Count =</span> <span class="fu">c</span>(<span class="dv">650</span>, <span class="dv">248</span>, <span class="dv">838</span>, <span class="dv">1134</span>)</span>
<span id="cb337-3691"><a href="#cb337-3691" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3692"><a href="#cb337-3692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3693"><a href="#cb337-3693" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand the data frame by repeating rows according to the count</span></span>
<span id="cb337-3694"><a href="#cb337-3694" aria-hidden="true" tabindex="-1"></a>df_exp2 <span class="ot">&lt;-</span> df5[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df5), df5<span class="sc">$</span>Count), <span class="fu">c</span>(<span class="st">"Alcohol_Use"</span>, <span class="st">"Smoking"</span>)]</span>
<span id="cb337-3695"><a href="#cb337-3695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3696"><a href="#cb337-3696" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a table format</span></span>
<span id="cb337-3697"><a href="#cb337-3697" aria-hidden="true" tabindex="-1"></a>table_df2 <span class="ot">&lt;-</span> <span class="fu">table</span>(df_exp2<span class="sc">$</span>Alcohol_Use, df_exp2<span class="sc">$</span>Smoking)</span>
<span id="cb337-3698"><a href="#cb337-3698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3699"><a href="#cb337-3699" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Chi-squared test</span></span>
<span id="cb337-3700"><a href="#cb337-3700" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(df_exp2<span class="sc">$</span>Alcohol_Use,  df_exp2<span class="sc">$</span>Smoking,</span>
<span id="cb337-3701"><a href="#cb337-3701" aria-hidden="true" tabindex="-1"></a>           <span class="at">correct=</span>F)</span>
<span id="cb337-3702"><a href="#cb337-3702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3703"><a href="#cb337-3703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3704"><a href="#cb337-3704" aria-hidden="true" tabindex="-1"></a>**We can see that the results of the chi-squared test indicate that smoking is significantly associated with alcohol use. As earlier discussed, we determined that smoking was a risk factor for heart disease and it was associated with alcohol use**</span>
<span id="cb337-3705"><a href="#cb337-3705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3706"><a href="#cb337-3706" aria-hidden="true" tabindex="-1"></a>**So since these assumptions have been meet, then, smoking is a potential confounder**</span>
<span id="cb337-3707"><a href="#cb337-3707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3708"><a href="#cb337-3708" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>So we need to take account of smoking as a confounder:</span>
<span id="cb337-3709"><a href="#cb337-3709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3710"><a href="#cb337-3710" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Either at the study design stage:</span>
<span id="cb337-3711"><a href="#cb337-3711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3712"><a href="#cb337-3712" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Randomisation</span>
<span id="cb337-3713"><a href="#cb337-3713" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Restriction</span>
<span id="cb337-3714"><a href="#cb337-3714" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Matching</span>
<span id="cb337-3715"><a href="#cb337-3715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3716"><a href="#cb337-3716" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Or the analysis stage:</span>
<span id="cb337-3717"><a href="#cb337-3717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3718"><a href="#cb337-3718" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stratification</span>
<span id="cb337-3719"><a href="#cb337-3719" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Regression modelling</span>
<span id="cb337-3720"><a href="#cb337-3720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3721"><a href="#cb337-3721" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Failure to account for a confounder means that ORs may be biased</span>
<span id="cb337-3722"><a href="#cb337-3722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3723"><a href="#cb337-3723" aria-hidden="true" tabindex="-1"></a>**In order to control for confounding, we have to use multivariable logistic regression**</span>
<span id="cb337-3724"><a href="#cb337-3724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3725"><a href="#cb337-3725" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Logistic regression models can be extended to include <span class="sc">\&gt;</span>1 explanatory variable.</span>
<span id="cb337-3726"><a href="#cb337-3726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3727"><a href="#cb337-3727" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>By including 2+ explanatory variables in the same model, we are fitting a model in which each explanatory variable is controlled for the other</span>
<span id="cb337-3728"><a href="#cb337-3728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3729"><a href="#cb337-3729" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We may fit multivariable models which include:</span>
<span id="cb337-3730"><a href="#cb337-3730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3731"><a href="#cb337-3731" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*\&gt;2 variables*</span>
<span id="cb337-3732"><a href="#cb337-3732" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*Binary, categorical &amp; continuous (quantitative) variables*</span>
<span id="cb337-3733"><a href="#cb337-3733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3734"><a href="#cb337-3734" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Effect of Alcohol on Heart Disease - Adjusted for Smoking</span></span>
<span id="cb337-3735"><a href="#cb337-3735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3738"><a href="#cb337-3738" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3739"><a href="#cb337-3739" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with counts for alcohol use, smoking, and heart disease</span></span>
<span id="cb337-3740"><a href="#cb337-3740" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb337-3741"><a href="#cb337-3741" aria-hidden="true" tabindex="-1"></a>  <span class="at">alcohol =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb337-3742"><a href="#cb337-3742" aria-hidden="true" tabindex="-1"></a>  <span class="at">smoke =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb337-3743"><a href="#cb337-3743" aria-hidden="true" tabindex="-1"></a>  <span class="at">heart_disease =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb337-3744"><a href="#cb337-3744" aria-hidden="true" tabindex="-1"></a>  <span class="at">count =</span> <span class="fu">c</span>(<span class="dv">1250</span>, <span class="dv">100</span>, <span class="dv">1250</span>, <span class="dv">300</span>, <span class="dv">900</span>, <span class="dv">150</span>, <span class="dv">1100</span>, <span class="dv">300</span>)  <span class="co"># Adjusted counts to fit approximate output</span></span>
<span id="cb337-3745"><a href="#cb337-3745" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-3746"><a href="#cb337-3746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3747"><a href="#cb337-3747" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand the data frame by repeating rows according to the count</span></span>
<span id="cb337-3748"><a href="#cb337-3748" aria-hidden="true" tabindex="-1"></a>df_exp3 <span class="ot">&lt;-</span> df6[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df6), df6<span class="sc">$</span>count), <span class="fu">c</span>(<span class="st">"alcohol"</span>, <span class="st">"smoke"</span>, <span class="st">"heart_disease"</span>)]</span>
<span id="cb337-3749"><a href="#cb337-3749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3750"><a href="#cb337-3750" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'alcohol', 'smoke', and 'heart_disease' to factors</span></span>
<span id="cb337-3751"><a href="#cb337-3751" aria-hidden="true" tabindex="-1"></a>df_exp3<span class="sc">$</span>alcohol <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_exp3<span class="sc">$</span>alcohol, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb337-3752"><a href="#cb337-3752" aria-hidden="true" tabindex="-1"></a>df_exp3<span class="sc">$</span>smoke <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_exp3<span class="sc">$</span>smoke, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb337-3753"><a href="#cb337-3753" aria-hidden="true" tabindex="-1"></a>df_exp3<span class="sc">$</span>heart_disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_exp3<span class="sc">$</span>heart_disease, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb337-3754"><a href="#cb337-3754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3755"><a href="#cb337-3755" aria-hidden="true" tabindex="-1"></a><span class="co"># Run logistic regression</span></span>
<span id="cb337-3756"><a href="#cb337-3756" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_disease <span class="sc">~</span> alcohol <span class="sc">+</span> smoke, <span class="at">data =</span> df_exp3, <span class="at">family =</span> binomial)</span>
<span id="cb337-3757"><a href="#cb337-3757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3758"><a href="#cb337-3758" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb337-3759"><a href="#cb337-3759" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3)</span>
<span id="cb337-3760"><a href="#cb337-3760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3761"><a href="#cb337-3761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3764"><a href="#cb337-3764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3765"><a href="#cb337-3765" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(m3), <span class="fu">confint</span>(m3)))</span>
<span id="cb337-3766"><a href="#cb337-3766" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3767"><a href="#cb337-3767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3768"><a href="#cb337-3768" aria-hidden="true" tabindex="-1"></a>**After taking the exponents of the** $\beta$ **coefficients from our logistic regression model, we can see that the odds ratio for alcohol use is about 1.40. This odds ratio is much smaller than the crude or unadjusted odds ratio (1.94) we had before we add smoking to the model**</span>
<span id="cb337-3769"><a href="#cb337-3769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3770"><a href="#cb337-3770" aria-hidden="true" tabindex="-1"></a>**So we can interpret this odds ratio for alcohol use after adjusting for smoking, the effect of alcohol use on heart disease is similar with an adjusted odds ratio of about 1.40 in the 95% CI: 1.19 - 1.60. And this is statistically significant**</span>
<span id="cb337-3771"><a href="#cb337-3771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3772"><a href="#cb337-3772" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Controlling for confounders in a logistic regression using whitehall data</span></span>
<span id="cb337-3773"><a href="#cb337-3773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3774"><a href="#cb337-3774" aria-hidden="true" tabindex="-1"></a>Now use the <span class="in">`glm()`</span> command to obtain the odds ratio for prior CVD with hypertension, adjusted for HDL-C. This may be obtained as follows: <span class="in">`model &lt;- glm(prior_cvd ~ hypertens + hdlc, family = binomial(link = "logit"), data = df)`</span></span>
<span id="cb337-3775"><a href="#cb337-3775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3776"><a href="#cb337-3776" aria-hidden="true" tabindex="-1"></a>Note that the output gives us the odds ratio for ‘hyperten’ adjusted for ‘hdlc’ but it also gives us the odds ratios for ‘hdlc’ adjusted for ‘hyperten’.</span>
<span id="cb337-3777"><a href="#cb337-3777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3778"><a href="#cb337-3778" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question C1.4b:</span></span>
<span id="cb337-3779"><a href="#cb337-3779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3780"><a href="#cb337-3780" aria-hidden="true" tabindex="-1"></a>**What are the odds of having prior CVD if a participant is hypertensive, once you have adjusted for their levels of HDL-C?**</span>
<span id="cb337-3781"><a href="#cb337-3781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3784"><a href="#cb337-3784" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3785"><a href="#cb337-3785" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(prior_cvd <span class="sc">~</span> hyperten <span class="sc">+</span> hdlc, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> whitehall)</span>
<span id="cb337-3786"><a href="#cb337-3786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3787"><a href="#cb337-3787" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m4)</span>
<span id="cb337-3788"><a href="#cb337-3788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3789"><a href="#cb337-3789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3792"><a href="#cb337-3792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3793"><a href="#cb337-3793" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(m4), <span class="fu">confint</span>(m4)))</span>
<span id="cb337-3794"><a href="#cb337-3794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3795"><a href="#cb337-3795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3796"><a href="#cb337-3796" aria-hidden="true" tabindex="-1"></a>**Here, the odds ratio for prior CVD is 1.55 times higher in those with hypertension compared to those without hypertension, after adjusting for HDL-C (OR: 1.55, 95% CI: 1.33-1.80).**</span>
<span id="cb337-3797"><a href="#cb337-3797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3798"><a href="#cb337-3798" aria-hidden="true" tabindex="-1"></a><span class="fu"># C2: Survival Data</span></span>
<span id="cb337-3799"><a href="#cb337-3799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3800"><a href="#cb337-3800" aria-hidden="true" tabindex="-1"></a><span class="fu">## C2.1 Introduction to Survival Data {#sec-C2.1}</span></span>
<span id="cb337-3801"><a href="#cb337-3801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3802"><a href="#cb337-3802" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false"}</span>
<span id="cb337-3803"><a href="#cb337-3803" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-3804"><a href="#cb337-3804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3805"><a href="#cb337-3805" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-3806"><a href="#cb337-3806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3807"><a href="#cb337-3807" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand what **survival data** are</span>
<span id="cb337-3808"><a href="#cb337-3808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3809"><a href="#cb337-3809" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand the notion of **event, time to event** and **censoring** (informative and non-informative)</span>
<span id="cb337-3810"><a href="#cb337-3810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3811"><a href="#cb337-3811" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand **assumptions underpinning censoring** in survival data.</span>
<span id="cb337-3812"><a href="#cb337-3812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3813"><a href="#cb337-3813" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Definition of **Survival function** and **hazard function**.</span>
<span id="cb337-3814"><a href="#cb337-3814" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-3815"><a href="#cb337-3815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3816"><a href="#cb337-3816" aria-hidden="true" tabindex="-1"></a><span class="fu">### Characteristics of Survival Data</span></span>
<span id="cb337-3817"><a href="#cb337-3817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3818"><a href="#cb337-3818" aria-hidden="true" tabindex="-1"></a>Survival data are **time-to-event:**</span>
<span id="cb337-3819"><a href="#cb337-3819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3820"><a href="#cb337-3820" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cohort study on heart disease - time to first heart disease event.</span>
<span id="cb337-3821"><a href="#cb337-3821" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Breast cancer trial time to first recurrence of cancer.</span>
<span id="cb337-3822"><a href="#cb337-3822" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>IVF study - time to pregnancy.</span>
<span id="cb337-3823"><a href="#cb337-3823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3824"><a href="#cb337-3824" aria-hidden="true" tabindex="-1"></a>Special features are **time** and **censoring**</span>
<span id="cb337-3825"><a href="#cb337-3825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3826"><a href="#cb337-3826" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**time** to occurrence of the event of interest.</span>
<span id="cb337-3827"><a href="#cb337-3827" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>time to event may not be observed within the timeframe we have, it is therefore **censored**</span>
<span id="cb337-3828"><a href="#cb337-3828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3829"><a href="#cb337-3829" aria-hidden="true" tabindex="-1"></a>Summarized by the **survival function (and hazard function)**</span>
<span id="cb337-3830"><a href="#cb337-3830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3831"><a href="#cb337-3831" aria-hidden="true" tabindex="-1"></a><span class="al">![](Survival3.png)</span>{#fig-Sur3}</span>
<span id="cb337-3832"><a href="#cb337-3832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3833"><a href="#cb337-3833" aria-hidden="true" tabindex="-1"></a><span class="fu">### Defining time-to event</span></span>
<span id="cb337-3834"><a href="#cb337-3834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3835"><a href="#cb337-3835" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Event:**</span>
<span id="cb337-3836"><a href="#cb337-3836" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>e.g. death, recurrence, failure of prosthesis, success of implantation.</span>
<span id="cb337-3837"><a href="#cb337-3837" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Usually a well-defined binary variable for the outcome (e.g, Event: Death- 1=yes, 0=no)</span>
<span id="cb337-3838"><a href="#cb337-3838" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Time:** Depends on:</span>
<span id="cb337-3839"><a href="#cb337-3839" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Origin:** Time when risk of event begins.</span>
<span id="cb337-3840"><a href="#cb337-3840" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**entry:** Time when follow-up begins (often origin=entry)</span>
<span id="cb337-3841"><a href="#cb337-3841" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**exit:** Time of event or censoring.</span>
<span id="cb337-3842"><a href="#cb337-3842" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Scale:** Units of time e.g Scale days to years by specifying 365.25 as scale if time is measured in days.</span>
<span id="cb337-3843"><a href="#cb337-3843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3844"><a href="#cb337-3844" aria-hidden="true" tabindex="-1"></a>Measured in person-time, the sum of observation time contributed by all individuals in the study <span class="sc">\[</span>$=(\frac{\text{time/origin}}{scale})$<span class="sc">\]</span></span>
<span id="cb337-3845"><a href="#cb337-3845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3846"><a href="#cb337-3846" aria-hidden="true" tabindex="-1"></a><span class="fu">### Censoring</span></span>
<span id="cb337-3847"><a href="#cb337-3847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3848"><a href="#cb337-3848" aria-hidden="true" tabindex="-1"></a>Subjects censored at some time t are ignored at all future times.</span>
<span id="cb337-3849"><a href="#cb337-3849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3850"><a href="#cb337-3850" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Assumptions of censoring</span></span>
<span id="cb337-3851"><a href="#cb337-3851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3852"><a href="#cb337-3852" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>They carry no information about the survival function after t.</span>
<span id="cb337-3853"><a href="#cb337-3853" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If distribution of event-times is similar for censored vs non-censored subjects at a given time, then censoring is "non-informative"</span>
<span id="cb337-3854"><a href="#cb337-3854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3855"><a href="#cb337-3855" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Non-informative Censoring</span></span>
<span id="cb337-3856"><a href="#cb337-3856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3857"><a href="#cb337-3857" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Censoring at fixed times e.g pre-assigned end of study.</span>
<span id="cb337-3858"><a href="#cb337-3858" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Competing events e.g accidental deaths in a study of death due to MI</span>
<span id="cb337-3859"><a href="#cb337-3859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3860"><a href="#cb337-3860" aria-hidden="true" tabindex="-1"></a>Loss to follow-up may be informative, e.g if subjects are too ill to continue study - this may be problematic.</span>
<span id="cb337-3861"><a href="#cb337-3861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3862"><a href="#cb337-3862" aria-hidden="true" tabindex="-1"></a>Informative censoring usually problematic - carefully check distribution of censoring times.</span>
<span id="cb337-3863"><a href="#cb337-3863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3864"><a href="#cb337-3864" aria-hidden="true" tabindex="-1"></a><span class="fu">### Possible Observations of an individual being followed up for time-to-event</span></span>
<span id="cb337-3865"><a href="#cb337-3865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3866"><a href="#cb337-3866" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>They may <span class="in">`experience`</span> the outcome event - "failure"</span>
<span id="cb337-3867"><a href="#cb337-3867" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>They may not <span class="in">`experience`</span> the outcome event - "survival"</span>
<span id="cb337-3868"><a href="#cb337-3868" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Their event status may <span class="in">`not be observed`</span> - "censoring"</span>
<span id="cb337-3869"><a href="#cb337-3869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3870"><a href="#cb337-3870" aria-hidden="true" tabindex="-1"></a>Examples:</span>
<span id="cb337-3871"><a href="#cb337-3871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3872"><a href="#cb337-3872" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>had other event e.g died</span>
<span id="cb337-3873"><a href="#cb337-3873" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>loss to follow-up</span>
<span id="cb337-3874"><a href="#cb337-3874" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>overextend to the end of the study and no events was observed for this individual.</span>
<span id="cb337-3875"><a href="#cb337-3875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3876"><a href="#cb337-3876" aria-hidden="true" tabindex="-1"></a><span class="fu">### How Censoring may arise</span></span>
<span id="cb337-3877"><a href="#cb337-3877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3878"><a href="#cb337-3878" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Left censoring: First observation occurs after individual has experienced the outcome, but exact time of outcome is unknown.</span>
<span id="cb337-3879"><a href="#cb337-3879" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Right censoring: The study ends before they experience the event.</span>
<span id="cb337-3880"><a href="#cb337-3880" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interval censoring: Individual experiences outcome between two observations, but exact time of event is unknown.</span>
<span id="cb337-3881"><a href="#cb337-3881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3882"><a href="#cb337-3882" aria-hidden="true" tabindex="-1"></a><span class="fu">### Survival and Hazard functions</span></span>
<span id="cb337-3883"><a href="#cb337-3883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3884"><a href="#cb337-3884" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Two functions are very important in survival analysis, and these are the <span class="in">`Survival function`</span> and <span class="in">`Hazard function`</span></span>
<span id="cb337-3885"><a href="#cb337-3885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3886"><a href="#cb337-3886" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Survival function:s(t)`</span></span>
<span id="cb337-3887"><a href="#cb337-3887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3888"><a href="#cb337-3888" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>It is the probability that an individual is event-free beyond time (t) also written as $s(t) = P(T\geq t)$</span>
<span id="cb337-3889"><a href="#cb337-3889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3890"><a href="#cb337-3890" aria-hidden="true" tabindex="-1"></a>Where: T is the time to event, t = time of event</span>
<span id="cb337-3891"><a href="#cb337-3891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3892"><a href="#cb337-3892" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Hazard function (hazard rate):`</span></span>
<span id="cb337-3893"><a href="#cb337-3893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3894"><a href="#cb337-3894" aria-hidden="true" tabindex="-1"></a>The hazard function, denoted as $h(t)$, represents the instantaneous risk of an event occurring after time $t$, given that the individual is event-free up to time $t$. In other word, What is the probability that the event will happen between $T$ and the next fraction of time. The formula is:</span>
<span id="cb337-3895"><a href="#cb337-3895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3896"><a href="#cb337-3896" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-3897"><a href="#cb337-3897" aria-hidden="true" tabindex="-1"></a>h(t) = \lim_{\Delta t \to 0} \frac{P(t \leq T &lt; t + \Delta t \mid T \geq t)}{\Delta t}</span>
<span id="cb337-3898"><a href="#cb337-3898" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-3899"><a href="#cb337-3899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3900"><a href="#cb337-3900" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-3901"><a href="#cb337-3901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3902"><a href="#cb337-3902" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$h(t)$: Hazard function at time $t$</span>
<span id="cb337-3903"><a href="#cb337-3903" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$T$: Random variable representing the time to event</span>
<span id="cb337-3904"><a href="#cb337-3904" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\Delta t$: Infinitesimally small time interval</span>
<span id="cb337-3905"><a href="#cb337-3905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3906"><a href="#cb337-3906" aria-hidden="true" tabindex="-1"></a>Alternatively, the hazard function can also be expressed in terms of the probability density function $f(t)$ and the survival function $S(t)$ as:</span>
<span id="cb337-3907"><a href="#cb337-3907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3908"><a href="#cb337-3908" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-3909"><a href="#cb337-3909" aria-hidden="true" tabindex="-1"></a>h(t) = \frac{f(t)}{S(t)}</span>
<span id="cb337-3910"><a href="#cb337-3910" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-3911"><a href="#cb337-3911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3912"><a href="#cb337-3912" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-3913"><a href="#cb337-3913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3914"><a href="#cb337-3914" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$f(t)$: Probability density function of time to event</span>
<span id="cb337-3915"><a href="#cb337-3915" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$S(t) = P(T &gt; t)$: Survival function</span>
<span id="cb337-3916"><a href="#cb337-3916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3917"><a href="#cb337-3917" aria-hidden="true" tabindex="-1"></a>In contrast to the survival function, which focuses on not having an event, the hazard function focuses on the event occurring.</span>
<span id="cb337-3918"><a href="#cb337-3918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3919"><a href="#cb337-3919" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why we estimate the Survival function ?</span></span>
<span id="cb337-3920"><a href="#cb337-3920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3921"><a href="#cb337-3921" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Risk(proportion) or odds of events at the end of follow-up`</span></span>
<span id="cb337-3922"><a href="#cb337-3922" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Ignore differences in follow-up times across individuals.</span>
<span id="cb337-3923"><a href="#cb337-3923" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Does not deal with censoring appropriately.</span>
<span id="cb337-3924"><a href="#cb337-3924" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Average time-to-event:`</span></span>
<span id="cb337-3925"><a href="#cb337-3925" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Event rates may not be constant during follow-up, an 'average' would be misleading.</span>
<span id="cb337-3926"><a href="#cb337-3926" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Times-to-event may not follow a know distribution (useful for parametric analysis).</span>
<span id="cb337-3927"><a href="#cb337-3927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3928"><a href="#cb337-3928" aria-hidden="true" tabindex="-1"></a><span class="in">`The Survival function can overcome these limitations`</span></span>
<span id="cb337-3929"><a href="#cb337-3929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3930"><a href="#cb337-3930" aria-hidden="true" tabindex="-1"></a>The command <span class="in">`Surv`</span> is used to create a survival object, which sets up a time to event data structure. When we have only one time period, like in this study, we specify in the form <span class="in">`Surv(follow up time, event indicator)`</span>.</span>
<span id="cb337-3931"><a href="#cb337-3931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3932"><a href="#cb337-3932" aria-hidden="true" tabindex="-1"></a>Since we want to look at the event of “death”, and we have followed participants for several years, the following command is used:</span>
<span id="cb337-3933"><a href="#cb337-3933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3934"><a href="#cb337-3934" aria-hidden="true" tabindex="-1"></a><span class="in">`library(survival)`</span>, <span class="in">`surv_object &lt;- Surv(whitehall$fu_years, whitehall$death)`</span></span>
<span id="cb337-3935"><a href="#cb337-3935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3936"><a href="#cb337-3936" aria-hidden="true" tabindex="-1"></a>The output from R is a matrix with two columns – the first is the survival time, and the second an indicator for death or not.</span>
<span id="cb337-3937"><a href="#cb337-3937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3938"><a href="#cb337-3938" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question C2.1a:</span></span>
<span id="cb337-3939"><a href="#cb337-3939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3940"><a href="#cb337-3940" aria-hidden="true" tabindex="-1"></a>**How many events occurred during the follow up period?**</span>
<span id="cb337-3941"><a href="#cb337-3941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3944"><a href="#cb337-3944" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-3945"><a href="#cb337-3945" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the number of death events during the follow-up period</span></span>
<span id="cb337-3946"><a href="#cb337-3946" aria-hidden="true" tabindex="-1"></a>number_of_deaths <span class="ot">&lt;-</span> <span class="fu">sum</span>(whitehall<span class="sc">$</span>death)</span>
<span id="cb337-3947"><a href="#cb337-3947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3948"><a href="#cb337-3948" aria-hidden="true" tabindex="-1"></a>number_of_deaths</span>
<span id="cb337-3949"><a href="#cb337-3949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3950"><a href="#cb337-3950" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-3951"><a href="#cb337-3951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3952"><a href="#cb337-3952" aria-hidden="true" tabindex="-1"></a>**1,526 deaths**</span>
<span id="cb337-3953"><a href="#cb337-3953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3954"><a href="#cb337-3954" aria-hidden="true" tabindex="-1"></a><span class="fu">## C2.2 Kaplan-Meier Survival Function &amp; the Log Rank Test {#sec-C2.2}</span></span>
<span id="cb337-3955"><a href="#cb337-3955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3956"><a href="#cb337-3956" aria-hidden="true" tabindex="-1"></a>::: {.callout-important icon="false"}</span>
<span id="cb337-3957"><a href="#cb337-3957" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb337-3958"><a href="#cb337-3958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3959"><a href="#cb337-3959" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-3960"><a href="#cb337-3960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3961"><a href="#cb337-3961" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Produce a Kaplan-Meier survival curve and interpret it.</span>
<span id="cb337-3962"><a href="#cb337-3962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3963"><a href="#cb337-3963" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Test for differences in survival by using a log-rank test.</span>
<span id="cb337-3964"><a href="#cb337-3964" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-3965"><a href="#cb337-3965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3966"><a href="#cb337-3966" aria-hidden="true" tabindex="-1"></a><span class="fu">### C2.2.1 Kaplan-Meier Survival Function {#sec-C2.2.1}</span></span>
<span id="cb337-3967"><a href="#cb337-3967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3968"><a href="#cb337-3968" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb337-3969"><a href="#cb337-3969" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb337-3970"><a href="#cb337-3970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3971"><a href="#cb337-3971" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-3972"><a href="#cb337-3972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3973"><a href="#cb337-3973" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimate the survival function using Kaplan-Meier method.</span>
<span id="cb337-3974"><a href="#cb337-3974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3975"><a href="#cb337-3975" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Plot the estimated survival function.</span>
<span id="cb337-3976"><a href="#cb337-3976" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-3977"><a href="#cb337-3977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3978"><a href="#cb337-3978" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Kaplan-Meier (K-M) method</span></span>
<span id="cb337-3979"><a href="#cb337-3979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3980"><a href="#cb337-3980" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consider $n$ individuals with observed survival times $t_{1}, t_{2},....,t_{n}$ and suppose there are $r$ events of interest, in our case, we call them deaths.</span>
<span id="cb337-3981"><a href="#cb337-3981" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If we rearrange the death in ascending order $j=1,2,...,r$</span>
<span id="cb337-3982"><a href="#cb337-3982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3983"><a href="#cb337-3983" aria-hidden="true" tabindex="-1"></a>The $\text{estimated survival function}$ is</span>
<span id="cb337-3984"><a href="#cb337-3984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3985"><a href="#cb337-3985" aria-hidden="true" tabindex="-1"></a>The Kaplan-Meier estimator, denoted as $\hat{S}(t)$, estimates the survival function as:</span>
<span id="cb337-3986"><a href="#cb337-3986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3987"><a href="#cb337-3987" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-3988"><a href="#cb337-3988" aria-hidden="true" tabindex="-1"></a>\hat{S}(t) = \prod_{t_j \leq t} \left(P_{j}\right)</span>
<span id="cb337-3989"><a href="#cb337-3989" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-3990"><a href="#cb337-3990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3991"><a href="#cb337-3991" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-3992"><a href="#cb337-3992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3993"><a href="#cb337-3993" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$P_{j} = 1 - \frac{d_j}{n_j} = \frac{n_{j} - d_{j}}{n_{j}}$</span>
<span id="cb337-3994"><a href="#cb337-3994" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$t_j$: Distinct time points at which events occur</span>
<span id="cb337-3995"><a href="#cb337-3995" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$d_j$: Number of events (deaths) at time $t_j$</span>
<span id="cb337-3996"><a href="#cb337-3996" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n_j$: Number of individuals at risk just before time $t_j$</span>
<span id="cb337-3997"><a href="#cb337-3997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3998"><a href="#cb337-3998" aria-hidden="true" tabindex="-1"></a>The *estimated survival function* is *constant between events*, so the graph is a *step function*</span>
<span id="cb337-3999"><a href="#cb337-3999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4000"><a href="#cb337-4000" aria-hidden="true" tabindex="-1"></a>Recall @fig-Sur3, we have different characteristic of this participants. Some of them died, some of them were lost to follow up, some of them had the event of interest (MI).</span>
<span id="cb337-4001"><a href="#cb337-4001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4002"><a href="#cb337-4002" aria-hidden="true" tabindex="-1"></a>Let us compute kaplan-meier estimate of the survival function</span>
<span id="cb337-4003"><a href="#cb337-4003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4004"><a href="#cb337-4004" aria-hidden="true" tabindex="-1"></a>To produce a Kaplan-Meier (K-M) Survival Curve for all-cause mortality, we will use the <span class="in">`survminer`</span> R package which aims to plot time-to-event data using the ggplot R package.</span>
<span id="cb337-4005"><a href="#cb337-4005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4006"><a href="#cb337-4006" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Produce a Kaplan-Meier curve for mortality</span></span>
<span id="cb337-4007"><a href="#cb337-4007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4008"><a href="#cb337-4008" aria-hidden="true" tabindex="-1"></a>The command <span class="in">`ggsurvplot()`</span> from the <span class="in">`survminer`</span> R package produces a plot of the K-M survivor function. There are a variety of options that you could use that might make a graph more informative. You can find more details about the <span class="in">`survminer`</span> R package in <span class="co">[</span><span class="ot">this website</span><span class="co">](https://rpkgs.datanovia.com/survminer/)</span>{target="_blank"}.</span>
<span id="cb337-4009"><a href="#cb337-4009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4010"><a href="#cb337-4010" aria-hidden="true" tabindex="-1"></a>To produce a Kaplan-Meier curve for the total population we run the following command: <span class="in">`model &lt;- survfit(Surv(fu_years, death) ~ 1, data = df)`</span></span>
<span id="cb337-4011"><a href="#cb337-4011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4012"><a href="#cb337-4012" aria-hidden="true" tabindex="-1"></a>To get the risk table at prespecified times, we used the summary() command with the times option: <span class="in">`summary(model, times)`</span></span>
<span id="cb337-4013"><a href="#cb337-4013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4014"><a href="#cb337-4014" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Question C2.2a.i:</span></span>
<span id="cb337-4015"><a href="#cb337-4015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4016"><a href="#cb337-4016" aria-hidden="true" tabindex="-1"></a>Use the <span class="in">`survfit()`</span> and <span class="in">`summary()`</span> commands and the times option <span class="in">`seq(0.5, 9, 0.5)`</span> to see what time since re-survey corresponds to 75% survival.</span>
<span id="cb337-4017"><a href="#cb337-4017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4020"><a href="#cb337-4020" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4021"><a href="#cb337-4021" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb337-4022"><a href="#cb337-4022" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb337-4023"><a href="#cb337-4023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4024"><a href="#cb337-4024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4025"><a href="#cb337-4025" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> whitehall)</span>
<span id="cb337-4026"><a href="#cb337-4026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4027"><a href="#cb337-4027" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m5, <span class="at">times =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">9</span>, <span class="fl">0.5</span>))</span>
<span id="cb337-4028"><a href="#cb337-4028" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4029"><a href="#cb337-4029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4030"><a href="#cb337-4030" aria-hidden="true" tabindex="-1"></a>*75% survival occurs at around 6 years, and this agrees with report from stsum below.*</span>
<span id="cb337-4031"><a href="#cb337-4031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4032"><a href="#cb337-4032" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Question C2.2a.ii:</span></span>
<span id="cb337-4033"><a href="#cb337-4033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4034"><a href="#cb337-4034" aria-hidden="true" tabindex="-1"></a>Use the <span class="in">`ggsurvplot()`</span> command to plot the cumulative survival, and use the appropriate option to estimate how many participants were at risk going into the 8th year of follow-up.</span>
<span id="cb337-4035"><a href="#cb337-4035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4038"><a href="#cb337-4038" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4039"><a href="#cb337-4039" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(m5, <span class="at">risk.table =</span> T)</span>
<span id="cb337-4040"><a href="#cb337-4040" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4041"><a href="#cb337-4041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4042"><a href="#cb337-4042" aria-hidden="true" tabindex="-1"></a>*The graph shows that 1458 participants were at risk going into the 8th year of follow-up.*</span>
<span id="cb337-4043"><a href="#cb337-4043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4044"><a href="#cb337-4044" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb337-4045"><a href="#cb337-4045" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Time intervals constructed so that each contains 1 event time, which is taken to occur at the start of the interval.</span>
<span id="cb337-4046"><a href="#cb337-4046" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>No interval begins at censoring time</span>
<span id="cb337-4047"><a href="#cb337-4047" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\hat{S}(t) = \text{Survival probability * Survival Probability at previous time (t) interval}$</span>
<span id="cb337-4048"><a href="#cb337-4048" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The survival function plot is a step function, with sudden changes in the estimated probability corresponding to times at which an event was observed.</span>
<span id="cb337-4049"><a href="#cb337-4049" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>There are vertical lines, which correspond to the times the data were censored, while the horizontal parts correspond to the survival function.</span>
<span id="cb337-4050"><a href="#cb337-4050" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-4051"><a href="#cb337-4051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4052"><a href="#cb337-4052" aria-hidden="true" tabindex="-1"></a><span class="fu">### Confidence Interval for Survival function</span></span>
<span id="cb337-4053"><a href="#cb337-4053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4054"><a href="#cb337-4054" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Variance for $\hat{S(t)}$ is usually calculated using **Greenwood's formula**</span>
<span id="cb337-4055"><a href="#cb337-4055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4056"><a href="#cb337-4056" aria-hidden="true" tabindex="-1"></a><span class="fu">#### No Censoring</span></span>
<span id="cb337-4057"><a href="#cb337-4057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4058"><a href="#cb337-4058" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4059"><a href="#cb337-4059" aria-hidden="true" tabindex="-1"></a>\hat{S}(t) = \frac{\text{initial number of individuals - number of event up to t}}{\text{initial number of individuals in the study}}</span>
<span id="cb337-4060"><a href="#cb337-4060" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4061"><a href="#cb337-4061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4062"><a href="#cb337-4062" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4063"><a href="#cb337-4063" aria-hidden="true" tabindex="-1"></a>\text{Var}(\hat{S}(t)) = \frac{\hat{S}(t)<span class="co">[</span><span class="ot">1 - \hat{S}(t)</span><span class="co">]</span>}{n}</span>
<span id="cb337-4064"><a href="#cb337-4064" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4065"><a href="#cb337-4065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4066"><a href="#cb337-4066" aria-hidden="true" tabindex="-1"></a><span class="fu">#### With Censoring</span></span>
<span id="cb337-4067"><a href="#cb337-4067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4068"><a href="#cb337-4068" aria-hidden="true" tabindex="-1"></a>The variance of the Kaplan-Meier survival estimate with censoring, using Greenwood's formula, is:</span>
<span id="cb337-4069"><a href="#cb337-4069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4070"><a href="#cb337-4070" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4071"><a href="#cb337-4071" aria-hidden="true" tabindex="-1"></a>\text{Var}(\hat{S}(t)) = \hat{S}(t)^2 \sum_{i: t_i \leq t} \frac{d_i}{n_i (n_i - d_i)}</span>
<span id="cb337-4072"><a href="#cb337-4072" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4073"><a href="#cb337-4073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4074"><a href="#cb337-4074" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-4075"><a href="#cb337-4075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4076"><a href="#cb337-4076" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\hat{S}(t)$ is the Kaplan-Meier survival estimate at time $t$,</span>
<span id="cb337-4077"><a href="#cb337-4077" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$d_i$ is the number of observed events at time $t_i$,</span>
<span id="cb337-4078"><a href="#cb337-4078" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n_i$ is the number of individuals at risk just before $t_i$.</span>
<span id="cb337-4079"><a href="#cb337-4079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4080"><a href="#cb337-4080" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Confidence Interval for the Kaplan-Meier Survival Estimate (Using Variance)</span></span>
<span id="cb337-4081"><a href="#cb337-4081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4082"><a href="#cb337-4082" aria-hidden="true" tabindex="-1"></a>The approximate $100(1 - \alpha)\%$ confidence interval for the Kaplan-Meier survival estimate $\hat{S}(t)$, using the variance, is given by:</span>
<span id="cb337-4083"><a href="#cb337-4083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4084"><a href="#cb337-4084" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4085"><a href="#cb337-4085" aria-hidden="true" tabindex="-1"></a>\left( \hat{S}(t) - z \cdot \sqrt{\text{Var}(\hat{S}(t))}, \hat{S}(t) + z \cdot \sqrt{\text{Var}(\hat{S}(t))} \right)</span>
<span id="cb337-4086"><a href="#cb337-4086" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4087"><a href="#cb337-4087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4088"><a href="#cb337-4088" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-4089"><a href="#cb337-4089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4090"><a href="#cb337-4090" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\hat{S}(t)$ is the Kaplan-Meier survival estimate at time $t$,</span>
<span id="cb337-4091"><a href="#cb337-4091" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$z$ is the z-score for the desired confidence level (e.g., $z = 1.96$ for a 95% confidence interval),</span>
<span id="cb337-4092"><a href="#cb337-4092" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\text{Var}(\hat{S}(t))$ is the variance of the survival estimate at time $t$.</span>
<span id="cb337-4093"><a href="#cb337-4093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4094"><a href="#cb337-4094" aria-hidden="true" tabindex="-1"></a>This formula provides a confidence interval around the survival estimate by directly using the variance, giving an interval centered on $\hat{S}(t)$ with width determined by the variance.</span>
<span id="cb337-4095"><a href="#cb337-4095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4096"><a href="#cb337-4096" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb337-4097"><a href="#cb337-4097" aria-hidden="true" tabindex="-1"></a><span class="fu">## Greenwood formula:</span></span>
<span id="cb337-4098"><a href="#cb337-4098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4099"><a href="#cb337-4099" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Only asymptomatically correct: It underestimates variance when few subjects remain at risk</span>
<span id="cb337-4100"><a href="#cb337-4100" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Can give CIs outside the range 0 to 1; solution to this problems include:</span>
<span id="cb337-4101"><a href="#cb337-4101" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Truncation</span>
<span id="cb337-4102"><a href="#cb337-4102" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Log-transformation</span>
<span id="cb337-4103"><a href="#cb337-4103" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Log-log transformation.</span>
<span id="cb337-4104"><a href="#cb337-4104" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-4105"><a href="#cb337-4105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4106"><a href="#cb337-4106" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Confidence Interval for the Kaplan-Meier Survival Estimate (With log-log tranformation)</span></span>
<span id="cb337-4107"><a href="#cb337-4107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4108"><a href="#cb337-4108" aria-hidden="true" tabindex="-1"></a>For a Kaplan-Meier survival estimate $\hat{S}(t)$, the approximate $100(1 - \alpha)\%$ confidence interval is:</span>
<span id="cb337-4109"><a href="#cb337-4109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4110"><a href="#cb337-4110" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4111"><a href="#cb337-4111" aria-hidden="true" tabindex="-1"></a>\left( \hat{S}(t)^{\exp\left(-z \cdot \text{SE}(\log(-\log(\hat{S}(t))))\right)}, \hat{S}(t)^{\exp\left(z \cdot \text{SE}(\log(-\log(\hat{S}(t))))\right)} \right)</span>
<span id="cb337-4112"><a href="#cb337-4112" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4113"><a href="#cb337-4113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4114"><a href="#cb337-4114" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-4115"><a href="#cb337-4115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4116"><a href="#cb337-4116" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\hat{S}(t)$ is the Kaplan-Meier survival estimate at time $t$,</span>
<span id="cb337-4117"><a href="#cb337-4117" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$z$ is the z-score for the confidence level (e.g., $z = 1.96$ for 95% confidence),</span>
<span id="cb337-4118"><a href="#cb337-4118" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\text{SE}(\log(-\log(\hat{S}(t))))$ is the standard error of the log-log transformed survival probability.</span>
<span id="cb337-4119"><a href="#cb337-4119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4120"><a href="#cb337-4120" aria-hidden="true" tabindex="-1"></a>This formula gives a confidence interval for the survival probability at each time point, accounting for the variability in the estimate.</span>
<span id="cb337-4121"><a href="#cb337-4121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4122"><a href="#cb337-4122" aria-hidden="true" tabindex="-1"></a>This formula provides an estimate of the variance in survival probability at each observed time point.</span>
<span id="cb337-4123"><a href="#cb337-4123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4124"><a href="#cb337-4124" aria-hidden="true" tabindex="-1"></a><span class="fu">#### The Log-Rank Test</span></span>
<span id="cb337-4125"><a href="#cb337-4125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4126"><a href="#cb337-4126" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb337-4127"><a href="#cb337-4127" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Learning Objectives</span></span>
<span id="cb337-4128"><a href="#cb337-4128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4129"><a href="#cb337-4129" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-4130"><a href="#cb337-4130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4131"><a href="#cb337-4131" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand the log-rank test for comparing the equality of survival functions across groups</span>
<span id="cb337-4132"><a href="#cb337-4132" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-4133"><a href="#cb337-4133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4134"><a href="#cb337-4134" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Comparing Survival in Two or More Grroups</span></span>
<span id="cb337-4135"><a href="#cb337-4135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4136"><a href="#cb337-4136" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Log-rank test (Test the equality of the survival functions in k groups)</span></span>
<span id="cb337-4137"><a href="#cb337-4137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4138"><a href="#cb337-4138" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Generally, principles of the log-rank test is that their survival function across the key group is the same.</span>
<span id="cb337-4139"><a href="#cb337-4139" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The issue now is that we have certain number of times in which we are looking at this observed events and expected events. And also we not only have the number of times, but we also look at this observed events and expected events across groups.</span>
<span id="cb337-4140"><a href="#cb337-4140" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For example, if we take the case of 2 groups of patients, are there observed events at a particular time $t$ in a group k or we indicated this with $O_{jk}$ when the time is equal to j and then we have expected events at time j for group k and we indicate this with $E_{JK}$.</span>
<span id="cb337-4141"><a href="#cb337-4141" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If we take the sum of all the observed events across all the times that we have for a particular group, and we take the sum of all expected event across the times that we have in a particular group. And we take the difference of these 2 quantities, and then we take the square. If we divide this by the sum across all the possible times that we have of the various $j$ and we do the same across all the groups that we have, then it can be shown that this test statistics, is distributed as a Chi-Squared distribution with 1 degree of freedom.</span>
<span id="cb337-4142"><a href="#cb337-4142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4143"><a href="#cb337-4143" aria-hidden="true" tabindex="-1"></a>In the case of **two groups** the formula is:</span>
<span id="cb337-4144"><a href="#cb337-4144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4145"><a href="#cb337-4145" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4146"><a href="#cb337-4146" aria-hidden="true" tabindex="-1"></a>\sum_{k=1}^2\frac{\left( \sum_{j=1}^{t} O_{jk} - \sum_{j=1}^{t} E_{jk}\right)^2}{\sum_{j=1}^{t} V_j} - \chi_{1}^2</span>
<span id="cb337-4147"><a href="#cb337-4147" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4148"><a href="#cb337-4148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4149"><a href="#cb337-4149" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If we have more than two groups, then it is still distributed as a Chi-Squared distribution, but in this case, the degrees of freedom becomes $k-1$.</span>
<span id="cb337-4150"><a href="#cb337-4150" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We have to be careful because the log-rank test is just a test of significance, so it doesn't gives us an estimate of the difference of the groups or it doesn't provide us with a confidence interval.</span>
<span id="cb337-4151"><a href="#cb337-4151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4152"><a href="#cb337-4152" aria-hidden="true" tabindex="-1"></a>|                |       |      $k=1$      |      $K=2$      |     Total     |</span>
<span id="cb337-4153"><a href="#cb337-4153" aria-hidden="true" tabindex="-1"></a>|:--------------:|:-----:|:---------------:|:---------------:|:-------------:|</span>
<span id="cb337-4154"><a href="#cb337-4154" aria-hidden="true" tabindex="-1"></a>| **Event at t** |  Yes  |    $d_{t1}$     |    $d_{t2}$     |     $d_t$     |</span>
<span id="cb337-4155"><a href="#cb337-4155" aria-hidden="true" tabindex="-1"></a>| **Event at t** |  No   | $n_{t1}-d_{t1}$ | $n_{t2}-d_{t2}$ | $n_{t}-d_{t}$ |</span>
<span id="cb337-4156"><a href="#cb337-4156" aria-hidden="true" tabindex="-1"></a>|                | Total |    $n_{t1}$     |    $n_{t2}$     |     $n_t$     |</span>
<span id="cb337-4157"><a href="#cb337-4157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4158"><a href="#cb337-4158" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb337-4159"><a href="#cb337-4159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4160"><a href="#cb337-4160" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$d_{t1}$ = Observed events for group 1 this will be $O_{t1}$, i.e, death at time t for group 1</span>
<span id="cb337-4161"><a href="#cb337-4161" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$d_{t2}$ = Observed events for group 2 this will be $O_{t2}$, i.e, death at time t for group 2</span>
<span id="cb337-4162"><a href="#cb337-4162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4163"><a href="#cb337-4163" aria-hidden="true" tabindex="-1"></a>*There will be need to calculates the expected events* $E_{t1}$ *for group 1,* $E_{t2}$ *for group 2 and variance* ($V_t$)</span>
<span id="cb337-4164"><a href="#cb337-4164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4165"><a href="#cb337-4165" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4166"><a href="#cb337-4166" aria-hidden="true" tabindex="-1"></a>E_{t1} = \frac{n_{t1}d_t}{n_t}, E_{t2}= \frac{n_{t2}d_t}{n_t} \text{ and}, V_t = \frac{n_{t1}n_{t2}d_t(n_t-d_t)}{(n_t)^2(n_t-1)}</span>
<span id="cb337-4167"><a href="#cb337-4167" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4168"><a href="#cb337-4168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4169"><a href="#cb337-4169" aria-hidden="true" tabindex="-1"></a>*The above formula is use to calculate expected event and variance in case of Chi-square test*</span>
<span id="cb337-4170"><a href="#cb337-4170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4171"><a href="#cb337-4171" aria-hidden="true" tabindex="-1"></a>First, we will divide the variable vitd at the median (nb: there are several methods you can use to code this correctly in R). We will show a recoding approach based on tidyverse R package. We can use a combination of the <span class="in">`mutate()`</span> command and <span class="in">`case_when()`</span> command as follows: <span class="in">`df &lt;- df %&gt;% mutate(vitd_med = case_when(vitd &lt;= summary(df$vitd)[3] ~ 0, vitd &gt; summary(df$vitd)[3] ~ 1))`</span></span>
<span id="cb337-4172"><a href="#cb337-4172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4173"><a href="#cb337-4173" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb337-4174"><a href="#cb337-4174" aria-hidden="true" tabindex="-1"></a>We use the <span class="in">`summary()`</span> command to estimate the descriptive statistics (i.e., minimum value, 1st quartile, median, mean, 3rd quartile, and maximum value) of the <span class="in">`vitd`</span> variable. The 3rd element in the output of the <span class="in">`summary()`</span>command is the median which is used to dichotomise the <span class="in">`vitd`</span> variable.</span>
<span id="cb337-4175"><a href="#cb337-4175" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-4176"><a href="#cb337-4176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4177"><a href="#cb337-4177" aria-hidden="true" tabindex="-1"></a>The <span class="in">`survdiff()`</span> command compares the survival distrubutions of an exposure variable by performing a log-rank test. The syntax of the <span class="in">`survdiff()`</span> command is the following: <span class="in">`survdiff(Surv(time, event) ~ variable, data)`</span></span>
<span id="cb337-4178"><a href="#cb337-4178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4179"><a href="#cb337-4179" aria-hidden="true" tabindex="-1"></a>The <span class="in">`survdiff()`</span> command uses as a dependent variable a survival object which is produced by the <span class="in">`Surv()`</span> command. To create a survival object, we should define the follow up time <span class="in">`(time)`</span> and the outcome status <span class="in">`(event)`</span> in the <span class="in">`Surv()`</span> command.</span>
<span id="cb337-4180"><a href="#cb337-4180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4181"><a href="#cb337-4181" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Question C2.2b:</span></span>
<span id="cb337-4182"><a href="#cb337-4182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4183"><a href="#cb337-4183" aria-hidden="true" tabindex="-1"></a>Using the <span class="in">`survdiff()`</span> command, compare the survival distributions for the two categories of VitD. Is there a significant difference in the survival of participants below and above the median of vitamin D concentration?</span>
<span id="cb337-4184"><a href="#cb337-4184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4187"><a href="#cb337-4187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4188"><a href="#cb337-4188" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb337-4189"><a href="#cb337-4189" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb337-4190"><a href="#cb337-4190" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb337-4191"><a href="#cb337-4191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4192"><a href="#cb337-4192" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the median of `vitd` once and store it in a variable</span></span>
<span id="cb337-4193"><a href="#cb337-4193" aria-hidden="true" tabindex="-1"></a>vitd_median <span class="ot">&lt;-</span> <span class="fu">median</span>(whitehall<span class="sc">$</span>vitd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb337-4194"><a href="#cb337-4194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4195"><a href="#cb337-4195" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the median in your mutate statement</span></span>
<span id="cb337-4196"><a href="#cb337-4196" aria-hidden="true" tabindex="-1"></a>whitehall <span class="ot">&lt;-</span> whitehall <span class="sc">%&gt;%</span></span>
<span id="cb337-4197"><a href="#cb337-4197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vitd_med =</span> <span class="fu">case_when</span>(</span>
<span id="cb337-4198"><a href="#cb337-4198" aria-hidden="true" tabindex="-1"></a>    vitd <span class="sc">&lt;=</span> vitd_median <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb337-4199"><a href="#cb337-4199" aria-hidden="true" tabindex="-1"></a>    vitd <span class="sc">&gt;</span> vitd_median <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb337-4200"><a href="#cb337-4200" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb337-4201"><a href="#cb337-4201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4202"><a href="#cb337-4202" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> vitd_med, <span class="at">data =</span> whitehall)</span>
<span id="cb337-4203"><a href="#cb337-4203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4204"><a href="#cb337-4204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4205"><a href="#cb337-4205" aria-hidden="true" tabindex="-1"></a>*The log-rank test indicates that we can reject the null hypothesis that the survival distributions for the two categories are the same, as the chi(1)=120 , p\&lt;2e-16. There is a statistically significant difference in survival for participants above and below the median of vitamin D concentrations. Looking at the KM plot of the survival functions, we can see that participants with vitamin D above the median tend to survive longer.*</span>
<span id="cb337-4206"><a href="#cb337-4206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4207"><a href="#cb337-4207" aria-hidden="true" tabindex="-1"></a><span class="fu">## C2.3 Cox Proportional Hazards Regression</span></span>
<span id="cb337-4208"><a href="#cb337-4208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4209"><a href="#cb337-4209" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb337-4210"><a href="#cb337-4210" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learning Outcomes</span></span>
<span id="cb337-4211"><a href="#cb337-4211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4212"><a href="#cb337-4212" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-4213"><a href="#cb337-4213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4214"><a href="#cb337-4214" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand the theory of proportional hazards models (modelling equation)</span>
<span id="cb337-4215"><a href="#cb337-4215" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate and interpret the results of a Cox proportional hazards regression model</span>
<span id="cb337-4216"><a href="#cb337-4216" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Test the assumptions underlying a Cox regression (proportional hazards) model</span>
<span id="cb337-4217"><a href="#cb337-4217" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-4218"><a href="#cb337-4218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4219"><a href="#cb337-4219" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cox Model (Cox 1972)</span></span>
<span id="cb337-4220"><a href="#cb337-4220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4221"><a href="#cb337-4221" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It models the hazard function $h(t)$ as</span>
<span id="cb337-4222"><a href="#cb337-4222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4223"><a href="#cb337-4223" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4224"><a href="#cb337-4224" aria-hidden="true" tabindex="-1"></a>h(t | X) = h_0(t) \exp(\beta_1 X_1 + \beta_2 X_2 + \dots + \beta_p X_p) </span>
<span id="cb337-4225"><a href="#cb337-4225" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4226"><a href="#cb337-4226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4227"><a href="#cb337-4227" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-4228"><a href="#cb337-4228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4229"><a href="#cb337-4229" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$h(t | X)$ is the hazard function at time $t$ for an individual with covariates $X$,</span>
<span id="cb337-4230"><a href="#cb337-4230" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$h_0(t)$ is the baseline hazard function at time $t$,</span>
<span id="cb337-4231"><a href="#cb337-4231" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\beta_1, \beta_2, \dots, \beta_p$ are the coefficients for the covariates $X_1, X_2, \dots, X_p$.</span>
<span id="cb337-4232"><a href="#cb337-4232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4233"><a href="#cb337-4233" aria-hidden="true" tabindex="-1"></a>This model assumes that the effect of covariates on the hazard is multiplicative and proportional over time.</span>
<span id="cb337-4234"><a href="#cb337-4234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4235"><a href="#cb337-4235" aria-hidden="true" tabindex="-1"></a>Alternative writing:</span>
<span id="cb337-4236"><a href="#cb337-4236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4237"><a href="#cb337-4237" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4238"><a href="#cb337-4238" aria-hidden="true" tabindex="-1"></a>\log(\frac{h(t | X)}{h_0(t)})= \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_p X_p</span>
<span id="cb337-4239"><a href="#cb337-4239" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4240"><a href="#cb337-4240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4241"><a href="#cb337-4241" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb337-4242"><a href="#cb337-4242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4243"><a href="#cb337-4243" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\log(h(t | X))$ is the log hazard function at time $t$ for an individual with covariates $X$,</span>
<span id="cb337-4244"><a href="#cb337-4244" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\log(h_0(t))$ is the log of the baseline hazard function at time $t$,</span>
<span id="cb337-4245"><a href="#cb337-4245" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\beta_1, \beta_2, \dots, \beta_p$ are the coefficients for the covariates $X_1, X_2, \dots, X_p$.</span>
<span id="cb337-4246"><a href="#cb337-4246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4247"><a href="#cb337-4247" aria-hidden="true" tabindex="-1"></a>This equation shows that the covariates $X$ have a linear effect on the log of the hazard function, a key assumption in the Cox model.</span>
<span id="cb337-4248"><a href="#cb337-4248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4249"><a href="#cb337-4249" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Characteristics of the Cox Model</span></span>
<span id="cb337-4250"><a href="#cb337-4250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4251"><a href="#cb337-4251" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It is a <span class="in">`Semi-parametric model`</span> because there are no assumptions about the shape of the baseline hazard function and because there is a <span class="in">`Non-Parametric`</span> part, i.e, the one with log and <span class="in">`parametric part`</span> that is given by the exponential part of the coefficient.</span>
<span id="cb337-4252"><a href="#cb337-4252" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The coefficients $\beta_1, \beta_2, \dots, \beta_p$ can be estimated by maximizing the partial likelihood.</span>
<span id="cb337-4253"><a href="#cb337-4253" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Confidence intervals and test of hypothesis can be obtained.</span>
<span id="cb337-4254"><a href="#cb337-4254" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>There is no assumption needed for the baseline $(h_0(t))$ as a function. This is a very strong point because essentially we are able to estimate the coefficient of the model without imposing any shape or constraint on the baseline as a function.</span>
<span id="cb337-4255"><a href="#cb337-4255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4256"><a href="#cb337-4256" aria-hidden="true" tabindex="-1"></a>Suppose now we have estimated our coefficients intermodal, so we want to see how we can interpret this coefficient $\beta_1 \text{ to } \beta_p$.</span>
<span id="cb337-4257"><a href="#cb337-4257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4258"><a href="#cb337-4258" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>If the first covariate $X_1$ corresponds to an indicator variable representing assignment to a treatment group (drug) or a control group (placebo), then the coefficient $\beta_1$ represents the $log-hazards-ratio$ between the two groups after adjusting for other covariates $X_2,\dots,X_p.$</span>
<span id="cb337-4259"><a href="#cb337-4259" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>In this case, $\text{the Hazard Ratio(HR) is} \exp(\beta_1)$</span>
<span id="cb337-4260"><a href="#cb337-4260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4261"><a href="#cb337-4261" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Prortional Hazards Assumption</span></span>
<span id="cb337-4262"><a href="#cb337-4262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4263"><a href="#cb337-4263" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The Cox model is also called the Cox proportional hazards model because there is a very strong and important assumption that the needs to be satisfied, if we want to use this model, and this assumption is called the **Proportional hazards assumption**</span>
<span id="cb337-4264"><a href="#cb337-4264" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If we take a group of individuals that are in an exposed group and we take the ratio as a function of this group of exposed individuals with respect to their hazard function, to an unexposed group of individuals, the ratio needs to be constant over time.</span>
<span id="cb337-4265"><a href="#cb337-4265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4266"><a href="#cb337-4266" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4267"><a href="#cb337-4267" aria-hidden="true" tabindex="-1"></a>\text{Proportional hazards assumption:} \frac{h(t)_{exposed}}{h(t)_{unexposed}} \text{ is constant over time.} </span>
<span id="cb337-4268"><a href="#cb337-4268" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4269"><a href="#cb337-4269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4270"><a href="#cb337-4270" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Suppose that a group of cancer patients on an experimental treatment for 10 years.</span>
<span id="cb337-4271"><a href="#cb337-4271" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the hazard of dying for the $\text{non-treated group}$ is twice the rate as that of the $\text{treated group(HR=2.0)}$, the proportional-hazards assumption implies that this ratio is the same at 1 year, at 2 years, or at any point on the time scale.</span>
<span id="cb337-4272"><a href="#cb337-4272" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Because the Cox model, by definition, is constrained to follow this assumption, it is important to evaluate its validity.</span>
<span id="cb337-4273"><a href="#cb337-4273" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If there is *violation* of the Cox proportional hazard assumption, this implies that there are *time-varying coefficients* in the model, or valid for a particular certain time points but not for all time points in the study.</span>
<span id="cb337-4274"><a href="#cb337-4274" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It is important not to confuse *time dependent coefficients* with time *dependent covariates*. They are two different concepts.</span>
<span id="cb337-4275"><a href="#cb337-4275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4276"><a href="#cb337-4276" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Unadjusted Cox regression</span></span>
<span id="cb337-4277"><a href="#cb337-4277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4278"><a href="#cb337-4278" aria-hidden="true" tabindex="-1"></a>The <span class="in">`coxph()`</span> command is used to run a Cox proportional hazards regression model in R. The simplified syntax of the <span class="in">`coxph()`</span> command is the following: <span class="in">`coxph(formula, data)`</span></span>
<span id="cb337-4279"><a href="#cb337-4279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4280"><a href="#cb337-4280" aria-hidden="true" tabindex="-1"></a>The formula used in the <span class="in">`coxph()`</span> command needs a survival object as dependent variable which is created using the <span class="in">`Surv()`</span> command. The syntax of the <span class="in">`Surv()`</span> command is the following: <span class="in">`Surv(time, event)`</span></span>
<span id="cb337-4281"><a href="#cb337-4281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4282"><a href="#cb337-4282" aria-hidden="true" tabindex="-1"></a>where time is the follow-up time per individual and event is the disease/outcome status per individual.</span>
<span id="cb337-4283"><a href="#cb337-4283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4284"><a href="#cb337-4284" aria-hidden="true" tabindex="-1"></a>For example, we can examine the effect of frailty on the risk of death. Frailty is measured using a quantitative scale and it would be better to treat it as a categorical variable:</span>
<span id="cb337-4285"><a href="#cb337-4285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4288"><a href="#cb337-4288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4289"><a href="#cb337-4289" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb337-4290"><a href="#cb337-4290" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb337-4291"><a href="#cb337-4291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4292"><a href="#cb337-4292" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>frailty <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(whitehall<span class="sc">$</span>frailty)</span>
<span id="cb337-4293"><a href="#cb337-4293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4294"><a href="#cb337-4294" aria-hidden="true" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> frailty, <span class="at">data =</span> whitehall) </span>
<span id="cb337-4295"><a href="#cb337-4295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4296"><a href="#cb337-4296" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m6)</span>
<span id="cb337-4297"><a href="#cb337-4297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4298"><a href="#cb337-4298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4299"><a href="#cb337-4299" aria-hidden="true" tabindex="-1"></a>*Looking at the output, you can see that the hazard of dying is nearly 6 times greater for participants in frailty level 5 compared with frailty level 1 (HR 5.7, 95% CI:4.8-6.8). This is statistically significant.*</span>
<span id="cb337-4300"><a href="#cb337-4300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4301"><a href="#cb337-4301" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Question C2.3a.i:</span></span>
<span id="cb337-4302"><a href="#cb337-4302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4303"><a href="#cb337-4303" aria-hidden="true" tabindex="-1"></a>What is association of vitamin D (using the variable coded above and below the median) with the risk (hazard) of dying?</span>
<span id="cb337-4304"><a href="#cb337-4304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4307"><a href="#cb337-4307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4308"><a href="#cb337-4308" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb337-4309"><a href="#cb337-4309" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb337-4310"><a href="#cb337-4310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4311"><a href="#cb337-4311" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>vitd_med <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(whitehall<span class="sc">$</span>vitd_med)</span>
<span id="cb337-4312"><a href="#cb337-4312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4313"><a href="#cb337-4313" aria-hidden="true" tabindex="-1"></a>m7 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> vitd_med, <span class="at">data =</span> whitehall) </span>
<span id="cb337-4314"><a href="#cb337-4314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4315"><a href="#cb337-4315" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m7)</span>
<span id="cb337-4316"><a href="#cb337-4316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4317"><a href="#cb337-4317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4318"><a href="#cb337-4318" aria-hidden="true" tabindex="-1"></a>*Participants that have vitamin D concentrations above the median have a 43% lower hazard (or risk) of dying, and this is statistically significant (HR 0.57, 95% CI: 0.51-0.63).*</span>
<span id="cb337-4319"><a href="#cb337-4319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4320"><a href="#cb337-4320" aria-hidden="true" tabindex="-1"></a><span class="fu">### Test the Proportional Hazards Assumption (PHA)</span></span>
<span id="cb337-4321"><a href="#cb337-4321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4322"><a href="#cb337-4322" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb337-4323"><a href="#cb337-4323" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learning Objectives:</span></span>
<span id="cb337-4324"><a href="#cb337-4324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4325"><a href="#cb337-4325" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-4326"><a href="#cb337-4326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4327"><a href="#cb337-4327" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Test Proportionality Hazards Assumption</span>
<span id="cb337-4328"><a href="#cb337-4328" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Learn some solutions in case of violations of proportionality hazards assumption.</span>
<span id="cb337-4329"><a href="#cb337-4329" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-4330"><a href="#cb337-4330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4331"><a href="#cb337-4331" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dealing with violation of PHA</span></span>
<span id="cb337-4332"><a href="#cb337-4332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4333"><a href="#cb337-4333" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Violation implies that there are time-varying coefficients in the model. To deal with this:</span>
<span id="cb337-4334"><a href="#cb337-4334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4335"><a href="#cb337-4335" aria-hidden="true" tabindex="-1"></a>Two solutions:</span>
<span id="cb337-4336"><a href="#cb337-4336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4337"><a href="#cb337-4337" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Stratify** by the offending variable- fit separate models across the levels of the variable (Strata option)</span>
<span id="cb337-4338"><a href="#cb337-4338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4339"><a href="#cb337-4339" aria-hidden="true" tabindex="-1"></a>or</span>
<span id="cb337-4340"><a href="#cb337-4340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4341"><a href="#cb337-4341" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**model** the offending variable as the **time-varying coefficient(s).**</span>
<span id="cb337-4342"><a href="#cb337-4342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4343"><a href="#cb337-4343" aria-hidden="true" tabindex="-1"></a>There are many similarities between Cox regression and linear and logistic regression. We have seen that you can adjust for additional variables in the same way. You can also fit interactions using the same commands. However, the one key difference between a Cox regression and other regression models is the *proportional hazards assumption*.</span>
<span id="cb337-4344"><a href="#cb337-4344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4345"><a href="#cb337-4345" aria-hidden="true" tabindex="-1"></a>The proportional hazards assumption states that hazard ratio (comparing levels of an exposure variable) is constant over time. This assumption needs to be tested. The lecture explained 3 ways to do this: fitting an interaction with time, examining the residuals with a log-log plot and testing the residuals for a correlation with time. In practice, generally just choosing one method to use is sufficient.</span>
<span id="cb337-4346"><a href="#cb337-4346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4347"><a href="#cb337-4347" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Fitting an interaction with time</span></span>
<span id="cb337-4348"><a href="#cb337-4348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4349"><a href="#cb337-4349" aria-hidden="true" tabindex="-1"></a>If the PH assumption is violated, it means that the hazard ratio is not constant over time, i.e. there is an interaction between a covariate and time. Thus, we can fit a Cox model with a time interaction in it and see if this is significant. We can also use a likelihood ratio (LR) test to see if a model with a time-varying covariate fits better than one without. In R, the interaction of a covariate with time can be fitted by using the time-transform functionality <span class="in">`tt()`</span> in the <span class="in">`coxph()`</span> command.</span>
<span id="cb337-4350"><a href="#cb337-4350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4353"><a href="#cb337-4353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4354"><a href="#cb337-4354" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb337-4355"><a href="#cb337-4355" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb337-4356"><a href="#cb337-4356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4357"><a href="#cb337-4357" aria-hidden="true" tabindex="-1"></a>whitehall<span class="sc">$</span>age_grp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(whitehall<span class="sc">$</span>age_grp)</span>
<span id="cb337-4358"><a href="#cb337-4358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4359"><a href="#cb337-4359" aria-hidden="true" tabindex="-1"></a>m8 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> frailty <span class="sc">+</span> age_grp <span class="sc">+</span> <span class="fu">tt</span>(age_grp), <span class="at">data =</span> whitehall)</span>
<span id="cb337-4360"><a href="#cb337-4360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4361"><a href="#cb337-4361" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m8)</span>
<span id="cb337-4362"><a href="#cb337-4362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4363"><a href="#cb337-4363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4364"><a href="#cb337-4364" aria-hidden="true" tabindex="-1"></a>*When we look at the p-value for the coefficient in the tt(age_grp) row, we see that it is significant (p=0.03). This suggests there is a significant interaction with time, which indicates the HR for age group is not constant over time.*</span>
<span id="cb337-4365"><a href="#cb337-4365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4366"><a href="#cb337-4366" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Inspecting log-log plots</span></span>
<span id="cb337-4367"><a href="#cb337-4367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4368"><a href="#cb337-4368" aria-hidden="true" tabindex="-1"></a>To compute a log-log plot, we should compute the survival curves for our variable using the <span class="in">`survfit()`</span> command and then we can print the log-log plot using the <span class="in">`ggsurvplot()`</span> command.</span>
<span id="cb337-4369"><a href="#cb337-4369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4370"><a href="#cb337-4370" aria-hidden="true" tabindex="-1"></a>A log-log plot for age group is computed using the command below:</span>
<span id="cb337-4371"><a href="#cb337-4371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4374"><a href="#cb337-4374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4375"><a href="#cb337-4375" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb337-4376"><a href="#cb337-4376" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb337-4377"><a href="#cb337-4377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4378"><a href="#cb337-4378" aria-hidden="true" tabindex="-1"></a>m9 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> frailty <span class="sc">+</span> <span class="fu">strata</span>(age_grp), <span class="at">data =</span> whitehall)</span>
<span id="cb337-4379"><a href="#cb337-4379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4380"><a href="#cb337-4380" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(m9)</span>
<span id="cb337-4381"><a href="#cb337-4381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4382"><a href="#cb337-4382" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">data =</span> whitehall, <span class="at">fun =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb337-4383"><a href="#cb337-4383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4384"><a href="#cb337-4384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4385"><a href="#cb337-4385" aria-hidden="true" tabindex="-1"></a>*When we inspect a log-log plot, we want to see that the curves in the main portion of the plot (i.e. not the tails of the plot, where there are few events) are generally parallel over time. If the curves touch or cross, this indicates there is a violation of the PH assumption.*</span>
<span id="cb337-4386"><a href="#cb337-4386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4387"><a href="#cb337-4387" aria-hidden="true" tabindex="-1"></a>*Looking at the curves for each level of age group above, they appear to be generally parallel with similar slopes over time. This looks acceptable and does not indicate a meaningful violation of the PH assumption. This may contradict the results of the tt() command above as statistical tests will often be significant for small deviations if you have a lot of power (e.g. if you have a large dataset). For this reason, we often prefer to visually inspect the data for obvious violations of the PH assumption.*</span>
<span id="cb337-4388"><a href="#cb337-4388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4389"><a href="#cb337-4389" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Testing the residuals for a correlation with time</span></span>
<span id="cb337-4390"><a href="#cb337-4390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4391"><a href="#cb337-4391" aria-hidden="true" tabindex="-1"></a>The PH assumption can be also assessed using a statistical test based on the scaled Schoenfeld residuals. In principle, Schoenfeld residuals are independent of time. If a plot shows that Schoenfeld residuals are distributed in a non-random pattern against time, this is evidence of violation of the PH assumption.</span>
<span id="cb337-4392"><a href="#cb337-4392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4393"><a href="#cb337-4393" aria-hidden="true" tabindex="-1"></a>We can test the proportional hazards assumption for each covariate in a Cox model using the <span class="in">`cox.zph()`</span> command.</span>
<span id="cb337-4394"><a href="#cb337-4394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4395"><a href="#cb337-4395" aria-hidden="true" tabindex="-1"></a>In a cox model including <span class="in">`age_grp`</span> and <span class="in">`frailty`</span> as covariates, we can examine if any of these variables violate the PH assumption by running the following command:</span>
<span id="cb337-4396"><a href="#cb337-4396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4399"><a href="#cb337-4399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4400"><a href="#cb337-4400" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb337-4401"><a href="#cb337-4401" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb337-4402"><a href="#cb337-4402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4403"><a href="#cb337-4403" aria-hidden="true" tabindex="-1"></a>m10 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> frailty <span class="sc">+</span> age_grp, <span class="at">data =</span> whitehall)</span>
<span id="cb337-4404"><a href="#cb337-4404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4405"><a href="#cb337-4405" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(m10)</span>
<span id="cb337-4406"><a href="#cb337-4406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4407"><a href="#cb337-4407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4408"><a href="#cb337-4408" aria-hidden="true" tabindex="-1"></a>*The cox.zph() command has two outputs. The first one is a chi-squared test and a p-value for testing the violation of PH assumption for each one of the variables included in the cox model. The second one is a global chi-squared test and a p-value for testing if there is any variable in our model that violates the PH assumption.*</span>
<span id="cb337-4409"><a href="#cb337-4409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4410"><a href="#cb337-4410" aria-hidden="true" tabindex="-1"></a>*We observe that both frailty and age_grp variables violate the PH assumption.*</span>
<span id="cb337-4411"><a href="#cb337-4411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4412"><a href="#cb337-4412" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Question C2.3b:</span></span>
<span id="cb337-4413"><a href="#cb337-4413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4414"><a href="#cb337-4414" aria-hidden="true" tabindex="-1"></a>Interpret a log-log plot for frailty (adjusted for age group) and assess if it violates the PH assumption.</span>
<span id="cb337-4415"><a href="#cb337-4415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4418"><a href="#cb337-4418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4419"><a href="#cb337-4419" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb337-4420"><a href="#cb337-4420" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb337-4421"><a href="#cb337-4421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4422"><a href="#cb337-4422" aria-hidden="true" tabindex="-1"></a>m11 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> <span class="fu">strata</span>(frailty) <span class="sc">+</span> age_grp, <span class="at">data =</span> whitehall)</span>
<span id="cb337-4423"><a href="#cb337-4423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4424"><a href="#cb337-4424" aria-hidden="true" tabindex="-1"></a>fit7 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(m11)</span>
<span id="cb337-4425"><a href="#cb337-4425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4426"><a href="#cb337-4426" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit7, <span class="at">data =</span> whitehall, <span class="at">fun =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb337-4427"><a href="#cb337-4427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4428"><a href="#cb337-4428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4429"><a href="#cb337-4429" aria-hidden="true" tabindex="-1"></a>*In this log-log plot, we see the curves for the different levels of frailty (levels 1-4) criss-cross and touch each other at several points over time. This is a clearer violation of the PH assumption.*</span>
<span id="cb337-4430"><a href="#cb337-4430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4431"><a href="#cb337-4431" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Fixing violations in the PH assumption</span></span>
<span id="cb337-4432"><a href="#cb337-4432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4433"><a href="#cb337-4433" aria-hidden="true" tabindex="-1"></a>If the PH assumption has been violated for a covariate, we can fit a stratified Cox model where we stratify by the covariate that violates the PH assumption.</span>
<span id="cb337-4434"><a href="#cb337-4434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4435"><a href="#cb337-4435" aria-hidden="true" tabindex="-1"></a>To stratify a Cox model by a specific variable, we use the <span class="in">`strata()`</span> command from the <span class="in">`survival`</span> R package.</span>
<span id="cb337-4436"><a href="#cb337-4436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4439"><a href="#cb337-4439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4440"><a href="#cb337-4440" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb337-4441"><a href="#cb337-4441" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb337-4442"><a href="#cb337-4442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4443"><a href="#cb337-4443" aria-hidden="true" tabindex="-1"></a>m12 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(fu_years, death) <span class="sc">~</span> <span class="fu">strata</span>(frailty) <span class="sc">+</span> age_grp, <span class="at">data =</span> whitehall)</span>
<span id="cb337-4444"><a href="#cb337-4444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4445"><a href="#cb337-4445" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m12)</span>
<span id="cb337-4446"><a href="#cb337-4446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4447"><a href="#cb337-4447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4448"><a href="#cb337-4448" aria-hidden="true" tabindex="-1"></a>*Notice that you do not get any output regarding the variable ‘frailty’ that you stratified on, although R indicates in the formula that you have used this variable in the strata. You would still interpret the HR of age_grp as having been adjusted for frailty, though. So you would say that the hazard of dying was 4.3 times greater in the 81-95 age group compared to the 60-70 age group, once it was adjusted for frailty (as stratifying on a variable is another way to adjust for its association).*</span>
<span id="cb337-4449"><a href="#cb337-4449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4450"><a href="#cb337-4450" aria-hidden="true" tabindex="-1"></a><span class="fu">## C2.4 Poisson Regression</span></span>
<span id="cb337-4451"><a href="#cb337-4451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4452"><a href="#cb337-4452" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb337-4453"><a href="#cb337-4453" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learning Objectives:</span></span>
<span id="cb337-4454"><a href="#cb337-4454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4455"><a href="#cb337-4455" aria-hidden="true" tabindex="-1"></a>By the end of this section, students will be able to:</span>
<span id="cb337-4456"><a href="#cb337-4456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4457"><a href="#cb337-4457" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Open datasets in their chosen statistical software programme</span>
<span id="cb337-4458"><a href="#cb337-4458" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explore datasets and understand what data they have</span>
<span id="cb337-4459"><a href="#cb337-4459" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use basic commands to edit their data</span>
<span id="cb337-4460"><a href="#cb337-4460" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb337-4461"><a href="#cb337-4461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4462"><a href="#cb337-4462" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Use of Poisson Regression</span></span>
<span id="cb337-4463"><a href="#cb337-4463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4464"><a href="#cb337-4464" aria-hidden="true" tabindex="-1"></a>There are several situations where Poisson regression can be useful. It can be use to:</span>
<span id="cb337-4465"><a href="#cb337-4465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4466"><a href="#cb337-4466" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Obtain rates and their rtios from **Cohort studies or RCTs** in which person-time varies across individuals.</span>
<span id="cb337-4467"><a href="#cb337-4467" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>It is important to obtain a **value for rates** as well as rate ratios (See Cox regression, in which rates are not estimates).</span>
<span id="cb337-4468"><a href="#cb337-4468" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>It is reasonable to assume that **rates are constant** over time, or within time bands.</span>
<span id="cb337-4469"><a href="#cb337-4469" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Poisson regression can also be used for analysis of count e.g number of admissions per day in a hospital.</span>
<span id="cb337-4470"><a href="#cb337-4470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4471"><a href="#cb337-4471" aria-hidden="true" tabindex="-1"></a>Here, we show a Poisson regression modelling the log(rate of disease) as the outcome.</span>
<span id="cb337-4472"><a href="#cb337-4472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4473"><a href="#cb337-4473" aria-hidden="true" tabindex="-1"></a>In R, we can use the <span class="in">`glm()`</span> command to fit a Poisson regression model as follows: <span class="in">`glm(formula, data, family = poisson(link = “log”))`</span></span>
<span id="cb337-4474"><a href="#cb337-4474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4475"><a href="#cb337-4475" aria-hidden="true" tabindex="-1"></a>The command <span class="in">`glm()`</span> is the same command that was used to fit a logistic regression model in the previous module. The only difference is that in Poisson regression we use the family <span class="in">`poisson(link = “log”)`</span>, whereas in logistic regression we use the family <span class="in">`binomial(link = “logit”)`</span>. Note that we use the offset(time) when we specify the formula of the Poisson regression to specify follow-up time. If you do not use the <span class="in">`offset(time)`</span> to specify the period of follow-up time, then you will be analysing a log(count) <span class="sc">\[</span>rather than rate<span class="sc">\]</span>.</span>
<span id="cb337-4476"><a href="#cb337-4476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4477"><a href="#cb337-4477" aria-hidden="true" tabindex="-1"></a><span class="fu">#### For example</span></span>
<span id="cb337-4478"><a href="#cb337-4478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4479"><a href="#cb337-4479" aria-hidden="true" tabindex="-1"></a>To estimate the incidence rate ratio of death for current smokers compared to non-smokers, we run the following command:</span>
<span id="cb337-4480"><a href="#cb337-4480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4483"><a href="#cb337-4483" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4484"><a href="#cb337-4484" aria-hidden="true" tabindex="-1"></a>model12 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(fu_years)) <span class="sc">+</span> currsmoker, <span class="at">data =</span> whitehall, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb337-4485"><a href="#cb337-4485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4486"><a href="#cb337-4486" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model12)</span>
<span id="cb337-4487"><a href="#cb337-4487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4488"><a href="#cb337-4488" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(model12), <span class="fu">confint</span>(model12)))</span>
<span id="cb337-4489"><a href="#cb337-4489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4490"><a href="#cb337-4490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4491"><a href="#cb337-4491" aria-hidden="true" tabindex="-1"></a>*The estimate in the row for ‘currsmoker’ is the rate ratio of death for current smokers compared to non-smokers. This output shows that the rate of death is 18% higher in current smokers compared to non-smokers (RR 1.18, 95% CI: 1.03-1.37). This association is statistically significant (p=0.02).*</span>
<span id="cb337-4492"><a href="#cb337-4492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4493"><a href="#cb337-4493" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Assumptions of Poisson regression</span></span>
<span id="cb337-4494"><a href="#cb337-4494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4495"><a href="#cb337-4495" aria-hidden="true" tabindex="-1"></a>There are some assumptions that needs to be satisfied in order to use a Poisson model.</span>
<span id="cb337-4496"><a href="#cb337-4496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4497"><a href="#cb337-4497" aria-hidden="true" tabindex="-1"></a>We can use the Poisson model when:</span>
<span id="cb337-4498"><a href="#cb337-4498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4499"><a href="#cb337-4499" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Events (counts) follows a poisson distribution.</span>
<span id="cb337-4500"><a href="#cb337-4500" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Events (counts) are independent of one another.</span>
<span id="cb337-4501"><a href="#cb337-4501" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Rates in different groups are proportional (See also Cox regression).</span>
<span id="cb337-4502"><a href="#cb337-4502" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Also, Poisson regression requires that within an exposure group such as smokers or non-smokers, the rate of the event of interest (such as death) stays constant over time, a very strong assumption. A cohort study often involves follow-up over many years and it is unrealistic, because of changes in age, to assume that the rate stays unchanged over follow-up.</span>
<span id="cb337-4503"><a href="#cb337-4503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4504"><a href="#cb337-4504" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Poisson Regression Model</span></span>
<span id="cb337-4505"><a href="#cb337-4505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4506"><a href="#cb337-4506" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In Poisson regression, we model the log(rate of disease) as the outcome:</span>
<span id="cb337-4507"><a href="#cb337-4507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4508"><a href="#cb337-4508" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4509"><a href="#cb337-4509" aria-hidden="true" tabindex="-1"></a>log(\text{rate of disease}) = \beta_o + \beta_1X_1</span>
<span id="cb337-4510"><a href="#cb337-4510" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4511"><a href="#cb337-4511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4512"><a href="#cb337-4512" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4513"><a href="#cb337-4513" aria-hidden="true" tabindex="-1"></a>\exp(\beta_o) = \text{ratebin unexposed group,} \exp(\beta_1) = \text{rate ratio}</span>
<span id="cb337-4514"><a href="#cb337-4514" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4515"><a href="#cb337-4515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4516"><a href="#cb337-4516" aria-hidden="true" tabindex="-1"></a>Poisson regression model assumes that the events occur following POisson distribution.</span>
<span id="cb337-4517"><a href="#cb337-4517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4518"><a href="#cb337-4518" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Same Model</span></span>
<span id="cb337-4519"><a href="#cb337-4519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4520"><a href="#cb337-4520" aria-hidden="true" tabindex="-1"></a>A Poisson model can be written in many different ways. For examples, we can represents it as follows:</span>
<span id="cb337-4521"><a href="#cb337-4521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4522"><a href="#cb337-4522" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4523"><a href="#cb337-4523" aria-hidden="true" tabindex="-1"></a>log(\text{rate of disease}) = \beta_o + \beta_1X_1 + \beta_2X_2+\dots</span>
<span id="cb337-4524"><a href="#cb337-4524" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4525"><a href="#cb337-4525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4526"><a href="#cb337-4526" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4527"><a href="#cb337-4527" aria-hidden="true" tabindex="-1"></a>log(\text{events| time}) = \beta_o + \beta_1X_1 + \beta_2X_2+\dots</span>
<span id="cb337-4528"><a href="#cb337-4528" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4529"><a href="#cb337-4529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4530"><a href="#cb337-4530" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4531"><a href="#cb337-4531" aria-hidden="true" tabindex="-1"></a>log(events) - log (time) = \beta_o + \beta_1X_1 + \beta_2X_2+\dots</span>
<span id="cb337-4532"><a href="#cb337-4532" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4533"><a href="#cb337-4533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4534"><a href="#cb337-4534" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4535"><a href="#cb337-4535" aria-hidden="true" tabindex="-1"></a>log(events) = \beta_o + \beta_1X_1 + \beta_2X_2+\dots + log (time)</span>
<span id="cb337-4536"><a href="#cb337-4536" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb337-4537"><a href="#cb337-4537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4538"><a href="#cb337-4538" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Question C2.4:</span></span>
<span id="cb337-4539"><a href="#cb337-4539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4540"><a href="#cb337-4540" aria-hidden="true" tabindex="-1"></a>Use a Poisson regression to assess if current smoking associated with the rate of death, once adjusted for age group and frailty?</span>
<span id="cb337-4541"><a href="#cb337-4541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4544"><a href="#cb337-4544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb337-4545"><a href="#cb337-4545" aria-hidden="true" tabindex="-1"></a>m13 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(fu_years)) <span class="sc">+</span> currsmoker <span class="sc">+</span> age_grp <span class="sc">+</span> frailty, <span class="at">data =</span> whitehall, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb337-4546"><a href="#cb337-4546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4547"><a href="#cb337-4547" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m13)</span>
<span id="cb337-4548"><a href="#cb337-4548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4549"><a href="#cb337-4549" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(m13), <span class="fu">confint</span>(m13)))</span>
<span id="cb337-4550"><a href="#cb337-4550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb337-4551"><a href="#cb337-4551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4552"><a href="#cb337-4552" aria-hidden="true" tabindex="-1"></a>*The rate of death is 25% higher in current smokers compared to non-smokers, once adjusted for age group and frailty (RR 1.25, 95% CI: 1.09-1.43). This association is statistically significant (p=0.002).*</span>
<span id="cb337-4553"><a href="#cb337-4553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4554"><a href="#cb337-4554" aria-hidden="true" tabindex="-1"></a>The detailed explanation each section of the output from a Poisson regression model is as follows:</span>
<span id="cb337-4555"><a href="#cb337-4555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4556"><a href="#cb337-4556" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Model Call</span>
<span id="cb337-4557"><a href="#cb337-4557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4558"><a href="#cb337-4558" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The model is a Poisson regression using death as the outcome variable, with the log link function.</span>
<span id="cb337-4559"><a href="#cb337-4559" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Predictors include:</span>
<span id="cb337-4560"><a href="#cb337-4560" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**offset(log(fu_years))**: An offset term that adjusts for follow-up time (<span class="in">`fu_years`</span>) in log scale, effectively modeling rates instead of simple counts.</span>
<span id="cb337-4561"><a href="#cb337-4561" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**currsmoker**: Indicator for current smoking status.</span>
<span id="cb337-4562"><a href="#cb337-4562" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**age_grp**: Categorical variable indicating age groups, with several levels (<span class="in">`age_grp2`</span>, <span class="in">`age_grp3`</span>, <span class="in">`age_grp4`</span>) comparing each age group to the reference (likely the youngest age group).</span>
<span id="cb337-4563"><a href="#cb337-4563" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**frailty**: Categorical variable indicating frailty levels, with levels (<span class="in">`frailty2`</span>, <span class="in">`frailty3`</span>, etc.) compared to a reference group (likely the lowest frailty level).</span>
<span id="cb337-4564"><a href="#cb337-4564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4565"><a href="#cb337-4565" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Deviance Residuals</span>
<span id="cb337-4566"><a href="#cb337-4566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4567"><a href="#cb337-4567" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These show the distribution of residuals from the model:</span>
<span id="cb337-4568"><a href="#cb337-4568" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Residuals range from -2.0348 to 3.2916, with a median near zero, indicating a reasonable but not perfect fit for most observations.</span>
<span id="cb337-4569"><a href="#cb337-4569" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Deviance residuals closer to zero indicate better fit for individual data points.</span>
<span id="cb337-4570"><a href="#cb337-4570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4571"><a href="#cb337-4571" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Coefficients Table</span>
<span id="cb337-4572"><a href="#cb337-4572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4573"><a href="#cb337-4573" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Each predictor has an **Estimate**, **Standard Error**, **z value**, and **Pr(\&gt;\|z\|)** (p-value).</span>
<span id="cb337-4574"><a href="#cb337-4574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4575"><a href="#cb337-4575" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Here’s what each of these columns represents:</span>
<span id="cb337-4576"><a href="#cb337-4576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4577"><a href="#cb337-4577" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Estimate**: The log-rate ratio associated with each predictor.</span>
<span id="cb337-4578"><a href="#cb337-4578" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Std. Error**: The standard error of each estimate.</span>
<span id="cb337-4579"><a href="#cb337-4579" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**z value**: The test statistic for each coefficient $(Estimate/Std.Error)$.</span>
<span id="cb337-4580"><a href="#cb337-4580" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Pr(\&gt;\|z\|)**: The p-value indicating statistical significance.<span class="sc">\*</span></span>
<span id="cb337-4581"><a href="#cb337-4581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4582"><a href="#cb337-4582" aria-hidden="true" tabindex="-1"></a>**Interpretation of Key Predictors**:</span>
<span id="cb337-4583"><a href="#cb337-4583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4584"><a href="#cb337-4584" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**(Intercept)**: The intercept is -4.35993. Exponentiating this (<span class="in">`exp(-4.35993) ≈ 0.0128`</span>) gives the baseline event rate for individuals in the reference categories of <span class="in">`currsmoker`</span>, <span class="in">`age_grp`</span>, and <span class="in">`frailty`</span>.</span>
<span id="cb337-4585"><a href="#cb337-4585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4586"><a href="#cb337-4586" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**currsmoker**: The estimate for currsmoker is 0.22259, indicating that current smokers have a higher death rate compared to non-smokers.</span>
<span id="cb337-4587"><a href="#cb337-4587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4588"><a href="#cb337-4588" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Exponentiating** gives <span class="in">`exp(0.22259) ≈ 1.25`</span>, so current smokers have a 25% higher death rate than non-smokers.</span>
<span id="cb337-4589"><a href="#cb337-4589" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The p-value (0.00239) indicates this effect is statistically significant at the 0.01 level.</span>
<span id="cb337-4590"><a href="#cb337-4590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4591"><a href="#cb337-4591" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**age_grp**: The coefficients for <span class="in">`age_grp2`</span>, <span class="in">`age_grp3`</span>, and <span class="in">`age_grp4`</span> indicate that death rates increase with age:</span>
<span id="cb337-4592"><a href="#cb337-4592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4593"><a href="#cb337-4593" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**age_grp2** (second age group) has a log-rate ratio of 0.5499, or about 73% higher death rate than the reference age group <span class="in">`(exp(0.5499) ≈ 1.73)`</span>.</span>
<span id="cb337-4594"><a href="#cb337-4594" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**age_grp3** has a rate ratio of <span class="in">`exp(0.94373) ≈ 2.57`</span>, or a 157% higher death rate.</span>
<span id="cb337-4595"><a href="#cb337-4595" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**age_grp4** has a rate ratio of <span class="in">`exp(1.38579) ≈ 4.00`</span>, or a 300% higher death rate.</span>
<span id="cb337-4596"><a href="#cb337-4596" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>All age groups have highly significant p-values, showing that increased age is strongly associated with higher death rates.</span>
<span id="cb337-4597"><a href="#cb337-4597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4598"><a href="#cb337-4598" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**frailty**: The coefficients for <span class="in">`frailty2`</span>, <span class="in">`frailty3`</span>, etc., indicate that higher frailty levels are associated with increasing death rates compared to the reference frailty level:</span>
<span id="cb337-4599"><a href="#cb337-4599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4600"><a href="#cb337-4600" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**frailty2** has a rate ratio of <span class="in">`exp(0.26967) ≈ 1.31`</span>, or a 31% higher death rate.</span>
<span id="cb337-4601"><a href="#cb337-4601" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**frailty3** has a rate ratio of <span class="in">`exp(0.46882) ≈ 1.60`</span>.</span>
<span id="cb337-4602"><a href="#cb337-4602" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**frailty4** has a rate ratio of <span class="in">`exp(0.76742) ≈ 2.15`</span>.</span>
<span id="cb337-4603"><a href="#cb337-4603" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**frailty5** has the highest rate ratio, <span class="in">`exp(1.33908) ≈ 3.82`</span>, or a 282% higher death rate.</span>
<span id="cb337-4604"><a href="#cb337-4604" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>These coefficients are significant, indicating that as frailty increases, so does the risk of death.</span>
<span id="cb337-4605"><a href="#cb337-4605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4606"><a href="#cb337-4606" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Significance Codes</span>
<span id="cb337-4607"><a href="#cb337-4607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4608"><a href="#cb337-4608" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The stars next to the p-values indicate the level of significance:</span>
<span id="cb337-4609"><a href="#cb337-4609" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="sc">\*\*\*</span> for p <span class="sc">\&lt;</span> 0.001, <span class="sc">\*\*</span> for p <span class="sc">\&lt;</span> 0.01, <span class="sc">\*</span> for p <span class="sc">\&lt;</span> 0.05.</span>
<span id="cb337-4610"><a href="#cb337-4610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4611"><a href="#cb337-4611" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Deviance and AIC</span>
<span id="cb337-4612"><a href="#cb337-4612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4613"><a href="#cb337-4613" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Null deviance**: 5138.5 on 4320 degrees of freedom, representing the deviance for a model with only an intercept.</span>
<span id="cb337-4614"><a href="#cb337-4614" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Residual deviance**: 4352.0 on 4312 degrees of freedom, showing the deviance for the fitted model with all predictors.</span>
<span id="cb337-4615"><a href="#cb337-4615" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A large drop in deviance (from 5138.5 to 4352.0) indicates a substantial improvement in model fit over the null model.</span>
<span id="cb337-4616"><a href="#cb337-4616" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**AIC**: 7412, a measure of model quality, with lower values indicating a better fit after accounting for model complexity.</span>
<span id="cb337-4617"><a href="#cb337-4617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4618"><a href="#cb337-4618" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>Fisher Scoring Iterations</span>
<span id="cb337-4619"><a href="#cb337-4619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4620"><a href="#cb337-4620" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The model took 6 iterations to converge, suggesting that the fitting process was stable.</span>
<span id="cb337-4621"><a href="#cb337-4621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4622"><a href="#cb337-4622" aria-hidden="true" tabindex="-1"></a><span class="fu">###### Summary Interpretation</span></span>
<span id="cb337-4623"><a href="#cb337-4623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4624"><a href="#cb337-4624" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The model suggests that current smoking status, age group, and frailty level are all significant predictors of the death rate.</span>
<span id="cb337-4625"><a href="#cb337-4625" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Current smokers, older age groups, and individuals with higher frailty levels have significantly higher death rates, even after accounting for follow-up time.</span>
<span id="cb337-4626"><a href="#cb337-4626" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The model fit (as indicated by the decrease in deviance and the AIC) is much improved over the null model, showing that these predictors are valuable for explaining variations in death rates.</span>
<span id="cb337-4627"><a href="#cb337-4627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4628"><a href="#cb337-4628" aria-hidden="true" tabindex="-1"></a><span class="fu"># Reference</span></span>
<span id="cb337-4629"><a href="#cb337-4629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4630"><a href="#cb337-4630" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fundamentals of Statistical Software &amp; Analysis by Oxford Population Health, University of Oxford Medical Sciences Division.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>